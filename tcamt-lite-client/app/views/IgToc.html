<div ui-tree>
    <ol ui-tree-nodes="" ng-model="integrationAbstractProfiles">
        <li ng-repeat="ip in integrationAbstractProfiles" ui-tree-node data-nodrag>
            <div ui-tree-handle ng-class="{selected : this.$modelValue===activeModel,used:selectedTestStep&&selectedTestStep.integrationProfileId===this.$modelValue.id}" title="{{ip.metaData.name}}">
     <i data-nodrag ng-click="toggle(this)" class="fa" ng-class="{'fa-caret-right': collapsed, 'fa-caret-down': !collapsed}">
					</i>
                  </span> <span ng-click="Activate(this);OpenIgMetadata(ip);"> <span class="label label-info label-icon">IP</span> {{ip.metaData.title}}</span>
            </div>
            <ol ui-tree-nodes="" ng-model="ip.profile.messages.children" ng-if="!collapsed">
                <li ng-repeat="msg in ip.profile.messages.children |filter:sr" ui-tree-node>
                    <div ui-tree-handle ng-click="selectIg(msg, ip);Activate(this);" ng-class="{selected : this.$modelValue===activeModel ,used:selectedTestStep&& selectedTestStep.conformanceProfileId===this.$modelValue.id || selectedTemplate.conformanceProfileId===this.$modelValue.id}" title="{{msg.name}}">
                        <span ng-hide="selectedTestStep"><span class="label label-success label-icon">CP</span>{{msg.structID}}-{{msg.name}}-{{msg.identifier}}</span>
                        <span context-menu="ApplyProfile" ng-hide="!selectedTestStep"><span class="label label-success label-icon">CP</span>{{msg.structID}}-{{msg.name}}-{{msg.identifier}}</span>
                    </div>
                </li>
            </ol>
        </li>
    </ol>
</div>
<script type="text/ng-template" id="EditDocumentMetadata.html">
    <div ng-controller="TestPlanCtrl" ng-init="init()">
<div class="container">
        <div class="container">
            <div ng-show="igDocument.metaData !== null">
                <div class="page-header" style="margin-bottom: 20px">
                    <span class="header4">Document metaData</span>
                </div>
                <div class="form-group control-group container" ng-class="{'igl-has-error has-feedback' : editForm.title.$invalid}">
                    <label class="col-md-2 control-label">Title</label>
                    <div class="controls col-md-10">
                        <input class="form-control" type="text" ng-disabled="true" ng-change="setDirty()" name="title" ng-model="igDocument.metaData.name" required/>
                    </div>
                </div>

                <div class="form-group control-group container" ng-class="{'igl-has-error has-feedback' : editForm.orgName.$invalid}">
                    <label class="col-md-2 control-label">Organization</label>
                    <div class="controls col-md-10">
                        <input class="form-control" type="text" name="orgName" ng-disabled="true" ng-change="setDirty()" ng-model="igDocument.metaData.orgName"/>
                    </div>
                </div>
                <div class="form-group control-group container" ng-class="{'igl-has-error has-feedback' : editForm.ext.$invalid}">
                    <label class="col-md-2 control-label">Extension</label>
                    <div class="controls col-md-10">
                        <input class="form-control" type="text" name="ext" ng-disabled="true" ng-change="setDirty()" ng-model="igDocument.metaData.ext"/>
                    </div>
                </div>
            </div>
            <div class="form-group control-group container" ng-class="{'igl-has-error has-feedback' : editForm.specificationName.$invalid}">
                <label class="col-md-2 control-label">Description</label>
                <div class="controls col-md-10">
                    <input class="form-control" type="text" name="specificationName" ng-disabled="true" ng-change="setDirty()" ng-model="igDocument.metaData.description"/>
                </div>
            </div>
            <div class="form-group control-group container" ng-disabled="true" ng-class="{'igl-has-error has-feedback' : editForm.status.$invalid}">
                <label class="col-md-2 control-label">HL7 Version</label>
                <div class="controls col-md-10">
                    <input class="form-control" type="text" name="status" ng-disabled="true" ng-change="setDirty()" ng-model="igDocument.metaData.hl7Version"/>
                </div>
            </div>
            <div class="form-group control-group container" ng-class="{'igl-has-error has-feedback' : editForm.date.$invalid}">
                <label class="col-md-2 control-label">Date Created</label>
                <div class="controls col-md-10">
                    <input type="text" name="date" disabled ng-change="setDirty()" class="form-control" ng-model="igDocument.metaData.date" required/>
                </div>
            </div>
        </div>
    </div>
    </div>
</script>
<script type="text/ng-template" id="EditMessages.html">
    <div ng-controller="MessageController" ng-init="init()">
                            <md-tabs md-dynamic-height md-border-bottom md-selected="tabStatus.active">
                                <md-tab md-on-select="setDeltaToF()">
                                    <md-tab-label>
                                        <i class="fa fa-info-circle fa-fw" aria-hidden="true"></i>MetaData
                                    </md-tab-label>
                                    <md-tab-body class="metadata-scroll">
                                        <div style="margin-top: 20px" ng-cloak class="md-inline-form metadata-scroll" layout="column">
                                            <md-content layout-padding>
                                                <label class="input-left igamt-label">Name*</label>

                                                <md-input-container class="md-block igamt-input-block" flex-gt-sm>
                                                    <input type="text"  name="name" ng-change="setDirty()" ng-model="message.name" ng-disabled="viewSettings.tableReadonly" required>
                                                    <div ng-messages="editForm.name.$error">
                                                        <div ng-message="required">Name is required.</div>
                                                    </div>
                                                </md-input-container>

                                                <label class="input-left igamt-label">Identifier</label>

                                                <md-input-container class="md-block igamt-input-block" flex-gt-sm>
                                                    <input  type="text"  name="identifier" ng-change="setDirty()" ng-model="message.identifier" ng-disabled="viewSettings.tableReadonly" required>
                                                    <div ng-messages="editForm.identifier.$error">
                                                        <div ng-message="required">Identifier is required.</div>
                                                    </div>
                                                </md-input-container>

                                                <label class="input-left igamt-label">Description</label>


                                                <md-input-container class="md-block igamt-input-block" flex-gt-sm>
                                                    <input  type="text"  name="description" ng-change="setDirty()" ng-model="message.description" ng-disabled="viewSettings.tableReadonly" required>

                                                </md-input-container>

                                                <label class="input-left igamt-label">Message Type</label>

                                                <md-input-container class="md-block igamt-input-block" flex-gt-sm>
                                                    <input  type="text"  name="messageType" ng-change="setDirty()" ng-model="message.messageType" disabled required>
                                                    <div ng-messages="editForm.messageType.$error">
                                                        <div ng-message="required">Message Type is required.</div>
                                                    </div>
                                                </md-input-container>


                                                <label class="input-left igamt-label">Message Event</label>

                                                <md-input-container class="md-block igamt-input-block" flex-gt-sm>
                                                    <input  type="text"  name="messageType" ng-change="setDirty()" ng-model="message.event"  required>
                                                    <div ng-messages="editForm.event.$error">
                                                        <div ng-message="required">Message Event is required.</div>
                                                    </div>
                                                </md-input-container>

                                                <label class="input-left igamt-label">Message Structure ID</label>

                                                <md-input-container class="md-block igamt-input-block" flex-gt-sm>
                                                    <input  type="text"  name="structID" ng-change="setDirty()" ng-model="message.structID"  required>
                                                    <div ng-messages="editForm.structID.$error">
                                                        <div ng-message="required">Message Event is required.</div>
                                                    </div>
                                                </md-input-container>

                                                <label class="input-left igamt-label" ng-show="!viewSettings.tableReadonly">Author Notes</label>

                                                <div ng-if="!viewSettings.tableReadonly">
                                                    <textarea froala="froalaEditorOptions" ng-model="message.authorNotes" name="text" id="authorNotes"></textarea>
                                                </div>
                                                <div ng-if="viewSettings.tableReadonly">
                                                    <div class="fr-view">
                                                        <div froala-view="message.authorNotes"></div>
                                                    </div>
                                                </div>

                                                <label class="input-left igamt-label">Usage Note </label>

                                                <md-input-container class="md-block igamt-input-block" flex-gt-sm style="margin-top:20px" >
                                                    <div  ng-show="!viewSettings.tableReadonly">
                                                         <textarea froala="froalaEditorOptions" md-select-on-focus
                                                                   ng-model="message.usageNote" name="usageNote"
                                                                   id="usageNote" ng-change="setDirty()"></textarea>
                                                    </div>
                                                    <div class="fr-view" ng-show="viewSettings.tableReadonly">
                                                        <div froala-view="message.usageNote"></div>
                                                    </div>
                                                </md-input-container>

                                                <label class="input-left igamt-label" ng-show="message.hl7Section != null && message.hl7Section != ''">HL7 Section</label>

                                                <md-input-container class="md-block igamt-input-block" flex-gt-sm
                                                                    ng-show="message.hl7Section != null && message.hl7Section != ''">
                                                    <input type="text" disabled
                                                           name="hl7Section"
                                                           id="hl7Section"
                                                           ng-model="message.hl7Section"
                                                    >
                                                </md-input-container>

                                            </md-content>
                                        </div>
                                    </md-tab-body>
                                </md-tab>

                                <md-tab md-on-select="setDeltaToF()">
                                    <md-tab-label>
                                        <i class="fa fa-table fa-fw" aria-hidden="true"></i>Definition
                                    </md-tab-label>
                                    <md-tab-body>
                                        <div class="el-def" style="margin-top: 5px">

                                            <md-tabs md-dynamic-height md-border-bottom md-selected="defTabStatus.active">
                                                <md-tab>
                                                    <md-tab-label>
                                                        Pre-Text
                                                    </md-tab-label>
                                                    <md-tab-body>
                                                        <div class="panel-primary">
                                                            <div class="panel-body">
                                                                <div ng-show="!viewSettings.tableReadonly">
                                                                    <textarea froala="froalaEditorOptions" ng-model="message.defPreText" name="text" id="defPreText" ng-change="setDirty()"></textarea>
                                                                </div>
                                                                <div ng-show="viewSettings.tableReadonly">
                                                                    <div class="fr-view">
                                                                        <div froala-view="message.defPreText"></div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </md-tab-body>
                                                </md-tab>

                                                <md-tab>
                                                    <md-tab-label>
                                                        Structure
                                                    </md-tab-label>
                                                    <md-tab-body>
                                                        <div layout="column">
                                                            <div flex layout="row" layout-align="start start">
                                                                <div class="table-context">
                                                                    <strong> Context :</strong>
                                                                    <span class="label-message-icon"><i class="fa fa-circle fa-fw"/></span>
                                                                    message
                                                                    <span class="label-field-icon"><i class="fa fa-circle fa-fw"/></span>
                                                                    segment
                                                                    <span class="label-component-icon"><i class="fa fa-circle fa-fw"/></span>
                                                                    Field
                                                                    <span class="label-sub-component-icon"><i class="fa fa-circle fa-fw"/></span>
                                                                    Component
                                                                </div>
                                                                <div flex class="pull-right">

                                                                    <!--<md-button ng-click="close()" md-colors="{background:'orange'}">-->



                                                                    <!--<md-button ng-click="close()" md-colors="{background:'orange'}">-->
                                                                    <md-select class="pull-right"  ng-model="viewSettings.visibleColumns"  md-selected-text="viewSettings.getPlaceHolder()" multiple ng-model-options="{trackBy: '$value.id'}" no-dirty-check>
                                                                        <md-optgroup label="Columns">
                                                                            <md-option ng-repeat="opt in  viewSettings.columnOptions track by $index" ng-value="opt">{{opt.label}}</md-option>
                                                                        </md-optgroup>
                                                                    </md-select>

                                                                </div>

                                                            </div>
                                                        </div>


                                                        <div class="igl-def-table-container">
                                                            <div class="panel-primary" style="overflow-y: auto">
                                                                <table  tt-table id="messageTable" tt-table tt-params="messageParams" class="table table-bordered table-fix-header table-condensed profile-table">
                                                                    <thead>
                                                                    <tr class="tbl-header" style="">
                                                                        <th class="col-fixed-name">Name</th>
                                                                        <th class="col-fixed-usage" style="text-align:center">Usage
                                                                        </th>
                                                                        <th class="col-fixed-cardinality" style="text-align:center">Cardinality</th>
                                                                        <th class="col-fixed-length" style="text-align:center">Length</th>
                                                                        <th class="col-fixed-confLength" style="text-align:center">ConfLength</th>
                                                                        <th class="col-fixed-dataType" style="text-align:center">Data Type</th>
                                                                        <th class="col-fixed-valueSet" style="text-align:center">Value Set/Single Code</th>
                                                                        <th class="col-fixed-constantValue" style="text-align:center">Constant Value</th>
                                                                        <th class="col-fixed-predicate" style="text-align:center">Predicate</th>
                                                                        <th class="col-fixed-definitionText" style="text-align:center">Conformance Statement</th>
                                                                        <th class="col-fixed-constantValue" style="text-align:center">Co-Constraints</th>
                                                                        <th class="col-fixed-constantValue" style="text-align:center">Dynamic Mapping</th>
                                                                    </tr>
                                                                    </thead>
                                                                    <tbody></tbody>
                                                                </table>
                                                            </div>
                                                        </div>
                                                    </md-tab-body>
                                                </md-tab>

                                                <md-tab>
                                                    <md-tab-label>
                                                        Post-Text
                                                    </md-tab-label>
                                                    <md-tab-body>

                                                        <div class="panel-primary" >
                                                            <div class="panel-body">
                                                                <div ng-show="viewSettings.tableReadonly">
                                                                    <div class="fr-view">
                                                                        <div froala-view="message.defPostText"></div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </md-tab-body>
                                                </md-tab>

                                                <md-tab>
                                                    <md-tab-label>
                                                        Conf. Statements
                                                    </md-tab-label>
                                                    <md-tab-body>

                                                        <div  class="panel-primary">
                                                            <div class="panel-body">
                                        <span class="pull-right" class="margin-right:5px">
                                                    <button title="Conformance Statements" type="button" class="btn btn-raised btn-sm btn-success" ng-hide="viewSettings.tableReadonly" ng-click="openAddGlobalConformanceStatementDialog(message)">
                                                        <span>Conformance Statements</span>
                                        </button>
                                        </span>
                                                                <div class="col-md-12">
                                                                    <span ng-hide="listGlobalConformanceStatements.length > 0">No Conformance statement</span>
                                                                    <div ng-repeat="node in listGlobalConformanceStatements">
                                                                        <span ng-show="node.type =='group'">Group : {{node.name}}</span>
                                                                        <span ng-show="node.type =='message'">Message : {{node.name}}</span>
                                                                        <table st-table="displayedCS" st-safe-src="node.conformanceStatements" class="table table-striped table-bordered">
                                                                            <thead>
                                                                            <tr class="tbl-header">
                                                                                <th st-sort="constraintId" class="col-md-2">ID</th>
                                                                                <th class="col-md-10">Description</th>
                                                                            </tr>
                                                                            </thead>
                                                                            <tbody>
                                                                            <tr ng-repeat="c in displayedCS">
                                                                                <td class="col-md-2">{{c.constraintId}}</td>
                                                                                <td class="col-md-10">{{c.description}}</td>
                                                                            </tr>
                                                                            </tbody>
                                                                        </table>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </md-tab-body>
                                                </md-tab>

                                                <md-tab>
                                                    <md-tab-label>
                                                        Predicates                                        </md-tab-label>
                                                    <md-tab-body>


                                                        <div  class="panel-primary">
                                                            <div class="panel-body">
                                                                <div class="col-md-12">
                                                                    <span ng-hide="listGlobalPredicates.length > 0">No Predicate</span>
                                                                    <div ng-repeat="node in listGlobalPredicates">
                                                                        <span ng-show="node.type =='group'">Group : {{node.name}}</span>
                                                                        <span ng-show="node.type =='message'">Message : {{node.name}}</span>
                                                                        <table st-table="displayedCP" st-safe-src="node.predicates" class="table table-striped table-bordered">
                                                                            <thead>
                                                                            <tr class="tbl-header">
                                                                                <th st-sort="constraintTarget" class="col-md-2">Target</th>
                                                                                <th class="col-md-8">Description</th>
                                                                                <th class="col-md-1">True Usage</th>
                                                                                <th class="col-md-1">False Usage</th>
                                                                            </tr>
                                                                            </thead>
                                                                            <tbody>
                                                                            <tr ng-repeat="c in displayedCP">
                                                                                <td class="col-md-2">{{c.constraintTarget}}</td>
                                                                                <td class="col-md-8">{{c.description}}</td>
                                                                                <td class="col-md-1">{{c.trueUsage}}</td>
                                                                                <td class="col-md-1">{{c.falseUsage}}</td>
                                                                            </tr>
                                                                            </tbody>
                                                                        </table>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </md-tab-body>
                                                </md-tab>
                                            </md-tabs>
                                        </div>
                                    </md-tab-body>
                                </md-tab>

                            </md-tabs>
    </div>


</script>
<script type="text/ng-template" id="MessageSegmentRefReadTree.html">
    <tr tt-node is-branch="hasChildren(node.obj)">
        <td>
            <span class="label label-segment label-icon">S</span>
            <span>
                {{getSegmentLabel(segmentsMap[node.obj.ref.id])}}
            </span>
        </td>
        <td>
            <span ng-bind="node.obj.usage"></span>
            <span ng-repeat="p in filteredConstraints  = (message.predicates | filter:{constraintTarget:node.path}:true)">
                    ({{::p.trueUsage}}/{{::p.falseUsage}})
            </span>
        </td>
        <td>[{{::node.obj.min}}, {{::node.obj.max}}]</td>
        <td class="emptyCol"></td>
        <td class="emptyCol"></td>
        <td class="emptyCol" ng-show="viewSettings.isVisibleColumn('datatype')"></td>
        <td class="emptyCol" ng-show="viewSettings.isVisibleColumn('valueSet')"></td>
        <td class="emptyCol" ng-show="viewSettings.isVisibleColumn('singleElm')"></td>
        <td ng-show="viewSettings.isVisibleColumn('predicate')">
            <div>
                <p ng-repeat="constraint in filteredConstraints  = (message.predicates | filter:{constraintTarget:node.path}:true)" tooltip-html="getPredicateAsString(constraint)" tooltip-append-to-body="true" tooltip-class="constraints-tooltip" ng-bind-html="getPredicateAsString(constraint)"
                   tooltip-trigger tooltip-animation="false" tooltip-placement="left">
                </p>
            </div>
        </td>
        <td class="emptyCol"></td>
        <td class="col-fixed-constantValue" style="text-align:center">
            <span> <i class="fa fa-eye" aria-hidden="true" ng-if="segmentsMap[node.obj.ref.id].coConstraintsTable.rowSize"></i></span>

        <td>
        <span><i class="fa fa-eye" aria-hidden="true"  ng-click="showDynamicMapping(segmentsMap[node.obj.ref.id])" ng-if="segmentsMap[node.obj.ref.id].dynamicMappingDefinition.dynamicMappingItems.length>0"></i></span>

    </td>
    </tr>
</script>
<script type="text/ng-template" id="MessageGroupReadTree.html">
    <tr tt-node is-branch="hasChildren(node.obj)">
        <td>
            <span>
                <span class="label label-success label-icon">G</span>
                <span ng-bind="::getGroupNodeName(node.obj)"></span>
            </span>
        </td>
        <td>
            <div>
                <span ng-bind="node.obj.usage"></span>
                <span ng-repeat="p in filteredConstraints  = (message.predicates | filter:{constraintTarget:node.path}:true)">
                    ({{::p.trueUsage}}/{{::p.falseUsage}})
                </span>
            </div>
        </td>
        <td>
            [{{::node.obj.min}}, {{::node.obj.max}}]
        </td>
        <td class="emptyCol" ng-show="viewSettings.isVisibleColumn('length')"></td>
        <td class="emptyCol" ng-show="viewSettings.isVisibleColumn('confLength')"></td>
        <td class="emptyCol" ng-show="viewSettings.isVisibleColumn('datatype')"></td>
        <td class="emptyCol" ng-show="viewSettings.isVisibleColumn('valueSet')"></td>
        <td class="emptyCol" ng-show="viewSettings.isVisibleColumn('singleElm')"></td>
        <td ng-show="viewSettings.isVisibleColumn('predicate')">
            <div>
                <p ng-repeat="constraint in filteredConstraints  = (message.predicates | filter:{constraintTarget:node.path}:true)" tooltip-html="getPredicateAsString(constraint)" tooltip-append-to-body="true" tooltip-class="constraints-tooltip" ng-bind-html="getPredicateAsString(constraint)"
                   tooltip-trigger tooltip-animation="false" tooltip-placement="left">
                </p>
            </div>
        </td>

        <td class="emptyCol"></td>
        <td style="text-align:center"></td>
        <td class></td>
    </tr>
</script>
<script type="text/ng-template" id="MessageFieldViewTree.html">
    <tr tt-node is-branch="hasChildren(node.obj)">
        <td>
            <span class="label label-field label-icon" ng-show="node.obj.type==='field'">F</span>
            <span class="label label-sub-component label-icon" ng-show="node.obj.type==='subcomponent'">S</span>
            <span class="label label-component label-icon" ng-show="node.obj.type==='component'">C</span>
            <span tooltip-html="getFieldNodeName(node.obj)" tooltip-append-to-body="true" tooltip-class="constraints-tooltip" ng-bind-html="getFieldNodeName(node.obj)" tooltip-trigger tooltip-animation="false" tooltip-placement="left"></span>
        </td>
        <td ng-class="hasUsageError(node.obj.id)" data-toggle="tooltip" title="{{displayMessageError(node.obj.id,'USAGE')}}">
            <span>{{node.obj.usage}}</span>
            <span ng-show="findPredicateByPath(node.path)">({{findPredicateByPath(node.path).trueUsage}}/{{findPredicateByPath(node.path).falseUsage}})</span>
        </td>
        <td ng-class="{'has-validation-error':hasCardinalityError(node.obj.id)}" data-toggle="tooltip" title="{{displayMessageError(node.obj.id,'CARDINALITY')}}">
            <span>[{{::node.obj.min}},{{::node.obj.max}}]</span>
        </td>
        <td ng-show="viewSettings.isVisibleColumn('length')" ng-class="{'emptyCol':datatypesMap[node.obj.datatype.id].components.length >0 || node.obj.minLength === 'NA' || node.obj.maxLength === 'NA','has-validation-error':hasLengthError(node.obj.id)}" data-toggle="tooltip" title="{{displayMessageError(node.obj.id,'LENGTH')}}">
            <span ng-show="datatypesMap[node.obj.datatype.id].components.length  == 0 && node.obj.minLength !== 'NA' && node.obj.maxLength !== 'NA'">[{{::node.obj.minLength}},{{::node.obj.maxLength}}]</span>
        </td>
        <td ng-class="{'emptyCol':datatypesMap[node.obj.datatype.id].components.length >0 || node.obj.confLength === 'NA' ,'has-validation-error':hasConfError(node.obj.id) && datatypesMap[node.obj.datatype.id].components.length===0}" ng-show="viewSettings.isVisibleColumn('confLength')" data-toggle="tooltip" title="{{displayMessageError(node.obj.id,'CONFLENGTH')}}">
            <span ng-show="datatypesMap[node.obj.datatype.id].components.length  == 0 && node.obj.confLength !== 'NA'">{{::node.obj.confLength}}</span>
        </td>
        <td ng-show="viewSettings.isVisibleColumn('datatype')" ng-class="{'has-validation-error':hasDatatypeError(node.obj.datatype.id)}" style="text-align:center">
            <span class="point" ng-click="redirectDT(node.obj.datatype)">
                 <display-label of="datatypesMap[node.obj.datatype.id]" desc="false"></display-label>
            </span>
        </td>
        <td ng-class="{'emptyCol':!isAvailableForValueSet(node)}" ng-show="viewSettings.isVisibleColumn('valueSet')" style="text-align:center">
            <div ng-show="isAvailableForValueSet(node)">
                <div ng-repeat="binding in findingBindings(node)">
                    <span class="badge label-white">
                        <span ng-class="{'label-message-icon' : binding.bindingFrom == 'message', 'label-field-icon' : binding.bindingFrom == 'segment', 'label-component-icon' : binding.bindingFrom == 'field', 'label-sub-component-icon' : binding.bindingFrom == 'component'}"><i class="fa fa-circle fa-fw"/></span>
                        <span title="For this message" ng-show="binding.bindingFrom == 'message' && binding.type == 'valueset'" ng-click="redirectVS(binding)">{{getTableLabel(binding.tableId)}}</span>
                        <span title="For {{getSegmentLabel(segmentsMap[node.segment])}}" ng-show="binding.bindingFrom == 'segment' && binding.type == 'valueset'" ng-click="redirectVS(binding)">{{getTableLabel(binding.tableId)}}</span>
                        <span title="For {{getDatatypeLabel(datatypesMap[node.fieldDT])}}" ng-show="binding.bindingFrom == 'field' && binding.type == 'valueset'" ng-click="redirectVS(binding)">{{getTableLabel(binding.tableId)}}</span>
                        <span title="For {{getDatatypeLabel(datatypesMap[node.componentDT])}}" ng-show="binding.bindingFrom == 'component' && binding.type == 'valueset'" ng-click="redirectVS(binding)">{{getTableLabel(binding.tableId)}}</span>
                        <span title="For this message" ng-show="binding.bindingFrom == 'message' && binding.type == 'singlecode'" ng-click="redirectVS(binding)">{{binding.code.value}}<i class="fa fa-arrow-right" aria-hidden="true"></i>[{{binding.code.codeSystem}}]</span>
                        <span title="For {{getSegmentLabel(segmentsMap[node.segment])}}" ng-show="binding.bindingFrom == 'segment' && binding.type == 'singlecode'" ng-click="redirectVS(binding)">{{binding.code.value}}<i class="fa fa-arrow-right" aria-hidden="true"></i>[{{binding.code.codeSystem}}]</span>
                        <span title="For {{getDatatypeLabel(datatypesMap[node.fieldDT])}}" ng-show="binding.bindingFrom == 'field' && binding.type == 'singlecode'" ng-click="redirectVS(binding)">{{binding.code.value}}<i class="fa fa-arrow-right" aria-hidden="true"></i>[{{binding.code.codeSystem}}]</span>
                        <span title="For {{getDatatypeLabel(datatypesMap[node.componentDT])}}" ng-show="binding.bindingFrom == 'component' && binding.type == 'singlecode'" ng-click="redirectVS(binding)">{{binding.code.value}}<i class="fa fa-arrow-right" aria-hidden="true"></i>[{{binding.code.codeSystem}}]</span>
                        <span title="Delete ValueSet Binding" ng-show="binding.bindingFrom == 'message'" ng-click="deleteBinding(binding)"><i class="fa fa-times fa-fw edit-icon"></i></span>
                    </span>
                </div>
            </div>
        </td>
        <td ng-class="{'emptyCol':!isAvailableConstantValue(node)}" ng-show="viewSettings.isVisibleColumn('singleElm')" style="text-align:center">
            <div ng-show="isAvailableConstantValue(node)">
                <span ng-show="node.sev" class="badge label-white">
                    <span ng-class="{'label-message-icon' : node.sev.from == 'message', 'label-field-icon' : node.sev.from == 'segment', 'label-component-icon' : node.sev.from == 'field', 'label-sub-component-icon' : node.sev.from == 'component'}"><i class="fa fa-circle fa-fw"/></span>
                    <span>{{node.sev.value}}</span>
                </span>
            </div>
        </td>
        <td ng-show="viewSettings.isVisibleColumn('predicate')">
            <div ng-show="viewSettings.tableReadonly && findPredicateByPath(node.path)">
                <span title="{{getPredicateAsString(findPredicateByPath(node.path))}}" class="badge label-white">
                    <span class="label-message-icon"><i class="fa fa-circle fa-fw"/></span>
                    <span>{{getConstraintAsTruncatedString(findPredicateByPath(node.path), 15)}}</span>
                </span>
            </div>
            <div ng-repeat="p in filteredSubConstraints=(parentsMap[node.obj.id].predicates | filter:{constraintTarget:node.obj.position + '[1]'}:true)">
                <span title="{{getPredicateAsString(p)}}" class="badge label-white">
                    <span class="label-field-icon"><i class="fa fa-circle fa-fw"/></span>
                    <span>{{getConstraintAsTruncatedString(p, 15)}}</span>
                </span>
            </div>
            <div ng-show="!viewSettings.tableReadonly">
                <div ng-show="findPredicateByPath(node.path)">
                    <span title="{{getPredicateAsString(findPredicateByPath(node.path))}}" class="badge label-white">
                        <span class="label-message-icon"><i class="fa fa-circle fa-fw"/></span>
                        <span>{{getConstraintAsTruncatedString(findPredicateByPath(node.path), 15)}}</span>
                        <span ng-click="openAddGlobalPredicateDialog(node, message)"><i class="fa fa-pencil fa-fw edit-icon"></i></span>
                        <span ng-click="deletePredicateByPath(node.path, message)"><i class="fa fa-times fa-fw edit-icon"></i></span>
                    </span>
                </div>
                <div ng-hide="findPredicateByPath(node.path) || filteredSubConstraints.length || viewSettings.tableReadonly || node.obj.usage !=='C'">
                    <a ng-click="openAddGlobalPredicateDialog(node, message)" class="point">
                        <span><i class="fa fa-plus fa-fw"></i></span>
                        <p class="warning" >Need predicate</p>
                    </a>
                </div>
            </div>
        </td>
        <td class="emptyCol" style="text-align:center">
        </td>
        <td  style="text-align:center">

        </td>
        <td  style="text-align:center">

        </td>
    </tr>
</script>
<script type="text/ng-template" id="MessageComponentViewTree.html">
    <tr tt-node is-branch="hasChildren(node.obj)">
        <td>
            <span>
                <span class="label label-field label-icon" ng-show="node.obj.type==='field'">F</span>
                <span class="label label-component label-icon" ng-show="node.obj.type==='component' && node.segmentPath.split('.').length - 1 == 1">C</span>
                <span class="label label-sub-component label-icon" ng-show="node.obj.type==='component' && node.segmentPath.split('.').length - 1 == 2">S</span>
                <span ng-bind="getComponentNodeName(node.obj)"/>
            </span>
        </td>
        <td>
            <span>{{node.obj.usage}}</span>
            <span ng-show="findPredicateByPath(node.path)">({{findPredicateByPath(node.path).trueUsage}}/{{findPredicateByPath(node.path).falseUsage}})</span>
        </td>
        <td class="emptyCol">
        </td>
        <td ng-show="viewSettings.isVisibleColumn('length')" ng-class="{'emptyCol':datatypesMap[node.obj.datatype.id].components.length >0 || node.obj.minLength === 'NA' || node.obj.maxLength === 'NA','has-validation-error':hasLengthError(node.obj.id)}" data-toggle="tooltip" title="{{displayMessageError(node.obj.id,'LENGTH')}}">
            <div ng-show="datatypesMap[node.obj.datatype.id].components.length  == 0 && node.obj.minLength !== 'NA' && node.obj.maxLength !== 'NA'">
                [{{::node.obj.minLength}},{{::node.obj.maxLength}}]
            </div>
        </td>
        <td ng-class="{'emptyCol':datatypesMap[node.obj.datatype.id].components.length >0 || node.obj.confLength === 'NA','has-validation-error':hasConfError(node.obj.id) && datatypesMap[node.obj.datatype.id].components.length===0}" ng-show="viewSettings.isVisibleColumn('confLength')" data-toggle="tooltip" title="{{displayMessageError(node.obj.id,'CONFLENGTH')}}">
            <div ng-show="datatypesMap[node.obj.datatype.id].components.length  == 0 && node.obj.confLength !== 'NA'" ng-bind="::node.obj.confLength">
            </div>
        </td>
        <td ng-show="viewSettings.isVisibleColumn('datatype')" ng-class="{'has-validation-error':hasDatatypeError(node.obj.datatype.id)}" style="text-align:left">
            <span class="point" ng-click="redirectDT(node.obj.datatype)">
                 <display-label of="datatypesMap[node.obj.datatype.id]" desc="false"></display-label>
            </span>
        </td>
        <td ng-class="{'emptyCol':!isAvailableForValueSet(node)}" ng-show="viewSettings.isVisibleColumn('valueSet')" style="text-align:center">
            <div ng-show="isAvailableForValueSet(node)">
                <div ng-repeat="binding in findingBindings(node)">
                    <span class="badge label-white">
                        <span ng-class="{'label-message-icon' : binding.bindingFrom == 'message', 'label-field-icon' : binding.bindingFrom == 'segment', 'label-component-icon' : binding.bindingFrom == 'field', 'label-sub-component-icon' : binding.bindingFrom == 'component'}"><i class="fa fa-circle fa-fw"/></span>
                        <span title="For this message" ng-show="binding.bindingFrom == 'message' && binding.type == 'valueset'" ng-click="redirectVS(binding)">{{getTableLabel(binding.tableId)}}</span>
                        <span title="For {{getSegmentLabel(segmentsMap[node.segment])}}" ng-show="binding.bindingFrom == 'segment' && binding.type == 'valueset'" ng-click="redirectVS(binding.tableId)">{{getTableLabel(binding.tableId)}}</span>
                        <span title="For {{getDatatypeLabel(datatypesMap[node.fieldDT])}}" ng-show="binding.bindingFrom == 'field' && binding.type == 'valueset'" ng-click="redirectVS(binding)">{{getTableLabel(binding.tableId)}}</span>
                        <span title="For {{getDatatypeLabel(datatypesMap[node.componentDT])}}" ng-show="binding.bindingFrom == 'component' && binding.type == 'valueset'" ng-click="redirectVS(binding)">{{getTableLabel(binding.tableId)}}</span>
                        <span title="For this message" ng-show="binding.bindingFrom == 'message' && binding.type == 'singlecode'" ng-click="redirectVS(binding)">{{binding.code.value}}<i class="fa fa-arrow-right" aria-hidden="true"></i>[{{binding.code.codeSystem}}]</span>
                        <span title="For {{getSegmentLabel(segmentsMap[node.segment])}}" ng-show="binding.bindingFrom == 'segment' && binding.type == 'singlecode'" ng-click="redirectVS(binding)">{{binding.code.value}}<i class="fa fa-arrow-right" aria-hidden="true"></i>[{{binding.code.codeSystem}}]</span>
                        <span title="For {{getDatatypeLabel(datatypesMap[node.fieldDT])}}" ng-show="binding.bindingFrom == 'field' && binding.type == 'singlecode'" ng-click="redirectVS(binding)">{{binding.code.value}}<i class="fa fa-arrow-right" aria-hidden="true"></i>[{{binding.code.codeSystem}}]</span>
                        <span title="For {{getDatatypeLabel(datatypesMap[node.componentDT])}}" ng-show="binding.bindingFrom == 'component' && binding.type == 'singlecode'" ng-click="redirectVS(binding)">{{binding.code.value}}<i class="fa fa-arrow-right" aria-hidden="true"></i>[{{binding.code.codeSystem}}]</span>
                        <span title="Delete ValueSet Binding" ng-show="binding.bindingFrom == 'message'" ng-click="deleteBinding(binding)"><i class="fa fa-times fa-fw edit-icon"></i></span>
                    </span>
                </div>
                <a ng-click="editModalBindingForMsg(node)" class="point">
                    <span><i class="fa fa-pencil fa-fw"></i></span>
                </a>
            </div>
        </td>
        <td ng-class="{'emptyCol':!isAvailableConstantValue(node)}" ng-show="viewSettings.isVisibleColumn('singleElm')" style="text-align:center">
            <div ng-show="isAvailableConstantValue(node)">
                <span ng-show="node.sev" class="badge label-white">
                    <span ng-class="{'label-message-icon' : node.sev.from == 'message', 'label-field-icon' : node.sev.from == 'segment', 'label-component-icon' : node.sev.from == 'field', 'label-sub-component-icon' : node.sev.from == 'component'}"><i class="fa fa-circle fa-fw"/></span>
                    <span>{{node.sev.value}}</span>
                </span>
            </div>
        </td>
        <td ng-show="viewSettings.isVisibleColumn('predicate')">
            <button ng-click="printPredicate(node.path)">dedededdede</button>

            <div ng-show="viewSettings.tableReadonly && findPredicateByPath(node.path)">
                <span title="{{getPredicateAsString(findPredicateByPath(node.path))}}" class="badge label-white">
                    <span class="label-message-icon"><i class="fa fa-circle fa-fw"/></span>
                    <span>{{getConstraintAsTruncatedString(findPredicateByPath(node.path), 15)}}</span>
                </span>
            </div>
            <div ng-repeat="p in filteredSubConstraints=(parentsMap[node.obj.id].predicates | filter:{constraintTarget:node.obj.position + '[1]'}:true)">
                <span title="{{getPredicateAsString(p)}}" class="badge label-white">
                    <span ng-class="{'label-component-icon' : node.segmentPath.split('.').length - 1 == 1, 'label-sub-component-icon' : node.segmentPath.split('.').length - 1 == 2}"><i class="fa fa-circle fa-fw"/></span>
                    <span>{{getConstraintAsTruncatedString(p, 15)}}</span>
                </span>
            </div>
        </td>
        <td class="emptyCol" style="text-align:center">
        </td>
        <td  style="text-align:center">
        </td>
        <td  style="text-align:center">

        </td>
    </tr>
</script>
<script type="text/ng-template" id="MessageRowTree.html">
    <tr tt-node>
        <td ng-click="print(node)">
            <span>
                {{rowName(node.obj)}}
            </span>
        </td>

        <td class="col-fixed-usage" style="text-align:center">{{rowUsage(node.obj)}}
        </td>
        <td class="col-fixed-cardinality" style="text-align:center">{{rowCard(node.obj)}}</td>
        <td class="col-fixed-length" style="text-align:center">{{rowLength(node.obj)}}</td>
        <td class="col-fixed-confLength" style="text-align:center">{{rowConfLength(node.obj)}}</td>
        <td class="col-fixed-dataType" style="text-align:center">{{rowDatatype(node.obj)}}</td>
        <td class="col-fixed-valueSet" style="text-align:center">{{rowValueSetBindings(node.obj)}}

                <div ng-repeat="binding in findingBindings(node)">
                    <span class="badge label-white">
                        <span ng-class="{'label-message-icon' : binding.bindingFrom == 'message', 'label-field-icon' : binding.bindingFrom == 'segment', 'label-component-icon' : binding.bindingFrom == 'field', 'label-sub-component-icon' : binding.bindingFrom == 'component'}"><i class="fa fa-circle fa-fw"/></span>
                        <span title="For this message" ng-show="binding.bindingFrom == 'message' && binding.type == 'valueset'" ng-click="redirectVS(binding)">{{getTableLabel(binding.tableId)}}</span>
                        <span title="For {{getSegmentLabel(segmentsMap[node.segment])}}" ng-show="binding.bindingFrom == 'segment' && binding.type == 'valueset'" ng-click="redirectVS(binding)">{{getTableLabel(binding.tableId)}}</span>
                        <span title="For {{getDatatypeLabel(datatypesMap[node.fieldDT])}}" ng-show="binding.bindingFrom == 'field' && binding.type == 'valueset'" ng-click="redirectVS(binding)">{{getTableLabel(binding.tableId)}}</span>
                        <span title="For {{getDatatypeLabel(datatypesMap[node.componentDT])}}" ng-show="binding.bindingFrom == 'component' && binding.type == 'valueset'" ng-click="redirectVS(binding)">{{getTableLabel(binding.tableId)}}</span>
                        <span title="For this message" ng-show="binding.bindingFrom == 'message' && binding.type == 'singlecode'" ng-click="redirectVS(binding)">{{binding.code.value}}<i class="fa fa-arrow-right" aria-hidden="true"></i>[{{binding.code.codeSystem}}]</span>
                        <span title="For {{getSegmentLabel(segmentsMap[node.segment])}}" ng-show="binding.bindingFrom == 'segment' && binding.type == 'singlecode'" ng-click="redirectVS(binding)">{{binding.code.value}}<i class="fa fa-arrow-right" aria-hidden="true"></i>[{{binding.code.codeSystem}}]</span>
                        <span title="For {{getDatatypeLabel(datatypesMap[node.fieldDT])}}" ng-show="binding.bindingFrom == 'field' && binding.type == 'singlecode'" ng-click="redirectVS(binding)">{{binding.code.value}}<i class="fa fa-arrow-right" aria-hidden="true"></i>[{{binding.code.codeSystem}}]</span>
                        <span title="For {{getDatatypeLabel(datatypesMap[node.componentDT])}}" ng-show="binding.bindingFrom == 'component' && binding.type == 'singlecode'" ng-click="redirectVS(binding)">{{binding.code.value}}<i class="fa fa-arrow-right" aria-hidden="true"></i>[{{binding.code.codeSystem}}]</span>
                        <span title="Delete ValueSet Binding" ng-show="binding.bindingFrom == 'message'" ng-click="deleteBinding(binding)"><i class="fa fa-times fa-fw edit-icon"></i></span>
                    </span>
                </div>
        </td>
        <td class="col-fixed-constantValue" style="text-align:center">

            <div ng-show="isAvailableConstantValue(node)">
                <span ng-show="node.sev" class="badge label-white">
                    <span ng-class="{'label-message-icon' : node.sev.from == 'message', 'label-field-icon' : node.sev.from == 'segment', 'label-component-icon' : node.sev.from == 'field', 'label-sub-component-icon' : node.sev.from == 'component'}"><i class="fa fa-circle fa-fw"/></span>
                    <span>{{node.sev.value}}</span>
                    <span title="Edit SingleElement" ng-show="node.sev.from == 'message'"><i class="fa fa-pencil fa-fw edit-icon"></i></span>
                    <span title="Add SingleElement" ng-show="node.sev.from != 'message'"><i class="fa fa-pencil fa-fw edit-icon"></i></span>
                    <span title="Delete SingleElement" ng-show="node.sev.from == 'message'"><i class="fa fa-times fa-fw edit-icon"></i></span>
                </span>
            </div>

        </td>

        <td class="col-fixed-predicate" style="text-align:center">

            <div ng-show="findPredicateByPath(node.path)">
                <span title="{{getPredicateAsString(findPredicateByPath(node.path))}}" class="badge label-white">
                    <span class="label-message-icon"><i class="fa fa-circle fa-fw"/></span>
                    <span>{{getConstraintAsTruncatedString(findPredicateByPath(node.path), 15)}}</span>
                </span>
            </div>
            <div ng-repeat="p in filteredSubConstraints=(parentsMap[node.obj.id].predicates | filter:{constraintTarget:node.obj.position + '[1]'}:true)">
                <span title="{{getPredicateAsString(p)}}" class="badge label-white">
                    <span class="label-field-icon"><i class="fa fa-circle fa-fw"/></span>
                    <span>{{getConstraintAsTruncatedString(p, 15)}}</span>
                </span>
            </div>
            <div>
                <div ng-show="findPredicateByPath(node.path)">
                    <span title="{{getPredicateAsString(findPredicateByPath(node.path))}}" class="badge label-white">
                        <span class="label-message-icon"><i class="fa fa-circle fa-fw"/></span>
                        <span>{{getConstraintAsTruncatedString(findPredicateByPath(node.path), 15)}}</span>
                    </span>
                </div>
                <div ng-hide="findPredicateByPath(node.path) || filteredSubConstraints.length || viewSettings.tableReadonly || node.obj.usage !=='C'">
                    <a class="point">
                        <span><i class="fa fa-plus fa-fw"></i></span>
                        <p class="warning" >Need predicate</p>
                    </a>
                </div>
            </div>

        </td>
        <td class="col-fixed-predicate" style="text-align:center">{{rowConformanceStatement(node.obj)}}</td>
        <td class="col-fixed-constantValue" style="text-align:center"><button ng-click="print(segmentsMap[node.obj.ref.id])">dedededdede</button></td>
        <td class="col-fixed-constantValue" style="text-align:center">{{hasDynamicMapping(node.obj)}}</td>
    </tr>
</script>

<script type="text/ng-template" id="label.html">
    <span ng-if="element.hl7Version!=='*'" ng-class="{deprecated : element.duplicated}">
        <span  class="badge" ng-class="{'label-HL7' : getScopeLabel(element)==='HL7',
         'label-USE':  getScopeLabel(element)==='USR','label-MASTER':getScopeLabel(element)==='MAS','label-PRL':getScopeLabel(element)==='PRL','label-DRV':getScopeLabel(element)==='DRV'}">
                {{getScopeLabel(element)}} {{hasHl7Version(element)}}

        <span ng-if="element.publicationVersion&&element.status==='PUBLISHED'" class="version-badge">v{{element.publicationVersion}}</span>
    </span>
    <span>{{getLabel(element)}}</span>
    <span ng-if="description">-{{getDescriptionLabel(element)}}</span>
    </span>


    <span ng-if="element.hl7Version=='*'">

            <span  class="badge" ng-class="{'label-HL7' : getScopeLabel(element)==='HL7',
         'label-USE':  getScopeLabel(element)==='USR','label-MASTER':getScopeLabel(element)==='MAS','label-PRL':getScopeLabel(element)==='PRL','label-DRV':getScopeLabel(element)==='DRV'}">
                {{getScopeLabel(element)}}

        <span ng-if="element.publicationVersion&&element.status==='PUBLISHED'" class="version-badge">v{{element.publicationVersion}}</span>

    </span>
    <span>{{getLabel(element)}}</span>
    <span ng-if="description">{{getDescriptionLabel(element)}}</span>
    <div>
        <span class="version-badge-under" ng-repeat="version in element.hl7versions" style="margin-left:2px;">{{version}}</span>
    </div>
    </span>
</script>
<script type="text/ng-template" id="dynamicMapping.html"> <md-dialog aria-label="confirmation">
    <form ng-cloak>
        <md-toolbar>
            <div class="md-toolbar-tools">
                <h2> Dynamic Mapping </h2>
                <span flex></span>
                <md-button ng-click="cancel()">
                    <i class="material-icons">clear</i>
                </md-button>
            </div>
        </md-toolbar>

        <md-dialog-content>
            <div class="md-dialog-content">
                <table st-safe-src="segment.dynamicMappingDefinition.dynamicMappingItems" st-table="displayItems" class="table table-striped table-condensed table-bordered">
                    <thead>
                    <tr class="tbl-header">
                        <th st-sort="firstReferenceValue" class="col-md-3">Reference Value</th>
                        <!--<th ng-show="segment.dynamicMappingDefinition.mappingStructure.secondRefereceLocation" st-sort="secondReferenceValue" class="col-md-3">Second Reference Value</th>-->
                        <th class="col-md-5">Datatype</th>

                    </tr>
                    </thead>
                    <tbody>
                    <tr ng-repeat="item in displayItems">
                        <td class="col-md-3">
                                    {{item.firstReferenceValue}}

                        </td>
                        <td class="col-md-5">
                            {{getDatatypeLabel(datatypesMap[item.datatypeId])}}

                        </td>

                    </tr>
                    </tbody>
                    <tr style="float:center !important;" ng-if="segment.dynamicMappingDefinition.dynamicMappingItems.length > 10">
                        <td colspan="6" class="text-center" style="float:center !important;">
                            <div st-pagination="" st-items-by-page="10" st-displayed-pages="7" style="float:center !important;"></div>
                        </td>
                    </tr>
                </table>

            </div>
        </md-dialog-content>
        <md-dialog-actions layout="row">
            <md-button  class="md-primary md-raised" md-autofocus ng-click="close()">Close
            </md-button>
        </md-dialog-actions>
    </form>
</md-dialog>
</script>