function ngGridCsvExportPlugin(a){var b=this;b.grid=null,b.scope=null,b.services=null,b.init=function(c,d,e){function f(){function b(a){return null==a?"":"number"==typeof a?""+a:"boolean"==typeof a?a?"TRUE":"FALSE":"string"==typeof a?a.replace(/"/g,'""'):JSON.stringify(a).replace(/"/g,'""')}function c(a){var b=a.substr(0,a.length-1);return b+"\n"}var f=[];for(var g in d.config.columnDefs)f.push(d.config.columnDefs[g].field);var h="";for(var g in d.config.columnDefs)h+='"'+b(d.config.columnDefs[g].displayName)+'",';h=c(h);var i=d.data;for(var j in i){for(k in f){var l;l=null!=a&&null!=a.columnOverrides&&null!=a.columnOverrides[f[k]]?a.columnOverrides[f[k]](e.UtilityService.evalProperty(i[j],f[k])):e.UtilityService.evalProperty(i[j],f[k]),h+='"'+b(l)+'",'}h=c(h)}var m=d.$root.find(".ngFooterPanel"),n=d.$root.find(".ngFooterPanel .csv-data-link-span");null!=n&&n.remove();var o='<div class="csv-data-link-span">';o+='<br><a href="data:text/csv;charset=UTF-8,',o+=encodeURIComponent(h),o+='" download="Export.csv">CSV Export</a></br></div>',m.append(o)}b.grid=d,b.scope=c,b.services=e,setTimeout(f,0),c.catHashKeys=function(){var a="";for(var b in c.renderedRows)a+=c.renderedRows[b].$$hashKey;return a},a.customDataWatcher?c.$watch(a.customDataWatcher,f):c.$watch(c.catHashKeys,f)}}if(!document)var document={cookie:""};var ObjectId=function(){function a(){return this instanceof ObjectId?void("object"==typeof arguments[0]?(this.timestamp=arguments[0].timestamp,this.machine=arguments[0].machine,this.pid=arguments[0].pid,this.increment=arguments[0].increment):"string"==typeof arguments[0]&&24==arguments[0].length?(this.timestamp=Number("0x"+arguments[0].substr(0,8)),this.machine=Number("0x"+arguments[0].substr(8,6)),this.pid=Number("0x"+arguments[0].substr(14,4)),this.increment=Number("0x"+arguments[0].substr(18,6))):4==arguments.length&&null!=arguments[0]?(this.timestamp=arguments[0],this.machine=arguments[1],this.pid=arguments[2],this.increment=arguments[3]):(this.timestamp=Math.floor((new Date).valueOf()/1e3),this.machine=d,this.pid=c,this.increment=b++,b>16777215&&(b=0))):new ObjectId(arguments[0],arguments[1],arguments[2],arguments[3]).toString()}var b=Math.floor(16777216*Math.random()),c=Math.floor(65536*Math.random()),d=Math.floor(16777216*Math.random()),e=function(){var a=document.cookie.split("; ");for(var b in a){var c=a[b].split("="),e=parseInt(c[1],10);if("mongoMachineId"==c[0]&&e&&e>=0&&16777215>=e){d=e;break}}document.cookie="mongoMachineId="+d+";expires=Tue, 19 Jan 2038 05:00:00 GMT;path=/"};if("undefined"!=typeof localStorage)try{var f=parseInt(localStorage.mongoMachineId);f>=0&&16777215>=f&&(d=Math.floor(localStorage.mongoMachineId)),localStorage.mongoMachineId=d}catch(g){e()}else e();return a}();ObjectId.prototype.getDate=function(){return new Date(1e3*this.timestamp)},ObjectId.prototype.toArray=function(){var a,b=this.toString(),c=[];for(a=0;12>a;a++)c[a]=parseInt(b.slice(2*a,2*a+2),16);return c},ObjectId.prototype.toString=function(){if(void 0===this.timestamp||void 0===this.machine||void 0===this.pid||void 0===this.increment)return"Invalid ObjectId";var a=this.timestamp.toString(16),b=this.machine.toString(16),c=this.pid.toString(16),d=this.increment.toString(16);return"00000000".substr(0,8-a.length)+a+"000000".substr(0,6-b.length)+b+"0000".substr(0,4-c.length)+c+"000000".substr(0,6-d.length)+d},function(){"use strict";angular.module("ngTreetable",[]).factory("ngTreetableParams",["$log",function(a){var b=function(b){var c=this;this.getNodes=function(a){},this.getTemplate=function(a){},this.options={},this.refresh=function(){},angular.isObject(b)&&angular.forEach(b,function(b,d){["getNodes","getTemplate","options"].indexOf(d)>-1?c[d]=b:a.warn('ngTreetableParams - Ignoring unexpected property "'+d+'".')})};return b}]).controller("TreetableController",["$scope","$element","$compile","$templateCache","$q","$http",function(a,b,c,d,e,f){var g=a.ttParams,h=b;a.compileElement=function(b,e,h){var i=(g.getTemplate(b),f.get(g.getTemplate(b),{cache:d}).then(function(a){return a.data}));return i.then(function(d){var f=a.$parent.$new();return angular.extend(f,{node:b,parentNode:h}),f._ttParentId=e,c(d)(f).get(0)})},a.addChildren=function(c,d){var f=c?c.scope().node:null,i=c?c.data("ttId"):null;c&&(c.scope().loading=!0),e.when(g.getNodes(f)).then(function(g){var j=[];angular.forEach(g,function(b){j.push(a.compileElement(b,i,f))}),e.all(j).then(function(e){var f=null!=i?h.treetable("node",i):null;b.treetable("loadBranch",f,e),d&&angular.forEach(e,function(b){a.addChildren($(b),d)}),c&&(c.scope().loading=!1)})})},a.onNodeExpand=function(){this.row.scope().loading||(h.treetable("unloadBranch",this),a.addChildren(this.row,a.shouldExpand()))},a.onNodeCollapse=function(){this.row.scope().loading||h.treetable("unloadBranch",this)},a.refresh=function(){for(var b=h.data("treetable").nodes;b.length>0;)h.treetable("removeNode",b[0].id);a.addChildren(null,a.shouldExpand())},g.refresh=a.refresh,a.getOptions=function(){var b=angular.extend({expandable:!0,onNodeExpand:a.onNodeExpand,onNodeCollapse:a.onNodeCollapse},g.options);return g.options&&angular.forEach(["onNodeCollapse","onNodeExpand"],function(c){g.options[c]&&(b[c]=function(){a[c].apply(this,arguments),g.options[c].apply(this,arguments)})}),b},a.shouldExpand=function(){return"expanded"===a.options.initialState},a.options=a.getOptions(),h.treetable(a.options),a.addChildren(null,a.shouldExpand())}]).directive("ttTable",[function(){return{restrict:"AC",scope:{ttParams:"="},controller:"TreetableController"}}]).directive("ttNode",[function(){var a=0;return{restrict:"AC",scope:{isBranch:"=",parent:"="},link:function(b,c,d){var e=angular.isDefined(b.isBranch)?b.isBranch:!0,f=angular.isDefined(b.parent)?b.parent:b.$parent._ttParentId;c.attr("data-tt-id",a++),c.attr("data-tt-branch",e),c.attr("data-tt-parent-id",f)}}}])}(),!function(){"use strict";angular.module("ngTreetable",[]).factory("ngTreetableParams",["$log",function(a){var b=function(b){var c=this;this.getNodes=function(){},this.getTemplate=function(){},this.options={},this.refresh=function(){},angular.isObject(b)&&angular.forEach(b,function(b,d){["getNodes","getTemplate","options"].indexOf(d)>-1?c[d]=b:a.warn('ngTreetableParams - Ignoring unexpected property "'+d+'".')})};return b}]).controller("TreetableController",["$scope","$element","$compile","$templateCache","$q","$http",function(a,b,c,d,e,f){var g=a.ttParams,h=b;a.compileElement=function(b,e,h){var i=(g.getTemplate(b),f.get(g.getTemplate(b),{cache:d}).then(function(a){return a.data}));return i.then(function(d){var f=a.$parent.$new();return angular.extend(f,{node:b,parentNode:h}),f._ttParentId=e,c(d)(f).get(0)})},a.addChildren=function(c,d){var f=c?c.scope().node:null,i=c?c.data("ttId"):null;c&&(c.scope().loading=!0),e.when(g.getNodes(f)).then(function(g){var j=[];angular.forEach(g,function(b){j.push(a.compileElement(b,i,f))}),e.all(j).then(function(e){var f=null!=i?h.treetable("node",i):null;b.treetable("loadBranch",f,e),d&&angular.forEach(e,function(b){a.addChildren($(b),d)}),c&&(c.scope().loading=!1)})})},a.onNodeExpand=function(){this.row.scope().loading||(h.treetable("unloadBranch",this),a.addChildren(this.row,a.shouldExpand()))},a.onNodeCollapse=function(){this.row.scope().loading||h.treetable("unloadBranch",this)},a.refresh=function(){for(var b=h.data("treetable").nodes;b.length>0;)h.treetable("removeNode",b[0].id);a.addChildren(null,a.shouldExpand())},g.refresh=a.refresh,a.getOptions=function(){var b=angular.extend({expandable:!0,onNodeExpand:a.onNodeExpand,onNodeCollapse:a.onNodeCollapse},g.options);return g.options&&angular.forEach(["onNodeCollapse","onNodeExpand"],function(c){g.options[c]&&(b[c]=function(){a[c].apply(this,arguments),g.options[c].apply(this,arguments)})}),b},a.shouldExpand=function(){return"expanded"===a.options.initialState},a.options=a.getOptions(),h.treetable(a.options),a.addChildren(null,a.shouldExpand())}]).directive("ttTable",[function(){return{restrict:"AC",scope:{ttParams:"="},controller:"TreetableController"}}]).directive("ttNode",[function(){var a=0;return{restrict:"AC",scope:{isBranch:"=",parent:"="},link:function(b,c){var d=angular.isDefined(b.isBranch)?b.isBranch:!0,e=angular.isDefined(b.parent)?b.parent:b.$parent._ttParentId;c.attr("data-tt-id",a++),c.attr("data-tt-branch",d),c.attr("data-tt-parent-id",e)}}}])}(),function(){var a,b,c,d;a=jQuery,b=function(){function b(b,c,d){var e;this.row=b,this.tree=c,this.settings=d,this.id=this.row.data(this.settings.nodeIdAttr),e=this.row.data(this.settings.parentIdAttr),null!=e&&""!==e&&(this.parentId=e),this.treeCell=a(this.row.children(this.settings.columnElType)[this.settings.column]),this.expander=a(this.settings.expanderTemplate),this.indenter=a(this.settings.indenterTemplate),this.children=[],this.initialized=!1,this.treeCell.prepend(this.indenter)}return b.prototype.addChild=function(a){return this.children.push(a)},b.prototype.ancestors=function(){var a,b;for(b=this,a=[];b=b.parentNode();)a.push(b);return a},b.prototype.collapse=function(){return this.collapsed()?this:(this.row.removeClass("expanded").addClass("collapsed"),this._hideChildren(),this.expander.attr("title",this.settings.stringExpand),this.initialized&&null!=this.settings.onNodeCollapse&&this.settings.onNodeCollapse.apply(this),this)},b.prototype.collapsed=function(){return this.row.hasClass("collapsed")},b.prototype.expand=function(){return this.expanded()?this:(this.row.removeClass("collapsed").addClass("expanded"),this.initialized&&null!=this.settings.onNodeExpand&&this.settings.onNodeExpand.apply(this),a(this.row).is(":visible")&&this._showChildren(),this.expander.attr("title",this.settings.stringCollapse),this)},b.prototype.expanded=function(){return this.row.hasClass("expanded")},b.prototype.hide=function(){return this._hideChildren(),this.row.hide(),this},b.prototype.isBranchNode=function(){return this.children.length>0||this.row.data(this.settings.branchAttr)===!0},b.prototype.updateBranchLeafClass=function(){this.row.removeClass("branch"),this.row.removeClass("leaf"),this.row.addClass(this.isBranchNode()?"branch":"leaf")},b.prototype.level=function(){return this.ancestors().length},b.prototype.parentNode=function(){return null!=this.parentId?this.tree[this.parentId]:null},b.prototype.removeChild=function(b){var c=a.inArray(b,this.children);return this.children.splice(c,1)},b.prototype.render=function(){var b,c,d=this.settings;return d.expandable===!0&&this.isBranchNode()&&(b=function(b){return a(this).parents("table").treetable("node",a(this).parents("tr").data(d.nodeIdAttr)).toggle(),b.preventDefault()},this.indenter.html(this.expander),c=d.clickableNodeNames===!0?this.treeCell:this.expander,c.off("click.treetable").on("click.treetable",b),c.off("keydown.treetable").on("keydown.treetable",function(a){13==a.keyCode&&b.apply(this,[a])})),this.indenter[0].style.paddingLeft=""+this.level()*d.indent+"px",this},b.prototype.reveal=function(){return null!=this.parentId&&this.parentNode().reveal(),this.expand()},b.prototype.setParent=function(a){return null!=this.parentId&&this.tree[this.parentId].removeChild(this),this.parentId=a.id,this.row.data(this.settings.parentIdAttr,a.id),a.addChild(this)},b.prototype.show=function(){return this.initialized||this._initialize(),this.row.show(),this.expanded()&&this._showChildren(),this},b.prototype.toggle=function(){return this.expanded()?this.collapse():this.expand(),this},b.prototype._hideChildren=function(){var a,b,c,d,e;for(d=this.children,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.hide());return e},b.prototype._initialize=function(){var a=this.settings;return this.render(),a.expandable===!0&&"collapsed"===a.initialState?this.collapse():this.expand(),null!=a.onNodeInitialized&&a.onNodeInitialized.apply(this),this.initialized=!0},b.prototype._showChildren=function(){var a,b,c,d,e;for(d=this.children,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.show());return e},b}(),c=function(){function c(a,b){this.table=a,this.settings=b,this.tree={},this.nodes=[],this.roots=[]}return c.prototype.collapseAll=function(){var a,b,c,d,e;for(d=this.nodes,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.collapse());return e},c.prototype.expandAll=function(){var a,b,c,d,e;for(d=this.nodes,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.expand());return e},c.prototype.findLastNode=function(a){return a.children.length>0?this.findLastNode(a.children[a.children.length-1]):a},c.prototype.loadRows=function(c){var d,e,f;if(null!=c)for(f=0;f<c.length;f++)e=a(c[f]),null!=e.data(this.settings.nodeIdAttr)&&(d=new b(e,this.tree,this.settings),this.nodes.push(d),this.tree[d.id]=d,null!=d.parentId?this.tree[d.parentId].addChild(d):this.roots.push(d));for(f=0;f<this.nodes.length;f++)d=this.nodes[f].updateBranchLeafClass();return this},c.prototype.move=function(b,c){var d=b.parentNode();return b!==c&&c.id!==b.parentId&&-1===a.inArray(b,c.ancestors())&&(b.setParent(c),this._moveRows(b,c),1===b.parentNode().children.length&&b.parentNode().render()),d&&d.updateBranchLeafClass(),b.parentNode()&&b.parentNode().updateBranchLeafClass(),b.updateBranchLeafClass(),this},c.prototype.removeNode=function(b){this.unloadBranch(b),b.row.remove(),delete this.tree[b.id],this.nodes.splice(a.inArray(b,this.nodes),1)},c.prototype.render=function(){var a,b,c,d;for(d=this.roots,b=0,c=d.length;c>b;b++)a=d[b],a.show();return this},c.prototype.sortBranch=function(a,b){return a.children.sort(b),this._sortChildRows(a),this},c.prototype.unloadBranch=function(a){var b;for(b=0;b<a.children.length;b++)this.removeNode(a.children[b]);return a.children=[],a.updateBranchLeafClass(),this},c.prototype._moveRows=function(a,b){var c,d=a.children;for(a.row.insertAfter(b.row),a.render(),c=d.length-1;c>=0;c--)this._moveRows(d[c],a)},c.prototype._sortChildRows=function(a){return this._moveRows(a,a)},c}(),d={init:function(b,d){var e;return e=a.extend({branchAttr:"ttBranch",clickableNodeNames:!1,column:0,columnElType:"td",expandable:!1,expanderTemplate:"<a href='#'>&nbsp;</a>",indent:19,indenterTemplate:"<span class='indenter'></span>",initialState:"collapsed",nodeIdAttr:"ttId",parentIdAttr:"ttParentId",stringExpand:"Expand",stringCollapse:"Collapse",onInitialized:null,onNodeCollapse:null,onNodeExpand:null,onNodeInitialized:null},b),this.each(function(){var b,f=a(this);return(d||void 0===f.data("treetable"))&&(b=new c(this,e),b.loadRows(this.rows).render(),f.addClass("treetable").data("treetable",b),null!=e.onInitialized&&e.onInitialized.apply(b)),f})},destroy:function(){return this.each(function(){return a(this).removeData("treetable").removeClass("treetable")})},collapseAll:function(){return this.data("treetable").collapseAll(),this},collapseNode:function(a){var b=this.data("treetable").tree[a];if(!b)throw new Error("Unknown node '"+a+"'");return b.collapse(),this},expandAll:function(){return this.data("treetable").expandAll(),this},expandNode:function(a){var b=this.data("treetable").tree[a];if(!b)throw new Error("Unknown node '"+a+"'");return b.initialized||b._initialize(),b.expand(),this},loadBranch:function(b,c){var d=this.data("treetable").settings,e=this.data("treetable").tree;if(c=a(c),null==b)this.append(c);else{var f=this.data("treetable").findLastNode(b);c.insertAfter(f.row)}return this.data("treetable").loadRows(c),c.filter("tr").each(function(){e[a(this).data(d.nodeIdAttr)].show()}),null!=b&&b.render().expand(),this},move:function(a,b){var c,d;return d=this.data("treetable").tree[a],c=this.data("treetable").tree[b],this.data("treetable").move(d,c),this},node:function(a){return this.data("treetable").tree[a]},removeNode:function(a){var b=this.data("treetable").tree[a];if(!b)throw new Error("Unknown node '"+a+"'");return this.data("treetable").removeNode(b),this},reveal:function(a){var b=this.data("treetable").tree[a];if(!b)throw new Error("Unknown node '"+a+"'");return b.reveal(),this},sortBranch:function(b,c){var d,e=this.data("treetable").settings;return c=c||e.column,d=c,a.isNumeric(c)&&(d=function(b,d){var e,f,g;return e=function(b){var d=b.row.find("td:eq("+c+")").text();return a.trim(d).toUpperCase()},f=e(b),g=e(d),g>f?-1:f>g?1:0}),this.data("treetable").sortBranch(b,d),this},unloadBranch:function(a){return this.data("treetable").unloadBranch(a),this}},a.fn.treetable=function(b){return d[b]?d[b].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof b&&b?a.error("Method "+b+" does not exist on jQuery.treetable"):d.init.apply(this,arguments)},this.TreeTable||(this.TreeTable={}),this.TreeTable.Node=b,this.TreeTable.Tree=c}.call(this),!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof module&&module.exports?module.exports=function(b,c){return void 0===c&&(c="undefined"!=typeof window?require("jquery"):require("jquery")(b)),a(c),c}:a(jQuery)}(function(a){"use strict";a.FE.PLUGINS.align=function(b){function c(c){b.selection.save(),b.html.wrap(!0,!0,!0),b.selection.restore();for(var d=b.selection.blocks(),e=0;e<d.length;e++)a(d[e]).css("text-align",c).removeClass("fr-temp-div"),""===a(d[e]).attr("class")&&a(d[e]).removeAttr("class");b.selection.save(),b.html.unwrap(),b.selection.restore()}function d(c){var d=b.selection.blocks();if(d.length){var e=b.helpers.getAlignment(a(d[0]));c.find("> *:first").replaceWith(b.icon.create("align-"+e))}}function e(c,d){var e=b.selection.blocks();if(e.length){var f=b.helpers.getAlignment(a(e[0]));d.find('a.fr-command[data-param1="'+f+'"]').addClass("fr-active")}}return{apply:c,refresh:d,refreshOnShow:e}},a.FE.DefineIcon("align",{NAME:"align-left"}),a.FE.DefineIcon("align-left",{NAME:"align-left"}),a.FE.DefineIcon("align-right",{NAME:"align-right"}),a.FE.DefineIcon("align-center",{NAME:"align-center"}),a.FE.DefineIcon("align-justify",{NAME:"align-justify"}),a.FE.RegisterCommand("align",{type:"dropdown",title:"Align",options:{left:"Align Left",center:"Align Center",right:"Align Right",justify:"Align Justify"},html:function(){var b='<ul class="fr-dropdown-list">',c=a.FE.COMMANDS.align.options;for(var d in c)b+='<li><a class="fr-command fr-title" data-cmd="align" data-param1="'+d+'" title="'+this.language.translate(c[d])+'">'+this.icon.create("align-"+d)+"</a></li>";return b+="</ul>"},callback:function(a,b){this.align.apply(b)},refresh:function(a){this.align.refresh(a)},refreshOnShow:function(a,b){this.align.refreshOnShow(a,b)},plugin:"align"})}),!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof module&&module.exports?module.exports=function(b,c){return void 0===c&&(c="undefined"!=typeof window?require("jquery"):require("jquery")(b)),a(c),c}:a(jQuery)}(function(a){"use strict";a.extend(a.FE.DEFAULTS,{charCounterMax:-1,charCounterCount:!0}),a.FE.PLUGINS.charCounter=function(b){function c(){return b.$el.text().length}function d(a){if(b.opts.charCounterMax<0)return!0;if(c()<b.opts.charCounterMax)return!0;var d=a.which;return!b.keys.ctrlKey(a)&&b.keys.isCharacter(d)?(a.preventDefault(),a.stopPropagation(),b.events.trigger("charCounter.exceeded"),!1):!0}function e(d){if(b.opts.charCounterMax<0)return d;var e=a("<div>").html(d).text().length;return e+c()<=b.opts.charCounterMax?d:(b.events.trigger("charCounter.exceeded"),"")}function f(){if(b.opts.charCounterCount){var a=c()+(b.opts.charCounterMax>0?"/"+b.opts.charCounterMax:"");h.text(a),b.opts.toolbarBottom&&h.css("margin-bottom",b.$tb.outerHeight(!0));var d=b.$wp.get(0).offsetWidth-b.$wp.get(0).clientWidth;d>=0&&("rtl"==b.opts.direction?h.css("margin-left",d):h.css("margin-right",d))}}function g(){return b.$wp&&b.opts.charCounterCount?(h=a('<span class="fr-counter"></span>'),h.css("bottom",b.$wp.css("border-bottom-width")),b.$box.append(h),b.events.on("keydown",d,!0),b.events.on("paste.afterCleanup",e),b.events.on("keyup",f),b.events.on("contentChanged",f),b.events.on("charCounter.update",f),f(),void b.events.on("destroy",function(){a(b.o_win).off("resize.char"+b.id),h.removeData().remove()})):!1}var h;return{_init:g,count:c}}}),!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof module&&module.exports?module.exports=function(b,c){return void 0===c&&(c="undefined"!=typeof window?require("jquery"):require("jquery")(b)),a(c),c}:a(jQuery)}(function(a){"use strict";a.extend(a.FE.POPUP_TEMPLATES,{"colors.picker":"[_BUTTONS_][_TEXT_COLORS_][_BACKGROUND_COLORS_]"}),a.extend(a.FE.DEFAULTS,{colorsText:["#61BD6D","#1ABC9C","#54ACD2","#2C82C9","#9365B8","#475577","#CCCCCC","#41A85F","#00A885","#3D8EB9","#2969B0","#553982","#28324E","#000000","#F7DA64","#FBA026","#EB6B56","#E25041","#A38F84","#EFEFEF","#FFFFFF","#FAC51C","#F37934","#D14841","#B8312F","#7C706B","#D1D5D8","REMOVE"],colorsBackground:["#61BD6D","#1ABC9C","#54ACD2","#2C82C9","#9365B8","#475577","#CCCCCC","#41A85F","#00A885","#3D8EB9","#2969B0","#553982","#28324E","#000000","#F7DA64","#FBA026","#EB6B56","#E25041","#A38F84","#EFEFEF","#FFFFFF","#FAC51C","#F37934","#D14841","#B8312F","#7C706B","#D1D5D8","REMOVE"],colorsStep:7,colorsDefaultTab:"text",colorsButtons:["colorsBack","|","-"]}),a.FE.PLUGINS.colors=function(b){function c(){var a=b.$tb.find('.fr-command[data-cmd="color"]'),c=b.popups.get("colors.picker");if(c||(c=e()),!c.hasClass("fr-active")){b.popups.setContainer("colors.picker",b.$tb),h(c.find(".fr-selected-tab").attr("data-param1"));var d=a.offset().left+a.outerWidth()/2,f=a.offset().top+(b.opts.toolbarBottom?10:a.outerHeight()-10);b.popups.show("colors.picker",d,f,a.outerHeight())}}function d(){b.popups.hide("colors.picker")}function e(){var a='<div class="fr-buttons fr-colors-buttons">';b.opts.toolbarInline&&b.opts.colorsButtons.length>0&&(a+=b.button.buildList(b.opts.colorsButtons)),a+=f()+"</div>";var c={buttons:a,text_colors:g("text"),background_colors:g("background")},d=b.popups.create("colors.picker",c);return d}function f(){var a='<div class="fr-colors-tabs">';return a+='<span class="fr-colors-tab '+("background"==b.opts.colorsDefaultTab?"":"fr-selected-tab ")+'fr-command" data-param1="text" data-cmd="colorChangeSet" title="'+b.language.translate("Text")+'">'+b.language.translate("Text")+"</span>",a+='<span class="fr-colors-tab '+("background"==b.opts.colorsDefaultTab?"fr-selected-tab ":"")+'fr-command" data-param1="background" data-cmd="colorChangeSet" title="'+b.language.translate("Background")+'">'+b.language.translate("Background")+"</span>",a+"</div>"}function g(a){for(var c="text"==a?b.opts.colorsText:b.opts.colorsBackground,d='<div class="fr-color-set fr-'+a+"-color"+(b.opts.colorsDefaultTab==a||"text"!=b.opts.colorsDefaultTab&&"background"!=b.opts.colorsDefaultTab&&"text"==a?" fr-selected-set":"")+'">',e=0;e<c.length;e++)0!==e&&e%b.opts.colorsStep===0&&(d+="<br>"),d+="REMOVE"!=c[e]?'<span class="fr-command fr-select-color" style="background: '+c[e]+';" data-cmd="'+a+'Color" data-param1="'+c[e]+'"></span>':'<span class="fr-command fr-select-color" data-cmd="'+a+'Color" data-param1="REMOVE" title="'+b.language.translate("Clear Formatting")+'"><i class="fa fa-eraser"></i></span>';return d+"</div>"}function h(c){var d,e=b.popups.get("colors.picker"),f=a(b.selection.element());for(d="background"==c?"background-color":"color",e.find(".fr-"+c+"-color .fr-select-color").removeClass("fr-selected-color");f.get(0)!=b.$el.get(0);){if("transparent"!=f.css(d)&&"rgba(0, 0, 0, 0)"!=f.css(d)){e.find(".fr-"+c+'-color .fr-select-color[data-param1="'+b.helpers.RGBToHex(f.css(d))+'"]').addClass("fr-selected-color");break}f=f.parent()}}function i(a,b){a.hasClass("fr-selected-tab")||(a.siblings().removeClass("fr-selected-tab"),a.addClass("fr-selected-tab"),a.parents(".fr-popup").find(".fr-color-set").removeClass("fr-selected-set"),a.parents(".fr-popup").find(".fr-color-set.fr-"+b+"-color").addClass("fr-selected-set"),h(b))}function j(c){"REMOVE"!=c?b.commands.applyProperty("background-color",b.helpers.HEXtoRGB(c)):(b.commands.applyProperty("background-color","#123456"),b.selection.save(),b.$el.find("span").each(function(c,d){var e=a(d),f=e.css("background-color");("#123456"===f||"#123456"===b.helpers.RGBToHex(f))&&e.replaceWith(e.html())}),b.selection.restore()),d()}function k(c){"REMOVE"!=c?b.commands.applyProperty("color",b.helpers.HEXtoRGB(c)):(b.commands.applyProperty("color","#123456"),b.selection.save(),b.$el.find("span").each(function(c,d){var e=a(d),f=e.css("color");("#123456"===f||"#123456"===b.helpers.RGBToHex(f))&&e.replaceWith(e.html())}),b.selection.restore()),d()}function l(){b.popups.hide("colors.picker"),b.toolbar.showInline()}return{showColorsPopup:c,hideColorsPopup:d,changeSet:i,background:j,text:k,back:l}},a.FE.DefineIcon("colors",{NAME:"tint"}),a.FE.RegisterCommand("color",{title:"Colors",undo:!1,focus:!0,refreshOnCallback:!1,popup:!0,callback:function(){this.popups.isVisible("colors.picker")?(this.$el.find(".fr-marker")&&(this.events.disableBlur(),this.selection.restore()),this.popups.hide("colors.picker")):this.colors.showColorsPopup()},plugin:"colors"}),a.FE.RegisterCommand("textColor",{undo:!0,callback:function(a,b){this.colors.text(b)}}),a.FE.RegisterCommand("backgroundColor",{undo:!0,callback:function(a,b){this.colors.background(b)}}),a.FE.RegisterCommand("colorChangeSet",{undo:!1,focus:!1,callback:function(a,b){var c=this.popups.get("colors.picker").find('.fr-command[data-cmd="'+a+'"][data-param1="'+b+'"]');this.colors.changeSet(c,b)}}),a.FE.DefineIcon("colorsBack",{NAME:"arrow-left"}),a.FE.RegisterCommand("colorsBack",{title:"Back",undo:!1,focus:!1,back:!0,refreshAfterCallback:!1,callback:function(){this.colors.back()}})}),!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof module&&module.exports?module.exports=function(b,c){return void 0===c&&(c="undefined"!=typeof window?require("jquery"):require("jquery")(b)),a(c),c}:a(jQuery)}(function(a){"use strict";a.extend(a.FE.DEFAULTS,{dragInline:!0}),a.FE.PLUGINS.draggable=function(b){function c(c){return a(c.target).hasClass("fr-draggable")?(a(c.target).addClass("fr-dragging"),b.opts.dragInline?b.$el.attr("contenteditable",!0):b.$el.attr("contenteditable",!1),b.opts.toolbarInline&&b.toolbar.hide(),b.undo.canDo()||b.undo.saveStep(),b.browser.msie||b.browser.edge||b.selection.clear(),void c.originalEvent.dataTransfer.setData("text","Froala")):(c.preventDefault(),!1)}function d(a){return!(a&&("HTML"==a.tagName||"BODY"==a.tagName||b.node.isElement(a)))}function e(a,c,d){b.opts.iframe&&(a+=b.$iframe.offset().top,c+=b.$iframe.offset().left),l.offset().top!=a&&l.css("top",a),l.offset().left!=c&&l.css("left",c),l.width()!=d&&l.css("width",d)}function f(c){var f=b.doc.elementFromPoint(c.originalEvent.pageX-b.win.pageXOffset,c.originalEvent.pageY-b.win.pageYOffset);if(!d(f)){for(var g=0,h=f;!d(h)&&h==f&&c.originalEvent.pageY-b.win.pageYOffset-g>0;)g++,h=b.doc.elementFromPoint(c.originalEvent.pageX-b.win.pageXOffset,c.originalEvent.pageY-b.win.pageYOffset-g);(!d(h)||0===b.$el.find(h).length&&h!=l.get(0))&&(h=null);for(var i=0,j=f;!d(j)&&j==f&&c.originalEvent.pageY-b.win.pageYOffset+i<a(b.doc).height();)i++,j=b.doc.elementFromPoint(c.originalEvent.pageX-b.win.pageXOffset,c.originalEvent.pageY-b.win.pageYOffset+i);(!d(j)||0===b.$el.find(j).length&&j!=l.get(0))&&(j=null),f=null==j&&h?h:j&&null==h?j:j&&h?i>g?h:j:null}if(a(f).hasClass("fr-drag-helper"))return!1;if(f&&!b.node.isBlock(f)&&(f=b.node.blockParent(f)),f&&["TD","TH","TR","THEAD","TBODY"].indexOf(f.tagName)>=0&&(f=a(f).parents("table").get(0)),f&&["LI"].indexOf(f.tagName)>=0&&(f=a(f).parents("UL, OL").get(0)),f&&!a(f).hasClass("fr-drag-helper")){l||(a.FE.$draggable_helper||(a.FE.$draggable_helper=a('<div class="fr-drag-helper"></div>')),l=a.FE.$draggable_helper,b.events.on("shared.destroy",function(){l.html("").removeData().remove()},!0));var k,m=c.originalEvent.pageY;k=m<a(f).offset().top+a(f).outerHeight()/2;var n=a(f),o=0;k||0!==n.next().length?(k||(n=n.next()),"before"==l.data("fr-position")&&n.is(l.data("fr-tag"))||(n.prev().length>0&&(o=parseFloat(n.prev().css("margin-bottom"))||0),o=Math.max(o,parseFloat(n.css("margin-top"))||0),e(n.offset().top-o/2-b.$box.offset().top,n.offset().left-b.win.pageXOffset-b.$box.offset().left,n.width()),l.data("fr-position","before"))):"after"==l.data("fr-position")&&n.is(l.data("fr-tag"))||(o=parseFloat(n.css("margin-bottom"))||0,e(n.offset().top+a(f).height()+o/2-b.$box.offset().top,n.offset().left-b.win.pageXOffset-b.$box.offset().left,n.width()),l.data("fr-position","after")),l.data("fr-tag",n),l.addClass("fr-visible"),l.appendTo(b.$box)}else l&&b.$box.find(l).length>0&&l.removeClass("fr-visible")}function g(a){a.originalEvent.dataTransfer.dropEffect="move",b.opts.dragInline||(a.preventDefault(),f(a))}function h(a){a.originalEvent.dataTransfer.dropEffect="move",b.opts.dragInline||a.preventDefault()}function i(a){b.$el.attr("contenteditable",!0);var c=b.$el.find(".fr-dragging");l&&l.hasClass("fr-visible")&&b.$box.find(l).length?j(a):c.length&&(a.preventDefault(),a.stopPropagation(),l&&!l.hasClass("fr-visible")&&c.removeClass("fr-dragging"))}function j(c){for(var d,e,f=0;f<a.FE.INSTANCES.length;f++)if(d=a.FE.INSTANCES[f].$el.find(".fr-dragging"),d.length){e=a.FE.INSTANCES[f];break}if(d.length){if(c.preventDefault(),c.stopPropagation(),l&&l.hasClass("fr-visible")&&b.$box.find(l).length)l.data("fr-tag")[l.data("fr-position")]('<span class="fr-marker"></span>'),l.removeClass("fr-visible");else{var g=b.markers.insertAtPoint(c.originalEvent);if(g===!1)return!1}if(b.popups.hideAll(),e==b||b.undo.canDo()||b.undo.saveStep(),b.core.isEmpty())b.$el.html(d);else{var h=b.$el.find(".fr-marker");h.replaceWith(d),d.after(a.FE.MARKERS),b.selection.restore()}return d.removeClass("fr-dragging"),b.$el.find(b.html.emptyBlockTagsQuery()).remove(),b.html.wrap(),b.undo.saveStep(),e!=b&&(e.popups.hideAll(),e.$el.find(b.html.emptyBlockTagsQuery()).remove(),e.html.wrap(),e.undo.saveStep(),e.events.trigger("element.dropped")),b.opts.iframe&&b.size.syncIframe(),b.events.trigger("element.dropped",[d]),!1}}function k(){b.opts.enter==a.FE.ENTER_BR&&(b.opts.dragInline=!0),b.events.on("dragstart",c,!0),b.events.on("dragover",g,!0),b.events.on("dragenter",h,!0),b.events.on("document.dragend",i,!0),b.events.on("document.drop",i,!0),b.events.on("drop",j,!0),b.events.on("html.get",function(a){return a=a.replace(/<(div)((?:[\w\W]*?))class="([\w\W]*?)fr-drag-helper([\w\W]*?)"((?:[\w\W]*?))>((?:[\w\W]*?))<\/(div)>/g,"")})}var l;return{_init:k}}}),!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof module&&module.exports?module.exports=function(b,c){return void 0===c&&(c="undefined"!=typeof window?require("jquery"):require("jquery")(b)),a(c),c}:a(jQuery)}(function(a){"use strict";a.extend(a.FE.POPUP_TEMPLATES,{emoticons:"[_BUTTONS_][_EMOTICONS_]"}),a.extend(a.FE.DEFAULTS,{emoticonsStep:8,emoticonsSet:[{code:"1f600",desc:"Grinning face"},{code:"1f601",desc:"Grinning face with smiling eyes"},{code:"1f602",desc:"Face with tears of joy"},{code:"1f603",desc:"Smiling face with open mouth"},{code:"1f604",desc:"Smiling face with open mouth and smiling eyes"},{code:"1f605",desc:"Smiling face with open mouth and cold sweat"},{code:"1f606",desc:"Smiling face with open mouth and tightly-closed eyes"},{code:"1f607",desc:"Smiling face with halo"},{code:"1f608",desc:"Smiling face with horns"},{code:"1f609",desc:"Winking face"},{code:"1f60a",desc:"Smiling face with smiling eyes"},{code:"1f60b",desc:"Face savoring delicious food"},{code:"1f60c",desc:"Relieved face"},{code:"1f60d",desc:"Smiling face with heart-shaped eyes"},{code:"1f60e",desc:"Smiling face with sunglasses"},{code:"1f60f",desc:"Smirking face"},{code:"1f610",desc:"Neutral face"},{code:"1f611",desc:"Expressionless face"},{code:"1f612",desc:"Unamused face"},{code:"1f613",desc:"Face with cold sweat"},{code:"1f614",desc:"Pensive face"},{code:"1f615",desc:"Confused face"},{code:"1f616",desc:"Confounded face"},{code:"1f617",desc:"Kissing face"},{code:"1f618",desc:"Face throwing a kiss"},{code:"1f619",desc:"Kissing face with smiling eyes"},{code:"1f61a",desc:"Kissing face with closed eyes"},{code:"1f61b",desc:"Face with stuck out tongue"},{code:"1f61c",
desc:"Face with stuck out tongue and winking eye"},{code:"1f61d",desc:"Face with stuck out tongue and tightly-closed eyes"},{code:"1f61e",desc:"Disappointed face"},{code:"1f61f",desc:"Worried face"},{code:"1f620",desc:"Angry face"},{code:"1f621",desc:"Pouting face"},{code:"1f622",desc:"Crying face"},{code:"1f623",desc:"Persevering face"},{code:"1f624",desc:"Face with look of triumph"},{code:"1f625",desc:"Disappointed but relieved face"},{code:"1f626",desc:"Frowning face with open mouth"},{code:"1f627",desc:"Anguished face"},{code:"1f628",desc:"Fearful face"},{code:"1f629",desc:"Weary face"},{code:"1f62a",desc:"Sleepy face"},{code:"1f62b",desc:"Tired face"},{code:"1f62c",desc:"Grimacing face"},{code:"1f62d",desc:"Loudly crying face"},{code:"1f62e",desc:"Face with open mouth"},{code:"1f62f",desc:"Hushed face"},{code:"1f630",desc:"Face with open mouth and cold sweat"},{code:"1f631",desc:"Face screaming in fear"},{code:"1f632",desc:"Astonished face"},{code:"1f633",desc:"Flushed face"},{code:"1f634",desc:"Sleeping face"},{code:"1f635",desc:"Dizzy face"},{code:"1f636",desc:"Face without mouth"},{code:"1f637",desc:"Face with medical mask"}],emoticonsButtons:["emoticonsBack","|"],emoticonsUseImage:!0}),a.FE.PLUGINS.emoticons=function(b){function c(){var a=b.$tb.find('.fr-command[data-cmd="emoticons"]'),c=b.popups.get("emoticons");if(c||(c=e()),!c.hasClass("fr-active")){b.popups.refresh("emoticons"),b.popups.setContainer("emoticons",b.$tb);var d=a.offset().left+a.outerWidth()/2,f=a.offset().top+(b.opts.toolbarBottom?10:a.outerHeight()-10);b.popups.show("emoticons",d,f,a.outerHeight())}}function d(){b.popups.hide("emoticons")}function e(){var a="";b.opts.toolbarInline&&b.opts.emoticonsButtons.length>0&&(a='<div class="fr-buttons fr-emoticons-buttons">'+b.button.buildList(b.opts.emoticonsButtons)+"</div>");var c={buttons:a,emoticons:f()},d=b.popups.create("emoticons",c);return b.tooltip.bind(d,".fr-emoticon"),d}function f(){for(var a='<div style="text-align: center">',c=0;c<b.opts.emoticonsSet.length;c++)0!==c&&c%b.opts.emoticonsStep===0&&(a+="<br>"),a+='<span class="fr-command fr-emoticon" data-cmd="insertEmoticon" title="'+b.language.translate(b.opts.emoticonsSet[c].desc)+'" data-param1="'+b.opts.emoticonsSet[c].code+'">'+(b.opts.emoticonsUseImage?'<img src="https://cdnjs.cloudflare.com/ajax/libs/emojione/2.0.1/assets/svg/'+b.opts.emoticonsSet[c].code+'.svg"/>':"&#x"+b.opts.emoticonsSet[c].code+";")+"</span>";return b.opts.emoticonsUseImage&&(a+='<p style="font-size: 12px; text-align: center; padding: 0 5px;">Emoji free by <a href="http://emojione.com/" target="_blank" rel="nofollow">Emoji One</a></p>'),a+="</div>"}function g(c,d){b.html.insert('<span class="fr-emoticon'+(d?" fr-emoticon-img":"")+'"'+(d?' style="background: url('+d+')"':"")+">"+(d?"&nbsp;":c)+"</span>"+a.FE.MARKERS,!0)}function h(){b.popups.hide("emoticons"),b.toolbar.showInline()}function i(){b.events.on("html.get",function(c){for(var d=0;d<b.opts.emoticonsSet.length;d++){var e=b.opts.emoticonsSet[d],f=a("<div>").html(e.code).text();c=c.split(f).join(e.code)}return c});var c=function(){if(!b.selection.isCollapsed())return!1;var c=b.selection.element(),d=b.selection.endElement();if(a(c).hasClass("fr-emoticon"))return c;if(a(d).hasClass("fr-emoticon"))return d;var e=b.selection.ranges(0),f=e.startContainer;if(f.nodeType==Node.ELEMENT_NODE&&f.childNodes.length>0&&e.startOffset>0){var g=f.childNodes[e.startOffset-1];if(a(g).hasClass("fr-emoticon"))return g}return!1};b.events.on("keydown",function(d){if(b.keys.isCharacter(d.which)&&b.selection.inEditor()){var e=b.selection.ranges(0),f=c();f&&(0===e.startOffset?a(f).before(a.FE.MARKERS+a.FE.INVISIBLE_SPACE):a(f).after(a.FE.INVISIBLE_SPACE+a.FE.MARKERS),b.selection.restore())}}),b.events.on("keyup",function(){for(var c=b.$el.get(0).querySelectorAll(".fr-emoticon"),d=0;d<c.length;d++)"undefined"!=typeof c[d].textContent&&0===c[d].textContent.replace(/\u200B/gi,"").length&&a(c[d]).remove()})}return{_init:i,insert:g,showEmoticonsPopup:c,hideEmoticonsPopup:d,back:h}},a.FE.DefineIcon("emoticons",{NAME:"smile-o"}),a.FE.RegisterCommand("emoticons",{title:"Emoticons",undo:!1,focus:!0,refreshOnCallback:!1,popup:!0,callback:function(){this.popups.isVisible("emoticons")?(this.$el.find(".fr-marker")&&(this.events.disableBlur(),this.selection.restore()),this.popups.hide("emoticons")):this.emoticons.showEmoticonsPopup()},plugin:"emoticons"}),a.FE.RegisterCommand("insertEmoticon",{callback:function(a,b){this.emoticons.insert("&#x"+b+";",this.opts.emoticonsUseImage?"https://cdnjs.cloudflare.com/ajax/libs/emojione/2.0.1/assets/svg/"+b+".svg":null),this.emoticons.hideEmoticonsPopup()}}),a.FE.DefineIcon("emoticonsBack",{NAME:"arrow-left"}),a.FE.RegisterCommand("emoticonsBack",{title:"Back",undo:!1,focus:!1,back:!0,refreshAfterCallback:!1,callback:function(){this.emoticons.back()}})}),!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof module&&module.exports?module.exports=function(b,c){return void 0===c&&(c="undefined"!=typeof window?require("jquery"):require("jquery")(b)),a(c),c}:a(jQuery)}(function(a){"use strict";a.extend(a.FE.DEFAULTS,{entities:"&amp;&lt;&gt;&quot;&apos;&iexcl;&cent;&pound;&curren;&yen;&brvbar;&sect;&uml;&copy;&ordf;&laquo;&not;&shy;&reg;&macr;&deg;&plusmn;&sup2;&sup3;&acute;&micro;&para;&middot;&cedil;&sup1;&ordm;&raquo;&frac14;&frac12;&frac34;&iquest;&Agrave;&Aacute;&Acirc;&Atilde;&Auml;&Aring;&AElig;&Ccedil;&Egrave;&Eacute;&Ecirc;&Euml;&Igrave;&Iacute;&Icirc;&Iuml;&ETH;&Ntilde;&Ograve;&Oacute;&Ocirc;&Otilde;&Ouml;&times;&Oslash;&Ugrave;&Uacute;&Ucirc;&Uuml;&Yacute;&THORN;&szlig;&agrave;&aacute;&acirc;&atilde;&auml;&aring;&aelig;&ccedil;&egrave;&eacute;&ecirc;&euml;&igrave;&iacute;&icirc;&iuml;&eth;&ntilde;&ograve;&oacute;&ocirc;&otilde;&ouml;&divide;&oslash;&ugrave;&uacute;&ucirc;&uuml;&yacute;&thorn;&yuml;&OElig;&oelig;&Scaron;&scaron;&Yuml;&fnof;&circ;&tilde;&Alpha;&Beta;&Gamma;&Delta;&Epsilon;&Zeta;&Eta;&Theta;&Iota;&Kappa;&Lambda;&Mu;&Nu;&Xi;&Omicron;&Pi;&Rho;&Sigma;&Tau;&Upsilon;&Phi;&Chi;&Psi;&Omega;&alpha;&beta;&gamma;&delta;&epsilon;&zeta;&eta;&theta;&iota;&kappa;&lambda;&mu;&nu;&xi;&omicron;&pi;&rho;&sigmaf;&sigma;&tau;&upsilon;&phi;&chi;&psi;&omega;&thetasym;&upsih;&piv;&ensp;&emsp;&thinsp;&zwnj;&zwj;&lrm;&rlm;&ndash;&mdash;&lsquo;&rsquo;&sbquo;&ldquo;&rdquo;&bdquo;&dagger;&Dagger;&bull;&hellip;&permil;&prime;&Prime;&lsaquo;&rsaquo;&oline;&frasl;&euro;&image;&weierp;&real;&trade;&alefsym;&larr;&uarr;&rarr;&darr;&harr;&crarr;&lArr;&uArr;&rArr;&dArr;&hArr;&forall;&part;&exist;&empty;&nabla;&isin;&notin;&ni;&prod;&sum;&minus;&lowast;&radic;&prop;&infin;&ang;&and;&or;&cap;&cup;&int;&there4;&sim;&cong;&asymp;&ne;&equiv;&le;&ge;&sub;&sup;&nsub;&sube;&supe;&oplus;&otimes;&perp;&sdot;&lceil;&rceil;&lfloor;&rfloor;&lang;&rang;&loz;&spades;&clubs;&hearts;&diams;"}),a.FE.PLUGINS.entities=function(b){function c(a){for(var d=b.node.contents(a),e=0;e<d.length;e++)if(d[e].nodeType==Node.TEXT_NODE){var h=d[e].textContent;if(h.match(f)){for(var i="",j=0;j<h.length;j++)i+=g[h[j]]?g[h[j]]:h[j];d[e].textContent=i}}else c(d[e])}function d(a){return 0===a.length?"":b.clean.exec(a,c)}function e(){b.opts.htmlSimpleAmpersand&&(b.opts.entities=b.opts.entities.replace("&amp;",""));var c=a("<div>").html(b.opts.entities).text(),e=b.opts.entities.split(";");g={},f="";for(var h=0;h<c.length;h++){var i=c.charAt(h);g[i]=e[h]+";",f+="\\"+i+(h<c.length-1?"|":"")}f=new RegExp("("+f+")","g"),b.events.on("html.get",d,!0)}var f,g;return{_init:e}}}),!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof module&&module.exports?module.exports=function(b,c){return void 0===c&&(c="undefined"!=typeof window?require("jquery"):require("jquery")(b)),a(c),c}:a(jQuery)}(function(a){"use strict";a.extend(a.FE.POPUP_TEMPLATES,{"file.insert":"[_BUTTONS_][_UPLOAD_LAYER_][_PROGRESS_BAR_]"}),a.extend(a.FE.DEFAULTS,{fileUploadURL:"http://i.froala.com/upload",fileUploadParam:"file",fileUploadParams:{},fileUploadToS3:!1,fileUploadMethod:"POST",fileMaxSize:10485760,fileAllowedTypes:["*"],fileInsertButtons:["fileBack","|"],fileUseSelectedText:!1}),a.FE.PLUGINS.file=function(b){function c(){var a=b.$tb.find('.fr-command[data-cmd="insertFile"]'),c=b.popups.get("file.insert");if(c||(c=r()),e(),!c.hasClass("fr-active")){b.popups.refresh("file.insert"),b.popups.setContainer("file.insert",b.$tb);var d=a.offset().left+a.outerWidth()/2,f=a.offset().top+(b.opts.toolbarBottom?0:a.outerHeight());b.popups.show("file.insert",d,f,a.outerHeight())}}function d(){var a=b.popups.get("file.insert");a&&(a.find(".fr-layer.fr-active").removeClass("fr-active").addClass("fr-pactive"),a.find(".fr-file-progress-bar-layer").addClass("fr-active"),a.find(".fr-buttons").hide(),f("Uploading",0))}function e(a){var c=b.popups.get("file.insert");c&&(c.find(".fr-layer.fr-pactive").addClass("fr-active").removeClass("fr-pactive"),c.find(".fr-file-progress-bar-layer").removeClass("fr-active"),c.find(".fr-buttons").show(),a&&b.popups.show("file.insert",null,null))}function f(a,c){var d=b.popups.get("file.insert");if(d){var e=d.find(".fr-file-progress-bar-layer");e.find("h3").text(a+(c?" "+c+"%":"")),e.removeClass("fr-error"),c?(e.find("div").removeClass("fr-indeterminate"),e.find("div > span").css("width",c+"%")):e.find("div").addClass("fr-indeterminate")}}function g(a){var c=b.popups.get("file.insert"),d=c.find(".fr-file-progress-bar-layer");d.addClass("fr-error"),d.find("h3").text(a)}function h(a,c,d){b.edit.on(),b.events.focus(!0),b.selection.restore(),b.html.insert('<a href="'+a+'" id="fr-inserted-file" class="fr-file">'+(c||b.selection.text())+"</a>");var e=b.$el.find("#fr-inserted-file");e.removeAttr("id"),b.popups.hide("file.insert"),b.undo.saveStep(),b.events.trigger("file.inserted",[e,d])}function i(c){try{if(b.events.trigger("file.uploaded",[c],!0)===!1)return b.edit.on(),!1;var d=a.parseJSON(c);return d.link?d:(n(y,c),!1)}catch(e){return n(A,c),!1}}function j(c){try{var d=a(c).find("Location").text(),e=a(c).find("Key").text();return b.events.trigger("file.uploadedToS3",[d,e,c],!0)===!1?(b.edit.on(),!1):d}catch(f){return n(A,c),!1}}function k(a){var c=this.status,d=this.response,e=this.responseXML,f=this.responseText;try{if(b.opts.fileUploadToS3)if(201==c){var g=j(e);g&&h(g,a,d||e)}else n(A,d||e);else if(c>=200&&300>c){var k=i(f);k&&h(k.link,a,d||f)}else n(z,d||f)}catch(l){n(A,d||f)}}function l(){n(A,this.response||this.responseText||this.responseXML)}function m(a){if(a.lengthComputable){var b=a.loaded/a.total*100|0;f("Uploading",b)}}function n(a,c){b.edit.on(),g(b.language.translate("Something went wrong. Please try again.")),b.events.trigger("file.error",[{code:a,message:E[a]},c])}function o(a){if(b.events.trigger("file.beforeUpload",[a])===!1)return!1;if("undefined"!=typeof a&&a.length>0){var c=a[0];if(c.size>b.opts.fileMaxSize)return n(B),!1;if(b.opts.fileAllowedTypes.indexOf("*")<0&&b.opts.fileAllowedTypes.indexOf(c.type.replace(/file\//g,""))<0)return n(C),!1;var e;if(b.drag_support.formdata&&(e=b.drag_support.formdata?new FormData:null),e){var f;if(b.opts.fileUploadToS3!==!1){e.append("key",b.opts.fileUploadToS3.keyStart+(new Date).getTime()+"-"+(c.name||"untitled")),e.append("success_action_status","201"),e.append("X-Requested-With","xhr"),e.append("Content-Type",c.type);for(f in b.opts.fileUploadToS3.params)e.append(f,b.opts.fileUploadToS3.params[f])}for(f in b.opts.fileUploadParams)e.append(f,b.opts.fileUploadParams[f]);e.append(b.opts.fileUploadParam,c);var g=b.opts.fileUploadURL;b.opts.fileUploadToS3&&(g="https://"+b.opts.fileUploadToS3.region+".amazonaws.com/"+b.opts.fileUploadToS3.bucket);var h=b.core.getXHR(g,b.opts.fileUploadMethod);h.onload=function(){k.call(h,[b.opts.fileUseSelectedText?null:c.name])},h.onerror=l,h.upload.onprogress=m,d(),b.edit.off(),h.send(e)}}}function p(c){b.events.$on(c,"dragover dragenter",".fr-file-upload-layer",function(){return a(this).addClass("fr-drop"),!1},!0),b.events.$on(c,"dragleave dragend",".fr-file-upload-layer",function(){return a(this).removeClass("fr-drop"),!1},!0),b.events.$on(c,"drop",".fr-file-upload-layer",function(b){b.preventDefault(),b.stopPropagation(),a(this).removeClass("fr-drop");var c=b.originalEvent.dataTransfer;c&&c.files&&o(c.files)},!0),b.events.$on(c,"change",'.fr-file-upload-layer input[type="file"]',function(){this.files&&o(this.files),a(this).val("")},!0)}function q(){e()}function r(a){if(a)return b.popups.onHide("file.insert",q),!0;var c="";c='<div class="fr-buttons">'+b.button.buildList(b.opts.fileInsertButtons)+"</div>";var d="";d='<div class="fr-file-upload-layer fr-layer fr-active" id="fr-file-upload-layer-'+b.id+'"><strong>'+b.language.translate("Drop file")+"</strong><br>("+b.language.translate("or click")+')<div class="fr-form"><input type="file" name="'+b.opts.fileUploadParam+'" accept="/*" tabIndex="-1"></div></div>';var e='<div class="fr-file-progress-bar-layer fr-layer"><h3 class="fr-message">Uploading</h3><div class="fr-loader"><span class="fr-progress"></span></div><div class="fr-action-buttons"><button type="button" class="fr-command" data-cmd="fileDismissError" tabIndex="2">OK</button></div></div>',f={buttons:c,upload_layer:d,progress_bar:e},g=b.popups.create("file.insert",f);return p(g),g}function s(c){return a(c).hasClass("fr-file")?b.events.trigger("file.unlink",[c]):void 0}function t(c){var e=c.originalEvent.dataTransfer;if(e&&e.files&&e.files.length){var f=e.files[0];if(f&&"undefined"!=typeof f.type&&f.type.indexOf("image")<0&&(b.opts.fileAllowedTypes.indexOf(f.type)>=0||b.opts.fileAllowedTypes.indexOf("*")>=0)){b.markers.remove(),b.markers.insertAtPoint(c.originalEvent),b.$el.find(".fr-marker").replaceWith(a.FE.MARKERS),b.popups.hideAll();var g=b.popups.get("file.insert");return g||(g=r()),b.popups.setContainer("file.insert",a(b.opts.scrollableContainer)),b.popups.show("file.insert",c.originalEvent.pageX,c.originalEvent.pageY),d(),o(e.files),c.preventDefault(),c.stopPropagation(),!1}}}function u(){b.events.on("drop",t)}function v(){b.events.disableBlur(),b.selection.restore(),b.events.enableBlur(),b.popups.hide("file.insert"),b.toolbar.showInline()}function w(){u(),b.events.on("link.beforeRemove",s),r(!0)}var x=1,y=2,z=3,A=4,B=5,C=6,D=7,E={};return E[x]="File cannot be loaded from the passed link.",E[y]="No link in upload response.",E[z]="Error during file upload.",E[A]="Parsing response failed.",E[B]="File is too large.",E[C]="File file type is invalid.",E[D]="Files can be uploaded only to same domain in IE 8 and IE 9.",{_init:w,showInsertPopup:c,upload:o,insert:h,back:v,hideProgressBar:e}},a.FE.DefineIcon("insertFile",{NAME:"file-o"}),a.FE.RegisterCommand("insertFile",{title:"Upload File",undo:!1,focus:!0,refershAfterCallback:!1,popup:!0,callback:function(){this.popups.isVisible("file.insert")?(this.$el.find(".fr-marker")&&(this.events.disableBlur(),this.selection.restore()),this.popups.hide("file.insert")):this.file.showInsertPopup()},plugin:"file"}),a.FE.DefineIcon("fileBack",{NAME:"arrow-left"}),a.FE.RegisterCommand("fileBack",{title:"Back",undo:!1,focus:!1,back:!0,refreshAfterCallback:!1,callback:function(){this.file.back()},refresh:function(a){this.opts.toolbarInline?(a.removeClass("fr-hidden"),a.next(".fr-separator").removeClass("fr-hidden")):(a.addClass("fr-hidden"),a.next(".fr-separator").addClass("fr-hidden"))}}),a.FE.RegisterCommand("fileDismissError",{title:"OK",callback:function(){this.file.hideProgressBar(!0)}})}),!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof module&&module.exports?module.exports=function(b,c){return void 0===c&&(c="undefined"!=typeof window?require("jquery"):require("jquery")(b)),a(c),c}:a(jQuery)}(function(a){"use strict";a.extend(a.FE.DEFAULTS,{fontFamily:{"Arial,Helvetica,sans-serif":"Arial","Georgia,serif":"Georgia","Impact,Charcoal,sans-serif":"Impact","Tahoma,Geneva,sans-serif":"Tahoma","Times New Roman,Times,serif":"Times New Roman","Verdana,Geneva,sans-serif":"Verdana"},fontFamilySelection:!1,fontFamilyDefaultSelection:"Font Family"}),a.FE.PLUGINS.fontFamily=function(b){function c(a){b.commands.applyProperty("font-family",a)}function d(a,b){b.find(".fr-command.fr-active").removeClass("fr-active"),b.find('.fr-command[data-param1="'+g()+'"]').addClass("fr-active");var c=b.find(".fr-dropdown-list"),d=b.find(".fr-active").parent();d.length?c.parent().scrollTop(d.offset().top-c.offset().top-(c.parent().outerHeight()/2-d.outerHeight()/2)):c.parent().scrollTop(0)}function e(b){var c=b.replace(/(sans-serif|serif|monospace|cursive|fantasy)/gi,"").replace(/"|'| /g,"").split(",");return a.grep(c,function(a){return a.length>0})}function f(a,b){for(var c=0;c<a.length;c++)for(var d=0;d<b.length;d++)if(a[c]==b[d])return[c,d];return null}function g(){var c=a(b.selection.element()).css("font-family"),d=e(c),g=[];for(var h in b.opts.fontFamily){var i=e(h),j=f(d,i);j&&g.push([h,j])}return 0===g.length?null:(g.sort(function(a,b){var c=a[1][0]-b[1][0];return 0===c?a[1][1]-b[1][1]:c}),g[0][0])}function h(c){if(b.opts.fontFamilySelection){var d=a(b.selection.element()).css("font-family").replace(/(sans-serif|serif|monospace|cursive|fantasy)/gi,"").replace(/"|'|/g,"").split(",");c.find("> span").text(b.opts.fontFamily[g()]||d[0]||b.opts.fontFamilyDefaultSelection)}}return{apply:c,refreshOnShow:d,refresh:h}},a.FE.RegisterCommand("fontFamily",{type:"dropdown",displaySelection:function(a){return a.opts.fontFamilySelection},defaultSelection:function(a){return a.opts.fontFamilyDefaultSelection},displaySelectionWidth:120,html:function(){var a='<ul class="fr-dropdown-list">',b=this.opts.fontFamily;for(var c in b)a+='<li><a class="fr-command" data-cmd="fontFamily" data-param1="'+c+'" style="font-family: '+c+'" title="'+b[c]+'">'+b[c]+"</a></li>";return a+="</ul>"},title:"Font Family",callback:function(a,b){this.fontFamily.apply(b)},refresh:function(a){this.fontFamily.refresh(a)},refreshOnShow:function(a,b){this.fontFamily.refreshOnShow(a,b)},plugin:"fontFamily"}),a.FE.DefineIcon("fontFamily",{NAME:"font"})}),!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof module&&module.exports?module.exports=function(b,c){return void 0===c&&(c="undefined"!=typeof window?require("jquery"):require("jquery")(b)),a(c),c}:a(jQuery)}(function(a){"use strict";a.extend(a.FE.DEFAULTS,{fontSize:["8","9","10","11","12","14","18","24","30","36","48","60","72","96"],fontSizeSelection:!1,fontSizeDefaultSelection:"12"}),a.FE.PLUGINS.fontSize=function(b){function c(a){b.commands.applyProperty("font-size",a+"px")}function d(c,d){var e=b.helpers.getPX(a(b.selection.element()).css("font-size"));d.find(".fr-command.fr-active").removeClass("fr-active"),d.find('.fr-command[data-param1="'+e+'"]').addClass("fr-active");var f=d.find(".fr-dropdown-list"),g=d.find(".fr-active").parent();g.length?f.parent().scrollTop(g.offset().top-f.offset().top-(f.parent().outerHeight()/2-g.outerHeight()/2)):f.parent().scrollTop(0)}function e(c){if(b.opts.fontSizeSelection){var d=b.helpers.getPX(a(b.selection.element()).css("font-size"));c.find("> span").text(d)}}return{apply:c,refreshOnShow:d,refresh:e}},a.FE.RegisterCommand("fontSize",{type:"dropdown",title:"Font Size",displaySelection:function(a){return a.opts.fontSizeSelection},displaySelectionWidth:30,defaultSelection:function(a){return a.opts.fontSizeDefaultSelection},html:function(){for(var a='<ul class="fr-dropdown-list">',b=this.opts.fontSize,c=0;c<b.length;c++){var d=b[c];a+='<li><a class="fr-command" data-cmd="fontSize" data-param1="'+d+'" title="'+d+'">'+d+"</a></li>"}return a+="</ul>"},callback:function(a,b){this.fontSize.apply(b)},refresh:function(a){this.fontSize.refresh(a)},refreshOnShow:function(a,b){this.fontSize.refreshOnShow(a,b)},plugin:"fontSize"}),a.FE.DefineIcon("fontSize",{NAME:"text-height"})}),!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof module&&module.exports?module.exports=function(b,c){return void 0===c&&(c="undefined"!=typeof window?require("jquery"):require("jquery")(b)),a(c),c}:a(jQuery)}(function(a){"use strict";a.FE.PLUGINS.fullscreen=function(b){function c(){return b.$box.hasClass("fr-fullscreen")}function d(){i=a(b.o_win).scrollTop(),b.$box.toggleClass("fr-fullscreen"),a("body").toggleClass("fr-fullscreen"),j=a('<div style="display: none;"></div>'),b.$box.after(j),b.helpers.isMobile()&&(b.$tb.data("parent",b.$tb.parent()),b.$tb.prependTo(b.$box),b.$tb.data("sticky-dummy")&&b.$tb.after(b.$tb.data("sticky-dummy"))),k=b.opts.height,l=b.opts.heightMax,b.opts.height=b.o_win.innerHeight-(b.opts.toolbarInline?0:b.$tb.outerHeight()),b.size.refresh(),b.opts.toolbarInline&&b.toolbar.showInline();for(var c=b.$box.parent();!c.is("body");)c.data("z-index",c.css("z-index")).css("z-index","auto"),c=c.parent();b.events.trigger("charCounter.update"),b.$win.trigger("scroll")}function e(){b.$box.toggleClass("fr-fullscreen"),a("body").toggleClass("fr-fullscreen"),b.$tb.prependTo(b.$tb.data("parent")),b.$tb.data("sticky-dummy")&&b.$tb.after(b.$tb.data("sticky-dummy")),b.opts.height=k,b.opts.heightMax=l,b.size.refresh(),a(b.o_win).scrollTop(i),b.opts.toolbarInline&&b.toolbar.showInline(),b.events.trigger("charCounter.update"),b.opts.toolbarSticky&&b.opts.toolbarStickyOffset&&(b.opts.toolbarBottom?b.$tb.css("bottom",b.opts.toolbarStickyOffset).data("bottom",b.opts.toolbarStickyOffset):b.$tb.css("top",b.opts.toolbarStickyOffset).data("top",b.opts.toolbarStickyOffset));for(var c=b.$box.parent();!c.is("body");)c.data("z-index")&&(c.css("z-index",""),c.css("z-index")!=c.data("z-index")&&c.css("z-index",c.data("z-index")),c.removeData("z-index")),c=c.parent();b.$win.trigger("scroll")}function f(){c()?e():d(),g(b.$tb.find('.fr-command[data-cmd="fullscreen"]'))}function g(a){var b=c();a.toggleClass("fr-active",b),a.find("i").toggleClass("fa-expand",!b).toggleClass("fa-compress",b)}function h(){return b.$wp?(b.events.$on(a(b.o_win),"resize",function(){c()&&(e(),d())}),void b.events.on("toolbar.hide",function(){return c()&&b.helpers.isMobile()?!1:void 0})):!1}var i,j,k,l;return{_init:h,toggle:f,refresh:g,isActive:c}},a.FE.RegisterCommand("fullscreen",{title:"Fullscreen",undo:!1,focus:!1,forcedRefresh:!0,callback:function(){this.fullscreen.toggle()},refresh:function(a){this.fullscreen.refresh(a)},plugin:"fullscreen"}),a.FE.DefineIcon("fullscreen",{NAME:"expand"})}),!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof module&&module.exports?module.exports=function(b,c){return void 0===c&&(c="undefined"!=typeof window?require("jquery"):require("jquery")(b)),a(c),c}:a(jQuery)}(function(a){"use strict";a.extend(a.FE.POPUP_TEMPLATES,{"image.insert":"[_BUTTONS_][_UPLOAD_LAYER_][_BY_URL_LAYER_][_PROGRESS_BAR_]","image.edit":"[_BUTTONS_]","image.alt":"[_BUTTONS_][_ALT_LAYER_]","image.size":"[_BUTTONS_][_SIZE_LAYER_]"}),a.extend(a.FE.DEFAULTS,{imageInsertButtons:["imageBack","|","imageUpload","imageByURL"],imageEditButtons:["imageReplace","imageAlign","imageRemove","|","imageLink","linkOpen","linkEdit","linkRemove","-","imageDisplay","imageStyle","imageAlt","imageSize"],imageAltButtons:["imageBack","|"],imageSizeButtons:["imageBack","|"],imageUploadURL:"http://i.froala.com/upload",imageUploadParam:"file",imageUploadParams:{},imageUploadToS3:!1,imageUploadMethod:"POST",imageMaxSize:10485760,imageAllowedTypes:["jpeg","jpg","png","gif","svg+xml"],imageResize:!0,imageResizeWithPercent:!1,imageDefaultWidth:300,imageDefaultAlign:"center",imageDefaultDisplay:"block",imageSplitHTML:!1,imageStyles:{"fr-rounded":"Rounded","fr-bordered":"Bordered"},imageMove:!0,imageMultipleStyles:!0,imageTextNear:!0,imagePaste:!0}),a.FE.PLUGINS.image=function(b){function c(){var a=b.popups.get("image.insert"),c=a.find(".fr-image-by-url-layer input");c.val(""),na&&c.val(na.attr("src")),c.trigger("change")}function d(){var a=b.$tb.find('.fr-command[data-cmd="insertImage"]'),c=b.popups.get("image.insert");if(c||(c=I()),r(),!c.hasClass("fr-active"))if(b.popups.refresh("image.insert"),b.popups.setContainer("image.insert",b.$tb),a.is(":visible")){var d=a.offset().left+a.outerWidth()/2,e=a.offset().top+(b.opts.toolbarBottom?10:a.outerHeight()-10);b.popups.show("image.insert",d,e,a.outerHeight())}else b.position.forSelection(c),b.popups.show("image.insert")}function e(){var c=b.popups.get("image.edit");c||(c=p()),b.popups.setContainer("image.edit",a(b.opts.scrollableContainer)),b.popups.refresh("image.edit");var d=na.offset().left+na.outerWidth()/2,e=na.offset().top+na.outerHeight();b.popups.show("image.edit",d,e,na.outerHeight())}function f(){r()}function g(a){if(!a.hasClass("fr-dii")&&!a.hasClass("fr-dib")){var c=a.css("float");a.css("float","none"),"block"==a.css("display")?(a.css("float",c),0===parseInt(a.css("margin-left"),10)&&(a.attr("style")||"").indexOf("margin-right: auto")>=0?a.addClass("fr-fil"):0===parseInt(a.css("margin-right"),10)&&(a.attr("style")||"").indexOf("margin-left: auto")>=0&&a.addClass("fr-fir"),a.addClass("fr-dib")):(a.css("float",c),"left"==a.css("float")?a.addClass("fr-fil"):"right"==a.css("float")&&a.addClass("fr-fir"),a.addClass("fr-dii")),a.css("margin",""),a.css("float",""),a.css("display",""),a.css("z-index",""),a.css("position",""),a.css("overflow",""),a.css("vertical-align","")}a.attr("width")&&(a.css("width",a.width()),a.removeAttr("width")),b.opts.imageTextNear||a.removeClass("fr-dii").addClass("fr-dib")}function h(){for(var c="IMG"==b.$el.get(0).tagName?[b.$el.get(0)]:b.$el.get(0).querySelectorAll("img"),d=0;d<c.length;d++)g(a(c[d])),b.opts.iframe&&a(c[d]).on("load",b.size.syncIframe)}function i(){var c,d=Array.prototype.slice.call(b.$el.get(0).querySelectorAll("img")),e=[];for(c=0;c<d.length;c++)e.push(d[c].getAttribute("src")),a(d[c]).toggleClass("fr-draggable",b.opts.imageMove);if(Aa)for(c=0;c<Aa.length;c++)e.indexOf(Aa[c].getAttribute("src"))<0&&b.events.trigger("image.removed",[a(Aa[c])]);Aa=d}function j(){oa||U(),(b.$wp||a(b.opts.scrollableContainer)).append(oa),oa.data("instance",b);var c=b.$wp?b.$wp.scrollTop()-(b.$wp.offset().top+1):-1,d=b.$wp?b.$wp.scrollLeft()-(b.$wp.offset().left+1):-1;b.$wp&&(d-=b.helpers.getPX(b.$wp.css("border-left-width"))),oa.css("top",b.opts.iframe?na.offset().top-1:na.offset().top+c).css("left",b.opts.iframe?na.offset().left-1:na.offset().left+d).css("width",na.outerWidth()).css("height",na.outerHeight()).addClass("fr-active")}function k(a){return'<div class="fr-handler fr-h'+a+'"></div>'}function l(c){return b.core.sameInstance(oa)?(c.preventDefault(),c.stopPropagation(),b.$el.find("img.fr-error").left?!1:(b.undo.canDo()||b.undo.saveStep(),pa=a(this),pa.data("start-x",c.pageX||c.originalEvent.touches[0].pageX),pa.data("start-width",na.width()),qa.show(),b.popups.hideAll(),void ba())):!0}function m(c){if(!b.core.sameInstance(oa))return!0;if(pa&&na){if(c.preventDefault(),b.$el.find("img.fr-error").left)return!1;var d=c.pageX||(c.originalEvent.touches?c.originalEvent.touches[0].pageX:null);if(!d)return!1;var e=pa.data("start-x"),f=d-e,g=pa.data("start-width");if((pa.hasClass("fr-hnw")||pa.hasClass("fr-hsw"))&&(f=0-f),b.opts.imageResizeWithPercent){var h=na.parentsUntil(b.$el,b.html.blockTagsQuery()).get(0);na.css("width",((g+f)/a(h).outerWidth()*100).toFixed(2)+"%")}else na.css("width",g+f);na.css("height","").removeAttr("height"),j(),b.events.trigger("image.resize",[la()])}}function n(a){if(!b.core.sameInstance(oa))return!0;if(pa&&na){if(a&&a.stopPropagation(),b.$el.find("img.fr-error").left)return!1;pa=null,qa.hide(),j(),e(),b.undo.saveStep(),b.events.trigger("image.resizeEnd",[la()])}}function o(a,c){b.edit.on(),na&&na.addClass("fr-error"),t(b.language.translate("Something went wrong. Please try again.")),b.events.trigger("image.error",[{code:a,message:za[a]},c])}function p(a){if(a)return b.$wp&&b.events.$on(b.$wp,"scroll",function(){na&&b.popups.isVisible("image.edit")&&e()}),!0;var c="";b.opts.imageEditButtons.length>1&&(c+='<div class="fr-buttons">',c+=b.button.buildList(b.opts.imageEditButtons),c+="</div>");var d={buttons:c},f=b.popups.create("image.edit",d);return f}function q(){var a=b.popups.get("image.insert");a&&(a.find(".fr-layer.fr-active").removeClass("fr-active").addClass("fr-pactive"),a.find(".fr-image-progress-bar-layer").addClass("fr-active"),a.find(".fr-buttons").hide(),s("Uploading",0))}function r(a){var c=b.popups.get("image.insert");c&&(c.find(".fr-layer.fr-pactive").addClass("fr-active").removeClass("fr-pactive"),c.find(".fr-image-progress-bar-layer").removeClass("fr-active"),c.find(".fr-buttons").show(),(a||b.$el.find("img.fr-error").length)&&(b.events.focus(),b.$el.find("img.fr-error").remove(),b.undo.saveStep(),b.undo.run(),b.undo.dropRedo()))}function s(a,c){var d=b.popups.get("image.insert");if(d){var e=d.find(".fr-image-progress-bar-layer");e.find("h3").text(a+(c?" "+c+"%":"")),e.removeClass("fr-error"),c?(e.find("div").removeClass("fr-indeterminate"),e.find("div > span").css("width",c+"%")):e.find("div").addClass("fr-indeterminate")}}function t(a){var c=b.popups.get("image.insert"),d=c.find(".fr-image-progress-bar-layer");d.addClass("fr-error"),d.find("h3").text(a)}function u(){var a=b.popups.get("image.insert"),c=a.find(".fr-image-by-url-layer input");c.val().length>0&&(q(),s("Loading image"),w(b.helpers.sanitizeURL(c.val()),!0,[],na),c.val(""),c.blur())}function v(){var c=a(this);b.popups.hide("image.insert"),c.removeClass("fr-uploading"),c.next().is("br")&&c.next().remove(),c.trigger("click").trigger("touchend"),b.events.trigger("image.loaded",[c])}function w(a,c,d,e,f){b.edit.off(),s("Loading image");var g=new Image;g.onload=function(){var c,g;if(e){var h=e.data("fr-old-src");b.$wp?(c=e.clone().removeData("fr-old-src"),h&&e.attr("src",h),e.removeClass("fr-uploading"),e.replaceWith(c),c.off("load")):c=e;for(var i=c.get(0).attributes,j=0;j<i.length;j++){var k=i[j];0===k.nodeName.indexOf("data-")&&c.removeAttr(k.nodeName)}if("undefined"!=typeof d)for(g in d)"link"!=g&&c.attr("data-"+g,d[g]);c.on("load",v),c.attr("src",a),b.edit.on(),b.undo.saveStep(),b.events.trigger(h?"image.replaced":"image.inserted",[c,f])}else c=C(a,d,v),b.undo.saveStep(),b.events.trigger("image.inserted",[c,f])},g.onerror=function(){o(sa)},g.src=a}function x(c){try{if(b.events.trigger("image.uploaded",[c],!0)===!1)return b.edit.on(),!1;var d=a.parseJSON(c);return d.link?d:(o(ta,c),!1)}catch(e){return o(va,c),!1}}function y(c){try{var d=a(c).find("Location").text(),e=a(c).find("Key").text();return b.events.trigger("image.uploadedToS3",[d,e,c],!0)===!1?(b.edit.on(),!1):d}catch(f){return o(va,c),!1}}function z(a){s("Loading image");var c=this.status,d=this.response,e=this.responseXML,f=this.responseText;try{if(b.opts.imageUploadToS3)if(201==c){var g=y(e);g&&w(g,!1,[],a,d||e)}else o(va,d||e);else if(c>=200&&300>c){var h=x(f);h&&w(h.link,!1,h,a,d||f)}else o(ua,d||f)}catch(i){o(va,d||f)}}function A(){o(va,this.response||this.responseText||this.responseXML)}function B(a){if(a.lengthComputable){var b=a.loaded/a.total*100|0;s("Uploading",b)}}function C(c,d,e){var f,g="";if(d&&"undefined"!=typeof d)for(f in d)"link"!=f&&(g+=" data-"+f+'="'+d[f]+'"');var h=b.opts.imageDefaultWidth||"auto";h&&"auto"!=h&&(""+h).indexOf("px")<0&&(""+h).indexOf("%")<0&&(h+="px");var i=a('<img class="fr-di'+b.opts.imageDefaultDisplay[0]+("center"!=b.opts.imageDefaultAlign?" fr-fi"+b.opts.imageDefaultAlign[0]:"")+'" src="'+c+'"'+g+(h?' style="width: '+h+';"':"")+">");i.on("load",e),b.edit.on(),b.events.focus(!0),b.selection.restore(),b.undo.saveStep(),b.opts.imageSplitHTML?b.markers.split():b.markers.insert();var j=b.$el.find(".fr-marker");return j.replaceWith(i),b.html.wrap(),b.selection.clear(),i}function D(c,d,f){function g(){var f=a(this);f.off("load"),f.addClass("fr-uploading"),f.next().is("br")&&f.next().remove(),b.placeholder.refresh(),f.is(na)||f.trigger("click").trigger("touchend"),j(),e(),ia(),q(),ia(),b.edit.off(),c.onload=function(){z.call(c,f)},c.onerror=A,c.upload.onprogress=B,c.send(d)}var h,i=new FileReader;i.addEventListener("load",function(){for(var a=atob(i.result.split(",")[1]),c=[],d=0;d<a.length;d++)c.push(a.charCodeAt(d));
var e=window.URL.createObjectURL(new Blob([new Uint8Array(c)],{type:"image/jpeg"}));na?(na.on("load",g),b.edit.on(),b.undo.saveStep(),na.data("fr-old-src",na.attr("src")),na.attr("src",e)):h=C(e,null,g)},!1),i.readAsDataURL(f)}function E(a){if(b.events.trigger("image.beforeUpload",[a])===!1)return!1;if("undefined"!=typeof a&&a.length>0){var c=a[0];if(c.size>b.opts.imageMaxSize)return o(wa),!1;if(b.opts.imageAllowedTypes.indexOf(c.type.replace(/image\//g,""))<0)return o(xa),!1;var d;if(b.drag_support.formdata&&(d=b.drag_support.formdata?new FormData:null),d){var e;if(b.opts.imageUploadToS3!==!1){d.append("key",b.opts.imageUploadToS3.keyStart+(new Date).getTime()+"-"+(c.name||"untitled")),d.append("success_action_status","201"),d.append("X-Requested-With","xhr"),d.append("Content-Type",c.type);for(e in b.opts.imageUploadToS3.params)d.append(e,b.opts.imageUploadToS3.params[e])}for(e in b.opts.imageUploadParams)d.append(e,b.opts.imageUploadParams[e]);d.append(b.opts.imageUploadParam,c);var f=b.opts.imageUploadURL;b.opts.imageUploadToS3&&(f="https://"+b.opts.imageUploadToS3.region+".amazonaws.com/"+b.opts.imageUploadToS3.bucket);var g=b.core.getXHR(f,b.opts.imageUploadMethod);D(g,d,c)}}}function F(c){b.events.$on(c,"dragover dragenter",".fr-image-upload-layer",function(){return a(this).addClass("fr-drop"),!1}),b.events.$on(c,"dragleave dragend",".fr-image-upload-layer",function(){return a(this).removeClass("fr-drop"),!1}),b.events.$on(c,"drop",".fr-image-upload-layer",function(d){d.preventDefault(),d.stopPropagation(),a(this).removeClass("fr-drop");var e=d.originalEvent.dataTransfer;if(e&&e.files){var f=c.data("instance")||b;f.image.upload(e.files)}}),b.events.$on(c,"change",'.fr-image-upload-layer input[type="file"]',function(){if(this.files){var d=c.data("instance")||b;d.image.upload(this.files)}a(this).val("")})}function G(c){var d=c.originalEvent.dataTransfer;if(d&&d.files&&d.files.length){var e=d.files[0];if(e&&e.type&&b.opts.imageAllowedTypes.indexOf(e.type.replace(/image\//g,""))>=0){b.markers.remove(),b.markers.insertAtPoint(c.originalEvent),b.$el.find(".fr-marker").replaceWith(a.FE.MARKERS),b.popups.hideAll();var f=b.popups.get("image.insert");return f||(f=I()),b.popups.setContainer("image.insert",a(b.opts.scrollableContainer)),b.popups.show("image.insert",c.originalEvent.pageX,c.originalEvent.pageY),q(),b.popups.show("image.insert",c.originalEvent.pageX,c.originalEvent.pageY),E(d.files),c.preventDefault(),c.stopPropagation(),!1}}}function H(){b.events.$on(b.$el,b._mousedown,"IMG"==b.$el.get(0).tagName?null:"img",function(a){b.selection.clear(),ra=!0,b.browser.msie&&(b.events.disableBlur(),b.$el.attr("contenteditable",!1)),b.draggable||a.preventDefault(),a.stopPropagation()}),b.events.$on(b.$el,b._mouseup,"IMG"==b.$el.get(0).tagName?null:"img",function(a){ra&&(ra=!1,a.stopPropagation(),b.browser.msie&&(b.$el.attr("contenteditable",!0),b.events.enableBlur()))}),b.events.on("drop",G),b.events.on("mousedown window.mousedown",aa),b.events.on("window.touchmove",ba),b.events.on("mouseup window.mouseup",_),b.events.on("commands.mousedown",function(a){a.parents(".fr-toolbar").length>0&&_()}),b.events.on("blur image.hideResizer commands.undo commands.redo element.dropped",function(){ra=!1,_(!0)})}function I(a){if(a)return b.popups.onRefresh("image.insert",c),b.popups.onHide("image.insert",f),!0;var d,e="";b.opts.imageInsertButtons.length>1&&(e='<div class="fr-buttons">'+b.button.buildList(b.opts.imageInsertButtons)+"</div>");var g=b.opts.imageInsertButtons.indexOf("imageUpload"),h=b.opts.imageInsertButtons.indexOf("imageByURL"),i="";g>=0&&(d=" fr-active",h>=0&&g>h&&(d=""),i='<div class="fr-image-upload-layer'+d+' fr-layer" id="fr-image-upload-layer-'+b.id+'"><strong>'+b.language.translate("Drop image")+"</strong><br>("+b.language.translate("or click")+')<div class="fr-form"><input type="file" accept="image/*" tabIndex="-1"></div></div>');var j="";h>=0&&(d=" fr-active",g>=0&&h>g&&(d=""),j='<div class="fr-image-by-url-layer'+d+' fr-layer" id="fr-image-by-url-layer-'+b.id+'"><div class="fr-input-line"><input type="text" placeholder="http://" tabIndex="1"></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="imageInsertByURL" tabIndex="2">'+b.language.translate("Insert")+"</button></div></div>");var k='<div class="fr-image-progress-bar-layer fr-layer"><h3 class="fr-message">Uploading</h3><div class="fr-loader"><span class="fr-progress"></span></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-back" data-cmd="imageDismissError" tabIndex="2">OK</button></div></div>',l={buttons:e,upload_layer:i,by_url_layer:j,progress_bar:k},m=b.popups.create("image.insert",l);return b.$wp&&b.events.$on(b.$wp,"scroll",function(){na&&b.popups.isVisible("image.insert")&&ia()}),F(m),m}function J(){if(na){var a=b.popups.get("image.alt");a.find("input").val(na.attr("alt")||"").trigger("change")}}function K(){var c=b.popups.get("image.alt");c||(c=L()),r(),b.popups.refresh("image.alt"),b.popups.setContainer("image.alt",a(b.opts.scrollableContainer));var d=na.offset().left+na.width()/2,e=na.offset().top+na.height();b.popups.show("image.alt",d,e,na.outerHeight())}function L(a){if(a)return b.popups.onRefresh("image.alt",J),!0;var c="";c='<div class="fr-buttons">'+b.button.buildList(b.opts.imageAltButtons)+"</div>";var d="";d='<div class="fr-image-alt-layer fr-layer fr-active" id="fr-image-alt-layer-'+b.id+'"><div class="fr-input-line"><input type="text" placeholder="'+b.language.translate("Alternate Text")+'" tabIndex="1"></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="imageSetAlt" tabIndex="2">'+b.language.translate("Update")+"</button></div></div>";var e={buttons:c,alt_layer:d},f=b.popups.create("image.alt",e);return b.$wp&&b.events.$on(b.$wp,"scroll.image-alt",function(){na&&b.popups.isVisible("image.alt")&&K()}),f}function M(a){if(na){var c=b.popups.get("image.alt");na.attr("alt",a||c.find("input").val()||""),c.find("input").blur(),setTimeout(function(){na.trigger("click").trigger("touchend")},b.helpers.isAndroid()?50:0)}}function N(){if(na){var a=b.popups.get("image.size");a.find('input[name="width"]').val(na.get(0).style.width).trigger("change"),a.find('input[name="height"]').val(na.get(0).style.height).trigger("change")}}function O(){var c=b.popups.get("image.size");c||(c=P()),r(),b.popups.refresh("image.size"),b.popups.setContainer("image.size",a(b.opts.scrollableContainer));var d=na.offset().left+na.width()/2,e=na.offset().top+na.height();b.popups.show("image.size",d,e,na.outerHeight())}function P(a){if(a)return b.popups.onRefresh("image.size",N),!0;var c="";c='<div class="fr-buttons">'+b.button.buildList(b.opts.imageSizeButtons)+"</div>";var d="";d='<div class="fr-image-size-layer fr-layer fr-active" id="fr-image-size-layer-'+b.id+'"><div class="fr-image-group"><div class="fr-input-line"><input type="text" name="width" placeholder="'+b.language.translate("Width")+'" tabIndex="1"></div><div class="fr-input-line"><input type="text" name="height" placeholder="'+b.language.translate("Height")+'" tabIndex="1"></div></div><div class="fr-action-buttons"><button type="button" class="fr-command fr-submit" data-cmd="imageSetSize" tabIndex="2">'+b.language.translate("Update")+"</button></div></div>";var e={buttons:c,size_layer:d},f=b.popups.create("image.size",e);return b.$wp&&b.events.$on(b.$wp,"scroll.image-size",function(){na&&b.popups.isVisible("image.size")&&O()}),f}function Q(a,c){if(na){var d=b.popups.get("image.size");na.css("width",a||d.find('input[name="width"]').val()),na.css("height",c||d.find('input[name="height"]').val()),d.find("input").blur(),setTimeout(function(){na.trigger("click").trigger("touchend")},b.helpers.isAndroid()?50:0)}}function R(a){var c,d,e=b.popups.get("image.insert");if(na||b.opts.toolbarInline)na&&(d=na.offset().top+na.outerHeight());else{var f=b.$tb.find('.fr-command[data-cmd="insertImage"]');c=f.offset().left+f.outerWidth()/2,d=f.offset().top+(b.opts.toolbarBottom?10:f.outerHeight()-10)}!na&&b.opts.toolbarInline&&(d=e.offset().top-b.helpers.getPX(e.css("margin-top")),e.hasClass("fr-above")&&(d+=e.outerHeight())),e.find(".fr-layer").removeClass("fr-active"),e.find(".fr-"+a+"-layer").addClass("fr-active"),b.popups.show("image.insert",c,d,na?na.outerHeight():0)}function S(a){var c=b.popups.get("image.insert");c.find(".fr-image-upload-layer").hasClass("fr-active")&&a.addClass("fr-active")}function T(a){var c=b.popups.get("image.insert");c.find(".fr-image-by-url-layer").hasClass("fr-active")&&a.addClass("fr-active")}function U(){var c;b.shared.$image_resizer?(oa=b.shared.$image_resizer,qa=b.shared.$img_overlay,b.events.on("destroy",function(){oa.removeClass("fr-active").appendTo(a("body"))},!0)):(b.shared.$image_resizer=a('<div class="fr-image-resizer"></div>'),oa=b.shared.$image_resizer,b.events.$on(oa,"mousedown",function(a){a.stopPropagation()},!0),b.opts.imageResize&&(oa.append(k("nw")+k("ne")+k("sw")+k("se")),b.shared.$img_overlay=a('<div class="fr-image-overlay"></div>'),qa=b.shared.$img_overlay,c=oa.get(0).ownerDocument,a(c).find("body").append(qa))),b.events.on("shared.destroy",function(){oa.html("").removeData().remove(),b.opts.imageResize&&qa.remove()},!0),b.helpers.isMobile()||b.events.$on(a(b.o_win),"resize.image",function(){_(!0)}),b.opts.imageResize&&(c=oa.get(0).ownerDocument,b.events.$on(oa,b._mousedown,".fr-handler",l),b.events.$on(a(c),b._mousemove,m),b.events.$on(a(c.defaultView||c.parentWindow),b._mouseup,n),b.events.$on(qa,"mouseleave",n))}function V(c){c=c||na,c&&b.events.trigger("image.beforeRemove",[c])!==!1&&(b.popups.hideAll(),_(!0),c.get(0)==b.$el.get(0)?c.removeAttr("src"):("A"==c.get(0).parentNode.tagName?(b.selection.setBefore(c.get(0).parentNode)||b.selection.setAfter(c.get(0).parentNode),a(c.get(0).parentNode).remove()):(b.selection.setBefore(c.get(0))||b.selection.setAfter(c.get(0)),c.remove()),b.selection.restore(),b.html.fillEmptyBlocks()),b.undo.saveStep())}function W(){H(),"IMG"==b.$el.get(0).tagName&&b.$el.addClass("fr-view"),b.events.$on(b.$el,b.helpers.isMobile()&&!b.helpers.isWindowsPhone()?"touchend":"click","IMG"==b.$el.get(0).tagName?null:"img",$),b.helpers.isMobile()&&(b.events.$on(b.$el,"touchstart","IMG"==b.$el.get(0).tagName?null:"img",function(){Ba=!1}),b.events.$on(b.$el,"touchmove",function(){Ba=!0})),b.events.on("window.keydown",function(c){var d=c.which;return!na||d!=a.FE.KEYCODE.BACKSPACE&&d!=a.FE.KEYCODE.DELETE?na&&d==a.FE.KEYCODE.ESC?(_(!0),c.preventDefault(),!1):na&&!b.keys.ctrlKey(c)?(c.preventDefault(),!1):void 0:(c.preventDefault(),V(),!1)},!0),b.events.$on(a(b.o_win),"keydown",function(b){var c=b.which;return na&&c==a.FE.KEYCODE.BACKSPACE?(b.preventDefault(),!1):void 0}),b.events.on("paste.before",Y),b.events.on("paste.beforeCleanup",Z),b.events.on("paste.after",X),b.events.on("html.set",h),h(),b.events.on("html.get",function(a){return a=a.replace(/<(img)((?:[\w\W]*?))class="([\w\W]*?)(fr-uploading|fr-error)([\w\W]*?)"((?:[\w\W]*?))>/g,"")}),b.opts.iframe&&b.events.on("image.loaded",b.size.syncIframe),b.$wp&&(i(),b.events.on("contentChanged",i)),b.events.$on(a(b.o_win),"orientationchange.image."+b.id,function(){setTimeout(function(){var a=la();a&&a.trigger("click").trigger("touchend")},0)}),p(!0),I(!0),P(!0),L(!0),b.events.on("node.remove",function(a){return"IMG"==a.get(0).tagName?(V(a),!1):void 0})}function X(){b.opts.imagePaste?b.$el.find("img[data-fr-image-pasted]").each(function(c,d){if(0===d.src.indexOf("data:")){if(b.events.trigger("image.beforePasteUpload",[d])===!1)return!1;var f=b.opts.imageDefaultWidth||"auto";"auto"!=f&&(f+=b.opts.imageResizeWithPercent?"%":"px"),a(d).css("width",f),a(d).addClass("fr-dib"),na=a(d),j(),e(),ia(),q(),b.edit.off();for(var g=atob(a(d).attr("src").split(",")[1]),h=[],i=0;i<g.length;i++)h.push(g.charCodeAt(i));var k=new Blob([new Uint8Array(h)],{type:"image/jpeg"});E([k]),a(d).removeAttr("data-fr-image-pasted")}else 0!==d.src.indexOf("http")?(b.selection.save(),a(d).remove(),b.selection.restore()):a(d).removeAttr("data-fr-image-pasted")}):b.$el.find("img[data-fr-image-pasted]").remove()}function Y(a){if(a&&a.clipboardData&&a.clipboardData.items&&a.clipboardData.items[0]){var c=a.clipboardData.items[0].getAsFile();if(c){var d=new FileReader;return d.onload=function(a){var c=a.target.result,d=b.opts.imageDefaultWidth||"auto";d&&"auto"!=d&&(""+d).indexOf("px")<0&&(""+d).indexOf("%")<0&&(d+="px"),b.html.insert('<img data-fr-image-pasted="true" class="fr-di'+b.opts.imageDefaultDisplay[0]+("center"!=b.opts.imageDefaultAlign?" fr-fi"+b.opts.imageDefaultAlign[0]:"")+'" src="'+c+'"'+(d?' style="width: '+d+';"':"")+">"),b.events.trigger("paste.after")},d.readAsDataURL(c),!1}}}function Z(a){return a=a.replace(/<img /gi,'<img data-fr-image-pasted="true" ')}function $(c){if(c&&"touchend"==c.type&&Ba)return!0;if(b.edit.isDisabled())return c.stopPropagation(),c.preventDefault(),!1;for(var d=0;d<a.FE.INSTANCES.length;d++)a.FE.INSTANCES[d]!=b&&a.FE.INSTANCES[d].events.trigger("image.hideResizer");b.toolbar.disable(),c.stopPropagation(),c.preventDefault(),b.helpers.isMobile()&&(b.events.disableBlur(),b.$el.blur(),b.events.enableBlur()),b.opts.iframe&&b.size.syncIframe(),na=a(this),ja(),j(),e(),b.selection.clear(),b.button.bulkRefresh(),b.events.trigger("video.hideResizer"),b.helpers.isIOS()&&setTimeout(e,100)}function _(a){na&&(ca()||a===!0)&&(b.toolbar.enable(),oa.removeClass("fr-active"),b.popups.hide("image.edit"),na=null,ba())}function aa(){Ca=!0}function ba(){Ca=!1}function ca(){return Ca}function da(a){na.removeClass("fr-fir fr-fil"),"left"==a?na.addClass("fr-fil"):"right"==a&&na.addClass("fr-fir"),j(),e()}function ea(a){na&&(na.hasClass("fr-fil")?a.find("> *:first").replaceWith(b.icon.create("align-left")):na.hasClass("fr-fir")?a.find("> *:first").replaceWith(b.icon.create("align-right")):a.find("> *:first").replaceWith(b.icon.create("align-justify")))}function fa(a,b){if(na){var c="justify";na.hasClass("fr-fil")?c="left":na.hasClass("fr-fir")&&(c="right"),b.find('.fr-command[data-param1="'+c+'"]').addClass("fr-active")}}function ga(a){na.removeClass("fr-dii fr-dib"),"inline"==a?na.addClass("fr-dii"):"block"==a&&na.addClass("fr-dib"),j(),e()}function ha(a,b){var c="block";na.hasClass("fr-dii")&&(c="inline"),b.find('.fr-command[data-param1="'+c+'"]').addClass("fr-active")}function ia(){var c=b.popups.get("image.insert");c||(c=I()),b.popups.isVisible("image.insert")||(r(),b.popups.refresh("image.insert"),b.popups.setContainer("image.insert",a(b.opts.scrollableContainer)));var d=na.offset().left+na.width()/2,e=na.offset().top+na.height();b.popups.show("image.insert",d,e,na.outerHeight())}function ja(){if(na){b.selection.clear();var a=b.doc.createRange();a.selectNode(na.get(0));var c=b.selection.get();c.addRange(a)}}function ka(){na?na.trigger("click").trigger("touchend"):(b.events.disableBlur(),b.selection.restore(),b.events.enableBlur(),b.popups.hide("image.insert"),b.toolbar.showInline())}function la(){return na}function ma(a){if(!na)return!1;if(!b.opts.imageMultipleStyles){var c=Object.keys(b.opts.imageStyles);c.splice(c.indexOf(a),1),na.removeClass(c.join(" "))}na.toggleClass(a),na.trigger("click").trigger("touchend")}var na,oa,pa,qa,ra=!1,sa=1,ta=2,ua=3,va=4,wa=5,xa=6,ya=7,za={};za[sa]="Image cannot be loaded from the passed link.",za[ta]="No link in upload response.",za[ua]="Error during file upload.",za[va]="Parsing response failed.",za[wa]="File is too large.",za[xa]="Image file type is invalid.",za[ya]="Files can be uploaded only to same domain in IE 8 and IE 9.";var Aa,Ba,Ca=!1;return{_init:W,showInsertPopup:d,showLayer:R,refreshUploadButton:S,refreshByURLButton:T,upload:E,insertByURL:u,align:da,refreshAlign:ea,refreshAlignOnShow:fa,display:ga,refreshDisplayOnShow:ha,replace:ia,back:ka,get:la,insert:w,showProgressBar:q,remove:V,hideProgressBar:r,applyStyle:ma,showAltPopup:K,showSizePopup:O,setAlt:M,setSize:Q,exitEdit:_}},a.FE.DefineIcon("insertImage",{NAME:"image"}),a.FE.RegisterShortcut(80,"insertImage"),a.FE.RegisterCommand("insertImage",{title:"Insert Image",undo:!1,focus:!0,refershAfterCallback:!1,popup:!0,callback:function(){this.popups.isVisible("image.insert")?(this.$el.find(".fr-marker")&&(this.events.disableBlur(),this.selection.restore()),this.popups.hide("image.insert")):this.image.showInsertPopup()},plugin:"image"}),a.FE.DefineIcon("imageUpload",{NAME:"upload"}),a.FE.RegisterCommand("imageUpload",{title:"Upload Image",undo:!1,focus:!1,callback:function(){this.image.showLayer("image-upload")},refresh:function(a){this.image.refreshUploadButton(a)}}),a.FE.DefineIcon("imageByURL",{NAME:"link"}),a.FE.RegisterCommand("imageByURL",{title:"By URL",undo:!1,focus:!1,callback:function(){this.image.showLayer("image-by-url")},refresh:function(a){this.image.refreshByURLButton(a)}}),a.FE.RegisterCommand("imageInsertByURL",{title:"Insert Image",undo:!0,refreshAfterCallback:!1,callback:function(){this.image.insertByURL()},refresh:function(a){var b=this.image.get();b?a.text("Replace"):a.text(this.language.translate("Insert"))}}),a.FE.DefineIcon("imageDisplay",{NAME:"star"}),a.FE.RegisterCommand("imageDisplay",{title:"Display",type:"dropdown",options:{inline:"Inline",block:"Break Text"},callback:function(a,b){this.image.display(b)},refresh:function(a){this.opts.imageTextNear||a.addClass("fr-hidden")},refreshOnShow:function(a,b){this.image.refreshDisplayOnShow(a,b)}}),a.FE.DefineIcon("imageAlign",{NAME:"align-center"}),a.FE.RegisterCommand("imageAlign",{type:"dropdown",title:"Align",options:{left:"Align Left",justify:"None",right:"Align Right"},html:function(){var b='<ul class="fr-dropdown-list">',c=a.FE.COMMANDS.imageAlign.options;for(var d in c)b+='<li><a class="fr-command fr-title" data-cmd="imageAlign" data-param1="'+d+'" title="'+this.language.translate(c[d])+'">'+this.icon.create("align-"+d)+"</a></li>";return b+="</ul>"},callback:function(a,b){this.image.align(b)},refresh:function(a){this.image.refreshAlign(a)},refreshOnShow:function(a,b){this.image.refreshAlignOnShow(a,b)}}),a.FE.DefineIcon("imageReplace",{NAME:"exchange"}),a.FE.RegisterCommand("imageReplace",{title:"Replace",undo:!1,focus:!1,refreshAfterCallback:!1,callback:function(){this.image.replace()}}),a.FE.DefineIcon("imageRemove",{NAME:"trash"}),a.FE.RegisterCommand("imageRemove",{title:"Remove",callback:function(){this.image.remove()}}),a.FE.DefineIcon("imageBack",{NAME:"arrow-left"}),a.FE.RegisterCommand("imageBack",{title:"Back",undo:!1,focus:!1,back:!0,callback:function(){this.image.back()},refresh:function(a){var b=this.image.get();b||this.opts.toolbarInline?(a.removeClass("fr-hidden"),a.next(".fr-separator").removeClass("fr-hidden")):(a.addClass("fr-hidden"),a.next(".fr-separator").addClass("fr-hidden"))}}),a.FE.RegisterCommand("imageDismissError",{title:"OK",undo:!1,callback:function(){this.image.hideProgressBar(!0)}}),a.FE.DefineIcon("imageStyle",{NAME:"magic"}),a.FE.RegisterCommand("imageStyle",{title:"Style",type:"dropdown",html:function(){var a='<ul class="fr-dropdown-list">',b=this.opts.imageStyles;for(var c in b)a+='<li><a class="fr-command" data-cmd="imageStyle" data-param1="'+c+'">'+this.language.translate(b[c])+"</a></li>";return a+="</ul>"},callback:function(a,b){this.image.applyStyle(b)},refreshOnShow:function(b,c){var d=this.image.get();d&&c.find(".fr-command").each(function(){var b=a(this).data("param1");a(this).toggleClass("fr-active",d.hasClass(b))})}}),a.FE.DefineIcon("imageAlt",{NAME:"info"}),a.FE.RegisterCommand("imageAlt",{undo:!1,focus:!1,title:"Alternate Text",callback:function(){this.image.showAltPopup()}}),a.FE.RegisterCommand("imageSetAlt",{undo:!0,focus:!1,title:"Update",refreshAfterCallback:!1,callback:function(){this.image.setAlt()}}),a.FE.DefineIcon("imageSize",{NAME:"arrows-alt"}),a.FE.RegisterCommand("imageSize",{undo:!1,focus:!1,title:"Change Size",callback:function(){this.image.showSizePopup()}}),a.FE.RegisterCommand("imageSetSize",{undo:!0,focus:!1,callback:function(){this.image.setSize()}})}),!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof module&&module.exports?module.exports=function(b,c){return void 0===c&&(c="undefined"!=typeof window?require("jquery"):require("jquery")(b)),a(c),c}:a(jQuery)}(function(a){"use strict";a.extend(a.FE.DEFAULTS,{inlineStyles:{"Big Red":"font-size: 20px; color: red;","Small Blue":"font-size: 14px; color: blue;"}}),a.FE.PLUGINS.inlineStyle=function(b){function c(c){""!==b.selection.text()?b.html.insert(a.FE.START_MARKER+'<span style="'+c+'">'+b.selection.text()+"</span>"+a.FE.END_MARKER):b.html.insert('<span style="'+c+'">'+a.FE.INVISIBLE_SPACE+a.FE.MARKERS+"</span>")}return{apply:c}},a.FE.RegisterCommand("inlineStyle",{type:"dropdown",html:function(){var a='<ul class="fr-dropdown-list">',b=this.opts.inlineStyles;for(var c in b)a+='<li><span style="'+b[c]+'"><a class="fr-command" data-cmd="inlineStyle" data-param1="'+b[c]+'" title="'+this.language.translate(c)+'">'+this.language.translate(c)+"</a></span></li>";return a+="</ul>"},title:"Inline Style",callback:function(a,b){this.inlineStyle.apply(b)},plugin:"inlineStyle"}),a.FE.DefineIcon("inlineStyle",{NAME:"paint-brush"})}),!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof module&&module.exports?module.exports=function(b,c){return void 0===c&&(c="undefined"!=typeof window?require("jquery"):require("jquery")(b)),a(c),c}:a(jQuery)}(function(a){"use strict";a.extend(a.FE.DEFAULTS,{lineBreakerTags:["table","hr","iframe","form","dl"],lineBreakerOffset:15}),a.FE.PLUGINS.lineBreaker=function(b){function c(c,d){var e,f,g,h,i,j,k,l;if(null==c)h=d.parent(),i=h.offset().top,k=d.offset().top,e=k-Math.min((k-i)/2,b.opts.lineBreakerOffset),g=h.outerWidth(),f=h.offset().left;else if(null==d)h=c.parent(),j=h.offset().top+h.outerHeight(),l=c.offset().top+c.outerHeight(),e=l+Math.min((j-l)/2,b.opts.lineBreakerOffset),g=h.outerWidth(),f=h.offset().left;else{h=c.parent();var m=c.offset().top+c.height(),o=d.offset().top;if(m>o)return!1;e=(m+o)/2,g=h.outerWidth(),f=h.offset().left}b.opts.iframe&&(f+=b.$iframe.offset().left-a(b.o_win).scrollLeft(),e+=b.$iframe.offset().top-a(b.o_win).scrollTop()),b.$box.append(n),n.css("top",e-b.win.pageYOffset),n.css("left",f-b.win.pageXOffset),n.css("width",g),n.data("tag1",c),n.data("tag2",d),n.addClass("fr-visible").data("instance",b)}function d(a,d){var f,g,h=a.offset().top,i=a.offset().top+a.outerHeight();if(Math.abs(i-d)<=b.opts.lineBreakerOffset||Math.abs(d-h)<=b.opts.lineBreakerOffset)if(Math.abs(i-d)<Math.abs(d-h)){g=a.get(0);for(var j=g.nextSibling;j&&j.nodeType==Node.TEXT_NODE&&0===j.textContent.length;)j=j.nextSibling;if(!j)return c(a,null),!0;if(f=e(j))return c(a,f),!0}else{if(g=a.get(0),!g.previousSibling)return c(null,a),!0;if(f=e(g.previousSibling))return c(f,a),!0}n.removeClass("fr-visible").removeData("instance")}function e(c){if(c){var d=a(c);if(0===b.$el.find(d).length)return null;if(c.nodeType!=Node.TEXT_NODE&&b.opts.lineBreakerTags.indexOf(c.tagName.toLowerCase())>=0)return d;if(d.parents(b.opts.lineBreakerTags.join(",")).length>0)return c=d.parents(b.opts.lineBreakerTags.join(",")).get(0),a(c)}return null}function f(c){p=null;var f,g,h,i=null,j=b.doc.elementFromPoint(c.pageX-b.win.pageXOffset,c.pageY-b.win.pageYOffset);if(j&&("HTML"==j.tagName||"BODY"==j.tagName||b.node.isElement(j)))for(f=1;f<=b.opts.lineBreakerOffset;f++){if(g=b.doc.elementFromPoint(c.pageX-b.win.pageXOffset,c.pageY-b.win.pageYOffset-f),g&&!b.node.isElement(g)&&g!=b.$wp.get(0)&&a(g).parents(b.$wp).length){i=e(g);break}if(h=b.doc.elementFromPoint(c.pageX-b.win.pageXOffset,c.pageY-b.win.pageYOffset+f),h&&!b.node.isElement(h)&&h!=b.$wp.get(0)&&a(h).parents(b.$wp).length){i=e(h);break}}else i=e(j);i?d(i,c.pageY):b.core.sameInstance(n)&&n.removeClass("fr-visible").removeData("instance")}function g(a){return n.hasClass("fr-visible")&&!b.core.sameInstance(n)?!1:b.popups.areVisible()||b.$el.get(0).querySelectorAll(".fr-selected-cell").length?(n.removeClass("fr-visible"),!0):void(o===!1&&(p&&clearTimeout(p),p=setTimeout(f,30,a)))}function h(){p&&clearTimeout(p),n.hasClass("fr-visible")&&n.removeClass("fr-visible").removeData("instance")}function i(){o=!0,h()}function j(){o=!1}function k(c){if(!b.core.sameInstance(n))return!0;c.preventDefault(),n.removeClass("fr-visible").removeData("instance");var d=n.data("tag1"),e=n.data("tag2"),f=b.html.defaultTag();null==d?f&&"TD"!=e.parent().get(0).tagName?e.before("<"+f+">"+a.FE.MARKERS+"<br></"+f+">"):e.before(a.FE.MARKERS+"<br>"):f&&"TD"!=d.parent().get(0).tagName?d.after("<"+f+">"+a.FE.MARKERS+"<br></"+f+">"):d.after(a.FE.MARKERS+"<br>"),b.selection.restore()}function l(){b.shared.$line_breaker||(b.shared.$line_breaker=a('<div class="fr-line-breaker"><a class="fr-floating-btn" role="button" tabindex="-1" title="'+b.language.translate("Break")+'"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><rect x="21" y="11" width="2" height="8"/><rect x="14" y="17" width="7" height="2"/><path d="M14.000,14.000 L14.000,22.013 L9.000,18.031 L14.000,14.000 Z"/></svg></a></div>')),n=b.shared.$line_breaker,b.events.on("shared.destroy",function(){n.html("").removeData().remove()},!0),b.events.on("destroy",function(){n.removeData("instance").removeClass("fr-visible").appendTo("body")},!0),b.events.$on(n,"mouseleave",h,!0),b.events.$on(n,"mousemove",function(a){a.stopPropagation()},!0),b.events.$on(n,"mousedown","a",function(a){a.stopPropagation()},!0),b.events.$on(n,"click","a",k,!0)}function m(){return b.$wp?(l(),o=!1,b.events.$on(b.$win,"mousemove",g),b.events.$on(a(b.win),"scroll",h),b.events.on("popups.show.table.edit",h),b.events.$on(a(b.win),"mousedown",i),void b.events.$on(a(b.win),"mouseup",j)):!1}var n,o,p;return{_init:m}}}),!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof module&&module.exports?module.exports=function(b,c){return void 0===c&&(c="undefined"!=typeof window?require("jquery"):require("jquery")(b)),a(c),c}:a(jQuery)}(function(a){"use strict";a.extend(a.FE.POPUP_TEMPLATES,{"link.edit":"[_BUTTONS_]","link.insert":"[_BUTTONS_][_INPUT_LAYER_]"}),a.extend(a.FE.DEFAULTS,{linkEditButtons:["linkOpen","linkStyle","linkEdit","linkRemove"],linkInsertButtons:["linkBack","|","linkList"],linkAttributes:{},linkAutoPrefix:"http://",linkStyles:{"fr-green":"Green","fr-strong":"Thick"},linkMultipleStyles:!0,linkConvertEmailAddress:!0,linkAlwaysBlank:!1,linkAlwaysNoFollow:!1,linkList:[{text:"Froala",href:"https://froala.com",target:"_blank"},{text:"Google",href:"https://google.com",target:"_blank"},{displayText:"Facebook",href:"https://facebook.com"}],linkText:!0}),a.FE.PLUGINS.link=function(b){function c(){var c=b.image?b.image.get():null;if(!c&&b.$wp){var d=b.selection.element(),e=b.selection.endElement();return"A"!=d.tagName&&(d=a(d).parents("a:first").get(0)),"A"!=e.tagName&&(e=a(e).parents("a:first").get(0)),e&&e==d?d:null}return"A"==b.$el.get(0).tagName&&b.core.hasFocus()?b.$el:c&&c.get(0).parentNode&&"A"==c.get(0).parentNode.tagName?c.get(0).parentNode:void 0}function d(){var a=b.image?b.image.get():null,c=[];if(a)"A"==a.get(0).parentNode.tagName&&c.push(a.get(0).parentNode);else{var d,e,f,g;if(b.win.getSelection){var h=b.win.getSelection();if(h.getRangeAt&&h.rangeCount){g=b.doc.createRange();for(var i=0;i<h.rangeCount;++i)if(d=h.getRangeAt(i),e=d.commonAncestorContainer,e&&1!=e.nodeType&&(e=e.parentNode),e&&"a"==e.nodeName.toLowerCase())c.push(e);else{f=e.getElementsByTagName("a");for(var j=0;j<f.length;++j)g.selectNodeContents(f[j]),g.compareBoundaryPoints(d.END_TO_START,d)<1&&g.compareBoundaryPoints(d.START_TO_END,d)>-1&&c.push(f[j])}}}else if(b.doc.selection&&"Control"!=b.doc.selection.type)if(d=b.doc.selection.createRange(),e=d.parentElement(),"a"==e.nodeName.toLowerCase())c.push(e);else{f=e.getElementsByTagName("a"),g=b.doc.body.createTextRange();for(var k=0;k<f.length;++k)g.moveToElementText(f[k]),g.compareEndPoints("StartToEnd",d)>-1&&g.compareEndPoints("EndToStart",d)<1&&c.push(f[k])}}return c}function e(d){b.popups.hide("link.edit"),setTimeout(function(){if(!d||d&&(1==d.which||"mouseup"!=d.type)){var e=c(),g=b.image?b.image.get():null;if(e&&!g){if(b.image){var h=b.node.contents(e);if(1==h.length&&"IMG"==h[0].tagName)return a(h[0]).trigger("click"),!1}d&&d.stopPropagation(),f(e)}}},b.helpers.isIOS()?100:0)}function f(c){var d=b.popups.get("link.edit");d||(d=h());var e=a(c);b.popups.isVisible("link.edit")||b.popups.refresh("link.edit"),b.popups.setContainer("link.edit",a(b.opts.scrollableContainer));var f=e.offset().left+a(c).outerWidth()/2,g=e.offset().top+e.outerHeight();b.popups.show("link.edit",f,g,e.outerHeight())}function g(){b.popups.hide("link.edit")}function h(){var a="";b.opts.linkEditButtons.length>1&&("A"==b.$el.get(0).tagName&&b.opts.linkEditButtons.indexOf("linkRemove")>=0&&b.opts.linkEditButtons.splice(b.opts.linkEditButtons.indexOf("linkRemove"),1),a='<div class="fr-buttons">'+b.button.buildList(b.opts.linkEditButtons)+"</div>");var d={buttons:a},e=b.popups.create("link.edit",d);return b.$wp&&b.events.$on(b.$wp,"scroll.link-edit",function(){c()&&b.popups.isVisible("link.edit")&&f(c())}),e}function i(){}function j(){var d=b.popups.get("link.insert"),e=c();if(e){var f,g,h=a(e),i=d.find('input.fr-link-attr[type="text"]'),j=d.find('input.fr-link-attr[type="checkbox"]');for(f=0;f<i.length;f++)g=a(i[f]),g.val(h.attr(g.attr("name")||""));for(j.prop("checked",!1),f=0;f<j.length;f++)g=a(j[f]),h.attr(g.attr("name"))==g.data("checked")&&g.prop("checked",!0);d.find('input.fr-link-attr[type="text"][name="text"]').val(h.text())}else d.find('input.fr-link-attr[type="text"]').val(""),d.find('input.fr-link-attr[type="checkbox"]').prop("checked",!1),d.find('input.fr-link-attr[type="text"][name="text"]').val(b.selection.text());d.find("input.fr-link-attr").trigger("change");var k=b.image?b.image.get():null;k?d.find('.fr-link-attr[name="text"]').parent().hide():d.find('.fr-link-attr[name="text"]').parent().show()}function k(){var c=b.$tb.find('.fr-command[data-cmd="insertLink"]'),d=b.popups.get("link.insert");if(d||(d=l()),!d.hasClass("fr-active"))if(b.popups.refresh("link.insert"),b.popups.setContainer("link.insert",b.$tb||a(b.opts.scrollableContainer)),c.is(":visible")){var e=c.offset().left+c.outerWidth()/2,f=c.offset().top+(b.opts.toolbarBottom?10:c.outerHeight()-10);b.popups.show("link.insert",e,f,c.outerHeight())}else b.position.forSelection(d),b.popups.show("link.insert")}function l(a){if(a)return b.popups.onRefresh("link.insert",j),b.popups.onHide("link.insert",i),!0;var d="";b.opts.linkInsertButtons.length>=1&&(d='<div class="fr-buttons">'+b.button.buildList(b.opts.linkInsertButtons)+"</div>");var e='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="10" height="10" viewBox="0 0 32 32"><path d="M27 4l-15 15-7-7-5 5 12 12 20-20z" fill="#FFF"></path></svg>',f="",g=0;f='<div class="fr-link-insert-layer fr-layer fr-active" id="fr-link-insert-layer-'+b.id+'">',f+='<div class="fr-input-line"><input name="href" type="text" class="fr-link-attr" placeholder="URL" tabIndex="'+ ++g+'"></div>',b.opts.linkText&&(f+='<div class="fr-input-line"><input name="text" type="text" class="fr-link-attr" placeholder="'+b.language.translate("Text")+'" tabIndex="'+ ++g+'"></div>');for(var h in b.opts.linkAttributes){var k=b.opts.linkAttributes[h];f+='<div class="fr-input-line"><input name="'+h+'" type="text" class="fr-link-attr" placeholder="'+b.language.translate(k)+'" tabIndex="'+ ++g+'"></div>'}b.opts.linkAlwaysBlank||(f+='<div class="fr-checkbox-line"><span class="fr-checkbox"><input name="target" class="fr-link-attr" data-checked="_blank" type="checkbox" id="fr-link-target-'+b.id+'" tabIndex="'+ ++g+'"><span>'+e+'</span></span><label for="fr-link-target-'+b.id+'">'+b.language.translate("Open in new tab")+"</label></div>"),f+='<div class="fr-action-buttons"><button class="fr-command fr-submit" data-cmd="linkInsert" href="#" tabIndex="'+ ++g+'" type="button">'+b.language.translate("Insert")+"</button></div></div>";
var l={buttons:d,input_layer:f},m=b.popups.create("link.insert",l);return b.$wp&&b.events.$on(b.$wp,"scroll.link-insert",function(){var a=b.image?b.image.get():null;a&&b.popups.isVisible("link.insert")&&u(),c&&b.popups.isVisible("link.insert")&&s()}),m}function m(){var d=c(),e=b.image?b.image.get():null;return b.events.trigger("link.beforeRemove",[d])===!1?!1:void(e&&d?(e.unwrap(),e.trigger("click")):d&&(b.selection.save(),a(d).replaceWith(a(d).html()),b.selection.restore(),g()))}function n(){b.events.on("keyup",function(b){b.which!=a.FE.KEYCODE.ESC&&e(b)}),b.events.on("window.mouseup",e),l(!0),"A"==b.$el.get(0).tagName&&b.$el.addClass("fr-view")}function o(c){var d,e,f=b.opts.linkList[c],g=b.popups.get("link.insert"),h=g.find('input.fr-link-attr[type="text"]'),i=g.find('input.fr-link-attr[type="checkbox"]');for(e=0;e<h.length;e++)d=a(h[e]),f[d.attr("name")]?d.val(f[d.attr("name")]):d.val("");for(e=0;e<i.length;e++)d=a(i[e]),d.prop("checked",d.data("checked")==f[d.attr("name")])}function p(){var c,d,e=b.popups.get("link.insert"),f=e.find('input.fr-link-attr[type="text"]'),g=e.find('input.fr-link-attr[type="checkbox"]'),h=f.filter('[name="href"]').val(),i=f.filter('[name="text"]').val(),j={};for(d=0;d<f.length;d++)c=a(f[d]),["href","text"].indexOf(c.attr("name"))<0&&(j[c.attr("name")]=c.val());for(d=0;d<g.length;d++)c=a(g[d]),c.is(":checked")?j[c.attr("name")]=c.data("checked"):j[c.attr("name")]=c.data("unchecked");var k=a(b.o_win).scrollTop();r(h,i,j),a(b.o_win).scrollTop(k)}function q(){if(!b.selection.isCollapsed()){b.selection.save();for(var c=b.$el.find(".fr-marker").addClass("fr-unprocessed").toArray();c.length;){var d=a(c.pop());d.removeClass("fr-unprocessed");var e=b.node.deepestParent(d.get(0));if(e){var f=d.get(0),g="",h="";do f=f.parentNode,b.node.isBlock(f)||(g+=b.node.closeTagString(f),h=b.node.openTagString(f)+h);while(f!=e);var i=b.node.openTagString(d.get(0))+d.html()+b.node.closeTagString(d.get(0));d.replaceWith('<span id="fr-break"></span>');var j=a(e).html();j=j.replace(/<span id="fr-break"><\/span>/g,g+i+h),a(e).html(j)}c=b.$el.find(".fr-marker.fr-unprocessed").toArray()}b.selection.restore()}}function r(f,g,h){"undefined"==typeof h&&(h={});var i=b.image?b.image.get():null;i||"A"==b.$el.get(0).tagName?"A"==b.$el.get(0).tagName&&b.$el.focus():(b.selection.restore(),b.popups.hide("link.insert"));var j=f;if(b.opts.linkConvertEmailAddress){var k=/^[\w._]+@[a-zA-Z_]+?\.[a-zA-Z]{2,3}$/i;k.test(f)&&0!==f.indexOf("mailto:")&&(f="mailto:"+f)}if(0===f.indexOf("tel:")||0===f.indexOf("sms:")||0===f.indexOf("mailto:")||0===f.indexOf("notes:")||0===f.indexOf("data:image")||""===b.opts.linkAutoPrefix||/^(https?:|ftps?:|)\/\//.test(f)||(f=b.opts.linkAutoPrefix+f),f=b.helpers.sanitizeURL(f),b.opts.linkAlwaysBlank&&(h.target="_blank"),b.opts.linkAlwaysNoFollow&&(h.rel="nofollow"),g=g||"",f===b.opts.linkAutoPrefix){var l=b.popups.get("link.insert");return l.find('input[name="href"]').addClass("fr-error"),b.events.trigger("link.bad",[j]),!1}var m,n=c();if(n){m=a(n);var o=b.node.rawAttributes(n);for(var p in o)"class"!=p&&"style"!=p&&m.removeAttr(p);m.attr("href",f),g.length>0&&m.text()!=g&&!i&&m.text(g),i||m.prepend(a.FE.START_MARKER).append(a.FE.END_MARKER),m.attr(h),i||b.selection.restore()}else{i?i.wrap('<a href="'+f+'"></a>'):(b.doc.execCommand("unlink",!1,!1),b.selection.isCollapsed()?(g=0===g.length?j:g,b.html.insert('<a href="'+f+'">'+a.FE.START_MARKER+g+a.FE.END_MARKER+"</a>"),b.selection.restore()):g.length>0&&g!=b.selection.text()?(b.selection.remove(),b.html.insert('<a href="'+f+'">'+a.FE.START_MARKER+g+a.FE.END_MARKER+"</a>"),b.selection.restore()):(q(),b.doc.execCommand("createLink",!1,f)));for(var r=d(),s=0;s<r.length;s++)m=a(r[s]),m.attr(h),m.removeAttr("_moz_dirty");1==r.length&&b.$wp&&!i&&(a(r[0]).prepend(a.FE.START_MARKER).append(a.FE.END_MARKER),b.selection.restore())}i?(i.trigger("touchstart"),i.trigger(b.helpers.isMobile()?"touchend":"click")):(b.popups.get("link.insert"),e())}function s(){g();var d=c();if(d){var e=b.popups.get("link.insert");e||(e=l()),b.popups.isVisible("link.insert")||(b.popups.refresh("link.insert"),b.selection.save(),b.helpers.isMobile()&&(b.events.disableBlur(),b.$el.blur(),b.events.enableBlur())),b.popups.setContainer("link.insert",a(b.opts.scrollableContainer));var f=(b.image?b.image.get():null)||a(d),h=f.offset().left+f.outerWidth()/2,i=f.offset().top+f.outerHeight();b.popups.show("link.insert",h,i,f.outerHeight())}}function t(){var a=b.image?b.image.get():null;if(a)a.trigger("click").trigger("touchend");else{b.events.disableBlur(),b.selection.restore(),b.events.enableBlur();var d=c();d&&b.$wp?(b.selection.restore(),g(),e()):"A"==b.$el.get(0).tagName?(b.$el.focus(),e()):(b.popups.hide("link.insert"),b.toolbar.showInline())}}function u(){var c=b.image?b.image.get():null;if(c){var d=b.popups.get("link.insert");d||(d=l()),j(!0),b.popups.setContainer("link.insert",a(b.opts.scrollableContainer));var e=c.offset().left+c.outerWidth()/2,f=c.offset().top+c.outerHeight();b.popups.show("link.insert",e,f,c.outerHeight())}}function v(d){var e=c();if(!e)return!1;if(!b.opts.linkMultipleStyles){var f=Object.keys(b.opts.linkStyles);f.splice(f.indexOf(d),1),a(e).removeClass(f.join(" "))}a(e).toggleClass(d)}return{_init:n,remove:m,showInsertPopup:k,usePredefined:o,insertCallback:p,insert:r,update:s,get:c,allSelected:d,back:t,imageLink:u,applyStyle:v}},a.FE.DefineIcon("insertLink",{NAME:"link"}),a.FE.RegisterShortcut(75,"insertLink"),a.FE.RegisterCommand("insertLink",{title:"Insert Link",undo:!1,focus:!0,refreshOnCallback:!1,popup:!0,callback:function(){this.popups.isVisible("link.insert")?(this.$el.find(".fr-marker")&&(this.events.disableBlur(),this.selection.restore()),this.popups.hide("link.insert")):this.link.showInsertPopup()},plugin:"link"}),a.FE.DefineIcon("linkOpen",{NAME:"external-link"}),a.FE.RegisterCommand("linkOpen",{title:"Open Link",undo:!1,refresh:function(a){var b=this.link.get();b?a.removeClass("fr-hidden"):a.addClass("fr-hidden")},callback:function(){var a=this.link.get();a&&this.o_win.open(a.href)}}),a.FE.DefineIcon("linkEdit",{NAME:"edit"}),a.FE.RegisterCommand("linkEdit",{title:"Edit Link",undo:!1,refreshAfterCallback:!1,callback:function(){this.link.update()},refresh:function(a){var b=this.link.get();b?a.removeClass("fr-hidden"):a.addClass("fr-hidden")}}),a.FE.DefineIcon("linkRemove",{NAME:"unlink"}),a.FE.RegisterCommand("linkRemove",{title:"Unlink",callback:function(){this.link.remove()},refresh:function(a){var b=this.link.get();b?a.removeClass("fr-hidden"):a.addClass("fr-hidden")}}),a.FE.DefineIcon("linkBack",{NAME:"arrow-left"}),a.FE.RegisterCommand("linkBack",{title:"Back",undo:!1,focus:!1,back:!0,refreshAfterCallback:!1,callback:function(){this.link.back()},refresh:function(a){var b=this.link.get(),c=this.image?this.image.get():null;c||b||this.opts.toolbarInline?(a.removeClass("fr-hidden"),a.next(".fr-separator").removeClass("fr-hidden")):(a.addClass("fr-hidden"),a.next(".fr-separator").addClass("fr-hidden"))}}),a.FE.DefineIcon("linkList",{NAME:"search"}),a.FE.RegisterCommand("linkList",{title:"Choose Link",type:"dropdown",focus:!1,undo:!1,refreshAfterCallback:!1,html:function(){for(var a='<ul class="fr-dropdown-list">',b=this.opts.linkList,c=0;c<b.length;c++)a+='<li><a class="fr-command" data-cmd="linkList" data-param1="'+c+'">'+(b[c].displayText||b[c].text)+"</a></li>";return a+="</ul>"},callback:function(a,b){this.link.usePredefined(b)}}),a.FE.RegisterCommand("linkInsert",{focus:!1,refreshAfterCallback:!1,callback:function(){this.link.insertCallback()},refresh:function(a){var b=this.link.get();b?a.text(this.language.translate("Update")):a.text(this.language.translate("Insert"))}}),a.FE.DefineIcon("imageLink",{NAME:"link"}),a.FE.RegisterCommand("imageLink",{title:"Insert Link",undo:!1,focus:!1,callback:function(){this.link.imageLink()},refresh:function(a){var b,c=this.link.get();c?(b=a.prev(),b.hasClass("fr-separator")&&b.removeClass("fr-hidden"),a.addClass("fr-hidden")):(b=a.prev(),b.hasClass("fr-separator")&&b.addClass("fr-hidden"),a.removeClass("fr-hidden"))}}),a.FE.DefineIcon("linkStyle",{NAME:"magic"}),a.FE.RegisterCommand("linkStyle",{title:"Style",type:"dropdown",html:function(){var a='<ul class="fr-dropdown-list">',b=this.opts.linkStyles;for(var c in b)a+='<li><a class="fr-command" data-cmd="linkStyle" data-param1="'+c+'">'+this.language.translate(b[c])+"</a></li>";return a+="</ul>"},callback:function(a,b){this.link.applyStyle(b)},refreshOnShow:function(b,c){var d=this.link.get();if(d){var e=a(d);c.find(".fr-command").each(function(){var b=a(this).data("param1");a(this).toggleClass("fr-active",e.hasClass(b))})}}})}),!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof module&&module.exports?module.exports=function(b,c){return void 0===c&&(c="undefined"!=typeof window?require("jquery"):require("jquery")(b)),a(c),c}:a(jQuery)}(function(a){"use strict";a.FE.PLUGINS.lists=function(b){function c(a){return'<span class="fr-open-'+a.toLowerCase()+'"></span>'}function d(a){return'<span class="fr-close-'+a.toLowerCase()+'"></span>'}function e(b,c){for(var d=[],e=0;e<b.length;e++){var f=b[e].parentNode;"LI"==b[e].tagName&&f.tagName!=c&&d.indexOf(f)<0&&d.push(f)}for(e=d.length-1;e>=0;e--){var g=a(d[e]);g.replaceWith("<"+c.toLowerCase()+">"+g.html()+"</"+c.toLowerCase()+">")}}function f(c,d){e(c,d);for(var f=b.html.defaultTag(),g=0;g<c.length;g++)"LI"!=c[g].tagName&&(f&&c[g].tagName.toLowerCase()==f?a(c[g]).replaceWith("<"+d+"><li"+b.node.attributes(c[g])+">"+a(c[g]).html()+"</li></"+d+">"):a(c[g]).wrap("<"+d+"><li></li></"+d+">"));b.clean.lists()}function g(e){var f,g;for(f=e.length-1;f>=0;f--)for(g=f-1;g>=0;g--)if(a(e[g]).find(e[f]).length||e[g]==e[f]){e.splice(f,1);break}var h=[];for(f=0;f<e.length;f++){var i=a(e[f]),j=e[f].parentNode;i.before(d(j.tagName)),"LI"==j.parentNode.tagName?(i.before(d("LI")),i.after(c("LI"))):(b.node.isEmpty(i.get(0),!0)||0!==i.find(b.html.blockTagsQuery()).length||i.append("<br>"),i.append(c("LI")),i.prepend(d("LI"))),i.after(c(j.tagName)),"LI"==j.parentNode.tagName&&(j=j.parentNode.parentNode),h.indexOf(j)<0&&h.push(j)}for(f=0;f<h.length;f++){var k=a(h[f]),l=k.html();l=l.replace(/<span class="fr-close-([a-z]*)"><\/span>/g,"</$1>"),l=l.replace(/<span class="fr-open-([a-z]*)"><\/span>/g,"<$1>"),k.replaceWith(b.node.openTagString(k.get(0))+l+b.node.closeTagString(k.get(0)))}b.$el.find("li:empty").remove(),b.$el.find("ul:empty, ol:empty").remove(),b.clean.lists(),b.html.wrap()}function h(a,b){for(var c=!0,d=0;d<a.length;d++){if("LI"!=a[d].tagName)return!1;a[d].parentNode.tagName!=b&&(c=!1)}return c}function i(a){b.selection.save(),b.html.wrap(!0,!0),b.selection.restore();for(var c=b.selection.blocks(),d=0;d<c.length;d++)"LI"!=c[d].tagName&&"LI"==c[d].parentNode.tagName&&(c[d]=c[d].parentNode);b.selection.save(),h(c,a)?g(c):f(c,a),b.html.unwrap(),b.selection.restore()}function j(c,d){var e=a(b.selection.element());if(e.get(0)!=b.$el.get(0)){var f=e.get(0);"LI"!=f.tagName&&(f=e.parents("li").get(0)),f&&f.parentNode.tagName==d&&b.$el.get(0).contains(f.parentNode)&&c.addClass("fr-active")}}function k(c){b.selection.save();for(var d=0;d<c.length;d++){var e=c[d].previousSibling;if(e){var f=a(c[d]).find("> ul, > ol").get(0);if(f){for(var g=a("<li>").prependTo(a(f)),h=b.node.contents(c[d])[0];h&&!b.node.isList(h);){var i=h.nextSibling;g.append(h),h=i}a(e).append(a(f)),a(c[d]).remove()}else{var j=a(e).find("> ul, > ol").get(0);if(j)a(j).append(a(c[d]));else{var k=a("<"+c[d].parentNode.tagName+">");a(e).append(k),k.append(a(c[d]))}}}}b.clean.lists(),b.selection.restore()}function l(a){b.selection.save(),g(a),b.selection.restore()}function m(a){if("indent"==a||"outdent"==a){for(var c=!1,d=b.selection.blocks(),e=[],f=0;f<d.length;f++)"LI"==d[f].tagName?(c=!0,e.push(d[f])):"LI"==d[f].parentNode.tagName&&(c=!0,e.push(d[f].parentNode));c&&("indent"==a?k(e):l(e))}}function n(){b.events.on("commands.after",m),b.events.on("keydown",function(c){if(c.which==a.FE.KEYCODE.TAB){for(var d,e=b.selection.blocks(),f=[],g=0;g<e.length;g++)"LI"==e[g].tagName?(d=!0,f.push(e[g])):"LI"==e[g].parentNode.tagName&&(d=!0,f.push(e[g].parentNode));if(d)return c.preventDefault(),c.stopPropagation(),c.shiftKey?l(f):k(f),!1}},!0)}return{_init:n,format:i,refresh:j}},a.FE.RegisterCommand("formatUL",{title:"Unordered List",refresh:function(a){this.lists.refresh(a,"UL")},callback:function(){this.lists.format("UL")},plugin:"lists"}),a.FE.RegisterCommand("formatOL",{title:"Ordered List",refresh:function(a){this.lists.refresh(a,"OL")},callback:function(){this.lists.format("OL")},plugin:"lists"}),a.FE.DefineIcon("formatUL",{NAME:"list-ul"}),a.FE.DefineIcon("formatOL",{NAME:"list-ol"})}),!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof module&&module.exports?module.exports=function(b,c){return void 0===c&&(c="undefined"!=typeof window?require("jquery"):require("jquery")(b)),a(c),c}:a(jQuery)}(function(a){"use strict";a.extend(a.FE.DEFAULTS,{paragraphFormat:{N:"Normal",H1:"Heading 1",H2:"Heading 2",H3:"Heading 3",H4:"Heading 4",PRE:"Code"},paragraphFormatSelection:!1}),a.FE.PLUGINS.paragraphFormat=function(b){function c(c,d){var e=b.html.defaultTag();if(d&&d.toLowerCase()!=e)if(c.find("ul, ol").length>0){var f=a("<"+d+">");c.prepend(f);for(var g=b.node.contents(c.get(0))[0];g&&["UL","OL"].indexOf(g.tagName)<0;){var h=g.nextSibling;f.append(g),g=h}}else c.html("<"+d+">"+c.html()+"</"+d+">")}function d(c,d){var e=b.html.defaultTag();d||(d='div class="fr-temp-div" data-empty="true"'),d.toLowerCase()==e?c.replaceWith(c.html()):c.replaceWith(a("<"+d+">").html(c.html()))}function e(c,d){var e=b.html.defaultTag();d||(d='div class="fr-temp-div"'+(b.node.isEmpty(c.get(0),!0)?' data-empty="true"':"")),d.toLowerCase()==e?(b.node.isEmpty(c.get(0),!0)||c.append("<br/>"),c.replaceWith(c.html())):c.replaceWith(a("<"+d+">").html(c.html()))}function f(c,d){d||(d='div class="fr-temp-div"'+(b.node.isEmpty(c.get(0),!0)?' data-empty="true"':"")),c.replaceWith(a("<"+d+" "+b.node.attributes(c.get(0))+">").html(c.html()))}function g(g){"N"==g&&(g=b.html.defaultTag()),b.selection.save(),b.html.wrap(!0,!0,!0),b.selection.restore();var h=b.selection.blocks();b.selection.save(),b.$el.find("pre").attr("skip",!0);for(var i=0;i<h.length;i++)if(h[i].tagName!=g&&!b.node.isList(h[i])){var j=a(h[i]);"LI"==h[i].tagName?c(j,g):"LI"==h[i].parentNode.tagName&&h[i]?d(j,g):["TD","TH"].indexOf(h[i].parentNode.tagName)>=0?e(j,g):f(j,g)}b.$el.find('pre:not([skip="true"]) + pre:not([skip="true"])').each(function(){a(this).prev().append("<br>"+a(this).html()),a(this).remove()}),b.$el.find("pre").removeAttr("skip"),b.html.unwrap(),b.selection.restore()}function h(a,c){var d=b.selection.blocks();if(d.length){var e=d[0],f="N",g=b.html.defaultTag();e.tagName.toLowerCase()!=g&&e!=b.$el.get(0)&&(f=e.tagName),c.find('.fr-command[data-param1="'+f+'"]').addClass("fr-active")}else c.find('.fr-command[data-param1="N"]').addClass("fr-active")}function i(a){if(b.opts.paragraphFormatSelection){var c=b.selection.blocks();if(c.length){var d=c[0],e="N",f=b.html.defaultTag();d.tagName.toLowerCase()!=f&&d!=b.$el.get(0)&&(e=d.tagName),["LI","TD","TH"].indexOf(e)>=0&&(e="N"),a.find("> span").text(b.opts.paragraphFormat[e])}else a.find("> span").text(edior.opts.paragraphFormat.N)}}return{apply:g,refreshOnShow:h,refresh:i}},a.FE.RegisterCommand("paragraphFormat",{type:"dropdown",displaySelection:function(a){return a.opts.paragraphFormatSelection},defaultSelection:"Normal",displaySelectionWidth:100,html:function(){var a='<ul class="fr-dropdown-list">',b=this.opts.paragraphFormat;for(var c in b)a+="<li><"+c+' style="padding: 0 !important; margin: 0 !important;"><a class="fr-command" data-cmd="paragraphFormat" data-param1="'+c+'" title="'+this.language.translate(b[c])+'">'+this.language.translate(b[c])+"</a></"+c+"></li>";return a+="</ul>"},title:"Paragraph Format",callback:function(a,b){this.paragraphFormat.apply(b)},refresh:function(a){this.paragraphFormat.refresh(a)},refreshOnShow:function(a,b){this.paragraphFormat.refreshOnShow(a,b)},plugin:"paragraphFormat"}),a.FE.DefineIcon("paragraphFormat",{NAME:"paragraph"})}),!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof module&&module.exports?module.exports=function(b,c){return void 0===c&&(c="undefined"!=typeof window?require("jquery"):require("jquery")(b)),a(c),c}:a(jQuery)}(function(a){"use strict";a.extend(a.FE.DEFAULTS,{paragraphStyles:{"fr-text-gray":"Gray","fr-text-bordered":"Bordered","fr-text-spaced":"Spaced","fr-text-uppercase":"Uppercase"},paragraphMultipleStyles:!0}),a.FE.PLUGINS.paragraphStyle=function(b){function c(c){var d="";b.opts.paragraphMultipleStyles||(d=Object.keys(b.opts.paragraphStyles),d.splice(d.indexOf(c),1),d=d.join(" ")),b.selection.save(),b.html.wrap(!0,!0,!0),b.selection.restore();var e=b.selection.blocks();b.selection.save();for(var f=0;f<e.length;f++)a(e[f]).removeClass(d).toggleClass(c),a(e[f]).hasClass("fr-temp-div")&&a(e[f]).removeClass("fr-temp-div"),""===a(e[f]).attr("class")&&a(e[f]).removeAttr("class");b.html.unwrap(),b.selection.restore()}function d(c,d){var e=b.selection.blocks();if(e.length){var f=a(e[0]);d.find(".fr-command").each(function(){var b=a(this).data("param1");a(this).toggleClass("fr-active",f.hasClass(b))})}}function e(){}return{_init:e,apply:c,refreshOnShow:d}},a.FE.RegisterCommand("paragraphStyle",{type:"dropdown",html:function(){var a='<ul class="fr-dropdown-list">',b=this.opts.paragraphStyles;for(var c in b)a+='<li><a class="fr-command '+c+'" data-cmd="paragraphStyle" data-param1="'+c+'" title="'+this.language.translate(b[c])+'">'+this.language.translate(b[c])+"</a></li>";return a+="</ul>"},title:"Paragraph Style",callback:function(a,b){this.paragraphStyle.apply(b)},refreshOnShow:function(a,b){this.paragraphStyle.refreshOnShow(a,b)},plugin:"paragraphStyle"}),a.FE.DefineIcon("paragraphStyle",{NAME:"magic"})}),!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof module&&module.exports?module.exports=function(b,c){return void 0===c&&(c="undefined"!=typeof window?require("jquery"):require("jquery")(b)),a(c),c}:a(jQuery)}(function(a){"use strict";a.extend(a.FE.DEFAULTS,{quickInsertButtons:["image","table","ul","ol","hr"],quickInsertTags:["p","div","h1","h2","h3","h4","h5","h6","pre","blockquote"]}),a.FE.QUICK_INSERT_BUTTONS={image:{icon:"insertImage",callback:function(){var b=this;b.shared.$qi_image_input||(b.shared.$qi_image_input=a('<input accept="image/*" name="quickInsertImage'+this.id+'" style="display: none;" type="file">'),a("body").append(b.$qi_image_input)),b.$qi_image_input=b.shared.$qi_image_input,b.events.$on(b.$qi_image_input,"change",function(){var b=a(this).data("inst");if(this.files){b.quickInsert.hide(),b.image.showInsertPopup();var c=b.popups.get("image.insert");b.position.forSelection(c),b.image.upload(this.files),a(this).val(""),a(this).blur()}},!0),b.$qi_image_input.data("inst",b).trigger("click")},requiredPlugin:"image",title:"Insert Image"},table:{icon:"insertTable",callback:function(){this.quickInsert.hide(),this.table.insert(2,2),this.undo.saveStep()},requiredPlugin:"table",title:"Insert Table"},ol:{icon:"formatOL",callback:function(){this.quickInsert.hide(),this.lists.format("OL"),this.undo.saveStep()},requiredPlugin:"lists",title:"Ordered List"},ul:{icon:"formatUL",callback:function(){this.quickInsert.hide(),this.lists.format("UL"),this.undo.saveStep()},requiredPlugin:"lists",title:"Unordered List"},hr:{icon:"insertHR",callback:function(){this.quickInsert.hide(),this.commands.insertHR(),this.undo.saveStep()},title:"Insert Horizontal Line"}},a.FE.RegisterQuickInsertCommand=function(b,c){a.FE.QUICK_INSERT_BUTTONS[b]=c},a.FE.PLUGINS.quickInsert=function(b){function c(c){j||h(),b.$box.append(j);var d,e;d=c.offset().top-b.$box.offset().top-(j.outerHeight()-c.outerHeight())/2,e=0-j.outerWidth(),b.opts.iframe&&(d+=b.$iframe.offset().top-a(b.o_win).scrollTop()),j.css("top",d),j.css("left",e),j.data("tag",c),j.addClass("fr-visible")}function d(){var d=b.selection.element();b.node.isBlock(d)||(d=b.node.blockParent(d)),d&&b.node.isEmpty(d)&&b.node.isElement(d.parentNode)?d&&b.selection.isCollapsed()&&c(a(d)):e()}function e(){j&&(b.html.checkIfEmpty(),j.hasClass("fr-on")&&g(),j.removeClass("fr-visible fr-on"),j.css("left",-9999).css("top",-9999))}function f(c){if(c.preventDefault(),j.hasClass("fr-on"))g();else{if(!b.shared.$qi_helper){for(var d=b.opts.quickInsertButtons,e='<div class="fr-qi-helper">',f=0,h=0;h<d.length;h++){var i=a.FE.QUICK_INSERT_BUTTONS[d[h]];i&&(!i.requiredPlugin||a.FE.PLUGINS[i.requiredPlugin]&&b.opts.pluginsEnabled.indexOf(i.requiredPlugin)>=0)&&(e+='<a class="fr-btn fr-floating-btn" role="button" title="'+b.language.translate(i.title)+'" tabindex="-1" data-cmd="'+d[h]+'" style="transition-delay: '+.025*f++ +'s;">'+b.icon.create(i.icon)+"</a>")}e+="</div>",b.shared.$qi_helper=a(e),b.tooltip.bind(b.shared.$qi_helper,".fr-qi-helper > a.fr-btn")}k=b.shared.$qi_helper,k.appendTo(b.$box),setTimeout(function(){k.css("top",parseFloat(j.css("top"))),k.css("left",parseFloat(j.css("left"))+j.outerWidth()),k.find("a").addClass("fr-size-1"),j.addClass("fr-on")},10)}}function g(){var a=b.$box.find(".fr-qi-helper");a.length&&(a.find("a").removeClass("fr-size-1"),a.css("left",-9999),j.removeClass("fr-on"))}function h(){b.shared.$quick_insert||(b.shared.$quick_insert=a('<div class="fr-quick-insert"><a class="fr-floating-btn" role="button" tabindex="-1" title="'+b.language.translate("Quick Insert")+'"><svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><path d="M22,16.75 L16.75,16.75 L16.75,22 L15.25,22.000 L15.25,16.75 L10,16.75 L10,15.25 L15.25,15.25 L15.25,10 L16.75,10 L16.75,15.25 L22,15.25 L22,16.75 Z"/></svg></a></div>')),j=b.shared.$quick_insert,b.tooltip.bind(b.$box,".fr-quick-insert > a.fr-floating-btn"),b.events.on("destroy",function(){j.removeClass("fr-on").appendTo(a("body")).css("left",-9999).css("top",-9999),k&&(g(),k.appendTo(a("body")))},!0),b.events.on("shared.destroy",function(){j.html("").removeData().remove(),k&&k.html("").removeData().remove()},!0),b.events.on("commands.before",e),b.events.on("commands.after",function(){b.popups.areVisible()||d()}),b.events.bindClick(b.$box,".fr-quick-insert > a",f),b.events.bindClick(b.$box,".fr-qi-helper > a.fr-btn",function(c){var d=a(c.currentTarget).data("cmd");a.FE.QUICK_INSERT_BUTTONS[d].callback.apply(b,[c.currentTarget])})}function i(){return b.$wp?(b.opts.iframe&&b.$el.parent("html").find("head").append('<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css">'),b.popups.onShow("image.edit",e),b.events.on("mouseup",d),b.events.on("blur",e),void b.events.on("keyup",d)):!1}var j,k;return{_init:i,hide:e}}}),!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof module&&module.exports?module.exports=function(b,c){return void 0===c&&(c="undefined"!=typeof window?require("jquery"):require("jquery")(b)),a(c),c}:a(jQuery)}(function(a){"use strict";a.FE.PLUGINS.quote=function(b){function c(a){for(;a.parentNode&&a.parentNode!=b.$el.get(0);)a=a.parentNode;return a}function d(){var d,e=b.selection.blocks();for(d=0;d<e.length;d++)e[d]=c(e[d]);b.selection.save();var f=a("<blockquote>");for(f.insertBefore(e[0]),d=0;d<e.length;d++)f.append(e[d]);b.html.unwrap(),b.selection.restore()}function e(){var c,d=b.selection.blocks();for(c=0;c<d.length;c++)"BLOCKQUOTE"!=d[c].tagName&&(d[c]=a(d[c]).parentsUntil(b.$el,"BLOCKQUOTE").get(0));for(b.selection.save(),c=0;c<d.length;c++)d[c]&&a(d[c]).replaceWith(d[c].innerHTML);b.html.unwrap(),b.selection.restore()}function f(a){b.selection.save(),b.html.wrap(!0,!0),b.selection.restore(),"increase"==a?d():"decrease"==a&&e()}return{apply:f}},a.FE.RegisterShortcut(222,"quote","increase"),a.FE.RegisterShortcut(222,"quote","decrease",!0),a.FE.RegisterCommand("quote",{title:"Quote",type:"dropdown",options:{increase:"Increase",decrease:"Decrease"},callback:function(a,b){this.quote.apply(b)},plugin:"quote"}),a.FE.DefineIcon("quote",{NAME:"quote-left"})}),!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof module&&module.exports?module.exports=function(b,c){return void 0===c&&(c="undefined"!=typeof window?require("jquery"):require("jquery")(b)),a(c),c}:a(jQuery)}(function(a){"use strict";a.extend(a.FE.DEFAULTS,{saveInterval:1e4,saveURL:null,saveParams:{},saveParam:"body",saveMethod:"POST"}),a.FE.PLUGINS.save=function(b){function c(a,c){b.events.trigger("save.error",[{code:a,message:n[a]},c])}function d(d){if("undefined"==typeof d&&(d=b.html.get()),b.events.trigger("save.before")===!1)return!1;if(b.opts.saveURL){var e={};for(var f in b.opts.saveParams){var g=b.opts.saveParams[f];"function"==typeof g?e[f]=g.call(this):e[f]=g}var h={};h[b.opts.saveParam]=d,a.ajax({type:b.opts.saveMethod,url:b.opts.saveURL,data:a.extend(h,e),crossDomain:b.opts.requestWithCORS,xhrFields:{withCredentials:b.opts.requestWithCORS},headers:b.opts.requestHeaders}).done(function(a){b.events.trigger("save.after",[a])}).fail(function(a){c(m,a.response)})}else c(l)}function e(){clearTimeout(i),i=setTimeout(function(){var a=b.html.get();(j!=a||k)&&(j=a,k=!1,d(a))},b.opts.saveInterval)}function f(){e(),k=!1}function g(){k=!0}function h(){b.opts.saveInterval&&(j=b.html.get(),b.events.on("contentChanged",e),b.events.on("keydown",function(){clearTimeout(i)}))}var i=null,j=null,k=!1,l=1,m=2,n={};return n[l]="Missing saveURL option.",n[m]="Something went wrong during save.",{_init:h,save:d,reset:f,force:g}},a.FE.DefineIcon("save",{NAME:"floppy-o"}),a.FE.RegisterCommand("save",{title:"Save",undo:!1,focus:!1,refreshAfterCallback:!1,callback:function(){this.save.save()},plugin:"save"})}),!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof module&&module.exports?module.exports=function(b,c){return void 0===c&&(c="undefined"!=typeof window?require("jquery"):require("jquery")(b)),a(c),c}:a(jQuery)}(function(a){"use strict";a.extend(a.FE.POPUP_TEMPLATES,{"table.insert":"[_BUTTONS_][_ROWS_COLUMNS_]","table.edit":"[_BUTTONS_]","table.colors":"[_BUTTONS_][_COLORS_]"}),a.extend(a.FE.DEFAULTS,{tableInsertMaxSize:10,tableEditButtons:["tableHeader","tableRemove","|","tableRows","tableColumns","tableStyle","-","tableCells","tableCellBackground","tableCellVerticalAlign","tableCellHorizontalAlign","tableCellStyle"],tableInsertButtons:["tableBack","|"],tableResizerOffset:5,tableResizingLimit:30,tableColorsButtons:["tableBack","|"],tableColors:["#61BD6D","#1ABC9C","#54ACD2","#2C82C9","#9365B8","#475577","#CCCCCC","#41A85F","#00A885","#3D8EB9","#2969B0","#553982","#28324E","#000000","#F7DA64","#FBA026","#EB6B56","#E25041","#A38F84","#EFEFEF","#FFFFFF","#FAC51C","#F37934","#D14841","#B8312F","#7C706B","#D1D5D8","REMOVE"],tableColorsStep:7,tableCellStyles:{"fr-highlighted":"Highlighted","fr-thick":"Thick"},tableStyles:{"fr-dashed-borders":"Dashed Borders","fr-alternate-rows":"Alternate Rows"},tableCellMultipleStyles:!0,tableMultipleStyles:!0,tableInsertHelper:!0,tableInsertHelperOffset:15}),a.FE.PLUGINS.table=function(b){function c(){var a=b.$tb.find('.fr-command[data-cmd="insertTable"]'),c=b.popups.get("table.insert");if(c||(c=g()),!c.hasClass("fr-active")){b.popups.refresh("table.insert"),b.popups.setContainer("table.insert",b.$tb);var d=a.offset().left+a.outerWidth()/2,e=a.offset().top+(b.opts.toolbarBottom?10:a.outerHeight()-10);b.popups.show("table.insert",d,e,a.outerHeight())}}function d(){var c=B();if(c){var d=b.popups.get("table.edit");d||(d=i()),b.popups.setContainer("table.edit",a(b.opts.scrollableContainer));var e=I(c),f=(e.left+e.right)/2,g=e.bottom;if(b.popups.show("table.edit",f,g,e.bottom-e.top),b.$el.find(".fr-selected-cell").length>1){b.toolbar.disable(),b.$el.removeClass("fr-no-selection"),b.edit.on();var h=a(b.o_win).scrollTop();b.$el.focus(),b.selection.setAtEnd(b.$el.find(".fr-selected-cell:last").get(0)),b.selection.restore(),a(b.o_win).scrollTop(h),b.button.bulkRefresh()}}}function e(){var c=B();if(c){var d=b.popups.get("table.colors");d||(d=j()),b.popups.setContainer("table.colors",a(b.opts.scrollableContainer));var e=I(c),f=(e.left+e.right)/2,g=e.bottom;l(),b.popups.show("table.colors",f,g,e.bottom-e.top)}}function f(){0===b.$el.get(0).querySelectorAll(".fr-selected-cell").length&&b.toolbar.enable()}function g(c){if(c)return b.popups.onHide("table.insert",function(){b.popups.get("table.insert").find('.fr-table-size .fr-select-table-size > span[data-row="1"][data-col="1"]').trigger("mouseenter")}),!0;var d="";b.opts.tableInsertButtons.length>0&&(d='<div class="fr-buttons">'+b.button.buildList(b.opts.tableInsertButtons)+"</div>");var e={buttons:d,rows_columns:h()},f=b.popups.create("table.insert",e);return b.events.$on(f,"mouseenter",".fr-table-size .fr-select-table-size .fr-table-cell",function(c){var d=a(c.currentTarget),e=d.data("row"),f=d.data("col"),g=d.parent();g.siblings(".fr-table-size-info").html(e+" &times; "+f),g.find("> span").removeClass("hover");for(var h=1;h<=b.opts.tableInsertMaxSize;h++)for(var i=0;i<=b.opts.tableInsertMaxSize;i++){var j=g.find('> span[data-row="'+h+'"][data-col="'+i+'"]');e>=h&&f>=i?j.addClass("hover"):e+1>=h||2>=h&&!b.helpers.isMobile()?j.css("display","inline-block"):h>2&&!b.helpers.isMobile()&&j.css("display","none")}},!0),f}function h(){for(var a='<div class="fr-table-size"><div class="fr-table-size-info">1 &times; 1</div><div class="fr-select-table-size">',c=1;c<=b.opts.tableInsertMaxSize;c++){for(var d=1;d<=b.opts.tableInsertMaxSize;d++){var e="inline-block";c>2&&!b.helpers.isMobile()&&(e="none");var f="fr-table-cell ";1==c&&1==d&&(f+=" hover"),a+='<span class="fr-command '+f+'" data-cmd="tableInsert" data-row="'+c+'" data-col="'+d+'" data-param1="'+c+'" data-param2="'+d+'" style="display: '+e+';"><span></span></span>'}a+='<div class="new-line"></div>'}return a+="</div></div>"}function i(a){if(a)return b.popups.onHide("table.edit",f),!0;var c="";b.opts.tableEditButtons.length>0&&(c='<div class="fr-buttons">'+b.button.buildList(b.opts.tableEditButtons)+"</div>");var e={buttons:c},g=b.popups.create("table.edit",e);return b.events.$on(b.$wp,"scroll.table-edit",function(){b.popups.isVisible("table.edit")&&d()}),g}function j(){var a="";b.opts.tableColorsButtons.length>0&&(a='<div class="fr-buttons fr-table-colors-buttons">'+b.button.buildList(b.opts.tableColorsButtons)+"</div>");var c={buttons:a,colors:k()},d=b.popups.create("table.colors",c);return b.events.$on(b.$wp,"scroll.table-colors",function(){b.popups.isVisible("table.colors")&&e()}),d}function k(){for(var a='<div class="fr-table-colors">',c=0;c<b.opts.tableColors.length;c++)0!==c&&c%b.opts.tableColorsStep===0&&(a+="<br>"),a+="REMOVE"!=b.opts.tableColors[c]?'<span class="fr-command" style="background: '+b.opts.tableColors[c]+';" data-cmd="tableCellBackgroundColor" data-param1="'+b.opts.tableColors[c]+'"></span>':'<span class="fr-command" data-cmd="tableCellBackgroundColor" data-param1="REMOVE" title="'+b.language.translate("Clear Formatting")+'"><i class="fa fa-eraser"></i></span>';return a+="</div>"}function l(){var a=b.popups.get("table.colors"),c=b.$el.find(".fr-selected-cell:first");a.find(".fr-selected-color").removeClass("fr-selected-color"),a.find('span[data-param1="'+b.helpers.RGBToHex(c.css("background-color"))+'"]').addClass("fr-selected-color")}function m(c,d){var e,f,g='<table style="width: 100%;"><tbody>',h=100/d;for(e=0;c>e;e++){for(g+="<tr>",f=0;d>f;f++)g+='<td style="width: '+h.toFixed(4)+'%;">',0===e&&0===f&&(g+=a.FE.MARKERS),g+="<br></td>";g+="</tr>"}g+="</tbody></table>",b.html.insert(g),b.selection.restore()}function n(){if(b.$el.find(".fr-selected-cell").length>0){var a=b.$el.find(".fr-selected-cell").closest("table");b.selection.setBefore(a.get(0))||b.selection.setAfter(a.get(0)),b.selection.restore(),b.popups.hide("table.edit"),a.remove()}}function o(){var c=b.$el.find(".fr-selected-cell").closest("table");if(c.length>0&&0===c.find("th").length){
var e,f="<thead><tr>",g=0;for(c.find("tr:first > td").each(function(){var b=a(this);g+=parseInt(b.attr("colspan"),10)||1}),e=0;g>e;e++)f+="<th><br></th>";f+="</tr></thead>",c.prepend(f),d()}}function p(){var a=b.$el.find(".fr-selected-cell").closest("table"),c=a.find("thead");if(c.length>0)if(0===a.find("tbody tr").length)n();else if(c.remove(),b.$el.find(".fr-selected-cell").length>0)d();else{b.popups.hide("table.edit");var e=a.find("tbody tr:first td:first").get(0);e&&(b.selection.setAtEnd(e),b.selection.restore())}}function q(c){var e=b.$el.find(".fr-selected-cell").closest("table");if(e.length>0){if(b.$el.find("th.fr-selected-cell").length>0&&"above"==c)return;var f,g,h=B(),i=G(h);g="above"==c?i.min_i:i.max_i;var j="<tr>";for(f=0;f<h[g].length;f++)if("below"==c&&g<h.length-1&&h[g][f]==h[g+1][f]||"above"==c&&g>0&&h[g][f]==h[g-1][f]){if(0===f||f>0&&h[g][f]!=h[g][f-1]){var k=a(h[g][f]);k.attr("rowspan",parseInt(k.attr("rowspan"),10)+1)}}else j+="<td><br></td>";j+="</tr>";var l=a(e.find("tr").not(e.find("table tr")).get(g));"below"==c?l.after(j):"above"==c&&(l.before(j),b.popups.isVisible("table.edit")&&d())}}function r(){var c=b.$el.find(".fr-selected-cell").closest("table");if(c.length>0){var d,e,f,g=B(),h=G(g);if(0===h.min_i&&h.max_i==g.length-1)n();else{for(d=h.max_i;d>=h.min_i;d--){for(f=a(c.find("tr").not(c.find("table tr")).get(d)),e=0;e<g[d].length;e++)if(0===e||g[d][e]!=g[d][e-1]){var i=a(g[d][e]);if(parseInt(i.attr("rowspan"),10)>1){var j=parseInt(i.attr("rowspan"),10)-1;1==j?i.removeAttr("rowspan"):i.attr("rowspan",j)}if(d<g.length-1&&g[d][e]==g[d+1][e]&&(0===d||g[d][e]!=g[d-1][e])){for(var k=g[d][e],l=e;l>0&&g[d][l]==g[d][l-1];)l--;0===l?a(c.find("tr").not(c.find("table tr")).get(d+1)).prepend(k):a(g[d+1][l-1]).after(k)}}var m=f.parent();f.remove(),0===m.find("tr").length&&m.remove(),g=B(c)}h.min_i>0?b.selection.setAtEnd(g[h.min_i-1][0]):b.selection.setAtEnd(g[0][0]),b.selection.restore(),b.popups.hide("table.edit")}}}function s(c){var e=b.$el.find(".fr-selected-cell").closest("table");if(e.length>0){var f,g=B(),h=G(g);f="before"==c?h.min_j:h.max_j;var i,j=100/g[0].length,k=100/(g[0].length+1);e.find("th, td").each(function(){i=a(this),i.data("old-width",i.outerWidth()/e.outerWidth()*100)}),e.find("tr").not(e.find("table tr")).each(function(b){for(var d,e=a(this),h=0,i=0;f>h-1;){if(d=e.find("> th, > td").get(i),!d){d=null;break}d==g[b][h]?(h+=parseInt(a(d).attr("colspan"),10)||1,i++):(h+=parseInt(a(g[b][h]).attr("colspan"),10)||1,"after"==c&&(d=0===i?-1:e.find("> th, > td").get(i-1)))}var l=a(d);if("after"==c&&h-1>f||"before"==c&&f>0&&g[b][f]==g[b][f-1]){if(0===b||b>0&&g[b][f]!=g[b-1][f]){var m=parseInt(l.attr("colspan"),10)+1;l.attr("colspan",m),l.css("width",(l.data("old-width")*k/j+k).toFixed(4)+"%"),l.removeData("old-width")}}else{var n;n=e.find("th").length>0?'<th style="width: '+k.toFixed(4)+'%;"><br></th>':'<td style="width: '+k.toFixed(4)+'%;"><br></td>',-1==d?e.prepend(n):null==d?e.append(n):"before"==c?l.before(n):"after"==c&&l.after(n)}}),e.find("th, td").each(function(){i=a(this),i.data("old-width")&&(i.css("width",(i.data("old-width")*k/j).toFixed(4)+"%"),i.removeData("old-width"))}),b.popups.isVisible("table.edit")&&d()}}function t(){var c=b.$el.find(".fr-selected-cell").closest("table");if(c.length>0){var d,e,f,g=B(),h=G(g);if(0===h.min_j&&h.max_j==g[0].length-1)n();else{var i=100/g[0].length,j=100/(g[0].length-h.max_j+h.min_j-1);for(c.find("th, td").each(function(){f=a(this),f.hasClass("fr-selected-cell")||f.data("old-width",f.outerWidth()/c.outerWidth()*100)}),e=h.max_j;e>=h.min_j;e--)for(d=0;d<g.length;d++)if(0===d||g[d][e]!=g[d-1][e])if(f=a(g[d][e]),parseInt(f.attr("colspan"),10)>1){var k=parseInt(f.attr("colspan"),10)-1;1==k?f.removeAttr("colspan"):f.attr("colspan",k),f.css("width",((f.data("old-width")-Z(e,g))*j/i).toFixed(4)+"%"),f.removeData("old-width")}else{var l=a(f.parent().get(0));f.remove(),0===l.find("> th, > td").length&&(0===l.prev().length||0===l.next().length||l.prev().find("> th[rowspan], > td[rowspan]").length<l.prev().find("> th, > td").length)&&l.remove()}h.min_j>0?b.selection.setAtEnd(g[h.min_i][h.min_j-1]):b.selection.setAtEnd(g[h.min_i][0]),b.selection.restore(),b.popups.hide("table.edit"),c.find("th, td").each(function(){f=a(this),f.data("old-width")&&(f.css("width",(f.data("old-width")*j/i).toFixed(4)+"%"),f.removeData("old-width"))})}}}function u(){if(b.$el.find(".fr-selected-cell").length>1&&(0===b.$el.find("th.fr-selected-cell").length||0===b.$el.find("td.fr-selected-cell").length)){var c,e,f,g=B(),h=G(g),i=b.$el.find(".fr-selected-cell"),j=a(i[0]),k=j.parent(),l=k.find(".fr-selected-cell"),m=j.closest("table"),n=j.html(),o=0;for(c=0;c<l.length;c++)o+=a(l[c]).outerWidth();for(j.css("width",(o/k.outerWidth()*100).toFixed(4)+"%"),h.min_j<h.max_j&&j.attr("colspan",h.max_j-h.min_j+1),h.min_i<h.max_i&&j.attr("rowspan",h.max_i-h.min_i+1),c=1;c<i.length;c++)e=a(i[c]),"<br>"!=e.html()&&""!==e.html()&&(n+="<br>"+e.html()),e.remove();j.html(n),b.selection.setAtEnd(j.get(0)),b.selection.restore(),b.toolbar.enable();var p=m.find("tr:empty");for(c=p.length-1;c>=0;c--)f=a(p[c]),(0===f.prev().length||0===f.next().length||f.prev().find("> th[rowspan], > td[rowspan]").length<f.prev().find("> th, > td").length)&&f.remove();d()}}function v(){if(1==b.$el.find(".fr-selected-cell").length){var c=b.$el.find(".fr-selected-cell"),d=c.parent(),e=c.closest("table"),f=parseInt(c.attr("rowspan"),10),g=B(),h=C(c.get(0),g),i=c.clone().html("<br>");if(f>1){var j=Math.ceil(f/2);j>1?c.attr("rowspan",j):c.removeAttr("rowspan"),f-j>1?i.attr("rowspan",f-j):i.removeAttr("rowspan");for(var k=h.row+j,l=0===h.col?h.col:h.col-1;l>=0&&(g[k][l]==g[k][l-1]||k>0&&g[k][l]==g[k-1][l]);)l--;-1==l?a(e.find("tr").not(e.find("table tr")).get(k)).prepend(i):a(g[k][l]).after(i)}else{var m,n=a("<tr>").append(i);for(m=0;m<g[0].length;m++)if(0===m||g[h.row][m]!=g[h.row][m-1]){var o=a(g[h.row][m]);o.is(c)||o.attr("rowspan",(parseInt(o.attr("rowspan"),10)||1)+1)}d.after(n)}E(),b.popups.hide("table.edit")}}function w(){if(1==b.$el.find(".fr-selected-cell").length){var c=b.$el.find(".fr-selected-cell"),d=parseInt(c.attr("colspan"),10)||1,e=c.parent().outerWidth(),f=c.outerWidth(),g=c.clone().html("<br>"),h=B(),i=C(c.get(0),h);if(d>1){var j=Math.ceil(d/2);f=$(i.col,i.col+j-1,h)/e*100;var k=$(i.col+j,i.col+d-1,h)/e*100;j>1?c.attr("colspan",j):c.removeAttr("colspan"),d-j>1?g.attr("colspan",d-j):g.removeAttr("colspan"),c.css("width",f.toFixed(4)+"%"),g.css("width",k.toFixed(4)+"%")}else{var l;for(l=0;l<h.length;l++)if(0===l||h[l][i.col]!=h[l-1][i.col]){var m=a(h[l][i.col]);if(!m.is(c)){var n=(parseInt(m.attr("colspan"),10)||1)+1;m.attr("colspan",n)}}f=f/e*100/2,c.css("width",f.toFixed(4)+"%"),g.css("width",f.toFixed(4)+"%")}c.after(g),E(),b.popups.hide("table.edit")}}function x(a){"REMOVE"!=a?b.$el.find(".fr-selected-cell").css("background-color",b.helpers.HEXtoRGB(a)):b.$el.find(".fr-selected-cell").css("background-color","")}function y(a){b.$el.find(".fr-selected-cell").css("vertical-align",a)}function z(a){b.$el.find(".fr-selected-cell").css("text-align",a)}function A(a,b,c,d){if(b.length>0){if(!c){var e=Object.keys(d);e.splice(e.indexOf(a),1),b.removeClass(e.join(" "))}b.toggleClass(a)}}function B(c){c=c||null;var d=[];if(null==c&&b.$el.find(".fr-selected-cell").length>0&&(c=b.$el.find(".fr-selected-cell").closest("table")),c){var e=a(c);return e.find("tr").not(e.find("table tr")).each(function(b,c){var e=a(c),f=0;e.find("> th, > td").each(function(c,e){for(var g=a(e),h=parseInt(g.attr("colspan"),10)||1,i=parseInt(g.attr("rowspan"),10)||1,j=b;b+i>j;j++)for(var k=f;f+h>k;k++)d[j]||(d[j]=[]),d[j][k]?f++:d[j][k]=e;f+=h})}),d}}function C(a,b){for(var c=0;c<b.length;c++)for(var d=0;d<b[c].length;d++)if(b[c][d]==a)return{row:c,col:d}}function D(a,b,c){for(var d=a+1,e=b+1;d<c.length;){if(c[d][b]!=c[a][b]){d--;break}d++}for(d==c.length&&d--;e<c[a].length;){if(c[a][e]!=c[a][b]){e--;break}e++}return e==c[a].length&&e--,{row:d,col:e}}function E(){var c=b.$el.find(".fr-selected-cell");c.length>0&&c.each(function(){var b=a(this);b.removeClass("fr-selected-cell"),""===b.attr("class")&&b.removeAttr("class")})}function F(){setTimeout(function(){b.selection.clear(),b.$el.addClass("fr-no-selection"),b.edit.off(),b.$el.blur()},0)}function G(a){var c,d=a.length,e=0,f=a[0].length,g=0,h=b.$el.find(".fr-selected-cell");for(c=0;c<h.length;c++){var i=C(h[c],a),j=D(i.row,i.col,a);d=Math.min(i.row,d),e=Math.max(j.row,e),f=Math.min(i.col,f),g=Math.max(j.col,g)}return{min_i:d,max_i:e,min_j:f,max_j:g}}function H(b,c,d,e,f){var g,h,i,j,k=b,l=c,m=d,n=e;for(g=k;l>=g;g++)((parseInt(a(f[g][m]).attr("rowspan"),10)||1)>1||(parseInt(a(f[g][m]).attr("colspan"),10)||1)>1)&&(i=C(f[g][m],f),j=D(i.row,i.col,f),k=Math.min(i.row,k),l=Math.max(j.row,l),m=Math.min(i.col,m),n=Math.max(j.col,n)),((parseInt(a(f[g][n]).attr("rowspan"),10)||1)>1||(parseInt(a(f[g][n]).attr("colspan"),10)||1)>1)&&(i=C(f[g][n],f),j=D(i.row,i.col,f),k=Math.min(i.row,k),l=Math.max(j.row,l),m=Math.min(i.col,m),n=Math.max(j.col,n));for(h=m;n>=h;h++)((parseInt(a(f[k][h]).attr("rowspan"),10)||1)>1||(parseInt(a(f[k][h]).attr("colspan"),10)||1)>1)&&(i=C(f[k][h],f),j=D(i.row,i.col,f),k=Math.min(i.row,k),l=Math.max(j.row,l),m=Math.min(i.col,m),n=Math.max(j.col,n)),((parseInt(a(f[l][h]).attr("rowspan"),10)||1)>1||(parseInt(a(f[l][h]).attr("colspan"),10)||1)>1)&&(i=C(f[l][h],f),j=D(i.row,i.col,f),k=Math.min(i.row,k),l=Math.max(j.row,l),m=Math.min(i.col,m),n=Math.max(j.col,n));return k==b&&l==c&&m==d&&n==e?{min_i:b,max_i:c,min_j:d,max_j:e}:H(k,l,m,n,f)}function I(b){var c=G(b),d=a(b[c.min_i][c.min_j]),e=a(b[c.min_i][c.max_j]),f=a(b[c.max_i][c.min_j]),g=d.offset().left,h=e.offset().left+e.outerWidth(),i=d.offset().top,j=f.offset().top+f.outerHeight();return{left:g,right:h,top:i,bottom:j}}function J(b,c){if(a(b).is(c))E(),a(b).addClass("fr-selected-cell");else{F();var d=B(),e=C(b,d),f=C(c,d),g=H(Math.min(e.row,f.row),Math.max(e.row,f.row),Math.min(e.col,f.col),Math.max(e.col,f.col),d);E();for(var h=g.min_i;h<=g.max_i;h++)for(var i=g.min_j;i<=g.max_j;i++)a(d[h][i]).addClass("fr-selected-cell")}}function K(c){var d=null,e=a(c.target);return"TD"==c.target.tagName||"TH"==c.target.tagName?d=c.target:e.closest("td").length>0?d=e.closest("td").get(0):e.closest("th").length>0&&(d=e.closest("th").get(0)),0===b.$el.find(d).length?null:d}function L(c){if(b.$el.find(".fr-selected-cell").length>0&&!c.shiftKey&&(E(),b.$el.removeClass("fr-no-selection"),b.edit.on()),1==c.which){ia=!0;var d=K(c);if(d){b.popups.hide("table.edit"),c.stopPropagation(),b.events.trigger("image.hideResizer"),b.events.trigger("video.hideResizer"),ha=!0;var e=d.tagName.toLowerCase();c.shiftKey&&b.$el.find(e+".fr-selected-cell").length>0?a(b.$el.find(e+".fr-selected-cell").closest("table")).is(a(d).closest("table"))?J(ja,d):F():((b.keys.ctrlKey(c)||c.shiftKey)&&F(),ja=d,J(ja,ja))}}}function M(c){if(1==c.which){if(ia=!1,ha){ha=!1;var e=K(c);e||1!=b.$el.find(".fr-selected-cell").length?b.$el.find(".fr-selected-cell").length>0&&(b.selection.isCollapsed()?d():E()):E()}else b.$tb.is(c.target)||b.$tb.is(a(c.target).closest(b.$tb.get(0)))||(b.$el.get(0).querySelectorAll(".fr-selected-cell").length>0&&b.toolbar.enable(),E());if(la){la=!1,fa.removeClass("fr-moving"),b.$el.removeClass("fr-no-selection"),b.edit.on();var f=parseFloat(fa.css("left"))+b.opts.tableResizerOffset;b.opts.iframe&&(f-=b.$iframe.offset().left),fa.data("release-position",f),fa.removeData("max-left"),fa.removeData("max-right"),Y(c),Q()}}}function N(c){if(ha===!0){var d=a(c.currentTarget);if(d.closest("table").is(b.$el.find(".fr-selected-cell").closest("table"))){if("TD"==c.currentTarget.tagName&&0===b.$el.find("th.fr-selected-cell").length)return void J(ja,c.currentTarget);if("TH"==c.currentTarget.tagName&&0===b.$el.find("td.fr-selected-cell").length)return void J(ja,c.currentTarget)}F()}}function O(a){(37==a.which||38==a.which||39==a.which||40==a.which)&&b.$el.find(".fr-selected-cell").length>0&&(E(),b.popups.hide("table.edit"))}function P(){b.shared.$table_resizer||(b.shared.$table_resizer=a('<div class="fr-table-resizer"><div></div></div>')),fa=b.shared.$table_resizer,b.events.$on(fa,"mousedown",function(){return b.core.sameInstance(fa)?(la=!0,fa.addClass("fr-moving"),E(),F(),fa.find("div").css("opacity",1),!1):!0}),b.events.$on(fa,"mousemove",function(a){return b.core.sameInstance(fa)?void(la&&(b.opts.iframe&&(a.pageX-=b.$iframe.offset().left),_(a))):!0}),b.events.on("shared.destroy",function(){fa.html("").removeData().remove()},!0),b.events.on("destroy",function(){b.$el.find(".fr-selected-cell").removeClass("fr-selected-cell"),fa.hide().appendTo(a("body"))},!0)}function Q(){fa&&(fa.find("div").css("opacity",0),fa.css("top",0),fa.css("left",0),fa.css("height",0),fa.find("div").css("height",0),fa.hide())}function R(){ga&&ga.removeClass("fr-visible").css("left","-9999px")}function S(c,d){var e=a(d),f=e.closest("table");if(d&&"TD"!=d.tagName&&"TH"!=d.tagName&&(e.closest("td").length>0?d=e.closest("td"):e.closest("th").length>0&&(d=e.closest("th"))),!d||"TD"!=d.tagName&&"TH"!=d.tagName)fa&&e.get(0)!=fa.get(0)&&e.parent().get(0)!=fa.get(0)&&b.core.sameInstance(fa)&&Q();else{if(e=a(d),0===b.$el.find(e).length)return!1;var g=e.offset().left-1,h=g+e.outerWidth();if(Math.abs(c.pageX-g)<=b.opts.tableResizerOffset||Math.abs(h-c.pageX)<=b.opts.tableResizerOffset){var i,j,k,l,m,n=B(f),o=C(d,n),p=D(o.row,o.col,n),q=f.offset().top,r=f.outerHeight()-1;if(o.col>0&&c.pageX-g<=b.opts.tableResizerOffset){k=g;var s=a(n[o.row][o.col-1]);l=1==(parseInt(s.attr("colspan"),10)||1)?s.offset().left-1+b.opts.tableResizingLimit:g-Z(o.col-1,n)+b.opts.tableResizingLimit,m=1==(parseInt(e.attr("colspan"),10)||1)?g+e.outerWidth()-b.opts.tableResizingLimit:g+Z(o.col,n)-b.opts.tableResizingLimit,i=o.col-1,j=o.col}else if(h-c.pageX<=b.opts.tableResizerOffset)if(k=h,p.col<n[p.row].length&&n[p.row][p.col+1]){var t=a(n[p.row][p.col+1]);l=1==(parseInt(e.attr("colspan"),10)||1)?g+b.opts.tableResizingLimit:h-Z(p.col,n)+b.opts.tableResizingLimit,m=1==(parseInt(t.attr("colspan"),10)||1)?h+t.outerWidth()-b.opts.tableResizingLimit:h+Z(o.col+1,n)-b.opts.tableResizingLimit,i=p.col,j=p.col+1}else{i=p.col,j=null;var u=f.parent();l=f.offset().left-1+n[0].length*b.opts.tableResizingLimit,m=u.offset().left-1+u.width()+parseFloat(u.css("padding-left"))}fa||P(),fa.data("table",f),fa.data("first",i),fa.data("second",j),fa.data("instance",b),b.$wp.append(fa);var v=k-b.win.pageXOffset-b.opts.tableResizerOffset,w=q-b.win.pageYOffset;b.opts.iframe&&(v+=b.$iframe.offset().left-a(b.o_win).scrollLeft(),w+=b.$iframe.offset().top-a(b.o_win).scrollTop(),l+=b.$iframe.offset().left,m+=b.$iframe.offset().left),fa.data("max-left",l),fa.data("max-right",m),fa.data("origin",k-b.win.pageXOffset),fa.css("top",w),fa.css("left",v),fa.css("height",r),fa.find("div").css("height",r),fa.css("padding-left",b.opts.tableResizerOffset),fa.css("padding-right",b.opts.tableResizerOffset),fa.show()}else b.core.sameInstance(fa)&&Q()}}function T(c,d){if(b.$box.find(".fr-line-breaker").is(":visible"))return!1;ga||ca(),b.$box.append(ga),ga.data("instance",b);var e=a(d),f=e.find("tr:first"),g=c.pageX,h=0,i=0;b.opts.iframe&&(h+=b.$iframe.offset().left-a(b.o_win).scrollLeft(),i+=b.$iframe.offset().top-a(b.o_win).scrollTop());var j;f.find("th, td").each(function(){var c=a(this);return c.offset().left<=g&&g<c.offset().left+c.outerWidth()/2?(j=parseInt(ga.find("a").css("width"),10),ga.css("top",i+c.offset().top-b.win.pageYOffset-j-5),ga.css("left",h+c.offset().left-b.win.pageXOffset-j/2),ga.data("selected-cell",c),ga.data("position","before"),ga.addClass("fr-visible"),!1):c.offset().left+c.outerWidth()/2<=g&&g<c.offset().left+c.outerWidth()?(j=parseInt(ga.find("a").css("width"),10),ga.css("top",i+c.offset().top-b.win.pageYOffset-j-5),ga.css("left",h+c.offset().left+c.outerWidth()-b.win.pageXOffset-j/2),ga.data("selected-cell",c),ga.data("position","after"),ga.addClass("fr-visible"),!1):void 0})}function U(c,d){if(b.$box.find(".fr-line-breaker").is(":visible"))return!1;ga||ca(),b.$box.append(ga),ga.data("instance",b);var e=a(d),f=c.pageY,g=0,h=0;b.opts.iframe&&(g+=b.$iframe.offset().left-a(b.o_win).scrollLeft(),h+=b.$iframe.offset().top-a(b.o_win).scrollTop());var i;e.find("tr").each(function(){var c=a(this);return c.offset().top<=f&&f<c.offset().top+c.outerHeight()/2?(i=parseInt(ga.find("a").css("width"),10),ga.css("top",h+c.offset().top-b.win.pageYOffset-i/2),ga.css("left",g+c.offset().left-b.win.pageXOffset-i-5),ga.data("selected-cell",c.find("td:first")),ga.data("position","above"),ga.addClass("fr-visible"),!1):c.offset().top+c.outerHeight()/2<=f&&f<c.offset().top+c.outerHeight()?(i=parseInt(ga.find("a").css("width"),10),ga.css("top",h+c.offset().top+c.outerHeight()-b.win.pageYOffset-i/2),ga.css("left",g+c.offset().left-b.win.pageXOffset-i-5),ga.data("selected-cell",c.find("td:first")),ga.data("position","below"),ga.addClass("fr-visible"),!1):void 0})}function V(c,d){if(0===b.$el.find(".fr-selected-cell").length){var e,f,g;if(d&&("HTML"==d.tagName||"BODY"==d.tagName||b.node.isElement(d)))for(e=1;e<=b.opts.tableInsertHelperOffset;e++){if(f=b.doc.elementFromPoint(c.pageX-b.win.pageXOffset,c.pageY-b.win.pageYOffset+e),a(f).hasClass("fr-tooltip"))return!0;if(f&&("TH"==f.tagName||"TD"==f.tagName||"TABLE"==f.tagName)&&a(f).parents(b.$wp).length)return T(c,f.closest("table")),!0;if(g=b.doc.elementFromPoint(c.pageX-b.win.pageXOffset+e,c.pageY-b.win.pageYOffset),a(g).hasClass("fr-tooltip"))return!0;if(g&&("TH"==g.tagName||"TD"==g.tagName||"TABLE"==g.tagName)&&a(g).parents(b.$wp).length)return U(c,g.closest("table")),!0}b.core.sameInstance(ga)&&R()}}function W(a){ka=null;var c=b.doc.elementFromPoint(a.pageX-b.win.pageXOffset,a.pageY-b.win.pageYOffset);(!b.popups.areVisible()||b.popups.areVisible()&&b.popups.isVisible("table.edit"))&&S(a,c),b.popups.areVisible()||b.$tb.hasClass("fr-inline")&&b.$tb.is(":visible")||V(a,c)}function X(){if(la){var c=fa.data("table"),d=c.offset().top-b.win.pageYOffset;b.opts.iframe&&(d+=b.$iframe.offset().top-a(b.o_win).scrollTop()),fa.css("top",d)}}function Y(){var c=fa.data("origin"),d=fa.data("release-position");if(c!==d){var e=fa.data("first"),f=fa.data("second"),g=fa.data("table"),h=g.outerWidth();if(null!==e&&null!==f){var i,j,k,l=B(g),m=[],n=[],o=[],p=[];for(i=0;i<l.length;i++)j=a(l[i][e]),k=a(l[i][f]),m[i]=j.outerWidth(),o[i]=k.outerWidth(),n[i]=m[i]/h*100,p[i]=o[i]/h*100;for(i=0;i<l.length;i++){j=a(l[i][e]),k=a(l[i][f]);var q=(n[i]*(m[i]+d-c)/m[i]).toFixed(4);j.css("width",q+"%"),k.css("width",(n[i]+p[i]-q).toFixed(4)+"%")}}else{var r,s=g.parent(),t=h/s.width()*100;r=null==e?(h-d+c)/h*t:(h+d-c)/h*t,g.css("width",Math.round(r).toFixed(4)+"%")}}fa.removeData("origin"),fa.removeData("release-position"),fa.removeData("first"),fa.removeData("second"),fa.removeData("table"),b.undo.saveStep()}function Z(b,c){var d,e=a(c[0][b]).outerWidth();for(d=1;d<c.length;d++)e=Math.min(e,a(c[d][b]).outerWidth());return e}function $(a,b,c){var d,e=0;for(d=a;b>=d;d++)e+=Z(d,c);return e}function _(a){if(b.$el.find(".fr-selected-cell").length>1&&ia&&F(),ia===!1&&ha===!1&&la===!1)ka&&clearTimeout(ka),ka=setTimeout(W,30,a);else if(la){var c=a.pageX-b.win.pageXOffset;b.opts.iframe&&(c+=b.$iframe.offset().left);var d=fa.data("max-left"),e=fa.data("max-right");c>=d&&e>=c?fa.css("left",c-b.opts.tableResizerOffset):d>c&&parseFloat(fa.css("left"),10)>d-b.opts.tableResizerOffset?fa.css("left",d-b.opts.tableResizerOffset):c>e&&parseFloat(fa.css("left"),10)<e-b.opts.tableResizerOffset&&fa.css("left",e-b.opts.tableResizerOffset)}else ia&&R()}function aa(c){b.node.isEmpty(c.get(0))?c.prepend(a.FE.MARKERS):c.prepend(a.FE.START_MARKER).append(a.FE.END_MARKER)}function ba(c){var d=c.which;if(d==a.FE.KEYCODE.TAB&&0===b.opts.tabSpaces){var e;if(b.$el.find(".fr-selected-cell").length>0)e=b.$el.find(".fr-selected-cell:last");else{var f=b.selection.element();"TD"==f.tagName||"TH"==f.tagName?e=a(f):a(f).closest("td").length>0?e=a(f).closest("td"):a(f).closest("th").length>0&&(e=a(f).closest("th"))}e&&(c.preventDefault(),E(),b.popups.hide("table.edit"),c.shiftKey?e.prev().length>0?aa(e.prev()):e.closest("tr").length>0&&e.closest("tr").prev().length>0?aa(e.closest("tr").prev().find("td:last")):e.closest("tbody").length>0&&e.closest("table").find("thead tr").length>0&&aa(e.closest("table").find("thead tr th:last")):e.next().length>0?aa(e.next()):e.closest("tr").length>0&&e.closest("tr").next().length>0?aa(e.closest("tr").next().find("td:first")):e.closest("thead").length>0&&e.closest("table").find("tbody tr").length>0?aa(e.closest("table").find("tbody tr td:first")):(e.addClass("fr-selected-cell"),q("below"),E(),aa(e.closest("tr").next().find("td:first"))),b.selection.restore())}}function ca(){b.shared.$ti_helper||(b.shared.$ti_helper=a('<div class="fr-insert-helper"><a class="fr-floating-btn" role="button" tabindex="-1" title="'+b.language.translate("Insert")+'"><svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg"><path d="M22,16.75 L16.75,16.75 L16.75,22 L15.25,22.000 L15.25,16.75 L10,16.75 L10,15.25 L15.25,15.25 L15.25,10 L16.75,10 L16.75,15.25 L22,15.25 L22,16.75 Z"/></svg></a></div>'),b.events.bindClick(b.shared.$ti_helper,"a",function(){var a=ga.data("selected-cell"),c=ga.data("position"),d=ga.data("instance")||b;"before"==c?(a.addClass("fr-selected-cell"),d.table.insertColumn(c),a.removeClass("fr-selected-cell")):"after"==c?(a.addClass("fr-selected-cell"),d.table.insertColumn(c),a.removeClass("fr-selected-cell")):"above"==c?(a.addClass("fr-selected-cell"),d.table.insertRow(c),a.removeClass("fr-selected-cell")):"below"==c&&(a.addClass("fr-selected-cell"),d.table.insertRow(c),a.removeClass("fr-selected-cell")),R()})),ga=b.shared.$ti_helper,b.tooltip.bind(b.$box,".fr-insert-helper > a.fr-floating-btn"),b.events.on("shared.destroy",function(){ga.html("").removeData().remove()},!0),b.events.$on(ga,"mousemove",function(a){a.stopPropagation()},!0),b.events.$on(a(b.win),"scroll",function(){R()},!0)}function da(){if(!b.$wp)return!1;if(!b.helpers.isMobile()){ia=!1,ha=!1,la=!1,b.events.$on(b.$el,"mousedown",L),b.popups.onShow("image.edit",function(){E(),ia=!1,ha=!1}),b.popups.onShow("link.edit",function(){E(),ia=!1,ha=!1}),b.events.on("commands.mousedown",function(a){a.parents(".fr-toolbar").length>0&&E()}),b.events.$on(b.$el,"mouseenter","th, td",N),b.events.$on(b.$win,"mouseup",M),b.opts.iframe&&b.events.$on(a(b.o_win),"mouseup",M),b.events.$on(b.$el,"keydown",O),b.events.$on(b.$win,"mousemove",_),b.events.$on(a(b.o_win),"scroll",X),b.events.on("contentChanged",function(){b.$el.find(".fr-selected-cell").length>0&&(d(),b.$el.find("img").on("load.selected-cells",function(){a(this).off("load.selected-cells"),b.$el.find(".fr-selected-cell").length>0&&d()}))}),b.events.$on(a(b.o_win),"resize",function(){E()}),b.events.on("keydown",function(c){if(b.$el.find(".fr-selected-cell").length>0){if(c.which==a.FE.KEYCODE.ESC&&b.popups.isVisible("table.edit"))return E(),b.popups.hide("table.edit"),c.preventDefault(),c.stopPropagation(),c.stopImmediatePropagation(),!1;if(b.$el.find(".fr-selected-cell").length>1)return c.preventDefault(),!1}},!0),b.events.$on(a(b.win),"keydown input keyup",d);var c;b.events.on("html.beforeGet",function(){c=b.$el.find(".fr-selected-cell"),c.removeClass("fr-selected-cell")}),b.events.on("html.get",function(a){return a=a.replace(/<(td|th)((?:[\w\W]*?)) class=""((?:[\w\W]*?))>((?:[\w\W]*?))<\/(td|th)>/g,"<$1$2$3>$4</$5>")}),b.events.on("html.afterGet",function(){c.addClass("fr-selected-cell")}),g(!0),i(!0)}b.events.on("keydown",ba,!0)}function ea(){b.$el.find(".fr-selected-cell").length>0?d():(b.popups.hide("table.insert"),b.toolbar.showInline())}var fa,ga,ha,ia,ja,ka,la;return{_init:da,insert:m,remove:n,insertRow:q,deleteRow:r,insertColumn:s,deleteColumn:t,mergeCells:u,splitCellVertically:w,splitCellHorizontally:v,addHeader:o,removeHeader:p,setBackground:x,showInsertPopup:c,showEditPopup:d,showColorsPopup:e,back:ea,verticalAlign:y,horizontalAlign:z,applyStyle:A}},a.FE.DefineIcon("insertTable",{NAME:"table"}),a.FE.RegisterCommand("insertTable",{title:"Insert Table",undo:!1,focus:!0,refreshOnCallback:!1,popup:!0,callback:function(){this.popups.isVisible("table.insert")?(this.$el.find(".fr-marker")&&(this.events.disableBlur(),this.selection.restore()),this.popups.hide("table.insert")):this.table.showInsertPopup()},plugin:"table"}),a.FE.RegisterCommand("tableInsert",{callback:function(a,b,c){this.table.insert(b,c),this.popups.hide("table.insert")}}),a.FE.DefineIcon("tableHeader",{NAME:"header"}),a.FE.RegisterCommand("tableHeader",{title:"Table Header",focus:!1,callback:function(){var a=this.popups.get("table.edit").find('.fr-command[data-cmd="tableHeader"]');a.hasClass("fr-active")?this.table.removeHeader():this.table.addHeader()},refresh:function(a){var b=this.$el.find(".fr-selected-cell").closest("table");b.length>0&&(0===b.find("th").length?a.removeClass("fr-active"):a.addClass("fr-active"))}}),a.FE.DefineIcon("tableRows",{NAME:"bars"}),a.FE.RegisterCommand("tableRows",{type:"dropdown",focus:!1,title:"Row",options:{above:"Insert row above",below:"Insert row below","delete":"Delete row"},html:function(){var b='<ul class="fr-dropdown-list">',c=a.FE.COMMANDS.tableRows.options;for(var d in c)b+='<li><a class="fr-command" data-cmd="tableRows" data-param1="'+d+'" title="'+this.language.translate(c[d])+'">'+this.language.translate(c[d])+"</a></li>";return b+="</ul>"},callback:function(a,b){"above"==b||"below"==b?this.table.insertRow(b):this.table.deleteRow()}}),a.FE.DefineIcon("tableColumns",{NAME:"bars fa-rotate-90"}),a.FE.RegisterCommand("tableColumns",{type:"dropdown",focus:!1,title:"Column",options:{before:"Insert column before",after:"Insert column after","delete":"Delete column"},html:function(){var b='<ul class="fr-dropdown-list">',c=a.FE.COMMANDS.tableColumns.options;for(var d in c)b+='<li><a class="fr-command" data-cmd="tableColumns" data-param1="'+d+'" title="'+this.language.translate(c[d])+'">'+this.language.translate(c[d])+"</a></li>";return b+="</ul>"},callback:function(a,b){"before"==b||"after"==b?this.table.insertColumn(b):this.table.deleteColumn()}}),a.FE.DefineIcon("tableCells",{NAME:"square-o"}),a.FE.RegisterCommand("tableCells",{type:"dropdown",focus:!1,title:"Cell",options:{merge:"Merge cells","vertical-split":"Vertical split","horizontal-split":"Horizontal split"},html:function(){var b='<ul class="fr-dropdown-list">',c=a.FE.COMMANDS.tableCells.options;for(var d in c)b+='<li><a class="fr-command" data-cmd="tableCells" data-param1="'+d+'" title="'+this.language.translate(c[d])+'">'+this.language.translate(c[d])+"</a></li>";return b+="</ul>"},callback:function(a,b){"merge"==b?this.table.mergeCells():"vertical-split"==b?this.table.splitCellVertically():this.table.splitCellHorizontally()},refreshOnShow:function(a,b){this.$el.find(".fr-selected-cell").length>1?(b.find('a[data-param1="vertical-split"]').addClass("fr-disabled"),b.find('a[data-param1="horizontal-split"]').addClass("fr-disabled"),b.find('a[data-param1="merge"]').removeClass("fr-disabled")):(b.find('a[data-param1="merge"]').addClass("fr-disabled"),b.find('a[data-param1="vertical-split"]').removeClass("fr-disabled"),b.find('a[data-param1="horizontal-split"]').removeClass("fr-disabled"))}}),a.FE.DefineIcon("tableRemove",{NAME:"trash"}),a.FE.RegisterCommand("tableRemove",{title:"Remove Table",focus:!1,callback:function(){this.table.remove()}}),a.FE.DefineIcon("tableStyle",{NAME:"paint-brush"}),a.FE.RegisterCommand("tableStyle",{title:"Table Style",type:"dropdown",focus:!1,html:function(){var a='<ul class="fr-dropdown-list">',b=this.opts.tableStyles;for(var c in b)a+='<li><a class="fr-command" data-cmd="tableStyle" data-param1="'+c+'" title="'+this.language.translate(b[c])+'">'+this.language.translate(b[c])+"</a></li>";return a+="</ul>"},callback:function(a,b){this.table.applyStyle(b,this.$el.find(".fr-selected-cell").closest("table"),this.opts.tableMultipleStyles,this.opts.tableStyles)},refreshOnShow:function(b,c){var d=this.$el.find(".fr-selected-cell").closest("table");d&&c.find(".fr-command").each(function(){var b=a(this).data("param1");a(this).toggleClass("fr-active",d.hasClass(b))})}}),a.FE.DefineIcon("tableCellBackground",{NAME:"tint"}),a.FE.RegisterCommand("tableCellBackground",{title:"Cell Background",focus:!1,callback:function(){this.table.showColorsPopup()}}),a.FE.RegisterCommand("tableCellBackgroundColor",{undo:!0,focus:!1,callback:function(a,b){this.table.setBackground(b)}}),a.FE.DefineIcon("tableBack",{NAME:"arrow-left"}),a.FE.RegisterCommand("tableBack",{title:"Back",undo:!1,focus:!1,back:!0,callback:function(){this.table.back()},refresh:function(a){0!==this.$el.find(".fr-selected-cell").length||this.opts.toolbarInline?(a.removeClass("fr-hidden"),a.next(".fr-separator").removeClass("fr-hidden")):(a.addClass("fr-hidden"),a.next(".fr-separator").addClass("fr-hidden"))}}),a.FE.DefineIcon("tableCellVerticalAlign",{NAME:"arrows-v"}),a.FE.RegisterCommand("tableCellVerticalAlign",{type:"dropdown",focus:!1,title:"Vertical Align",options:{Top:"Align Top",Middle:"Align Middle",Bottom:"Align Bottom"},html:function(){var b='<ul class="fr-dropdown-list">',c=a.FE.COMMANDS.tableCellVerticalAlign.options;for(var d in c)b+='<li><a class="fr-command" data-cmd="tableCellVerticalAlign" data-param1="'+d.toLowerCase()+'" title="'+this.language.translate(c[d])+'">'+this.language.translate(d)+"</a></li>";return b+="</ul>"},callback:function(a,b){this.table.verticalAlign(b)},refreshOnShow:function(a,b){b.find('.fr-command[data-param1="'+this.$el.find(".fr-selected-cell").css("vertical-align")+'"]').addClass("fr-active")}}),a.FE.DefineIcon("tableCellHorizontalAlign",{NAME:"align-left"}),a.FE.DefineIcon("align-left",{NAME:"align-left"}),a.FE.DefineIcon("align-right",{NAME:"align-right"}),a.FE.DefineIcon("align-center",{NAME:"align-center"}),a.FE.DefineIcon("align-justify",{NAME:"align-justify"}),a.FE.RegisterCommand("tableCellHorizontalAlign",{type:"dropdown",focus:!1,title:"Horizontal Align",options:{left:"Align Left",center:"Align Center",right:"Align Right",justify:"Align Justify"},html:function(){var b='<ul class="fr-dropdown-list">',c=a.FE.COMMANDS.tableCellHorizontalAlign.options;for(var d in c)b+='<li><a class="fr-command fr-title" data-cmd="tableCellHorizontalAlign" data-param1="'+d+'" title="'+this.language.translate(c[d])+'">'+this.icon.create("align-"+d)+"</a></li>";return b+="</ul>"},callback:function(a,b){this.table.horizontalAlign(b)},refresh:function(a){a.find("> *:first").replaceWith(this.icon.create("align-"+this.helpers.getAlignment(this.$el.find(".fr-selected-cell:first"))))},refreshOnShow:function(a,b){b.find('.fr-command[data-param1="'+this.helpers.getAlignment(this.$el.find(".fr-selected-cell:first"))+'"]').addClass("fr-active")}}),a.FE.DefineIcon("tableCellStyle",{NAME:"magic"}),a.FE.RegisterCommand("tableCellStyle",{title:"Cell Style",type:"dropdown",focus:!1,html:function(){var a='<ul class="fr-dropdown-list">',b=this.opts.tableCellStyles;for(var c in b)a+='<li><a class="fr-command" data-cmd="tableCellStyle" data-param1="'+c+'" title="'+this.language.translate(b[c])+'">'+this.language.translate(b[c])+"</a></li>";return a+="</ul>"},callback:function(a,b){this.table.applyStyle(b,this.$el.find(".fr-selected-cell"),this.opts.tableCellMultipleStyles,this.opts.tableCellStyles)},refreshOnShow:function(b,c){var d=this.$el.find(".fr-selected-cell:first");d&&c.find(".fr-command").each(function(){var b=a(this).data("param1");a(this).toggleClass("fr-active",d.hasClass(b))})}})}),!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"object"==typeof module&&module.exports?module.exports=function(b,c){return void 0===c&&(c="undefined"!=typeof window?require("jquery"):require("jquery")(b)),a(c),c}:a(jQuery)}(function(a){"use strict";a.extend(a.FE.DEFAULTS,{}),a.FE.URLRegEx=/(\s|^|>)((http|https|ftp|ftps)\:\/\/[a-zA-Z0-9\-\.]+(\.[a-zA-Z]{2,3})?(:\d*)?(\/[^\s<]*)?)(\s|$|<)/gi,a.FE.PLUGINS.url=function(b){function c(d){d.each(function(){if("IFRAME"!=this.tagName)if(3==this.nodeType){
var d=this.textContent.replace(/&nbsp;/gi,"");a.FE.URLRegEx.test(d)&&(a(this).before(d.replace(a.FE.URLRegEx,'$1<a href="$2">$2</a>$7')),a(this).remove())}else 1==this.nodeType&&["A","BUTTON","TEXTAREA"].indexOf(this.tagName)<0&&c(b.node.contents(this))})}function d(){b.events.on("paste.afterCleanup",function(b){return a.FE.URLRegEx.test(b)?b.replace(a.FE.URLRegEx,'$1<a href="$2">$2</a>$7'):void 0}),b.events.on("keyup",function(d){var e=d.which;(e==a.FE.KEYCODE.ENTER||e==a.FE.KEYCODE.SPACE)&&c(b.node.contents(b.$el.get(0)))}),b.events.on("keydown",function(c){var d=c.which;if(d==a.FE.KEYCODE.ENTER){var e=b.selection.element();if(("A"==e.tagName||a(e).parents("a").length)&&b.selection.info(e).atEnd)return c.stopImmediatePropagation(),"A"!==e.tagName&&(e=a(e).parents("a")[0]),a(e).after("&nbsp;"+a.FE.MARKERS),b.selection.restore(),!1}})}return{_init:d}}}),function(a,b){var c=/[<>&\r\n"']/gm,d={"<":"lt;",">":"gt;","&":"amp;","\r":"#13;","\n":"#10;",'"':"quot;","'":"#39;"};a.extend({fileDownload:function(e,f){function g(){var b=n.cookieValue;"string"==typeof b&&(b=b.toLowerCase());var c=n.cookieName.toLowerCase()+"="+b;if(document.cookie.toLowerCase().indexOf(c)>-1){s.onSuccess(e);var d=n.cookieName+"=; path="+n.cookiePath+"; expires="+new Date(0).toUTCString()+";";return n.cookieDomain&&(d+=" domain="+n.cookieDomain+";"),document.cookie=d,void i(!1)}if(u||t)try{var f=u?u.document:h(t);if(f&&null!==f.body&&f.body.innerHTML.length){var j=!0;if(w&&w.length){var k=a(f.body).contents().first();try{k.length&&k[0]===w[0]&&(j=!1)}catch(l){if(!l||-2146828218!=l.number)throw l;j=!0}}if(j)return void setTimeout(function(){s.onFail(f.body.innerHTML,e),i(!0)},100)}}catch(m){return s.onFail("",e),void i(!0)}setTimeout(g,n.checkInterval)}function h(a){var b=a[0].contentWindow||a[0].contentDocument;return b.document&&(b=b.document),b}function i(a){setTimeout(function(){u&&(l&&u.close(),k&&u.focus&&(u.focus(),a&&u.close()))},0)}function j(a){return a.replace(c,function(a){return"&"+d[a]})}var k,l,m,n=a.extend({preparingMessageHtml:null,failMessageHtml:null,androidPostUnsupportedMessageHtml:"Unfortunately your Android browser doesn't support this type of file download. Please try again with a different browser.",dialogOptions:{modal:!0},prepareCallback:function(a){},successCallback:function(a){},failCallback:function(a,b){},httpMethod:"GET",data:null,checkInterval:100,cookieName:"fileDownload",cookieValue:"true",cookiePath:"/",cookieDomain:null,popupWindowTitle:"Initiating file download...",encodeHTMLEntities:!0},f),o=new a.Deferred,p=(navigator.userAgent||navigator.vendor||b.opera).toLowerCase();/ip(ad|hone|od)/.test(p)?k=!0:-1!==p.indexOf("android")?l=!0:m=/avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|playbook|silk|iemobile|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(p)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|e\-|e\/|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(di|rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|xda(\-|2|g)|yas\-|your|zeto|zte\-/i.test(p.substr(0,4));var q=n.httpMethod.toUpperCase();if(l&&"GET"!==q&&n.androidPostUnsupportedMessageHtml)return a().dialog?a("<div>").html(n.androidPostUnsupportedMessageHtml).dialog(n.dialogOptions):alert(n.androidPostUnsupportedMessageHtml),o.reject();var r=null,s={onPrepare:function(b){n.preparingMessageHtml?r=a("<div>").html(n.preparingMessageHtml).dialog(n.dialogOptions):n.prepareCallback&&n.prepareCallback(b)},onSuccess:function(a){r&&r.dialog("close"),n.successCallback(a),o.resolve(a)},onFail:function(b,c){r&&r.dialog("close"),n.failMessageHtml&&a("<div>").html(n.failMessageHtml).dialog(n.dialogOptions),n.failCallback(b,c),o.reject(b,c)}};s.onPrepare(e),null!==n.data&&"string"!=typeof n.data&&(n.data=a.param(n.data));var t,u,v,w;if("GET"===q){if(null!==n.data){var x=e.indexOf("?");-1!==x?"&"!==e.substring(e.length-1)&&(e+="&"):e+="?",e+=n.data}k||l?(u=b.open(e),u.document.title=n.popupWindowTitle,b.focus()):m?b.location(e):t=a("<iframe>").hide().prop("src",e).appendTo("body")}else{var y="";null!==n.data&&a.each(n.data.replace(/\+/g," ").split("&"),function(){var a=this.split("="),b=n.encodeHTMLEntities?j(decodeURIComponent(a[0])):decodeURIComponent(a[0]);if(b){var c=n.encodeHTMLEntities?j(decodeURIComponent(a[1])):decodeURIComponent(a[1]);y+='<input type="hidden" name="'+b+'" value="'+c+'" />'}}),m?(w=a("<form>").appendTo("body"),w.hide().prop("method",n.httpMethod).prop("action",e).html(y)):(k?(u=b.open("about:blank"),u.document.title=n.popupWindowTitle,v=u.document,b.focus()):(t=a("<iframe style='display: none' src='about:blank'></iframe>").appendTo("body"),v=h(t)),v.write("<html><head></head><body><form method='"+n.httpMethod+"' action='"+e+"'>"+y+"</form>"+n.popupWindowTitle+"</body></html>"),w=a(v).find("form")),w.submit()}setTimeout(g,n.checkInterval);var z=o.promise();return z.abort=function(){i(),t.remove()},z}})}(jQuery,this),function($){function loadAndParseFile(a,b){$.ajax({url:a,async:!1,cache:b.cache,contentType:"text/plain;charset="+b.encoding,dataType:"text",success:function(a,c){parseData(a,b.mode)}})}function parseData(data,mode){for(var parsed="",parameters=data.split(/\n/),regPlaceHolder=/(\{\d+\})/g,regRepPlaceHolder=/\{(\d+)\}/g,unicodeRE=/(\\u.{4})/gi,i=0;i<parameters.length;i++)if(parameters[i]=parameters[i].replace(/^\s\s*/,"").replace(/\s\s*$/,""),parameters[i].length>0&&"#"!=parameters[i].match("^#")){var pair=parameters[i].split("=");if(pair.length>0){for(var name=unescape(pair[0]).replace(/^\s\s*/,"").replace(/\s\s*$/,""),value=1==pair.length?"":pair[1];"\\"==value.match(/\\$/);)value=value.substring(0,value.length-1),value+=parameters[++i].replace(/\s\s*$/,"");for(var s=2;s<pair.length;s++)value+="="+pair[s];if(value=value.replace(/^\s\s*/,"").replace(/\s\s*$/,""),"map"==mode||"both"==mode){var unicodeMatches=value.match(unicodeRE);if(unicodeMatches)for(var u=0;u<unicodeMatches.length;u++)value=value.replace(unicodeMatches[u],unescapeUnicode(unicodeMatches[u]));$.i18n.map[name]=value}if("vars"==mode||"both"==mode)if(value=value.replace(/"/g,'\\"'),checkKeyNamespace(name),regPlaceHolder.test(value)){for(var parts=value.split(regPlaceHolder),first=!0,fnArgs="",usedArgs=[],p=0;p<parts.length;p++)!regPlaceHolder.test(parts[p])||0!=usedArgs.length&&-1!=usedArgs.indexOf(parts[p])||(first||(fnArgs+=","),fnArgs+=parts[p].replace(regRepPlaceHolder,"v$1"),usedArgs.push(parts[p]),first=!1);parsed+=name+"=function("+fnArgs+"){";var fnExpr='"'+value.replace(regRepPlaceHolder,'"+v$1+"')+'"';parsed+="return "+fnExpr+";};"}else parsed+=name+'="'+value+'";'}}eval(parsed)}function checkKeyNamespace(key){var regDot=/\./;if(regDot.test(key))for(var fullname="",names=key.split(/\./),i=0;i<names.length;i++)i>0&&(fullname+="."),fullname+=names[i],eval("typeof "+fullname+' == "undefined"')&&eval(fullname+"={};")}function getFiles(a){return a&&a.constructor==Array?a:[a]}function normaliseLanguageCode(a){return a=a.toLowerCase(),a.length>3&&(a=a.substring(0,3)+a.substring(3).toUpperCase()),a}function unescapeUnicode(a){var b=[],c=parseInt(a.substr(2),16);c>=0&&c<Math.pow(2,16)&&b.push(c);for(var d="",e=0;e<b.length;++e)d+=String.fromCharCode(b[e]);return d}$.i18n={},$.i18n.map={},$.i18n.properties=function(a){var b={name:"Messages",language:"",path:"",mode:"vars",cache:!1,encoding:"UTF-8",callback:null};a=$.extend(b,a),null!==a.language&&""!=a.language||(a.language=$.i18n.browserLang()),null===a.language&&(a.language="");var c=getFiles(a.name);for(i=0;i<c.length;i++)loadAndParseFile(a.path+c[i]+".properties",a),a.language.length>=2&&loadAndParseFile(a.path+c[i]+"_"+a.language.substring(0,2)+".properties",a),a.language.length>=5&&loadAndParseFile(a.path+c[i]+"_"+a.language.substring(0,5)+".properties",a);a.callback&&a.callback()},$.i18n.prop=function(a){var b=$.i18n.map[a];if(null==b)return"["+a+"]";var c;if("string"==typeof b){for(c=0;-1!=(c=b.indexOf("\\",c));)b="t"==b[c+1]?b.substring(0,c)+"	"+b.substring(c++ +2):"r"==b[c+1]?b.substring(0,c)+"\r"+b.substring(c++ +2):"n"==b[c+1]?b.substring(0,c)+"\n"+b.substring(c++ +2):"f"==b[c+1]?b.substring(0,c)+"\f"+b.substring(c++ +2):"\\"==b[c+1]?b.substring(0,c)+"\\"+b.substring(c++ +2):b.substring(0,c)+b.substring(c+1);var d,e,f=[];for(c=0;c<b.length;)if("'"==b[c])if(c==b.length-1)b=b.substring(0,c);else if("'"==b[c+1])b=b.substring(0,c)+b.substring(++c);else{for(d=c+2;-1!=(d=b.indexOf("'",d));){if(d==b.length-1||"'"!=b[d+1]){b=b.substring(0,c)+b.substring(c+1,d)+b.substring(d+1),c=d-1;break}b=b.substring(0,d)+b.substring(++d)}-1==d&&(b=b.substring(0,c)+b.substring(c+1))}else if("{"==b[c])if(d=b.indexOf("}",c+1),-1==d)c++;else if(e=parseInt(b.substring(c+1,d)),!isNaN(e)&&e>=0){var g=b.substring(0,c);""!=g&&f.push(g),f.push(e),c=0,b=b.substring(d+1)}else c=d+1;else c++;""!=b&&f.push(b),b=f,$.i18n.map[a]=f}if(0==b.length)return"";if(1==b.lengh&&"string"==typeof b[0])return b[0];var g="";for(c=0;c<b.length;c++)g+="string"==typeof b[c]?b[c]:b[c]+1<arguments.length?arguments[b[c]+1]:"{"+b[c]+"}";return g},$.i18n.browserLang=function(){return normaliseLanguageCode(navigator.language||navigator.userLanguage)};var cbSplit;cbSplit||(cbSplit=function(a,b,c){if("[object RegExp]"!==Object.prototype.toString.call(b))return"undefined"==typeof cbSplit._nativeSplit?a.split(b,c):cbSplit._nativeSplit.call(a,b,c);var d,e,f,g,h=[],i=0,j=(b.ignoreCase?"i":"")+(b.multiline?"m":"")+(b.sticky?"y":""),b=RegExp(b.source,j+"g");if(a+="",cbSplit._compliantExecNpcg||(d=RegExp("^"+b.source+"$(?!\\s)",j)),void 0===c||0>+c)c=1/0;else if(c=Math.floor(+c),!c)return[];for(;(e=b.exec(a))&&(f=e.index+e[0].length,!(f>i&&(h.push(a.slice(i,e.index)),!cbSplit._compliantExecNpcg&&e.length>1&&e[0].replace(d,function(){for(var a=1;a<arguments.length-2;a++)void 0===arguments[a]&&(e[a]=void 0)}),e.length>1&&e.index<a.length&&Array.prototype.push.apply(h,e.slice(1)),g=e[0].length,i=f,h.length>=c)));)b.lastIndex===e.index&&b.lastIndex++;return i===a.length?!g&&b.test("")||h.push(""):h.push(a.slice(i)),h.length>c?h.slice(0,c):h},cbSplit._compliantExecNpcg=void 0===/()??/.exec("")[1],cbSplit._nativeSplit=String.prototype.split),String.prototype.split=function(a,b){return cbSplit(this,a,b)}}(jQuery),"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(a){return this.slice(0,a.length)==a}),"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(a){return this.slice(-a.length)==a});var waitingDialog=function(a){var b=a('<div class="modal fade" data-backdrop="static" data-keyboard="false" tabindex="-1" role="dialog" aria-hidden="true" style="padding-top:15%; overflow-y:visible;"><div class="modal-dialog modal-m"><div class="modal-content"><div class="modal-header"><h3 style="margin:0;"></h3></div><div class="modal-body"><div class="progress progress-striped active" style="margin-bottom:0;"><div class="progress-bar" style="width: 100%"></div></div></div></div></div></div>');return{show:function(c,d){var e=a.extend({dialogSize:"xs",progressType:""},d);"undefined"==typeof c&&(c="Loading"),"undefined"==typeof d&&(d={}),b.find(".modal-dialog").attr("class","modal-dialog").addClass("modal-"+e.dialogSize),b.find(".progress-bar").attr("class","progress-bar"),e.progressType&&b.find(".progress-bar").addClass("progress-bar-"+e.progressType),b.find("h3").text(c),b.modal()},hide:function(){b.modal("hide")}}}(jQuery),app=angular.module("tcl",["ngAnimate","LocalStorageModule","ngCookies","ngMessages","ngResource","ngRoute","ngSanitize","ngTouch","ngIdle","ui.bootstrap","smart-table","ngTreetable","restangular","ng-context-menu","angularjs-dropdown-multiselect","dndLists","froala","ngNotificationsBar","ngDragDrop","ui.tree","ui.bootstrap.contextMenu"]),httpHeaders,loginMessage,spinner,mToHide=["usernameNotFound","emailNotFound","usernameFound","emailFound","loginSuccess","userAdded","igDocumentNotSaved","igDocumentSaved","uploadImageFailed"],msg={};app.config(["$routeProvider","RestangularProvider","$httpProvider","KeepaliveProvider","IdleProvider","notificationsConfigProvider",function(a,b,c,d,e,f){a.when("/",{templateUrl:"views/home.html"}).when("/home",{templateUrl:"views/home.html"}).when("/tp",{templateUrl:"views/tp.html"}).when("/masterDTLib",{templateUrl:"views/masterDTLib.html",controller:"DatatypeLibraryCtl"}).when("/doc",{templateUrl:"views/doc.html"}).when("/setting",{templateUrl:"views/setting.html"}).when("/about",{templateUrl:"views/about.html"}).when("/contact",{templateUrl:"views/contact.html"}).when("/forgotten",{templateUrl:"views/account/forgotten.html",controller:"ForgottenCtrl"}).when("/issue",{templateUrl:"views/issue.html",controller:"IssueCtrl"}).when("/registration",{templateUrl:"views/account/registration.html",controller:"RegistrationCtrl"}).when("/useraccount",{templateUrl:"views/account/userAccount.html"}).when("/glossary",{templateUrl:"views/glossary.html"}).when("/registerResetPassword",{templateUrl:"views/account/registerResetPassword.html",controller:"RegisterResetPasswordCtrl",resolve:{isFirstSetup:function(){return!0}}}).when("/resetPassword",{templateUrl:"views/account/registerResetPassword.html",controller:"RegisterResetPasswordCtrl",resolve:{isFirstSetup:function(){return!1}}}).when("/registrationSubmitted",{templateUrl:"views/account/registrationSubmitted.html"}).when("/masterDTLib",{templateUrl:"views/edit/masterDTLib.html"}).otherwise({redirectTo:"/"}),c.interceptors.push(["$q",function(a){return{request:function(b){return b||a.when(b)}}}]),c.interceptors.push(["$rootScope","$q",function(a,b){var c=function(a){if(a.data&&a.data.text&&a.data.type)if(401===a.status)loginMessage={text:a.data.text,type:a.data.type,skip:a.data.skip,show:!0,manualHandle:a.data.manualHandle};else if(503===a.status)msg={text:"server.down",type:"danger",show:!0,manualHandle:!0};else{msg={text:a.data.text,type:a.data.type,skip:a.data.skip,show:!0,manualHandle:a.data.manualHandle};for(var b=!1,c=0;c<mToHide.length&&!b;)msg.text===mToHide[c]&&(b=!0),c++;b===!0&&(msg.show=!1)}};return{response:function(a){return c(a),a||b.when(a)},responseError:function(a){return c(a),b.reject(a)}}}]),c.interceptors.push(["$rootScope","$q",function(a,b){return{response:function(a){return a||b.when(a)},responseError:function(c){if(401===c.status&&"api/accounts/cuser"!==c.config.url){if("api/accounts/login"!==c.config.url){var d=b.defer(),e={config:c.config,deferred:d};a.requests401.push(e)}return a.$broadcast("event:loginRequired"),b.when(c)}return b.reject(c)}}}]),c.interceptors.push(["$q",function(a){return{response:function(b){return spinner=!1,b||a.when(b)},responseError:function(b){return spinner=!1,a.reject(b)}}}]),e.idle(7200),e.timeout(30),d.interval(60),f.setAutoHide(!0),f.setHideDelay(3e4),f.setAutoHideAnimationDelay(1200);var g=function(a,b){return spinner=!0,a};c.defaults.transformRequest.push(g),httpHeaders=c.defaults.headers}]),app.run(["$rootScope","$location","Restangular","$modal","$filter","base64","userInfoService","$http","AppInfo","StorageService","$templateCache","$window","notifications",function(a,b,c,d,e,f,g,h,i,j,k,l,m){a.appInfo={},a.loginDialogShown=!1,a.subActivePath=null,i.get().then(function(b){a.appInfo=b,a.froalaEditorOptions={placeholderText:"",toolbarButtons:["fullscreen","bold","italic","underline","strikeThrough","subscript","superscript","fontFamily","fontSize","|","color","emoticons","inlineStyle","paragraphStyle","|","paragraphFormat","align","formatOL","formatUL","outdent","indent","quote","insertHR","-","undo","redo","clearFormatting","selectAll","insertTable","insertLink","insertImage","insertFile"],imageUploadURL:a.appInfo.uploadedImagesUrl+"/upload",imageAllowedTypes:["jpeg","jpg","png","gif"],fileUploadURL:a.appInfo.uploadedImagesUrl+"/upload",fileAllowedTypes:["application/pdf","application/msword","application/x-pdf","text/plain","application/xml","text/xml"],charCounterCount:!1,quickInsertTags:8,events:{"froalaEditor.initialized":function(){},"froalaEditor.file.error":function(b,c,d){a.msg().text=d.text,a.msg().type=d.type,a.msg().show=!0},"froalaEditor.image.error ":function(b,c,d){a.msg().text=d.text,a.msg().type=d.type,a.msg().show=!0}},key:"Rg1Wb2KYd1Td1WIh1CVc2F=="},httpHeaders.common.appVersion=b.version;var c=j.getAppVersion(j.APP_VERSION);j.setAppVersion(b.version),null!=c&&c===b.version||a.clearAndReloadApp()},function(b){a.appInfo={},a.openErrorDlg("Sorry we could not communicate with the server. Please try again")}),a.msg=function(){return msg},a.loginMessage=function(){return loginMessage},a.showSpinner=function(){return spinner},a.requests401=[],a.$on("event:loginRequired",function(){a.showLoginDialog()}),a.$on("event:loginConfirmed",function(){var c,d=a.requests401,e=function(a){h(a.config).then(function(b){a.deferred.resolve(b)})};for(c=0;c<d.length;c+=1)e(d[c]);a.requests401=[],b.url("/ig")}),a.$on("event:loginRequest",function(b,c,d){httpHeaders.common.Accept="application/json",httpHeaders.common.Authorization="Basic "+f.encode(c+":"+d),h.get("api/accounts/login").success(function(){httpHeaders.common.Authorization=null,h.get("api/accounts/cuser").then(function(b){if(b.data&&null!=b.data){var c=angular.fromJson(b.data);g.setCurrentUser(c),a.$broadcast("event:loginConfirmed")}else g.setCurrentUser(null)},function(){g.setCurrentUser(null)})})}),a.$on("event:logoutRequest",function(){httpHeaders.common.Authorization=null,g.setCurrentUser(null),h.get("j_spring_security_logout")}),a.$on("event:loginCancel",function(){httpHeaders.common.Authorization=null}),a.$on("$routeChangeStart",function(a,b){msg&&"false"===msg.manualHandle&&(msg.show=!1)}),a.$watch(function(){return a.msg().text},function(b){a.showNotification(a.msg())}),a.$watch("language()",function(b){a.showNotification(a.msg())}),a.loadUserFromCookie=function(){g.hasCookieInfo()===!0&&(g.loadFromCookie(),httpHeaders.common.Authorization=g.getHthd())},a.isSubActive=function(b){return b===a.subActivePath},a.setSubActive=function(b){a.subActivePath=b},a.getFullName=function(){return g.isAuthenticated()===!0?g.getFullName():""},a.clearAndReloadApp=function(){a.clearTemplate(),a.reloadPage()},a.openErrorDlg=function(b){j.clearAll(),a.errorModalInstance&&null!==a.errorModalInstance&&a.errorModalInstance.opened||(a.errorModalInstance=d.open({templateUrl:"CriticalError.html",size:"lg",backdrop:!0,keyboard:"true",controller:"FailureCtrl",resolve:{error:function(){return b}}}),a.errorModalInstance.result.then(function(){a.clearAndReloadApp()},function(){a.clearAndReloadApp()}))},a.openSessionExpiredDlg=function(){a.sessionExpiredModalInstance&&null!==a.sessionExpiredModalInstance&&a.sessionExpiredModalInstance.opened||(a.sessionExpiredModalInstance=d.open({templateUrl:"timedout-dialog.html",size:"lg",backdrop:!0,keyboard:"true",controller:"FailureCtrl",resolve:{error:function(){return""}}}),a.sessionExpiredModalInstance.result.then(function(){a.clearAndReloadApp()},function(){a.clearAndReloadApp()}))},a.clearTemplate=function(){k.removeAll()},a.reloadPage=function(){l.location.reload()},a.showNotification=function(a){if(void 0!=a&&a.show&&null!=a.text&&a.text){var b=angular.copy(a),c=$.i18n.prop(b.text),d=b.type;m.closeAll(),"danger"===d?m.showError({message:c}):"warning"===d?m.showWarning({message:c}):"success"===d&&m.showSuccess({message:c}),a.text=null,a.type=null,a.show=!1}},a.scrollbarWidth=0,a.getScrollbarWidth=function(){if(0==a.scrollbarWidth){var b=document.createElement("div");b.style.visibility="hidden",b.style.width="100px",b.style.msOverflowStyle="scrollbar",document.body.appendChild(b);var c=b.offsetWidth;b.style.overflow="scroll";var d=document.createElement("div");d.style.width="100%",b.appendChild(d);var e=d.offsetWidth;b.parentNode.removeChild(b),a.scrollbarWidth=c-e}return a.scrollbarWidth}}]),angular.module("tcl").factory("userInfo",["$resource",function(a){return a("api/accounts/cuser")}]),angular.module("tcl").factory("userLoaderService",["userInfo","$q",function(a,b){var c=function(){var c=b.defer();return a.get({},function(a){c.resolve(a)},function(){c.reject("Unable to fetch user info")}),c.promise};return{load:c}}]),angular.module("tcl").factory("userInfoService",["StorageService","userLoaderService",function(a,b){var c=null,d=!1,e=!1,f=!1,g=null,h="",i="",j=function(){g=a.get("userID"),h=a.get("username"),e=a.get("author"),d=a.get("supervisor"),f=a.get("admin")},k=function(b){a.set("hthd",b)},l=function(b){return a.get("hthd")},m=function(){return""!==a.get("username")},n=function(){return s()?c.accountId.toString():"0"},o=function(){return f},p=function(){return e},q=function(){return d},r=function(){return s()&&null!=c?c.pending:!1},s=function(){var a=void 0!==c&&null!=c&&c.authenticated===!0;return a},t=function(){s()||b.load().then(u)},u=function(a){c=a,null!==c&&void 0!==c?(h=c.username,g=c.accountId,i=c.fullName,angular.isArray(c.authorities)&&angular.forEach(c.authorities,function(a,b){switch(a.authority){case"user":break;case"admin":f=!0;break;case"author":e=!0;break;case"supervisor":d=!0}})):(d=!1,e=!1,f=!1,h="",g=null,i="")},v=function(){return h},w=function(){return i};return{saveHthd:k,getHthd:l,hasCookieInfo:m,loadFromCookie:j,getAccountID:n,isAdmin:o,isAuthor:p,isAuthenticated:s,isPending:r,isSupervisor:q,setCurrentUser:u,loadFromServer:t,getUsername:v,getFullName:w}}]),angular.module("tcl").factory("Account",["$resource",function(a){return a("api/accounts/:id",{id:"@id"})}]),angular.module("tcl").factory("LoginService",["$resource","$q",function(a,b){return function(){var c=a("api/accounts/login"),d=b.defer();return c.get({},function(a){d.resolve(a)}),d.promise}}]),angular.module("tcl").factory("AccountLoader",["Account","$q",function(a,b){return function(c){var d=b.defer();return a.get({id:c},function(a){d.resolve(a)},function(){d.reject("Unable to fetch account")}),d.promise}}]),angular.module("tcl").factory("AppInfo",["$http","$q",function(a,b){return{get:function(){var c=b.defer();return a.get("api/appInfo").then(function(a){c.resolve(angular.fromJson(a.data))},function(a){c.reject(a.data)}),c.promise}}}]),angular.module("tcl").factory("AutoSaveService",["$interval","IgDocumentService","$rootScope","StorageService",function(a,b,c,d){var e={value:void 0,interval:"60000",start:function(){angular.isDefined(this.value)&&this.stop(),this.value=a(this.saveDoc,this.interval)},stop:function(){angular.isDefined(this.value)&&(a.cancel(this.value),this.value=void 0)},saveDoc:function(){null!=c.igdocument&&c.hasChanges()&&(c.autoSaving=!0,c.saved=!1,c.clearChanges(),b.save(c.igdocument).then(function(){c.autoSaving=!1,c.saved=!0,d.setIgDocument(c.igdocument),c.msg().text=null,c.msg().type=null,c.msg().show=!1},function(){c.autoSaving=!1,c.saved=!1,c.msg().text=null,c.msg().type=null,c.msg().show=!1}))}};return e}]),angular.module("tcl").factory("CloneDeleteSvc",["$rootScope","$modal","ProfileAccessSvc","$cookies",function(a,b,c,d){function e(a){var c=b.open({templateUrl:"ValueSetReferencesCtrl.html",controller:"ValueSetReferencesCtrl",resolve:{tableToDelete:function(){return a}}});c.result.then(function(a){$scope.tableToDelete=a},function(){})}function f(a){var c=b.open({templateUrl:"ConfirmValueSetDeleteCtrl.html",controller:"ConfirmValueSetDeleteCtrl",resolve:{tableToDelete:function(){return a}}});c.result.then(function(a){tableToDelete=a},function(){})}function g(a){return c.ValueSets().removeDead(a)}function h(a){var c,d=b.open({templateUrl:"DatatypeReferencesCtrl.html",controller:"DatatypeReferencesCtrl",resolve:{dtToDelete:function(){return a}}});d.result.then(function(a){c=a},function(){})}function i(a){var c,d=b.open({templateUrl:"ConfirmDatatypeDeleteCtrl.html",controller:"ConfirmDatatypeDeleteCtrl",resolve:{dtToDelete:function(){return a}}});d.result.then(function(a){c=a},function(){})}function j(a,b){var d=c.Datatypes().findValueSetsFromDatatypeIds(b),e=c.Datatypes().findValueSetsFromDatatypeIds(a),f=c.ValueSets().findDead(d,e);g(f);var h=c.Datatypes().removeDead(b);return h}function k(a){var c,d=b.open({templateUrl:"SegmentReferencesCtrl.html",controller:"SegmentReferencesCtrl",resolve:{segToDelete:function(){return a}}});d.result.then(function(a){c=a},function(){})}function l(a){var c,d=b.open({templateUrl:"ConfirmSegmentDeleteCtrl.html",controller:"ConfirmSegmentDeleteCtrl",resolve:{segToDelete:function(){return a}}});d.result.then(function(a){c=a},function(){})}function m(a,b){var d=c.Segments().findDatatypesFromSegmentRefs(b),e=c.Segments().findDatatypesFromSegmentRefs(a),f=c.Datatypes().findDead(d,e);j(e,f);var g=c.Segments().removeDead(b);return g}function n(a){var b=_.sortBy(a,"sectionPosition"),c=b[0].sectionPosition;return _.each(b,function(a){a.sectionPosition=c++}),b}var o=this;return o.copySection=function(b){var c=angular.copy(b.reference);c.id=new ObjectId;var d=Math.floor(100*Math.random());a.igdocument.profile.metaData.ext||(a.igdocument.profile.metaData.ext=""),c.sectionTitle=b.reference.sectionTitle+"-"+a.igdocument.profile.metaData.ext+"-"+d,c.label=c.sectionTitle,b.parent.childSections.splice(0,0,c),b.parent.childSections=n(b.parent.childSections),a.$broadcast("event:SetToC"),a.$broadcast("event:openSection",c)},o.copySegment=function(b){var c=angular.copy(b);if(c.id=(new ObjectId).toString(),c.label=a.createNewFlavorName(b.label),void 0!=c.fields&&null!=c.fields&&0!=c.fields.length)for(var d=0;d<c.fields.length;d++)c.fields[d].id=(new ObjectId).toString();var e=c.dynamicMappings;void 0!=e&&null!=e&&0!=e.length&&angular.forEach(e,function(a){a.id=(new ObjectId).toString(),angular.forEach(a.mappings,function(a){a.id=(new ObjectId).toString()})}),a.segments.push(c),a.igdocument.profile.segments.children.splice(0,0,c),a.igdocument.profile.segments.children=n(a.igdocument.profile.segments.children),a.segment=c,a.segmentsMap[c.id]=c,a.recordChanged(),a.$broadcast("event:SetToC"),a.$broadcast("event:openSegment",c)},o.copyDatatype=function(b){var c=angular.copy(b);if(c.id=(new ObjectId).toString(),c.label=a.createNewFlavorName(b.label),void 0!=c.components&&null!=c.components&&0!=c.components.length)for(var d=0;d<c.components.length;d++)c.components[d].id=(new ObjectId).toString();var e=c.predicates;void 0!=e&&null!=e&&0!=e.length&&angular.forEach(e,function(a){a.id=(new ObjectId).toString()});var f=c.conformanceStatements;void 0!=f&&null!=f&&0!=f.length&&angular.forEach(f,function(a){a.id=(new ObjectId).toString()}),a.igdocument.profile.datatypes.children.splice(0,0,c),a.igdocument.profile.datatypes.children=n(a.igdocument.profile.datatypes.children),a.datatype=c,a.datatypesMap[c.id]=c,a.recordChanged(),a.$broadcast("event:SetToC"),a.$broadcast("event:openDatatype",c)},o.copyTable=function(b){var c=angular.copy(b);c.id=(new ObjectId).toString(),c.bindingIdentifier=a.createNewFlavorName(b.bindingIdentifier),c.codes=[];for(var d=0,e=b.codes.length;e>d;d++){var f={id:(new ObjectId).toString(),type:"value",value:b.codes[d].value,label:b.codes[d].label,codeSystem:b.codes[d].codeSystem,codeUsage:b.codes[d].codeUsage};c.codes.push(f)}a.table=c,a.tablesMap[c.id]=c,a.codeSystems=[];for(var d=0;d<a.table.codes.length;d++)a.codeSystems.indexOf(a.table.codes[d].codeSystem)<0&&a.table.codes[d].codeSystem&&""!==a.table.codes[d].codeSystem&&a.codeSystems.push(a.table.codes[d].codeSystem);a.igdocument.profile.tables.children.splice(0,0,c),a.igdocument.profile.tables.children=n(a.igdocument.profile.tables.children),a.recordChanged(),a.$broadcast("event:SetToC"),a.$broadcast("event:openTable",c)},o.copyMessage=function(b){var d=angular.copy(b);d.id=(new ObjectId).toString();var e=c.Messages().getGroups(d);return angular.forEach(e,function(a){a.id=(new ObjectId).toString()}),d.name=a.createNewFlavorName(b.name),a.igdocument.profile.messages.children.splice(0,0,d),a.$broadcast("event:SetToC"),d},o.deleteValueSet=function(b){a.references=[],angular.forEach(a.segments,function(c){a.findTableRefs(b,c)}),null!=a.references&&a.references.length>0?e(b):f(b)},o.exportDisplayXML=function(b){var c=document.createElement("form");c.action=a.api("api/igdocuments/"+a.igdocument.id+"/export/Display/"+b),c.method="POST",c.target="_target";var e=document.createElement("input");e.name="X-XSRF-TOKEN",e.value=d["XSRF-TOKEN"],c.appendChild(e),c.style.display="none",document.body.appendChild(c),c.submit()},o.deleteDatatype=function(b){a.references=[],angular.forEach(a.segments,function(c){a.findDatatypeRefs(b,c)}),null!=a.references&&a.references.length>0?h(b):i(b)},o.deleteSegment=function(b){a.references=c.Segments().getParentalDependencies(b),null!=a.references&&a.references.length>0?k(b):l(b)},o.deleteMessage=function(a){var b=[a.id],d=c.Messages().messages(),e=_.findIndex(d,function(a){return a.id===b[0]});if(d.splice(e,1),0===c.Messages().messages().length)return c.ValueSets().truncate(),c.Datatypes().truncate(),void c.Segments().truncate();var f=c.Messages().getAllSegmentRefs(b),g=c.Messages().getAllSegmentRefs(d),h=c.Segments().findDead(f,g);if(0!==h.length){var i=m(g,h);return i}},o.deleteSection=function(a){var b=a.parent.childSections,c=_.findIndex(b,function(b){return b.id===a.reference.id});a.parent.childSections.splice(c,1)},o.findMessageIndex=function(a,b){var c=_.findIndex(a.children,function(a){return a.reference.id===b});return c},o}]),angular.module("tcl").factory("ContextMenuSvc",function(){var a={};return a.item=null,a.ext=null,a.get=function(){var b=a.item;return a.item=null,b},a.put=function(b){a.item=b},a}),angular.module("tcl").factory("DTLibSvc",["$http","ngTreetableParams",function(a,b){function c(b){console.log("dtLib scope="+JSON.stringify(b));var e={scope:b,dtLib:d.dtLib};return a.post("api/master-dt-lib",e).then(function(a){return d.dtLib=a.data,angular.fromJson(c.children)})}var d=this,c={};return d.getDTLib=function(a){return new b({getNodes:function(b){return c(a)},getTemplate:function(a){return"DTLibNode.html"},options:{onNodeExpand:function(){console.log("A node was expanded!")}}})},d.save=function(b){return a.post("api/master-dt-lib",b).then(function(a){return angular.fromJson(a.data.children)})},d}]),angular.module("tcl").factory("DatatypeService",["$rootScope","ViewSettings","ElementUtils",function(a,b,c){var d={getNodes:function(b){if(b&&null!=b){if(b.datatype){var c=a.datatypesMap[b.datatype];return c.components}return b.components}return null!=a.datatype?a.datatype.components:[]},getParent:function(b){return a.parentsMap[b.id]?a.parentsMap[b.id]:null},getTemplate:function(a){return b.tableReadonly?"Datatype"===a.type?"DatatypeReadTree.html":"component"!==a.type||d.isDatatypeSubDT(a)?"component"===a.type&&d.isDatatypeSubDT(a)?"DatatypeSubComponentReadTree.html":"":"DatatypeComponentReadTree.html":"Datatype"===a.type?"DatatypeEditTree.html":"component"!==a.type||d.isDatatypeSubDT(a)?"component"===a.type&&d.isDatatypeSubDT(a)?"DatatypeSubComponentEditTree.html":"":"DatatypeComponentEditTree.html";
},isDatatypeSubDT:function(b){if(null!=a.datatype)for(var c=0,d=a.datatype.components.length;d>c;c++)if(a.datatype.components[c].id===b.id)return!1;return!0},isBranch:function(a){var b=d.getNodes(a);return null!=b&&b.length>0},isVisible:function(a){return a?d.isRelevant(a)?d.isVisible(d.getParent(a)):!1:!0},isRelevant:function(a){if(void 0===a||!b.tableRelevance)return!0;if(void 0!=a.hide&&a.hide&&a.hide!==!1)return!1;var e=d.getDatatypeLevelPredicates(a);return c.isRelevant(a,e)},getDatatypeLevelConfStatements:function(a){var b=d.getParent(a),e=[];return b&&null!=b&&b.conformanceStatements.length>0?c.filterConstraints(a,b.conformanceStatements):e},getDatatypeLevelPredicates:function(a){var b=d.getParent(a),e=[];return b&&null!=b&&b.predicates.length>0?c.filterConstraints(a,b.predicates):e}};return d}]),angular.module("tcl").factory("ElementUtils",["$rootScope","ViewSettings",function(a,b){var c={filterConstraints:function(a,b){return b?$filter("filter")(b,{constraintTarget:a.position+"[1]"},!0):null},isRelevant:function(a,b){return b&&null!=b&&b.length>0?"R"===b[0].trueUsage||"RE"===b[0].trueUsage||"R"===b[0].falseUsage||"RE"===b[0].falseUsage:null==a.usage||!a.usage||"R"===a.usage||"RE"===a.usage||"C"===a.usage},setUsage:function(a){a.usage&&a.min&&("R"===a.usage&&0==a.min&&(a.min=1),"0"===a.usage&&(a.min=0))}};return c}]),angular.module("tcl").factory("IdleService",["$http",function(a){var b={keepAlive:function(){return a.get("api/session/keepAlive")}};return b}]),angular.module("tcl").factory("IgDocumentMapping",["$rootScope","ViewSettings","$q","userInfoService","$http","StorageService",function(a,b,c,d,e,f){var g={createMapping:function(){}};return g}]),angular.module("tcl").factory("IgDocumentService",["$rootScope","ViewSettings","$q","userInfoService","$http","StorageService","$cookies",function(a,b,c,d,e,f,g){var h={save:function(b){a.saved=!1;var f=c.defer(),g=angular.toJson([]);b.accountId=d.getAccountID();var h=angular.fromJson({changes:g,igDocument:b});return e.post("api/igdocuments/save",h).then(function(c){var d=angular.fromJson(c.data);b.metaData.date=d.date,b.metaData.version=d.version,a.saved=!0,f.resolve(d)},function(b){f.reject(b),a.saved=!1}),f.promise},exportAs:function(b,c){var d=document.createElement("form");d.action=a.api("api/igdocuments/"+b.id+"/export/"+c),d.method="POST",d.target="_target";var e=document.createElement("input");e.name="X-XSRF-TOKEN",e.value=g["XSRF-TOKEN"],d.appendChild(e),d.style.display="none",document.body.appendChild(d),d.submit()}};return h}]),angular.module("tcl").factory("MessageEventsSvc",["$http","ngTreetableParams",function(a,b){function c(b){return console.log("hl7Version="+JSON.stringify(b)),a.post("api/igdocuments/messageListByVersion",b).then(function(a){var b=angular.fromJson(a.data);return _.sortBy(b,function(a){return a.name})})}var d=this;return d.getMessageEvents=function(a){return new b({getNodes:function(b){return b?b.children:c(a)},getTemplate:function(a){return"MessageEventsNode.html"},options:{onNodeExpand:function(){console.log("A node was expanded!")}}})},d}]),angular.module("tcl").factory("Authors",["$resource",function(a){return a("api/shortaccounts",{filter:"accountType::author"})}]),angular.module("tcl").factory("Supervisors",["$resource",function(a){return a("api/shortaccounts",{filter:"accountType::supervisor"})}]),angular.module("tcl").factory("MultiAuthorsLoader",["Authors","$q",function(a,b){return function(){var c=b.defer();return a.query(function(a){c.resolve(a)},function(){c.reject("Unable to fetch list of authors")}),c.promise}}]),angular.module("tcl").factory("MultiSupervisorsLoader",["Supervisors","$q",function(a,b){return function(){var c=b.defer();return a.query(function(a){c.resolve(a)},function(){c.reject("Unable to fetch list of supervisors")}),c.promise}}]),angular.module("tcl").factory("ProfileAccessSvc",["$rootScope",function(a){function b(a){return angular.isArray(a)?a:(console.log("Array ensured."),[a])}var c=this;return c.Version=function(){return a.igdocument.profile.metaData.hl7Version},c.Messages=function(){function b(a){var c=[];return"group"===a.type?(console.log("Was a group groupORsegment.type="+a.type),c.push(a),_.each(a.children,function(a){var d=b(a);_.each(d,function(a){c.push(a)})})):console.log("Was a segmentRef groupORsegment.type="+a.type),c}function c(a){var b=[];return"group"===a.type?_.each(a.children,function(a){var d=c(a);_.each(d,function(a){b.push(a)})}):"segmentRef"===a.type?b.push(a.ref):console.log("Was neither group nor segmentRef groupORsegment.type="+a.type),b}var d=this;return d.messages=function(){return a.igdocument.profile.messages.children},d.findById=function(a){return _.find(d.messages(),function(b){return b.id===a})},d.getMessageIds=function(){var b=[];return _.each(a.igdocument.profile.messages.children,function(a){b.push(a.id)}),b},d.getAllSegmentRefs=function(a){var b=[];return _.each(a,function(a){var c=d.getSegmentRefs(a);_.each(c,function(a){b.push(a)})}),_.uniq(b)},d.getSegmentRefs=function(a){var b=[];return _.each(a.children,function(a){var d=c(a);_.each(d,function(a){b.push(a)})}),_.uniq(b)},d.getGroups=function(a){var c=[];return _.each(a.children,function(a){var d=b(a);_.each(d,function(a){c.push(a)})}),c},d},c.Segments=function(){var d=this;return d.segments=function(){return a.igdocument.profile.segments.children},d.truncate=function(){d.segments().length=0},d.getAllSegmentIds=function(){var a=[];return _.each(d.segments(),function(b){a.push(b.id)}),a},d.findByIds=function(a){var b=[];return _.each(a,function(a){var c=d.findById(a);c&&b.push(c)}),b},d.findById=function(a){var b=d.segments(),c=_.find(b,function(b){return b.id===a});return c||console.log("segs.findById: segment not found, segId="+a),c},d.findDead=function(a,b){var c=_.difference(a,b);return c},d.removeDead=function(a){var c=d.segments(),e=-1;return _.each(b(a),function(a){e=_.findIndex(c,{id:a}),e>-1&&c.splice(e,1)}),c.length},d.getParentalDependencies=function(a){var b=c.Messages().messages(),d=_.filter(b,function(b){var d=c.Messages().getSegmentRefs(b);return _.indexOf(d,a.id)>=0});return d},d.findDatatypesFromSegmentRefs=function(a){var b=[];return _.each(a,function(a){var c=d.findById(a);c?b.push(d.findDatatypesFromSegment(c)):console.log("segs.findDatatypesFromSegmentRefs: Did not find seg for segRef="+a)}),_.uniq(_.flatten(b))},d.findDatatypesFromSegment=function(a){var b=[];return _.each(a.fields,function(a){b.push(a.datatype)}),_.uniq(b)},d},c.Datatypes=function(){var c=this;return c.datatypes=function(){return a.igdocument.profile.datatypes.children},c.truncate=function(){c.datatypes().length=0},c.getAllDatatypeIds=function(){var a=[];return _.each(c.datatypes(),function(b){a.push(b.id)}),a},c.findById=function(a){var b=_.find(c.datatypes(),function(b){return b.id===a});return b||console.log("dts.findById: datatype not found id="+a),b},c.findDead=function(a,b){var c=_.difference(a,b);return c},c.removeDead=function(a){var d=c.datatypes(),e=0;return _.each(b(a),function(a){e=_.findIndex(d,{id:a}),e>-1&&d.splice(e,1)}),d.length},c.findValueSetsFromDatatypeIds=function(a){var b=[];return _.each(a,function(a){var d=c.findById(a);if(d){var e=c.findValueSetsFromDatatype(d);_.each(e,function(a){b.push(a)})}else console.log("dts.findValueSetsFromDatatypeIds: Did not find dt for dtId="+a)}),_.uniq(b)},c.findValueSetsFromDatatype=function(a){return vsIds=[],_.each(a.components,function(a){a.table.trim()&&vsIds.push(a.table)}),_.uniq(vsIds)},c},c.ValueSets=function(){var c=this;return c.valueSets=function(){return a.igdocument.profile.tables.children},c.truncate=function(){c.valueSets().length=0},c.getAllValueSetIds=function(){var a=[],b=c.valueSets();return _.each(b,function(b){b&&a.push(b.id)}),a},c.findById=function(a){var b=_.find(c.valueSets(),function(b){return b.id===a});return b||console.log("vss.findById:: Did not find vs for vsId="+dtId),b},c.findDead=function(a,b){var c=_.difference(a,b);return c},c.removeDead=function(a){var d=c.valueSets();return _.each(b(a),function(a){var b=0;_.each(d,function(c){b=_.findIndex(d,{id:a}),b>-1&&d.splice(b,1)})}),d.length},c},c}]),angular.module("tcl").factory("SegmentService",["$rootScope","ViewSettings","ElementUtils",function(a,b,c){var d={getNodes:function(b){return b?b.fields?b.fields:b.datatype?a.datatypesMap[b.datatype].components:b.children:null!=a.segment?a.segment.fields:[]},getParent:function(b){return a.parentsMap&&a.parentsMap[b.id]?a.parentsMap[b.id]:null},getTemplate:function(a){return b.tableReadonly?"segment"===a.type?"SegmentReadTree.html":"field"===a.type?"SegmentFieldReadTree.html":"SegmentComponentReadTree.html":"segment"===a.type?"SegmentEditTree.html":"field"===a.type?"SegmentFieldEditTree.html":"SegmentComponentEditTree.html"},getSegmentLevelConfStatements:function(a){var b=d.getParent(a.id),e=[];return b&&null!=b&&b.conformanceStatements.length>0?c.filterConstraints(a,b.conformanceStatements):e},getSegmentLevelPredicates:function(a){var b=d.getParent(a.id),e=[];return b&&null!=b&&b.predicates.length>0?c.filterConstraints(a,b.predicates):e},isBranch:function(a){var b=d.getNodes(a);return null!=b&&b.length>0},isVisible:function(a){return a?d.isRelevant(a)?d.isVisible(d.getParent(a)):!1:!0},isRelevant:function(a){if(void 0===a||!b.tableRelevance)return!0;if(void 0!=a.hide&&a.hide&&a.hide!==!1)return!1;var e=d.getSegmentLevelPredicates(a);return c.isRelevant(a,e)}};return d}]),angular.module("tcl").factory("StorageService",["localStorageService",function(a){var b={TABLE_COLUMN_SETTINGS_KEY:"SETTINGS_KEY",SELECTED_IG_DOCUMENT_TYPE:"SelectedIgDocumentType",SELECTED_IG_DOCUMENT_ID:"SelectedIgDocumentId",APP_VERSION:"APP_VERSION",TABLE_CONCISE_SETTINGS:"TABLE_CONCISE_SETTINGS",TABLE_RELEVANCE_SETTINGS:"TABLE_RELEVANCE_SETTINGS",TABLE_COLLAPSE_SETTINGS:"TABLE_COLLAPSE_SETTINGS",TABLE_READONLY_SETTINGS:"TABLE_READONLY_SETTINGS",IG_DOCUMENT:"IG_DOCUMENT",remove:function(b){return a.remove(b)},removeList:function(b,c,d){return a.remove(b,c,d)},clearAll:function(){return a.clearAll()},set:function(b,c){return a.set(b,c)},get:function(b){return a.get(b)},setSelectedIgDocumentType:function(a){this.set(this.SELECTED_IG_DOCUMENT_TYPE,a)},getSelectedIgDocumentType:function(){return this.get(this.SELECTED_IG_DOCUMENT_TYPE)},setAppVersion:function(a){this.set(this.APP_VERSION,a)},getAppVersion:function(){return this.get(this.APP_VERSION)},getIgDocument:function(){return null!=this.get(this.IG_DOCUMENT)?angular.fromJson(this.get(this.IG_DOCUMENT)):null},setIgDocument:function(a){this.set(this.IG_DOCUMENT,null!=a?angular.toJson(a):null)}};return b}]),angular.module("tcl").factory("ToCSvc",function(){function a(a,b,c,d,e,f){this.id=a,this.label=b,this.selected=!1,this.position=c,this.type=d,this.parent=e,this.reference=f}function b(b,c){var d=new a(c,"Metadata",0,c,b,b.metaData);return d}function c(b,d,e){var f=[];_.each(b,function(b){var d=new a(b.id,b.sectionTitle,b.sectionPosition,b.type,e,b);f.push(d);var g=c(b.childSections,b.type,b);_.each(g,function(a){d.children||(d.children=[]),d.children.push(a)})});var g=_.sortBy(f,"position");return f=g}function d(c){var d=new a(c.profile.id,c.profile.sectionTitle,c.profile.sectionPosition,c.profile.type,0,c.profile),f=[];return f.push(b(c.profile,"profileMetadata")),f.push(e(c.profile.messages,c.profile)),f.push(e(c.profile.segments,c.profile)),f.push(e(c.profile.datatypes,c.profile)),f.push(e(c.profile.tables,c.profile)),d.children=f,d}function e(b,c){var d=new a(b.id,b.sectionTitle,b.sectionPosition,b.type,c,b);return b&&(d.reference=b,angular.isArray(b.children)&&b.children.length>0&&(d.children=f(b.children[0].type,b,b.children))),d}function f(a,b,c){var d=[],e={};return _.each(c,function(c){e="message"===a?g(c,c.name,b):"table"===a?g(c,c.bindingIdentifier,b):g(c,c.label,b),d.push(e)}),_.sortBy(d,"reference.position")}function g(b,c,d){var e=new a(b.id,c,b.sectionPosition,b.type,d,b);return e}var h=this;return h.currentLeaf={selected:!1},h.findEntryFromRefId=function(a,b){var c=void 0;return angular.isArray(b)&&_.each(b,function(b){if(b.reference&&b.reference.id)if(b.reference.id===a)c=b;else{if(c)return c;c=h.findEntryFromRefId(a,b.children)}}),c},h.getToC=function(a){console.log("Getting toc... version="+a.profile.metaData.hl7Version+" "+a.id),toc=[];var e=b(a,"documentMetadata");toc.push(e);var f=c(a.childSections,a.type,a);_.each(f,function(a){toc.push(a)});var g=d(a);return toc.push(g),toc},h}),angular.module("tcl").factory("ViewSettings",["StorageService",function(a){var b=[{id:"usage",label:"Usage"},{id:"cardinality",label:"Cardinality"},{id:"length",label:"Length"},{id:"confLength",label:"Conf. Length"},{id:"datatype",label:"Datatype"},{id:"valueSet",label:"Value Set"},{id:"predicate",label:"Predicate"},{id:"confStatement",label:"Conf. Statement"},{id:"defText",label:"Defin. Text"},{id:"comment",label:"Comment"}],c=null==a.get(a.TABLE_COLUMN_SETTINGS_KEY)?angular.copy(b):angular.fromJson(a.get(a.TABLE_COLUMN_SETTINGS_KEY)),d={columnOptions:b,visibleColumns:c,translations:{buttonDefaultText:"Visible Columns"},extra:{displayProp:"label",buttonClasses:"btn btn-xs btn-primary",showCheckAll:!1,showUncheckAll:!1,scrollable:!1},tableRelevance:null==a.get(a.TABLE_RELEVANCE_SETTINGS)?!1:a.get(a.TABLE_RELEVANCE_SETTINGS),tableConcise:null==a.get(a.TABLE_CONCISE_SETTINGS)?!1:a.get(a.TABLE_CONCISE_SETTINGS),tableCollapse:null==a.get(a.TABLE_COLLAPSE_SETTINGS)?!0:a.get(a.TABLE_COLLAPSE_SETTINGS),tableReadonly:null==a.get(a.TABLE_READONLY_SETTINGS)?!1:a.get(a.TABLE_READONLY_SETTINGS),events:{onItemSelect:function(a){d.setVisibleColumns()},onItemDeselect:function(a){d.setVisibleColumns()}},setVisibleColumns:function(){a.set(a.TABLE_COLUMN_SETTINGS_KEY,angular.toJson(d.visibleColumns))},setTableConcise:function(b){d.tableConcise=b,a.set(a.TABLE_CONCISE_SETTINGS,d.tableConcise)},setTableRelevance:function(b){d.tableRelevance=b,a.set(a.TABLE_RELEVANCE_SETTINGS,d.tableRelevance)},setTableCollapse:function(b){d.tableCollapse=b,a.set(a.TABLE_COLLAPSE_SETTINGS,d.tableCollapse)},setTableReadonly:function(b){d.tableReadonly=b,a.set(a.TABLE_READONLY_SETTINGS,d.tableReadonly)},isVisibleColumn:function(a){for(var b=0;b<d.visibleColumns.length;b++)if(d.visibleColumns[b].id===a)return!0;return!1}};return d}]),angular.module("tcl").controller("AboutService",["$scope",function(a){}]),angular.module("tcl").service("base64",function(){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";this.encode=function(b){for(var c,d,e,f,g,h="",i="",j="",k=0;k<b.length;)c=b.charCodeAt(k++),d=b.charCodeAt(k++),i=b.charCodeAt(k++),e=c>>2,f=(3&c)<<4|d>>4,g=(15&d)<<2|i>>6,j=63&i,isNaN(d)?g=j=64:isNaN(i)&&(j=64),h=h+a.charAt(e)+a.charAt(f)+a.charAt(g)+a.charAt(j),c=d=i="",e=f=g=j="";return h},this.decode=function(b){var c,d,e,f,g,h="",i="",j="",k=0;for(b=b.replace(/[^A-Za-z0-9\+\/\=]/g,"");k<b.length;)e=a.indexOf(b.charAt(k++)),f=a.indexOf(b.charAt(k++)),g=a.indexOf(b.charAt(k++)),j=a.indexOf(b.charAt(k++)),c=e<<2|f>>4,d=(15&f)<<4|g>>2,i=(3&g)<<6|j,h+=String.fromCharCode(c),64!==g&&(h+=String.fromCharCode(d)),64!==j&&(h+=String.fromCharCode(i)),c=d=i="",e=f=g=j=""}}),angular.module("tcl").factory("i18n",function(){var a,b=function(b){$.i18n.properties({name:"messages",path:"lang/",mode:"map",language:b,callback:function(){a=b}})};return b("en"),{setLanguage:b}}),angular.module("tcl").factory("Section",["$http","$q",function(a,b){var c=function(){this.data=null,this.type=null,this.sections=[]};return c}]),angular.module("tcl").controller("MainService",["$scope",function(a){}]),angular.module("tcl").filter("bytes",[function(){return function(a,b){if(isNaN(parseFloat(a))||!isFinite(a))return"-";"undefined"==typeof b&&(b=1);var c=["bytes","kB","MB","GB","TB","PB"],d=Math.floor(Math.log(a)/Math.log(1024));return(a/Math.pow(1024,Math.floor(d))).toFixed(b)+" "+c[d]}}]),angular.module("tcl").filter("flavors",function(){return function(a,b){return a.filter(function(a){return a.name===b||angular.equals(a.name,b)})}}),angular.module("tcl").filter("yesno",[function(){return function(a){return a?"YES":"NO"}}]),angular.module("tcl").directive("preventRightClick",[function(){return{restrict:"A",link:function(a,b){b.bind("contextmenu",function(a){a.preventDefault()})}}}]),angular.module("tcl").directive("trunk",function(){var a="<ul class='trunk'><branch ng-repeat='branch in trunk track by trackBy()' branch='branch'></branch></ul>";return{restrict:"E",replace:!0,controller:"ToCCtl",scope:{trunk:"="},template:a}}).directive("drop",function(){var a="<ul dnd-list='drop'><branch ng-repeat='branch in drop track by $index' index='$index' branch='branch' drop='drop'></branch></ul>";return{restrict:"E",replace:!0,scope:{drop:"="},template:a}}).directive("branch",["$compile",function(a){var b="<li class='branch' prevent-right-click><label for='{{branch.id}}' class='fa fa-lg' ng-class=\" {'fa-caret-right': branch.selected,'fa-caret-down': !branch.selected} \" /></label><input type='checkbox' id='{{branch.id}}' ng-model='branch.selected'/><a ng-click='tocSelection(branch)' ng-class=\" {'toc-selected' : branch.highlight, 'selected': models.selected === branch} \" >{{branch.label}}</a><trunk trunk='branch.children'></trunk></li>",c="<li class='branch' context-menu context-menu-close='closedCtxSubMenu(branch)' data-target='contextDiv.html''> <label for='{{branch.id}}' class='fa fa-lg' ng-class=\" {'fa-caret-right': branch.selected,'fa-caret-down': !branch.selected} \" /></label><input type='checkbox' id='{{branch.id}}' ng-model='branch.selected'/><a ng-click='tocSelection(branch)' ng-class=\" {'toc-selected' : branch.highlight, 'selected': models.selected === branch} \" >{{branch.label}}</a><trunk trunk='branch.children'></trunk></li>",d="<li class='branch' context-menu context-menu-close='closedCtxSubMenu(branch)' data-target='messageHeadContextDiv.html'><label for='{{branch.id}}' class='fa fa-lg' ng-class=\" {'fa-caret-right': branch.selected,'fa-caret-down': !branch.selected} \" /><input type='checkbox' id='{{branch.id}}'ng-model='branch.selected'/><a ng-click='tocSelection(branch)' ng-class=\" {'toc-selected' : branch.highlight, 'selected': models.selected === branch} \" >{{branch.label}}</a><drop drop='branch.children'></drop></li>",e="<li class='branch' context-menu context-menu-close='closedCtxSubMenu(branch)' data-target='tableHeadContextDiv.html'><label for='{{branch.id}}' class='fa fa-lg' ng-class=\" {'fa-caret-right': branch.selected,'fa-caret-down': !branch.selected} \" /></label><input type='checkbox' id='{{branch.id}}' ng-model='branch.selected'/><a ng-click='tocSelection(branch)' ng-class=\" {'toc-selected' : branch.highlight, 'selected': models.selected === branch} \" >{{branch.label}}</a><drop drop='branch.children'></drop></li>",f="<leaf leaf='branch' index='index'></leaf>",g=function(g,h,i){angular.isArray(g.branch.children)?(_.indexOf(["profile","segments","datatypes"],g.branch.type)>-1?h.append(b):"messages"===g.branch.type?h.append(d):"tables"===g.branch.type?h.append(e):h.append(c),a(h.contents())(g)):(h.append(f).show(),a(h.contents())(g))};return{restrict:"E",replace:!0,controller:"ToCCtl",scope:{index:"=",drop:"=",branch:"="},link:g}}]).directive("leaf",["$compile",function(a){var b="<li class='point leaf'  prevent-right-click> <a ng-click='tocSelection(leaf)' ng-class=\" {'toc-selected' : leaf.highlight, 'selected': models.selected === leaf} \" >{{leaf.label}}</a></li>",c="<li class='point leaf' dnd-draggable='leaf' dnd-effect-allowed='move' dnd-moved='moved(index, leaf)' dnd-selected='models.selected = leaf' context-menu context-menu-close='closedCtxSubMenu(leaf)' data-target='messageContextDiv.html'> <a ng-click='tocSelection(leaf)' ng-class=\" {'toc-selected' : leaf.highlight, 'selected': models.selected === leaf} \" >{{leaf.reference.name}} - {{leaf.reference.description}}</a></li>",d="<li class='point leaf' context-menu context-menu-close='closedCtxSubMenu(leaf)' data-target='contextDiv.html'> <a ng-click='tocSelection(leaf)' ng-class=\" {'toc-selected' : leaf.highlight, 'selected': models.selected === leaf} \" >{{leaf.reference.bindingIdentifier}} - {{leaf.reference.name}}</a></li>",e="<li class='point leaf' context-menu context-menu-close='closedCtxSubMenu(leaf)' data-target='contextDiv.html'> <a ng-click='tocSelection(leaf)' ng-class=\" {'toc-selected' : leaf.highlight, 'selected': models.selected === leaf} \" >{{leaf.reference.sectionTitle}}</a>",f="<li class='point leaf' context-menu context-menu-close='closedCtxSubMenu(leaf)' data-target='contextDiv.html'> <a ng-click='tocSelection(leaf)' ng-class=\" {'toc-selected' : leaf.highlight, 'selected': models.selected === leaf} \" >{{leaf.reference.label}} - {{leaf.reference.description}}</a></li>",g=function(g,h,i){_.indexOf(["documentMetadata","profileMetadata"],g.leaf.type)>-1?h.html(b).show():"section"===g.leaf.type?h.html(e).show():"message"===g.leaf.type?h.html(c).show():"table"===g.leaf.type?h.html(d).show():h.html(f).show(),a(h.contents())(g)};return{restrict:"E",replace:!0,controller:"ToCCtl",scope:{index:"=",leaf:"=",drop:"="},link:g}}]),angular.module("tcl").directive("click",["$location",function(a){return{link:function(b,c,d){c.on("click",function(){b.$apply(function(){a.path(d.clickGo)})})}}}]),angular.module("tcl").directive("compile",["$compile",function(a){return function(b,c,d){b.$watch(function(a){return a.$eval(d.compile)},function(d){c.html(d),a(c.contents())(b)})}}]),angular.module("tcl").directive("csSelect",function(){return{require:"^stTable",template:"",scope:{row:"=csSelect"},link:function(a,b,c,d){b.bind("change",function(b){a.$apply(function(){d.select(a.row,"single")})}),a.$watch("row.isSelected",function(a,c){a===!0?b.parent().addClass("st-selected"):b.parent().removeClass("st-selected")})}}}),angular.module("tcl").directive("windowExit",["$window","$templateCache","$http","$rootScope","StorageService","IgDocumentService","ViewSettings","AutoSaveService",function(a,b,c,d,e,f,g,h){return{restrict:"AE",compile:function(c,i){var j=a.attachEvent||a.addEventListener,k=a.attachEvent?"onbeforeunload":"beforeunload";j(k,function(a){h.stop(),null!=d.igdocument&&(g.tableReadonly?e.setIgDocument(d.igdocument):f.save(d.igdocument).then(function(a){e.setIgDocument(d.igdocument)})),b.removeAll()})}}}]),angular.module("tcl").directive("focus",[function(){return{restrict:"EAC",link:function(a,b,c){}}}]),angular.module("tcl").directive("igCheckEmail",["$resource",function(a){return{restrict:"AC",require:"ngModel",link:function(b,c,d,e){var f=a("api/sooa/emails/:email",{email:"@email"}),g=/^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,4}$/;c.on("keyup",function(){if(0!==c.val().length&&g.test(c.val())){var a=new f({email:c.val()});a.$get(function(){b.emailUnique="emailNotFound"===a.text?"valid":void 0,b.emailValid=g.test(c.val())?"valid":void 0,b.emailUnique&&b.emailValid?e.$setValidity("email",!0):e.$setValidity("email",!1)},function(){})}else b.emailUnique=void 0,b.emailValid=void 0,e.$setValidity("email",!1)})}}}]),angular.module("tcl").directive("igCheckEmployer",[function(){return{require:"ngModel",link:function(a,b,c,d){var e="#"+c.igCheckEmployer;b.add(e).on("keyup",function(){a.$apply(function(){var a=b.val()===$(firstPassword).val();d.$setValidity("noMatch",a)})})}}}]),angular.module("tcl").directive("igCheckPassword",[function(){return{require:"ngModel",link:function(a,b,c,d){var e="#"+c.igCheckPassword;b.add(e).on("keyup",function(){a.$apply(function(){var a=b.val()===$(e).val();d.$setValidity("noMatch",a)})})}}}]),angular.module("tcl").directive("igCheckPhone",[function(){return{restrict:"AC",require:"ngModel",link:function(a,b,c,d){var e=/[0-9]*/;b.on("keyup",function(){b.val()&&null!=b.val()&&""!=b.val()?(a.phoneIsNumber=e.test(b.val())&&b.val()>0?"valid":void 0,a.phoneValidLength=b.val().length>=7?"valid":void 0,a.phoneIsNumber&&a.phoneValidLength?d.$setValidity("phone",!0):d.$setValidity("phone",!1)):(a.phoneIsNumber=void 0,a.phoneValidLength=void 0,d.$setValidity("phone",!0))})}}}]),angular.module("tcl").directive("igCheckPoaDate",[function(){return{replace:!0,link:function(a,b,c,d){var e=b.find("#inputStartDate"),f=b.find("#inputEndDate"),g=e.inheritedData().$ngModelController,h=f.inheritedData().$ngModelController,i=function(){var a=new Date(e.val()),b=new Date(f.val());b>a?(g.$setValidity("datesOK",!0),h.$setValidity("datesOK",!0)):(g.$setValidity("datesOK",!1),h.$setValidity("datesOK",!1))};e.on("change",i),f.on("change",i)}}}]),angular.module("tcl").directive("igCheckTimerange",[function(){return{replace:!0,link:function(a,b,c,d){var e,f,g,h,i=b.children(),j=i.find(".shour"),k=i.find(".sminute"),l=i.find(".ehour"),m=i.find(".eminute");e=j.inheritedData().$ngModelController,f=k.inheritedData().$ngModelController,g=l.inheritedData().$ngModelController,h=m.inheritedData().$ngModelController;var n=!0,o=function(){n&&(e.$setViewValue(e.$modelValue),f.$setViewValue(f.$modelValue),g.$setViewValue(g.$modelValue),h.$setViewValue(h.$modelValue),n=!1);var a=new Date,b=angular.copy(a),c=angular.copy(a);b.setHours(j.val()),b.setMinutes(k.val()),c.setHours(l.val()),c.setMinutes(m.val()),c>b?(e.$setValidity("poaOK",!0),f.$setValidity("poaOK",!0),g.$setValidity("poaOK",!0),h.$setValidity("poaOK",!0)):(e.$setValidity("poaOK",!1),f.$setValidity("poaOK",!1),g.$setValidity("poaOK",!1),h.$setValidity("poaOK",!1))};j.on("change",o),k.on("change",o),l.on("change",o),m.on("change",o)}}}]),angular.module("tcl").directive("igCheckUsername",["$resource",function(a){return{restrict:"AC",require:"ngModel",link:function(b,c,d,e){var f=a("api/sooa/usernames/:username",{username:"@username"});c.on("keyup",function(){if(c.val().length>=4){var a=new f({username:c.val()});a.$get(function(){b.usernameValidLength=c.val()&&c.val().length>=4&&c.val().length<=20?"valid":void 0,b.usernameUnique="usernameNotFound"===a.text?"valid":void 0,b.usernameValidLength&&b.usernameUnique?e.$setValidity("username",!0):e.$setValidity("username",!1)},function(){})}else b.usernameValidLength=void 0,b.usernameUnique=void 0,e.$setValidity("username",!1)})}}}]),angular.module("tcl").directive("igPasswordValidate",[function(){return{require:"ngModel",link:function(a,b,c,d){d.$parsers.unshift(function(b){return a.pwdValidLength=b&&b.length>=7?"valid":void 0,a.pwdHasLowerCaseLetter=b&&/[a-z]/.test(b)?"valid":void 0,a.pwdHasUpperCaseLetter=b&&/[A-Z]/.test(b)?"valid":void 0,a.pwdHasNumber=b&&/\d/.test(b)?"valid":void 0,a.pwdValidLength&&a.pwdHasLowerCaseLetter&&a.pwdHasUpperCaseLetter&&a.pwdHasNumber?(d.$setValidity("pwd",!0),b):void d.$setValidity("pwd",!1)})}}}]),angular.module("tcl").directive("ehrbold",[function(){return{restrict:"C",link:function(a,b,c){}}}]),angular.module("tcl").directive("msg",[function(){return{restrict:"EA",replace:!0,link:function(a,b,c){var d=c.key;c.keyExpr&&a.$watch(c.keyExpr,function(a){d=a,b.text($.i18n.prop(a))}),a.$watch("language()",function(a){b.text($.i18n.prop(d))})}}}]),angular.module("tcl").directive("stRatio",function(){return{link:function(a,b,c){var d=+c.stRatio;b.css("width",d+"%")}}}),angular.module("tcl").directive("validTrustDocument",[function(){return{require:"ngModel",link:function(a,b,c,d){b.bind("change",function(){a.$apply(function(){d.$setViewValue(b.val())})})}}}]),angular.module("tcl").controller("ContextMenuCtl",["$scope","$rootScope","ContextMenuSvc",function(a,b,c){a.clicked=function(a){c.put(a)}}]),angular.module("tcl").controller("DatatypeLibraryCtl",["$scope","$rootScope","$filter","$http",function(a,b,c,d){a.initDatatypeLibrary=function(){a.start=!1,d.get("api/datatype-library",{timeout:6e4}).then(function(b){a.datatypeLibrary=angular.fromJson(b.data)})}}]),angular.module("tcl").controller("SectionsListCtrl",["$scope","$rootScope","CloneDeleteSvc","ToCSvc",function(a,b,c,d){a.fixedSectionTitles=["Message Infrastructure","Metadata","Introduction","Conformance Profiles","Segments and Field Descriptions","Datatypes","Value Sets"],a.copy=function(a){var e=d.findEntryFromRefId(a.id,b.tocData);c.copySection(e)},a.close=function(){b.section=null,a.refreshTree(),a.loadingSelection=!1},a["delete"]=function(a){var e=d.findEntryFromRefId(a.id,b.tocData);c.deleteSection(e),b.$broadcast("event:SetToC")},a.isFixedSectionTitle=function(b){return a.fixedSectionTitles.indexOf(b.sectionTitle)>=0}}]),angular.module("tcl").controller("ErrorDetailsCtrl",["$scope","$modalInstance","error",function(a,b,c){a.error=c,a.ok=function(){b.close(a.error)},a.cancel=function(){b.dismiss("cancel")}}]),app.controller("ErrorCtrl",["$scope","$modalInstance","StorageService","$window",function(a,b,c,d){a.refresh=function(){b.close(d.location.reload())}}]),app.controller("FailureCtrl",["$scope","$modalInstance","StorageService","$window","error",function(a,b,c,d,e){a.error=e,a.close=function(){b.close()}}]),angular.module("tcl").controller("ToCCtl",["$scope","$rootScope","$timeout","ToCSvc","ContextMenuSvc","CloneDeleteSvc",function(a,b,c,d,e,f){a.collapsed=[],a.yesDrop=!1,a.noDrop=!0,a.moved=function(d,e){var f=_.findLastIndex(a.$parent.drop,function(a){return e.id===a.id});d===f?a.$parent.drop.splice(d+1,1):a.$parent.drop.splice(d,1),c(function(){var c=0;_.each(a.$parent.drop,function(a){c++;var d=_.find(b.igdocument.profile.messages.children,function(b){return b.id===a.reference.id});d.position=c})},100)},a.calcOffset=function(a){return"margin-left : "+a+"em"},a.trackBy=function(){return(new ObjectId).toString()},a.tocSelection=function(b){switch(b.highlight=!0,d.currentLeaf.highlight=!1,d.currentLeaf=b,b.type){case"documentMetadata":a.$emit("event:openDocumentMetadata",b.reference);break;case"profileMetadata":a.$emit("event:openProfileMetadata",b.reference);break;case"message":a.$emit("event:openMessage",b.reference);break;case"segment":a.$emit("event:openSegment",b.reference);break;case"datatype":a.$emit("event:openDatatype",b.reference);break;case"table":a.$emit("event:openTable",b.reference);break;default:a.$emit("event:openSection",b.reference)}return a.subview},a.closedCtxSubMenu=function(a,c){var d=e.get();switch(d){case"Add":console.log("Add==> node="+a);break;case"Copy":console.log("Copy==> node="+a+" node.reference.type="+a.reference.type),"section"===a.reference.type?f.copySection(a):"segment"===a.reference.type?f.copySegment(a.reference):"datatype"===a.reference.type?f.copyDatatype(a.reference):"table"===a.reference.type?f.copyTable(a.reference):"message"===a.reference.type&&f.copyMessage(a.reference);break;case"Delete":console.log("Copy==> node="+a),"section"===a.reference.type?f.deleteSection(a):"segment"===a.reference.type?f.deleteSegment(a.reference):"datatype"===a.reference.type?f.deleteDatatype(a.reference):"table"===a.reference.type?f.deleteValueSet(a.reference):"message"===a.reference.type&&f.deleteMessage(a.reference);break;case"Export":"message"===a.reference.type&&(console.log("Export==> node="+a),console.log("IG document ID  : "+b.igdocument.id),console.log("Selected Message ID  : "+a.reference.id),f.exportDisplayXML(a.reference.id));break;default:console.log("Context menu defaulted with "+d+" Should be Add, Copy, or Delete.")}b.$broadcast("event:SetToC")}}]),angular.module("tcl").controller("AboutCtrl",["$scope","$rootScope",function(a,b){a.releaseNotes=[{version:b.appInfo.version,date:b.appInfo.date,updates:["Update License for Editor"," Update Select IG Document Types Buttons","Update Create IG Document dialog"," Update Export as Dialog"]},{version:"1.0.0-beta-2",date:"03/07/2016",updates:["Display the left side table of contents for HTML export","Add Image (pfg,gif,jpeg,jpg) upload feature"," Add File (word, html,pdf) Upload feature","Export IG Document as Word Document","Display the list message events by version for the creation of a new IG Document","Handle the message level predicates and conformance statements","Added Issue and About Tabs"]}]}]),angular.module("tcl").controller("UserProfileCtrl",["$scope","$resource","AccountLoader","Account","userInfoService","$location",function(a,b,c,d,e,f){var g=b("api/accounts/:id/passwordchange",{
id:"@id"});a.accountpwd={},a.initModel=function(b){a.account=b,a.accountOrig=angular.copy(a.account)},a.updateAccount=function(){new d(a.account).$save(),a.accountOrig=angular.copy(a.account)},a.resetForm=function(){a.account=angular.copy(a.accountOrig)},a.isUnchanged=function(b){return angular.equals(b,a.accountOrig)},a.changePassword=function(){var b=new g;b.username=a.account.username,b.password=a.accountpwd.currentPassword,b.newPassword=a.accountpwd.newPassword,b.id=a.account.id,b.$save().then(function(b){a.msg=angular.fromJson(b)})},a.deleteAccount=function(){var b=new d;b.id=a.account.id,b.$remove(function(){e.setCurrentUser(null),a.$emit("event:logoutRequest"),f.url("/home")})},c(e.getAccountID()).then(function(b){a.initModel(b),a.$$phase||a.$apply()},function(){})}]),angular.module("tcl").controller("UserAccountCtrl",["$scope","$resource","AccountLoader","Account","userInfoService","$location","$rootScope",function(a,b,c,d,e,f,g){a.accordi={account:!0,accounts:!1},a.setSubActive=function(a){a&&null!=a&&(g.setSubActive(a),$(".accountMgt").hide(),$("#"+a).show())},a.initAccount=function(){null==g.subActivePath&&(g.subActivePath="account"),a.setSubActive(g.subActivePath)}}]),angular.module("tcl").controller("AccountsListCtrl",["$scope","MultiAuthorsLoader","MultiSupervisorsLoader","Account","$modal","$resource","AccountLoader","userInfoService","$location",function(a,b,c,d,e,f,g,h,i){a.tmpAccountList=[].concat(a.accountList),a.account=null,a.accountOrig=null,a.accountType="author",a.scrollbarWidth=a.getScrollbarWidth();var j=f("api/accounts/:id/userpasswordchange",{id:"@id"}),k=f("api/accounts/:id/approveaccount",{id:"@id"}),l=f("api/accounts/:id/suspendaccount",{id:"@id"});a.msg=null,a.accountpwd={},a.updateAccount=function(){new d(a.account).$save(),a.accountOrig=angular.copy(a.account)},a.resetForm=function(){a.account=angular.copy(a.accountOrig)},a.isUnchanged=function(b){return angular.equals(b,a.accountOrig)},a.changePassword=function(){var b=new j;b.username=a.account.username,b.password=a.accountpwd.currentPassword,b.newPassword=a.accountpwd.newPassword,b.id=a.account.id,b.$save().then(function(b){a.msg=angular.fromJson(b)})},a.loadAccounts=function(){h.isAuthenticated()&&h.isAdmin()&&(a.msg=null,(new b).then(function(b){a.accountList=b,a.tmpAccountList=[].concat(a.accountList)}))},a.initManageAccounts=function(){a.loadAccounts()},a.selectAccount=function(b){a.accountpwd={},a.account=b,a.accountOrig=angular.copy(a.account)},a.deleteAccount=function(){a.confirmDelete(a.account)},a.confirmDelete=function(b){var c=e.open({templateUrl:"ConfirmAccountDeleteCtrl.html",controller:"ConfirmAccountDeleteCtrl",resolve:{accountToDelete:function(){return b},accountList:function(){return a.accountList}}});c.result.then(function(b,c){a.accountToDelete=b,a.accountList=c},function(){})},a.approveAccount=function(){var b=new k;b.username=a.account.username,b.id=a.account.id,b.$save().then(function(b){a.account.pending=!1,a.msg=angular.fromJson(b)})},a.suspendAccount=function(){var b=new l;b.username=a.account.username,b.id=a.account.id,b.$save().then(function(b){a.account.pending=!0,a.msg=angular.fromJson(b)})}}]),angular.module("tcl").controller("ConfirmAccountDeleteCtrl",["$scope","$modalInstance","accountToDelete","accountList","Account",function(a,b,c,d,e){a.accountToDelete=c,a.accountList=d,a["delete"]=function(){e.remove({id:c.id},function(){var d=a.accountList.indexOf(c);-1!==index&&a.accountList.splice(d,1),b.close(a.accountToDelete)},function(){})},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("tcl").controller("ConstraintsListCtrl",["$scope","$rootScope","Restangular","$filter",function(a,b,c,d){a.loading=!1,a.tmpSegmentPredicates=[].concat(b.segmentPredicates),a.tmpSegmentConformanceStatements=[].concat(b.segmentConformanceStatements),a.tmpDatatypePredicates=[].concat(b.datatypePredicates),a.tmpDatatypeConformanceStatements=[].concat(b.datatypeConformanceStatements),a.init=function(){}}]),angular.module("tcl").controller("DatatypeListCtrl",["$scope","$rootScope","Restangular","ngTreetableParams","$filter","$http","$modal","$timeout","CloneDeleteSvc","ViewSettings","DatatypeService",function(a,b,c,d,e,f,g,h,i,j,k){a.readonly=!1,a.saved=!1,a.message=!1,a.datatypeCopy=null,a.viewSettings=j,a.init=function(){},a.copy=function(a){i.copyDatatype(a)},a.recordDatatypeChange=function(a,c,d,e,f){var g=b.findObjectInChanges("datatype","add",b.datatype.id);void 0===g&&b.recordChangeForEdit2(a,c,d,e,f)},a.close=function(){b.datatype=null,a.refreshTree(),a.loadingSelection=!1},a["delete"]=function(a){i.deleteDatatype(a),b.$broadcast("event:SetToC")},a.hasChildren=function(a){return a&&null!=a&&a.datatype&&void 0!=b.getDatatype(a.datatype)&&null!=b.getDatatype(a.datatype).components&&b.getDatatype(a.datatype).components.length>0},a.validateLabel=function(a,b){return!a||a.startsWith(b)},a.onDatatypeChange=function(c){b.recordChangeForEdit2("component","edit",c.id,"datatype",c.datatype),a.refreshTree()},a.refreshTree=function(){a.datatypesParams&&a.datatypesParams.refresh()},a.goToTable=function(b){a.$emit("event:openTable",b)},a.deleteTable=function(a){a.table=null,b.recordChangeForEdit2("component","edit",a.id,"table",null)},a.mapTable=function(b){var c=g.open({templateUrl:"TableMappingDatatypeCtrl.html",controller:"TableMappingDatatypeCtrl",windowClass:"app-modal-window",resolve:{selectedNode:function(){return b}}});c.result.then(function(b){a.selectedNode=b},function(){})},a.managePredicate=function(b){var c=g.open({templateUrl:"PredicateDatatypeCtrl.html",controller:"PredicateDatatypeCtrl",windowClass:"app-modal-window",resolve:{selectedNode:function(){return b}}});c.result.then(function(b){a.selectedNode=b},function(){})},a.manageConformanceStatement=function(b){var c=g.open({templateUrl:"ConformanceStatementDatatypeCtrl.html",controller:"ConformanceStatementDatatypeCtrl",windowClass:"app-modal-window",resolve:{selectedNode:function(){return b}}});c.result.then(function(b){a.selectedNode=b},function(){})},a.isSubDT=function(a){if(null!=b.datatype)for(var c=0,d=b.datatype.components.length;d>c;c++)if(b.datatype.components[c].id===a.id)return!1;return!0},a.findDTByComponentId=function(a){return b.parentsMap[a]?b.parentsMap[a]:null},a.countConformanceStatements=function(a){var c=0;if(null!=b.datatype)for(var d=0,e=b.datatype.conformanceStatements.length;e>d;d++)0===b.datatype.conformanceStatements[d].constraintTarget.indexOf(a+"[")&&(c+=1);return c},a.countPredicate=function(a){if(null!=b.datatype)for(var c=0,d=b.datatype.predicates.length;d>c;c++)if(0===b.datatype.predicates[c].constraintTarget.indexOf(a+"["))return 1;return 0},a.countPredicateOnSubComponent=function(b,c){var d=a.findDTByComponentId(c);if(null!=d)for(var e=0,f=d.predicates.length;f>e;e++)if(0===d.predicates[e].constraintTarget.indexOf(b+"["))return 1;return 0},a.isRelevant=function(a){return k.isRelevant(a)},a.isBranch=function(a){return k.isBranch(a)},a.isVisible=function(a){return k.isVisible(a)},a.children=function(a){return k.getNodes(a)},a.getParent=function(a){return k.getParent(a)},a.getDatatypeLevelConfStatements=function(a){return k.getDatatypeLevelConfStatements(a)},a.getDatatypeLevelPredicates=function(a){return k.getDatatypeLevelPredicates(a)}}]),angular.module("tcl").controller("DatatypeRowCtrl",["$scope","$filter",function(a,b){a.formName="form_"+(new Date).getTime()}]),angular.module("tcl").controller("ConfirmDatatypeDeleteCtrl",["$scope","$modalInstance","dtToDelete","$rootScope",function(a,b,c,d){a.dtToDelete=c,a.loading=!1,a["delete"]=function(){a.loading=!0;var c=d.datatypes.indexOf(a.dtToDelete);c>-1&&d.datatypes.splice(c,1),d.datatype===a.dtToDelete&&(d.datatype=null);var c=d.igdocument.profile.datatypes.children.indexOf(a.dtToDelete);c>-1&&d.igdocument.profile.datatypes.children.splice(c,1),d.datatypesMap[a.dtToDelete.id]=null,d.references=[],a.dtToDelete.id<0||(d.recordDelete("datatype","edit",a.dtToDelete.id),void 0!=a.dtToDelete.components&&null!=a.dtToDelete.components&&a.dtToDelete.components.length>0&&angular.forEach(a.dtToDelete.components,function(a){d.recordDelete("component","edit",a.id)}),void 0!=a.dtToDelete.predicates&&null!=a.dtToDelete.predicates&&a.dtToDelete.predicates.length>0&&angular.forEach(a.dtToDelete.predicates,function(a){d.recordDelete("predicate","edit",a.id)}),void 0!=a.dtToDelete.conformanceStatements&&null!=a.dtToDelete.conformanceStatements&&a.dtToDelete.conformanceStatements.length>0&&angular.forEach(a.dtToDelete.conformanceStatements,function(a){d.recordDelete("conformanceStatement","edit",a.id)})),d.msg().text="dtDeleteSuccess",d.msg().type="success",d.msg().show=!0,d.manualHandle=!0,d.$broadcast("event:SetToC"),b.close(a.dtToDelete)},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("tcl").controller("DatatypeReferencesCtrl",["$scope","$modalInstance","dtToDelete",function(a,b,c){a.dtToDelete=c,a.ok=function(){b.close(a.dtToDelete)},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("tcl").controller("TableMappingDatatypeCtrl",["$scope","$modalInstance","selectedNode","$rootScope",function(a,b,c,d){a.changed=!1,a.selectedNode=c,a.selectedTable=null,void 0!=c.table&&(a.selectedTable=d.tablesMap[c.table]),a.selectTable=function(b){a.changed=!0,a.selectedTable=b},a.mappingTable=function(){a.selectedNode.table=a.selectedTable.id,d.recordChangeForEdit2("component","edit",a.selectedNode.id,"table",a.selectedTable.id),a.ok()},a.ok=function(){b.close(a.selectedNode)}}]),angular.module("tcl").controller("ConformanceStatementDatatypeCtrl",["$scope","$modalInstance","selectedNode","$rootScope",function(a,b,c,d){a.constraintType="Plain",a.selectedNode=c,a.firstConstraint=null,a.secondConstraint=null,a.compositeType=null,a.complexConstraint=null,a.newComplexConstraintId=d.calNextCSID(),a.newComplexConstraint=[],a.changed=!1,a.tempComformanceStatements=[],angular.copy(d.datatype.conformanceStatements,a.tempComformanceStatements),a.setChanged=function(){a.changed=!0},a.initConformanceStatement=function(){a.newConstraint=angular.fromJson({position_1:null,position_2:null,location_1:null,location_2:null,datatype:"",component_1:null,subComponent_1:null,component_2:null,subComponent_2:null,verb:null,constraintId:d.calNextCSID(),contraintType:null,value:null,value2:null,valueSetId:null,bindingStrength:"R",bindingLocation:"1"}),a.newConstraint.datatype=d.datatype.name},a.initComplexStatement=function(){a.firstConstraint=null,a.secondConstraint=null,a.compositeType=null,a.newComplexConstraintId=d.calNextCSID()},a.initConformanceStatement(),a.deleteConformanceStatement=function(b){a.tempComformanceStatements.splice(a.tempComformanceStatements.indexOf(b),1),a.changed=!0},a.updateComponent_1=function(){a.newConstraint.subComponent_1=null},a.updateComponent_2=function(){a.newConstraint.subComponent_2=null},a.genLocation=function(a,b,c){var d=null;return null!=b&&null==c?d=a+"."+b.position+"("+b.name+")":null!=b&&null!=c&&(d=a+"."+b.position+"."+c.position+"("+c.name+")"),d},a.genPosition=function(a,b){var c=null;return null!=a&&null==b?c=a.position+"[1]":null!=a&&null!=b&&(Position=a.position+"[1]."+b.position+"[1]"),c},a.addComplexConformanceStatement=function(){a.complexConstraint=d.generateCompositeConformanceStatement(a.compositeType,a.firstConstraint,a.secondConstraint),a.complexConstraint.constraintId=a.newComplexConstraintId,-1==d.conformanceStatementIdList.indexOf(a.complexConstraint.constraintId)&&d.conformanceStatementIdList.push(a.complexConstraint.constraintId),a.tempComformanceStatements.push(a.complexConstraint),a.initComplexStatement(),a.changed=!0},a.addConformanceStatement=function(){if(a.newConstraint.position_1=a.genPosition(a.newConstraint.component_1,a.newConstraint.subComponent_1),a.newConstraint.position_2=a.genPosition(a.newConstraint.component_2,a.newConstraint.subComponent_2),a.newConstraint.location_1=a.genLocation(a.newConstraint.datatype,a.newConstraint.component_1,a.newConstraint.subComponent_1),a.newConstraint.location_2=a.genLocation(a.newConstraint.datatype,a.newConstraint.component_2,a.newConstraint.subComponent_2),null!=a.newConstraint.position_1){d.newConformanceStatementFakeId=d.newConformanceStatementFakeId-1;var b=null;if(null===a.selectedNode)var b=d.generateConformanceStatement(".",a.newConstraint);else var b=d.generateConformanceStatement(a.selectedNode.position+"[1]",a.newConstraint);a.tempComformanceStatements.push(b),a.changed=!0,-1==d.conformanceStatementIdList.indexOf(b.constraintId)&&d.conformanceStatementIdList.push(b.constraintId)}a.initConformanceStatement()},a.ok=function(){angular.forEach(a.tempComformanceStatements,function(a){d.conformanceStatementIdList.splice(d.conformanceStatementIdList.indexOf(a.constraintId),1)}),angular.forEach(d.datatype.conformanceStatements,function(a){-1==d.conformanceStatementIdList.indexOf(a.constraintId)&&d.conformanceStatementIdList.push(a.constraintId)}),b.close(a.selectedNode)},a.saveclose=function(){angular.forEach(a.tempComformanceStatements,function(a){-1==d.conformanceStatementIdList.indexOf(a.constraintId)&&d.conformanceStatementIdList.push(a.constraintId)}),angular.copy(a.tempComformanceStatements,d.datatype.conformanceStatements),d.recordChanged(),b.close(a.selectedNode)}}]),angular.module("tcl").controller("PredicateDatatypeCtrl",["$scope","$modalInstance","selectedNode","$rootScope",function(a,b,c,d){a.constraintType="Plain",a.selectedNode=c,a.firstConstraint=null,a.secondConstraint=null,a.compositeType=null,a.complexConstraint=null,a.complexConstraintTrueUsage=null,a.complexConstraintFalseUsage=null,a.changed=!1,a.tempPredicates=[],angular.copy(d.datatype.predicates,a.tempPredicates),a.setChanged=function(){a.changed=!0},a.initPredicate=function(){a.newConstraint=angular.fromJson({position_1:null,position_2:null,location_1:null,location_2:null,datatype:"",component_1:null,subComponent_1:null,component_2:null,subComponent_2:null,verb:null,contraintType:null,value:null,value2:null,trueUsage:null,falseUsage:null,valueSetId:null,bindingStrength:"R",bindingLocation:"1"}),a.newConstraint.datatype=d.datatype.name},a.initComplexPredicate=function(){a.firstConstraint=null,a.secondConstraint=null,a.compositeType=null,a.complexConstraintTrueUsage=null,a.complexConstraintFalseUsage=null},a.initPredicate(),a.deletePredicate=function(b){a.tempPredicates.splice(a.tempPredicates.indexOf(b),1),a.changed=!0},a.updateComponent_1=function(){a.newConstraint.subComponent_1=null},a.updateComponent_2=function(){a.newConstraint.subComponent_2=null},a.genLocation=function(a,b,c){var d=null;return null!=b&&null==c?d=a+"."+b.position+"("+b.name+")":null!=b&&null!=c&&(d=a+"."+b.position+"."+c.position+"("+c.name+")"),d},a.genPosition=function(a,b){var c=null;return null!=a&&null==b?c=a.position+"[1]":null!=a&&null!=b&&(c=a.position+"[1]."+b.position+"[1]"),c},a.deletePredicateByTarget=function(){for(var b=0,c=a.tempPredicates.length;c>b;b++)if(0===a.tempPredicates[b].constraintTarget.indexOf(a.selectedNode.position+"["))return a.deletePredicate(a.tempPredicates[b]),!0;return!1},a.addComplexPredicate=function(){a.complexConstraint=d.generateCompositePredicate(a.compositeType,a.firstConstraint,a.secondConstraint),a.complexConstraint.trueUsage=a.complexConstraintTrueUsage,a.complexConstraint.falseUsage=a.complexConstraintFalseUsage,null===a.selectedNode?a.complexConstraint.constraintId=".":a.complexConstraint.constraintId=a.newConstraint.datatype+"-"+a.selectedNode.position,a.tempPredicates.push(a.complexConstraint),a.initComplexPredicate(),a.changed=!0},a.addPredicate=function(){if(d.newPredicateFakeId=d.newPredicateFakeId-1,a.newConstraint.position_1=a.genPosition(a.newConstraint.component_1,a.newConstraint.subComponent_1),a.newConstraint.position_2=a.genPosition(a.newConstraint.component_2,a.newConstraint.subComponent_2),a.newConstraint.location_1=a.genLocation(a.newConstraint.datatype,a.newConstraint.component_1,a.newConstraint.subComponent_1),a.newConstraint.location_2=a.genLocation(a.newConstraint.datatype,a.newConstraint.component_2,a.newConstraint.subComponent_2),null!=a.newConstraint.position_1){var b=null;if(null===a.selectedNode)var b=d.generatePredicate(".",a.newConstraint);else var b=d.generatePredicate(a.selectedNode.position+"[1]",a.newConstraint);a.tempPredicates.push(b),a.changed=!0}a.initPredicate()},a.ok=function(){b.close(a.selectedNode)},a.saveclose=function(){angular.copy(a.tempPredicates,d.datatype.predicates),d.recordChanged(),b.close(a.selectedNode)}}]),angular.module("tcl").controller("ForgottenCtrl",["$scope","$resource",function(a,b){var c=b("api/sooa/accounts/passwordreset",{username:"@username"});a.requestResetPassword=function(){var b=new c;b.username=a.username,b.$save(function(){"resetRequestProcessed"===b.text&&(a.username="")})}}]),angular.module("tcl").controller("HL7VersionsDlgCtrl",["$scope","$rootScope","$modal","$log","$http","$httpBackend","userInfoService",function(a,b,c,d,e,f,g){b.clickSource={},b.scrollbarWidth=b.getScrollbarWidth(),a.hl7Versions=function(c){console.log("$scope.hl7Versions  clickSource="+c),b.clickSource=c,b.hasChanges()?a.confirmOpen(b.igdocument):(b.hl7Versions=!1,a.hl7VersionsInstance())},a.confirmOpen=function(d){return c.open({templateUrl:"ConfirmIGDocumentOpenCtrl.html",controller:"ConfirmIGDocumentOpenCtrl",resolve:{igdocumentToOpen:function(){return d}}}).result.then(function(c){b.clearChanges(),a.hl7VersionsInstance()},function(){console.log("Changes discarded.")})},a.hl7VersionsInstance=function(){return c.open({templateUrl:"hl7VersionsDlg.html",controller:"HL7VersionsInstanceDlgCtrl",windowClass:"hl7-versions-modal",resolve:{hl7Versions:function(){return a.listHL7Versions()}}}).result.then(function(c){switch(b.clickSource){case"btn":a.createIGDocument(b.hl7Version,c);break;case"ctx":a.updateIGDocument(c)}})},a.listHL7Versions=function(){return e.get("api/igdocuments/findVersions",{timeout:6e4}).then(function(c){var d=[];"ctx"!==b.clickSource&&(b.hl7Version=a.hl7Version=!1,b.igdocument=!1);for(var e=c.data.length,f=0;e>f;f++)d.push(c.data[f]);return d})},a.createIGDocument=function(a,c){console.log("Creating IGDocument..."),console.log("msgEvts="+c);var d={hl7Version:a,msgEvts:c,accountID:g.getAccountID(),timeout:6e4};return e.post("api/igdocuments/createIntegrationProfile",d).then(function(a){var c=angular.fromJson(a.data);b.$broadcast("event:openIGDocumentRequest",c),b.$broadcast("event:IgsPushed",c)}),b.igdocument},a.updateIGDocument=function(a){console.log("Updating igdocument..."),console.log("$scope.updateIGDocumentmsgEvts="+JSON.stringify(a));var c={igdocument:b.igdocument,msgEvts:a,timeout:6e4};e.post("api/igdocuments/updateIntegrationProfile",c).then(function(a){var c=angular.fromJson(a.data);b.$broadcast("event:openIGDocumentRequest",c),b.$broadcast("event:IgsPushed",c)})},a.closedCtxMenu=function(a,b){console.log("closedCtxMenu")}}]),angular.module("tcl").controller("HL7VersionsInstanceDlgCtrl",["$scope","$rootScope","$modalInstance","$http","hl7Versions","ProfileAccessSvc","MessageEventsSvc","$timeout",function(a,b,c,d,e,f,g,h){a.hl7Versions=e,a.hl7Version=b.hl7Version,a.okDisabled=!0,a.messageIds=[],a.messageEvents=[],a.loading=!1;var i=[];a.messageEventsParams=null,a.scrollbarWidth=b.getScrollbarWidth(),a.loadIGDocumentsByVersion=function(){a.loading=!0,h(function(){b.hl7Version=a.hl7Version,a.messageEventsParams=g.getMessageEvents(b.hl7Version),a.loading=!1})},a.isBranch=function(a){var b=!1;return"message"===a.type&&(b=!0,g.putState(a)),b},a.trackSelections=function(b,c){if(b)i.push({id:c.id,children:[{name:c.name}]});else for(var d=0;d<i.length;d++)i[d].id==c.id&&i.splice(d,1);a.okDisabled=0===i.length},a.$watch(function(){return b.igdocument.id},function(c,d){"ctx"===b.clickSource&&(a.hl7Version=b.hl7Version,a.messageIds=f.Messages().getMessageIds(),a.loadIGDocumentsByVersion())}),a.ok=function(){a.messageEvents=i,c.close(i)},a.cancel=function(){c.dismiss("cancel")}}]),angular.module("tcl").controller("IdleCtrl",["$scope","Idle","Keepalive","$modal","IdleService",function(a,b,c,d,e){}]),angular.module("tcl").controller("IssueCtrl",["$scope","$resource",function(a,b){var c=b("api/sooa/issues/:id");a.clearIssue=function(){a.issue.title="",a.issue.description="",a.issue.email=""},a.submitIssue=function(){var b=new c(a.issue);b.$save(function(){""===b.text&&a.clearIssue()})}}]),angular.module("tcl").controller("MainCtrl",["$scope","$rootScope","i18n","$location","userInfoService","$modal","Restangular","$filter","base64","$http","Idle","notifications","IdleService","AutoSaveService","StorageService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){function p(){b.warning&&(b.warning.close(),b.warning=null),b.timedout&&(b.timedout.close(),b.timedout=null)}e.loadFromServer(),b.loginDialog=null,a.language=function(){return c.language},a.setLanguage=function(a){c.setLanguage(a)},a.activeWhen=function(a){return a?"active":""},a.activeIfInList=function(a,b){var c=!1;if(angular.isArray(b)===!1)return"";for(var d=0;d<b.length&&c===!1;){if(b[d]===a)return"active";d++}return""},a.path=function(){return d.url()},a.login=function(){a.$emit("event:loginRequest",a.username,a.password)},a.loginReq=function(){b.loginMessage()&&(b.loginMessage().text="",b.loginMessage().show=!1),a.$emit("event:loginRequired")},a.logout=function(){if(b.igdocument&&null!=b.igdocument&&b.hasChanges()){var c=f.open({templateUrl:"ConfirmLogout.html",controller:"ConfirmLogoutCtrl"});c.result.then(function(){a.execLogout()},function(){})}else a.execLogout()},a.execLogout=function(){e.setCurrentUser(null),a.username=a.password=null,a.$emit("event:logoutRequest"),o.remove(o.IG_DOCUMENT),b.initMaps(),b.igdocument=null,n.stop(),d.url("/tp")},a.cancel=function(){a.$emit("event:loginCancel")},a.isAuthenticated=function(){return e.isAuthenticated()},a.isPending=function(){return e.isPending()},a.isSupervisor=function(){return e.isSupervisor()},a.isVendor=function(){return e.isAuthorizedVendor()},a.isAuthor=function(){return e.isAuthor()},a.isCustomer=function(){return e.isCustomer()},a.isAdmin=function(){return e.isAdmin()},a.getRoleAsString=function(){return a.isAuthor()===!0?"author":a.isSupervisor()===!0?"Supervisor":a.isAdmin()===!0?"Admin":"undefined"},a.getUsername=function(){return e.isAuthenticated()===!0?e.getUsername():""},b.showLoginDialog=function(c,d){b.loginDialog&&null!=b.loginDialog&&b.loginDialog.opened&&b.loginDialog.dismiss("cancel"),b.loginDialog=f.open({backdrop:"static",keyboard:"false",controller:"LoginCtrl",size:"lg",templateUrl:"views/account/login.html",resolve:{user:function(){return{username:a.username,password:a.password}}}}),b.loginDialog.result.then(function(b){b?(a.username=b.username,a.password=b.password,a.login()):a.cancel()})},b.started=!1,k.watch(),b.$on("IdleStart",function(){p(),b.warning=f.open({templateUrl:"warning-dialog.html",windowClass:"modal-danger"})}),b.$on("IdleEnd",function(){p()}),b.$on("IdleTimeout",function(){p(),a.isAuthenticated()&&(b.igdocument&&null!=b.igdocument&&b.hasChanges()?b.$emit("event:saveAndExecLogout"):b.$emit("event:execLogout")),b.timedout=f.open({templateUrl:"timedout-dialog.html",windowClass:"modal-danger"})}),a.$on("Keepalive",function(){a.isAuthenticated()&&m.keepAlive()}),b.$on("event:execLogout",function(){a.execLogout()}),b.start=function(){p(),k.watch(),b.started=!0},b.stop=function(){p(),k.unwatch(),b.started=!1},a.checkForIE=function(){var a={init:function(){this.browser=this.searchString(this.dataBrowser)||"An unknown browser",this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version",this.OS=this.searchString(this.dataOS)||"an unknown OS"},searchString:function(a){for(var b=0;b<a.length;b++){var c=a[b].string,d=a[b].prop;if(this.versionSearchString=a[b].versionSearch||a[b].identity,c){if(-1!==c.indexOf(a[b].subString))return a[b].identity}else if(d)return a[b].identity}},searchVersion:function(a){var b=a.indexOf(this.versionSearchString);if(-1!==b)return parseFloat(a.substring(b+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera",versionSearch:"Version"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]};if(a.init(),"Explorer"===a.browser);},b.readonly=!1,b.igdocument=null,b.message=null,b.datatype=null,b.pages=["list","edit","read"],b.context={page:b.pages[0]},b.messagesMap={},b.segmentsMap={},b.datatypesMap={},b.tablesMap={},b.segments=[],b.datatypes=[],b.segmentPredicates=[],b.segmentConformanceStatements=[],b.datatypePredicates=[],b.datatypeConformanceStatements=[],b.tables=[],b.postfixCloneTable="CA",b.newCodeFakeId=0,b.newTableFakeId=0,b.newPredicateFakeId=0,b.newConformanceStatementFakeId=0,b.segment=null,b.config=null,b.messagesData=[],b.messages=[],b.customIgs=[],b.preloadedIgs=[],b.changes={},b.generalInfo={type:null,message:null},b.references=[],b.section={},b.conformanceStatementIdList=[],b.parentsMap={},b.igChanged=!1,b.messageTree=null,a.scrollbarWidth=0,b.selectIGDocumentTab=function(a){},a.getScrollbarWidth=function(){if(0==a.scrollbarWidth){var b=document.createElement("div");b.style.visibility="hidden",b.style.width="100px",b.style.msOverflowStyle="scrollbar",document.body.appendChild(b);var c=b.offsetWidth;b.style.overflow="scroll";var d=document.createElement("div");d.style.width="100%",b.appendChild(d);var e=d.offsetWidth;b.parentNode.removeChild(b),a.scrollbarWidth=c-e}return a.scrollbarWidth},b.initMaps=function(){b.segment=null,b.datatype=null,b.message=null,b.table=null,b.codeSystems=[],b.messagesMap={},b.segmentsMap={},b.datatypesMap={},b.tablesMap={},b.segments=[],b.tables=[],b.segmentPredicates=[],b.segmentConformanceStatements=[],b.datatypePredicates=[],b.datatypeConformanceStatements=[],b.datatypes=[],b.messages=[],b.messagesData=[],b.newCodeFakeId=0,b.newTableFakeId=0,b.newPredicateFakeId=0,b.newConformanceStatementFakeId=0,b.clearChanges(),b.parentsMap=[],b.conformanceStatementIdList=[],b.messageTree=null},b.$watch(function(){return d.path()},function(a,c){b.setActive(a)}),b.api=function(a){return a},b.isActive=function(a){return a===b.activePath},b.setActive=function(a){""===a||"/"===a?d.path("/home"):b.activePath=a},b.clearChanges=function(a){b.igChanged=!1},b.hasChanges=function(){return b.igChanged},b.findObjectInChanges=function(a,c,d){if(void 0!==b.changes[a]&&void 0!==b.changes[a][c])for(var e=0;e<b.changes[a][c].length;e++){var f=b.changes[a][c][e];if(f.id===d)return f}},b.isNewObject=function(a,c,d){if(void 0!==b.changes[a]&&void 0!==b.changes[a][c])for(var e=0;e<b.changes[a][c].length;e++){var f=b.changes[a][c][e];if(f.id===d)return!0}return!1},b.removeObjectFromChanges=function(a,c,d){if(void 0!==b.changes[a]&&void 0!==b.changes[a][c])for(var e=0;e<b.changes[a][c].length;e++){var f=b.changes[a][c][e];f.id===d&&b.changes[a][c].splice(e,1)}},g.setBaseUrl("api/"),b.showError=function(a){var c=f.open({templateUrl:"ErrorDlgDetails.html",controller:"ErrorDetailsCtrl",resolve:{error:function(){return a}}});c.result.then(function(a){b.error=a},function(){})},b.apply=function(a){return void 0!=a&&null!=a&&(-1!==a.indexOf("_")||-1!==a.indexOf("-"))},b.isFlavor=function(a){return void 0!=a&&null!=a&&(-1!==a.indexOf("_")||-1!==a.indexOf("-"))},b.getDatatype=function(a){return b.datatypesMap&&b.datatypesMap[a]},b.calNextCSID=function(){if(null!=b.igdocument.metaData.ext){var a=Number(0);return angular.forEach(b.conformanceStatementIdList,function(c){var d=parseInt(c.replace(b.igdocument.metaData.ext+"-",""));d>a&&(a=d)}),b.igdocument.metaData.ext+"-"+(a+1)}return""},b.processElement=function(a,c){try{void 0!=a&&null!=a&&("message"===a.type?(a.children=h("orderBy")(a.children,"position"),angular.forEach(a.conformanceStatements,function(a){-1==b.conformanceStatementIdList.indexOf(a.constraintId)&&b.conformanceStatementIdList.push(a.constraintId)}),angular.forEach(a.children,function(c){b.processElement(c,a)})):"group"===a.type&&a.children?(c&&(b.parentsMap[a.id]=c),a.children=h("orderBy")(a.children,"position"),angular.forEach(a.children,function(c){b.processElement(c,a)})):"segmentRef"===a.type?(c&&(b.parentsMap[a.id]=c),b.processElement(b.segmentsMap[a.ref],a)):"segment"===a.type?(a.fields=h("orderBy")(a.fields,"position"),angular.forEach(a.conformanceStatements,function(a){-1==b.conformanceStatementIdList.indexOf(a.constraintId)&&b.conformanceStatementIdList.push(a.constraintId)}),angular.forEach(a.fields,function(c){b.processElement(c,a)})):"field"===a.type?(b.parentsMap[a.id]=c,b.processElement(b.datatypesMap[a.datatype],a)):"component"===a.type?(b.parentsMap[a.id]=c,b.processElement(b.datatypesMap[a.datatype],a)):"datatype"===a.type&&(a.components=h("orderBy")(a.components,"position"),angular.forEach(a.conformanceStatements,function(a){-1==b.conformanceStatementIdList.indexOf(a.constraintId)&&b.conformanceStatementIdList.push(a.constraintId)}),angular.forEach(a.components,function(c){b.processElement(c,a)})))}catch(d){throw d}},b.processMessageTree=function(a,c){try{if(void 0!=a&&null!=a)if("message"===a.type){var d=new Object;d.children=[],b.messageTree=d,a.children=h("orderBy")(a.children,"position"),angular.forEach(a.children,function(a){b.processMessageTree(a,d)})}else if("group"===a.type&&a.children){var e=new Object;e.path=a.position+"[1]",e.obj=a,e.children=[],c.path&&(e.path=c.path+"."+a.position+"[1]"),c.children.push(e),a.children=h("orderBy")(a.children,"position"),angular.forEach(a.children,function(a){b.processMessageTree(a,e)})}else if("segmentRef"===a.type){var f=new Object;f.path=a.position+"[1]",f.obj=a,f.children=[],c.path&&(f.path=c.path+"."+a.position+"[1]"),c.children.push(f);var g=b.segmentsMap[a.ref];b.processMessageTree(g,f)}else if("segment"===a.type)a.fields=h("orderBy")(a.fields,"position"),angular.forEach(a.fields,function(a){b.processMessageTree(a,c)});else if("field"===a.type){var i=new Object;i.obj=a,i.path=c.path+"."+a.position+"[1]",i.children=[],c.children.push(i),b.processMessageTree(b.datatypesMap[a.datatype],i)}else if("component"===a.type){var j=new Object;j.obj=a,j.path=c.path+"."+a.position+"[1]",j.children=[],c.children.push(j),b.processMessageTree(b.datatypesMap[a.datatype],j)}else"datatype"===a.type&&(a.components=h("orderBy")(a.components,"position"),angular.forEach(a.components,function(a){b.processMessageTree(a,c)}))}catch(k){throw k}},b.createNewFlavorName=function(a){return null!=b.igdocument?null===b.igdocument.metaData.ext?a+"_"+(Math.floor(1e7*Math.random())+1):a+"_"+b.igdocument.metaData.ext+"_"+(Math.floor(1e7*Math.random())+1):null},b.isSubComponent=function(a){"component"===a.type&&b.parentsMap[a.id]&&"component"===b.parentsMap[a.id].type},b.findDatatypeRefs=function(a,c){angular.equals(c.type,"field")||angular.equals(c.type,"component")?(b.datatypesMap[c.datatype]===a&&-1===b.references.indexOf(c)&&b.references.push(c),b.findDatatypeRefs(a,b.datatypesMap[c.datatype])):angular.equals(c.type,"segment")?angular.forEach(b.segments,function(c){angular.forEach(c.fields,function(c){b.findDatatypeRefs(a,c);
})}):angular.equals(c.type,"datatype")&&void 0!=c.components&&null!=c.components&&c.components.length>0&&angular.forEach(c.components,function(c){b.findDatatypeRefs(a,c)})},b.findTableRefs=function(a,c){angular.equals(c.type,"field")||angular.equals(c.type,"component")?(void 0!=c.table&&c.table===a.id&&-1===b.references.indexOf(c)&&b.references.push(c),b.findTableRefs(a,b.datatypesMap[c.datatype])):angular.equals(c.type,"segment")?angular.forEach(b.segments,function(c){angular.forEach(c.fields,function(c){b.findTableRefs(a,c)})}):angular.equals(c.type,"datatype")&&void 0!=c.components&&null!=c.components&&c.components.length>0&&angular.forEach(c.components,function(c){b.findTableRefs(a,c)})},b.genRegex=function(a){return"YYYY"===a?"(([0-9]{4})|(([0-9]{4})((0[1-9])|(1[0-2])))|(([0-9]{4})((0[1-9])|(1[0-2]))((0[1-9])|([1-2][0-9])|(3[0-1])))|(([0-9]{4})((0[1-9])|(1[0-2]))((0[1-9])|([1-2][0-9])|(3[0-1]))(([0-1][0-9])|(2[0-3])))|(([0-9]{4})((0[1-9])|(1[0-2]))((0[1-9])|([1-2][0-9])|(3[0-1]))(([0-1][0-9])|(2[0-3]))([0-5][0-9]))|(([0-9]{4})((0[1-9])|(1[0-2]))((0[1-9])|([1-2][0-9])|(3[0-1]))(([0-1][0-9])|(2[0-3]))([0-5][0-9])([0-5][0-9]))|(([0-9]{4})((0[1-9])|(1[0-2]))((0[1-9])|([1-2][0-9])|(3[0-1]))(([0-1][0-9])|(2[0-3]))([0-5][0-9])([0-5][0-9])\\.[0-9][0-9][0-9][0-9]))":"YYYYMM"===a?"((([0-9]{4})((0[1-9])|(1[0-2])))|(([0-9]{4})((0[1-9])|(1[0-2]))((0[1-9])|([1-2][0-9])|(3[0-1])))|(([0-9]{4})((0[1-9])|(1[0-2]))((0[1-9])|([1-2][0-9])|(3[0-1]))(([0-1][0-9])|(2[0-3])))|(([0-9]{4})((0[1-9])|(1[0-2]))((0[1-9])|([1-2][0-9])|(3[0-1]))(([0-1][0-9])|(2[0-3]))([0-5][0-9]))|(([0-9]{4})((0[1-9])|(1[0-2]))((0[1-9])|([1-2][0-9])|(3[0-1]))(([0-1][0-9])|(2[0-3]))([0-5][0-9])([0-5][0-9]))|(([0-9]{4})((0[1-9])|(1[0-2]))((0[1-9])|([1-2][0-9])|(3[0-1]))(([0-1][0-9])|(2[0-3]))([0-5][0-9])([0-5][0-9])\\.[0-9][0-9][0-9][0-9]))":"YYYYMMDD"===a?"((([0-9]{4})((0[1-9])|(1[0-2]))((0[1-9])|([1-2][0-9])|(3[0-1])))|(([0-9]{4})((0[1-9])|(1[0-2]))((0[1-9])|([1-2][0-9])|(3[0-1]))(([0-1][0-9])|(2[0-3])))|(([0-9]{4})((0[1-9])|(1[0-2]))((0[1-9])|([1-2][0-9])|(3[0-1]))(([0-1][0-9])|(2[0-3]))([0-5][0-9]))|(([0-9]{4})((0[1-9])|(1[0-2]))((0[1-9])|([1-2][0-9])|(3[0-1]))(([0-1][0-9])|(2[0-3]))([0-5][0-9])([0-5][0-9]))|(([0-9]{4})((0[1-9])|(1[0-2]))((0[1-9])|([1-2][0-9])|(3[0-1]))(([0-1][0-9])|(2[0-3]))([0-5][0-9])([0-5][0-9])\\.[0-9][0-9][0-9][0-9]))":"YYYYMMDDhh"===a?"((([0-9]{4})((0[1-9])|(1[0-2]))((0[1-9])|([1-2][0-9])|(3[0-1]))(([0-1][0-9])|(2[0-3])))|(([0-9]{4})((0[1-9])|(1[0-2]))((0[1-9])|([1-2][0-9])|(3[0-1]))(([0-1][0-9])|(2[0-3]))([0-5][0-9]))|(([0-9]{4})((0[1-9])|(1[0-2]))((0[1-9])|([1-2][0-9])|(3[0-1]))(([0-1][0-9])|(2[0-3]))([0-5][0-9])([0-5][0-9]))|(([0-9]{4})((0[1-9])|(1[0-2]))((0[1-9])|([1-2][0-9])|(3[0-1]))(([0-1][0-9])|(2[0-3]))([0-5][0-9])([0-5][0-9])\\.[0-9][0-9][0-9][0-9]))":"YYYYMMDDhhmm"===a?"((([0-9]{4})((0[1-9])|(1[0-2]))((0[1-9])|([1-2][0-9])|(3[0-1]))(([0-1][0-9])|(2[0-3]))([0-5][0-9]))|(([0-9]{4})((0[1-9])|(1[0-2]))((0[1-9])|([1-2][0-9])|(3[0-1]))(([0-1][0-9])|(2[0-3]))([0-5][0-9])([0-5][0-9]))|(([0-9]{4})((0[1-9])|(1[0-2]))((0[1-9])|([1-2][0-9])|(3[0-1]))(([0-1][0-9])|(2[0-3]))([0-5][0-9])([0-5][0-9])\\.[0-9][0-9][0-9][0-9]))":"YYYYMMDDhhmmss"===a?"((([0-9]{4})((0[1-9])|(1[0-2]))((0[1-9])|([1-2][0-9])|(3[0-1]))(([0-1][0-9])|(2[0-3]))([0-5][0-9])([0-5][0-9]))|(([0-9]{4})((0[1-9])|(1[0-2]))((0[1-9])|([1-2][0-9])|(3[0-1]))(([0-1][0-9])|(2[0-3]))([0-5][0-9])([0-5][0-9])\\.[0-9][0-9][0-9][0-9]))":"YYYYMMDDhhmmss.sss"===a?"((([0-9]{4})((0[1-9])|(1[0-2]))((0[1-9])|([1-2][0-9])|(3[0-1]))(([0-1][0-9])|(2[0-3]))([0-5][0-9])([0-5][0-9])\\.[0-9][0-9][0-9][0-9]))":"YYYY+-ZZZZ"===a?"([0-9]{4}).*((\\+|\\-)[0-9]{4})":"YYYYMM+-ZZZZ"===a?"([0-9]{4})((0[1-9])|(1[0-2])).*((\\+|\\-)[0-9]{4})":"YYYYMMDD+-ZZZZ"===a?"([0-9]{4})((0[1-9])|(1[0-2]))((0[1-9])|([1-2][0-9])|(3[0-1])).*((\\+|\\-)[0-9]{4})":"YYYYMMDDhh+-ZZZZ"===a?"([0-9]{4})((0[1-9])|(1[0-2]))((0[1-9])|([1-2][0-9])|(3[0-1]))(([0-1][0-9])|(2[0-3])).*((\\+|\\-)[0-9]{4})":"YYYYMMDDhhmm+-ZZZZ"===a?"([0-9]{4})((0[1-9])|(1[0-2]))((0[1-9])|([1-2][0-9])|(3[0-1]))(([0-1][0-9])|(2[0-3]))([0-5][0-9]).*((\\+|\\-)[0-9]{4})":"YYYYMMDDhhmmss+-ZZZZ"===a?"([0-9]{4})((0[1-9])|(1[0-2]))((0[1-9])|([1-2][0-9])|(3[0-1]))(([0-1][0-9])|(2[0-3]))([0-5][0-9])([0-5][0-9]).*((\\+|\\-)[0-9]{4})":"YYYYMMDDhhmmss.sss+-ZZZZ"===a?"([0-9]{4})((0[1-9])|(1[0-2]))((0[1-9])|([1-2][0-9])|(3[0-1]))(([0-1][0-9])|(2[0-3]))([0-5][0-9])([0-5][0-9])\\.[0-9][0-9][0-9][0-9]((\\+|\\-)[0-9]{4})":"ISO-compliant OID"===a?"[0-2](\\.(0|[1-9][0-9]*))*":"Alphanumeric"===a?"^[a-zA-Z0-9]*$":a},b.isAvailableDTForTable=function(a){if(void 0!=a){if("IS"===a.name||"ID"===a.name||"CWE"===a.name||"CNE"===a.name||"CE"===a.name)return!0;if(void 0!=a.components&&a.components.length>0)return!0}return!1},b.validateNumber=function(a){var b=window.event?a.keyCode:a.which;return 8==a.keyCode||46==a.keyCode||37==a.keyCode||39==a.keyCode?!0:!(48>b||b>57)},b.generateCompositeConformanceStatement=function(a,b,c){var d=b.assertion.replace("<Assertion>","");d=d.replace("</Assertion>","");var e=c.assertion.replace("<Assertion>","");e=e.replace("</Assertion>","");var f=null;return"AND"===a?f={id:(new ObjectId).toString(),constraintId:"AND("+b.constraintId+","+c.constraintId+")",constraintTarget:b.constraintTarget,description:"["+b.description+"] AND ["+c.description+"]",assertion:"<Assertion><AND>"+d+e+"</AND></Assertion>"}:"OR"===a?f={id:(new ObjectId).toString(),constraintId:"OR("+b.constraintId+","+c.constraintId+")",constraintTarget:b.constraintTarget,description:"["+b.description+"] OR ["+c.description+"]",assertion:"<Assertion><OR>"+d+e+"</OR></Assertion>"}:"IFTHEN"===a&&(f={id:(new ObjectId).toString(),constraintId:"IFTHEN("+b.constraintId+","+c.constraintId+")",constraintTarget:b.constraintTarget,description:"IF ["+b.description+"] THEN  ["+c.description+"]",assertion:"<Assertion><IMPLY>"+d+e+"</IMPLY></Assertion>"}),f},b.generateCompositePredicate=function(a,b,c){var d=b.assertion.replace("<Condition>","");d=d.replace("</Condition>","");var e=c.assertion.replace("<Condition>","");e=e.replace("</Condition>","");var f=null;return"AND"===a?f={id:(new ObjectId).toString(),constraintId:"AND("+b.constraintId+","+c.constraintId+")",constraintTarget:b.constraintTarget,description:"["+b.description+"] AND ["+c.description+"]",trueUsage:"",falseUsage:"",assertion:"<Condition><AND>"+d+e+"</AND></Condition>"}:"OR"===a?f={id:(new ObjectId).toString(),constraintId:"OR("+b.constraintId+","+c.constraintId+")",constraintTarget:b.constraintTarget,description:"["+b.description+"] OR ["+c.description+"]",trueUsage:"",falseUsage:"",assertion:"<Condition><OR>"+d+e+"</OR></Condition>"}:"IFTHEN"===a&&(f={id:(new ObjectId).toString(),constraintId:"IFTHEN("+b.constraintId+","+c.constraintId+")",constraintTarget:b.constraintTarget,description:"IF ["+b.description+"] THEN  ["+c.description+"]",trueUsage:"",falseUsage:"",assertion:"<Condition><IMPLY>"+d+e+"</IMPLY></Condition>"}),f},b.generateConformanceStatement=function(a,c){var d=null;if("valued"===c.contraintType)d={id:(new ObjectId).toString(),constraintId:c.constraintId,constraintTarget:a,description:c.location_1+" "+c.verb+" "+c.contraintType+".",assertion:'<Assertion><Presence Path="'+c.position_1+'"/></Assertion>'};else if("a literal value"===c.contraintType)if(-1==c.value.indexOf("^"))d={id:(new ObjectId).toString(),constraintId:c.constraintId,constraintTarget:a,description:"The value of "+c.location_1+" "+c.verb+" '"+c.value+"'.",assertion:'<Assertion><PlainText Path="'+c.position_1+'" Text="'+c.value+'" IgnoreCase="false"/></Assertion>'};else{var e=c.value.split("^"),f="",g=0;angular.forEach(e,function(a){g+=1;var b='<PlainText Path="'+c.position_1+"."+g+'[1]" Text="'+a+'" IgnoreCase="false"/>';f=""===f?b:"<AND>"+f+b+"</AND>"}),d={id:(new ObjectId).toString(),constraintId:c.constraintId,constraintTarget:a,description:"The value of "+c.location_1+" "+c.verb+" '"+c.value+"'.",assertion:"<Assertion>"+f+"</Assertion>"}}else"one of list values"===c.contraintType?d={id:(new ObjectId).toString(),constraintId:c.constraintId,constraintTarget:a,description:"The value of "+c.location_1+" "+c.verb+" "+c.contraintType+": "+c.value+".",assertion:'<Assertion><StringList Path="'+c.position_1+'" CSV="'+c.value+'"/></Assertion>'}:"one of codes in ValueSet"===c.contraintType?d={id:(new ObjectId).toString(),constraintId:c.constraintId,constraintTarget:a,description:"The value of "+c.location_1+" "+c.verb+" "+c.contraintType+": "+c.valueSetId+".",assertion:'<Assertion><ValueSet Path="'+c.position_1+'" ValueSetID="'+c.valueSetId+'" BindingStrength="'+c.bindingStrength+'" BindingLocation="'+c.bindingLocation+'"/></Assertion>'}:"formatted value"===c.contraintType?d="Regular expression"===c.value?{id:(new ObjectId).toString(),constraintId:c.constraintId,constraintTarget:a,description:"The value of "+c.location_1+" "+c.verb+" valid in format: '"+c.value2+"'.",assertion:'<Assertion><Format Path="'+c.position_1+'" Regex="'+c.value2+'"/></Assertion>'}:{id:(new ObjectId).toString(),constraintId:c.constraintId,constraintTarget:a,description:"The value of "+c.location_1+" "+c.verb+" valid in format: '"+c.value+"'.",assertion:'<Assertion><Format Path="'+c.position_1+'" Regex="'+b.genRegex(c.value)+'"/></Assertion>'}:"identical to another node"===c.contraintType?d={id:(new ObjectId).toString(),constraintId:c.constraintId,constraintTarget:a,description:"The value of "+c.location_1+" "+c.verb+" identical to the value of "+c.location_2+".",assertion:'<Assertion><PathValue Path1="'+c.position_1+'" Operator="EQ" Path2="'+c.position_2+'"/></Assertion>'}:"equal to another node"===c.contraintType?d={id:(new ObjectId).toString(),constraintId:c.constraintId,constraintTarget:a,description:"The value of "+c.location_1+" "+c.verb+" equal to the value of "+c.location_2+".",assertion:'<Assertion><PathValue Path1="'+c.position_1+'" Operator="EQ" Path2="'+c.position_2+'"/></Assertion>'}:"not-equal to another node"===c.contraintType?d={id:(new ObjectId).toString(),constraintId:c.constraintId,constraintTarget:a,description:"The value of "+c.location_1+" "+c.verb+" different with the value of "+c.location_2+".",assertion:'<Assertion><PathValue Path1="'+c.position_1+'" Operator="NE" Path2="'+c.position_2+'"/></Assertion>'}:"greater than another node"===c.contraintType?d={id:(new ObjectId).toString(),constraintId:c.constraintId,constraintTarget:a,description:"The value of "+c.location_1+" "+c.verb+" greater than the value of "+c.location_2+".",assertion:'<Assertion><PathValue Path1="'+c.position_1+'" Operator="GT" Path2="'+c.position_2+'"/></Assertion>'}:"equal to or greater than another node"===c.contraintType?d={id:(new ObjectId).toString(),constraintId:c.constraintId,constraintTarget:a,description:"The value of "+c.location_1+" "+c.verb+" equal to or greater than the value of "+c.location_2+".",assertion:'<Assertion><PathValue Path1="'+c.position_1+'" Operator="GE" Path2="'+c.position_2+'"/></Assertion>'}:"less than another node"===c.contraintType?d={id:(new ObjectId).toString(),constraintId:c.constraintId,constraintTarget:a,description:"The value of "+c.location_1+" "+c.verb+" less than the value of "+c.location_2+".",assertion:'<Assertion><PathValue Path1="'+c.position_1+'" Operator="LT" Path2="'+c.position_2+'"/></Assertion>'}:"equal to or less than another node"===c.contraintType?d={id:(new ObjectId).toString(),constraintId:c.constraintId,constraintTarget:a,description:"The value of "+c.location_1+" "+c.verb+" equal to or less than the value of "+c.location_2+".",assertion:'<Assertion><PathValue Path1="'+c.position_1+'" Operator="LE" Path2="'+c.position_2+'"/></Assertion>'}:"equal to"===c.contraintType?d={id:(new ObjectId).toString(),constraintId:c.constraintId,constraintTarget:a,description:"The value of "+c.location_1+" "+c.verb+" equal to "+c.value+".",assertion:'<Assertion><SimpleValue Path="'+c.position_1+'" Operator="EQ" Value="'+c.value+'"/></Assertion>'}:"not-equal to"===c.contraintType?d={id:(new ObjectId).toString(),constraintId:c.constraintId,constraintTarget:a,description:"The value of "+c.location_1+" "+c.verb+" different with "+c.value+".",assertion:'<Assertion><SimpleValue Path="'+c.position_1+'" Operator="NE" Value="'+c.value+'"/></Assertion>'}:"greater than"===c.contraintType?d={id:(new ObjectId).toString(),constraintId:c.constraintId,constraintTarget:a,description:"The value of "+c.location_1+" "+c.verb+" greater than "+c.value+".",assertion:'<Assertion><SimpleValue Path="'+c.position_1+'" Operator="GT" Value="'+c.value+'"/></Assertion>'}:"equal to or greater than"===c.contraintType?d={id:(new ObjectId).toString(),constraintId:c.constraintId,constraintTarget:a,description:"The value of "+c.location_1+" "+c.verb+" equal to or greater than "+c.value+".",assertion:'<Assertion><SimpleValue Path="'+c.position_1+'" Operator="GE" Value="'+c.value+'"/></Assertion>'}:"less than"===c.contraintType?d={id:(new ObjectId).toString(),constraintId:c.constraintId,constraintTarget:a,description:"The value of "+c.location_1+" "+c.verb+" less than "+c.value+".",assertion:'<Assertion><SimpleValue Path="'+c.position_1+'" Operator="LT" Value="'+c.value+'"/></Assertion>'}:"equal to or less than"===c.contraintType?d={id:(new ObjectId).toString(),constraintId:c.constraintId,constraintTarget:a,description:"The value of "+c.location_1+" "+c.verb+" equal to or less than "+c.value+".",assertion:'<Assertion><SimpleValue Path="'+c.position_1+'" Operator="LE" Value="'+c.value+'"/></Assertion>'}:"valued sequentially starting with the value '1'"===c.contraintType&&(d={id:(new ObjectId).toString(),constraintId:c.constraintId,constraintTarget:a,description:"The value of "+c.location_1+" "+c.verb+" valued sequentially starting with the value '1'.",assertion:'<Assertion><SetID Path="'+c.position_1+'"/></Assertion>'});return d},b.generatePredicate=function(a,c){var d=null;if("valued"===c.contraintType)d={id:(new ObjectId).toString(),constraintId:"CP_"+a+"_"+b.newPredicateFakeId,constraintTarget:a,description:"If "+c.location_1+" "+c.verb+" "+c.contraintType,trueUsage:c.trueUsage,falseUsage:c.falseUsage,assertion:'<Condition><Presence Path="'+c.position_1+'"/></Condition>'};else if("a literal value"===c.contraintType)if(-1==c.value.indexOf("^"))d={id:(new ObjectId).toString(),constraintId:"CP_"+a+"_"+b.newPredicateFakeId,constraintTarget:a,description:"If the value of "+c.location_1+" "+c.verb+" '"+c.value+"'.",trueUsage:c.trueUsage,falseUsage:c.falseUsage,assertion:'<Condition><PlainText Path="'+c.position_1+'" Text="'+c.value+'" IgnoreCase="false"/></Condition>'};else{var e=c.value.split("^"),f="",g=0;angular.forEach(e,function(a){g+=1;var b='<PlainText Path="'+c.position_1+"."+g+'[1]" Text="'+a+'" IgnoreCase="false"/>';f=""===f?b:"<AND>"+f+b+"</AND>"}),d={id:(new ObjectId).toString(),constraintId:"CP_"+a+"_"+b.newPredicateFakeId,constraintTarget:a,description:"If the value of "+c.location_1+" "+c.verb+" '"+c.value+"'.",trueUsage:c.trueUsage,falseUsage:c.falseUsage,assertion:"<Condition>"+f+"</Condition>"}}else"one of list values"===c.contraintType?d={id:(new ObjectId).toString(),constraintId:"CP_"+a+"_"+b.newPredicateFakeId,constraintTarget:a,description:"If the value of "+c.location_1+" "+c.verb+" "+c.contraintType+": "+c.value+".",trueUsage:c.trueUsage,falseUsage:c.falseUsage,assertion:'<Condition><StringList Path="'+c.position_1+'" CSV="'+c.value+'"/></Condition>'}:"one of codes in ValueSet"===c.contraintType?d={id:(new ObjectId).toString(),constraintId:"CP_"+a+"_"+b.newPredicateFakeId,constraintTarget:a,description:"If the value of "+c.location_1+" "+c.verb+" "+c.contraintType+": "+c.valueSetId+".",trueUsage:c.trueUsage,falseUsage:c.falseUsage,assertion:'<Condition><ValueSet Path="'+c.position_1+'" ValueSetID="'+c.valueSetId+'" BindingStrength="'+c.bindingStrength+'" BindingLocation="'+c.bindingLocation+'"/></Condition>'}:"formatted value"===c.contraintType?d="Regular expression"===c.value?{id:(new ObjectId).toString(),constraintId:"CP_"+a+"_"+b.newPredicateFakeId,constraintTarget:a,description:"If the value of "+c.location_1+" "+c.verb+" valid in format: '"+c.value2+"'.",trueUsage:c.trueUsage,falseUsage:c.falseUsage,assertion:'<Condition><Format Path="'+c.position_1+'" Regex="'+c.value2+'"/></Condition>'}:{id:(new ObjectId).toString(),constraintId:"CP_"+a+"_"+b.newPredicateFakeId,constraintTarget:a,description:"If the value of "+c.location_1+" "+c.verb+" valid in format: '"+c.value+"'.",trueUsage:c.trueUsage,falseUsage:c.falseUsage,assertion:'<Condition><Format Path="'+c.position_1+'" Regex="'+b.genRegex(c.value)+'"/></Condition>'}:"identical to another node"===c.contraintType?d={id:(new ObjectId).toString(),constraintId:"CP_"+a+"_"+b.newPredicateFakeId,constraintTarget:a,description:"The value of "+c.location_1+" "+c.verb+" identical to the value of "+c.location_2+".",trueUsage:c.trueUsage,falseUsage:c.falseUsage,assertion:'<Condition><PathValue Path1="'+c.position_1+'" Operator="EQ" Path2="'+c.position_2+'"/></Condition>'}:"equal to another node"===c.contraintType?d={id:(new ObjectId).toString(),constraintId:"CP_"+a+"_"+b.newPredicateFakeId,constraintTarget:a,description:"If the value of "+c.location_1+" "+c.verb+" equal to the value of "+c.location_2+".",trueUsage:c.trueUsage,falseUsage:c.falseUsage,assertion:'<Condition><PathValue Path1="'+c.position_1+'" Operator="EQ" Path2="'+c.position_2+'"/></Condition>'}:"not-equal to another node"===c.contraintType?d={id:(new ObjectId).toString(),constraintId:"CP_"+a+"_"+b.newPredicateFakeId,constraintTarget:a,description:"If the value of "+c.location_1+" "+c.verb+" different with the value of "+c.location_2+".",trueUsage:c.trueUsage,falseUsage:c.falseUsage,assertion:'<Condition><PathValue Path1="'+c.position_1+'" Operator="NE" Path2="'+c.position_2+'"/></Condition>'}:"greater than another node"===c.contraintType?d={id:(new ObjectId).toString(),constraintId:"CP_"+a+"_"+b.newPredicateFakeId,constraintTarget:a,description:"If the value of "+c.location_1+" "+c.verb+" greater than the value of "+c.location_2+".",trueUsage:c.trueUsage,falseUsage:c.falseUsage,assertion:'<Condition><PathValue Path1="'+c.position_1+'" Operator="GT" Path2="'+c.position_2+'"/></Condition>'}:"equal to or greater than another node"===c.contraintType?d={id:(new ObjectId).toString(),constraintId:"CP_"+a+"_"+b.newPredicateFakeId,constraintTarget:a,description:"If the value of "+c.location_1+" "+c.verb+" equal to or greater than the value of "+c.location_2+".",trueUsage:c.trueUsage,falseUsage:c.falseUsage,assertion:'<Condition><PathValue Path1="'+c.position_1+'" Operator="GE" Path2="'+c.position_2+'"/></Condition>'}:"less than another node"===c.contraintType?d={id:(new ObjectId).toString(),constraintId:"CP_"+a+"_"+b.newPredicateFakeId,constraintTarget:a,description:"If the value of "+c.location_1+" "+c.verb+" less than the value of "+c.location_2+".",trueUsage:c.trueUsage,falseUsage:c.falseUsage,assertion:'<Condition><PathValue Path1="'+c.position_1+'" Operator="LT" Path2="'+c.position_2+'"/></Condition>'}:"equal to or less than another node"===c.contraintType?d={id:(new ObjectId).toString(),constraintId:"CP_"+a+"_"+b.newPredicateFakeId,constraintTarget:a,description:"If the value of "+c.location_1+" "+c.verb+" equal to or less than the value of "+c.location_2+".",trueUsage:c.trueUsage,falseUsage:c.falseUsage,assertion:'<Condition><PathValue Path1="'+c.position_1+'" Operator="LE" Path2="'+c.position_2+'"/></Condition>'}:"equal to"===c.contraintType?d={id:(new ObjectId).toString(),constraintId:"CP_"+a+"_"+b.newPredicateFakeId,constraintTarget:a,description:"If the value of "+c.location_1+" "+c.verb+" equal to "+c.value+".",trueUsage:c.trueUsage,falseUsage:c.falseUsage,assertion:'<Condition><SimpleValue Path="'+c.position_1+'" Operator="EQ" Value="'+c.value+'"/></Condition>'}:"not-equal to"===c.contraintType?d={id:(new ObjectId).toString(),constraintId:"CP_"+a+"_"+b.newPredicateFakeId,constraintTarget:a,description:"If the value of "+c.location_1+" "+c.verb+" different with "+c.value+".",trueUsage:c.trueUsage,falseUsage:c.falseUsage,assertion:'<Condition><SimpleValue Path="'+c.position_1+'" Operator="NE" Value="'+c.value+'"/></Condition>'}:"greater than"===c.contraintType?d={id:(new ObjectId).toString(),constraintId:"CP_"+a+"_"+b.newPredicateFakeId,constraintTarget:a,description:"If the value of "+c.location_1+" "+c.verb+" greater than "+c.value+".",trueUsage:c.trueUsage,falseUsage:c.falseUsage,assertion:'<Condition><SimpleValue Path="'+c.position_1+'" Operator="GT" Value="'+c.value+'"/></Condition>'}:"equal to or greater than"===c.contraintType?d={id:(new ObjectId).toString(),constraintId:"CP_"+a+"_"+b.newPredicateFakeId,constraintTarget:a,description:"If the value of "+c.location_1+" "+c.verb+" equal to or greater than "+c.value+".",trueUsage:c.trueUsage,falseUsage:c.falseUsage,assertion:'<Condition><SimpleValue Path="'+c.position_1+'" Operator="GE" Value="'+c.value+'"/></Condition>'}:"less than"===c.contraintType?d={id:(new ObjectId).toString(),constraintId:"CP_"+a+"_"+b.newPredicateFakeId,constraintTarget:a,description:"If the value of "+c.location_1+" "+c.verb+" less than "+c.value+".",trueUsage:c.trueUsage,falseUsage:c.falseUsage,assertion:'<Condition><SimpleValue Path="'+c.position_1+'" Operator="LT" Value="'+c.value+'"/></Condition>'}:"equal to or less than"===c.contraintType?d={id:(new ObjectId).toString(),constraintId:"CP_"+a+"_"+b.newPredicateFakeId,constraintTarget:a,description:"If the value of "+c.location_1+" "+c.verb+" equal to or less than "+c.value+".",trueUsage:c.trueUsage,falseUsage:c.falseUsage,assertion:'<Condition><SimpleValue Path="'+c.position_1+'" Operator="LE" Value="'+c.value+'"/></Condition>'}:"valued sequentially starting with the value '1'"===c.contraintType&&(d={id:(new ObjectId).toString(),constraintId:"CP_"+a+"_"+b.newPredicateFakeId,constraintTarget:a,description:"If the value of "+c.location_1+" "+c.verb+" valued sequentially starting with the value '1'.",trueUsage:c.trueUsage,falseUsage:c.falseUsage,assertion:'<Condition><SetID Path="'+c.position_1+'"/></Condition>'});return d},b.erorrForComplexConfStatement=function(a,c,d,e,f){return b.isEmptyComplexConstraintID(a)?!0:b.isDuplicatedComplexConstraintID(a,c)?!0:b.isEmptyCompositeType(d)?!0:null==e?!0:null==f},b.erorrForComplexPredicate=function(a,c,d,e,f){return b.isEmptyCompositeType(a)?!0:null==c?!0:null==d?!0:null==e?!0:null==f},b.erorrForPredicate=function(a,c){if(b.isEmptyConstraintNode(a,c))return!0;if(b.isEmptyConstraintVerb(a))return!0;if(b.isEmptyConstraintPattern(a))return!0;if("a literal value"==a.contraintType||"equal to"==a.contraintType||"not-equal to"==a.contraintType||"greater than"==a.contraintType||"equal to or greater than"==a.contraintType||"less than"==a.contraintType||"equal to or less than"==a.contraintType||"one of list values"==a.contraintType||"formatted value"==a.contraintType){if(b.isEmptyConstraintValue(a))return!0;if("Regular expression"==a.value&&b.isEmptyConstraintValue2(a))return!0}else if("identical to another node"==a.contraintType||"equal to another node"==a.contraintType||"not-equal to another node"==a.contraintType||"greater than another node"==a.contraintType||"equal to or greater than another node"==a.contraintType||"less than another node"==a.contraintType||"equal to or less than another node"==a.contraintType){if(b.isEmptyConstraintAnotherNode(a))return!0}else if("one of codes in ValueSet"==a.contraintType&&b.isEmptyConstraintValueSet(a,c))return!0;return null==a.trueUsage?!0:null==a.falseUsage},b.erorrForConfStatement=function(a,c,d){if(b.isEmptyConstraintID(a))return!0;if(b.isDuplicatedConstraintID(a,c))return!0;if(b.isEmptyConstraintNode(a,d))return!0;if(b.isEmptyConstraintVerb(a))return!0;if(b.isEmptyConstraintPattern(a))return!0;if("a literal value"==a.contraintType||"equal to"==a.contraintType||"not-equal to"==a.contraintType||"greater than"==a.contraintType||"equal to or greater than"==a.contraintType||"less than"==a.contraintType||"equal to or less than"==a.contraintType||"one of list values"==a.contraintType||"formatted value"==a.contraintType){if(b.isEmptyConstraintValue(a))return!0;if("Regular expression"==a.value&&b.isEmptyConstraintValue2(a))return!0}else if("identical to another node"==a.contraintType||"equal to another node"==a.contraintType||"not-equal to another node"==a.contraintType||"greater than another node"==a.contraintType||"equal to or greater than another node"==a.contraintType||"less than another node"==a.contraintType||"equal to or less than another node"==a.contraintType){if(b.isEmptyConstraintAnotherNode(a))return!0}else if("one of codes in ValueSet"==a.contraintType&&b.isEmptyConstraintValueSet(a,d))return!0;return!1},b.isEmptyConstraintID=function(a){return null===a.constraintId?!0:""===a.constraintId},b.isEmptyComplexConstraintID=function(a){return null===a?!0:""===a},b.isDuplicatedConstraintID=function(a,c){return-1!=b.conformanceStatementIdList.indexOf(a.constraintId)&&c==a.constraintId},b.isDuplicatedComplexConstraintID=function(a,c){return-1!=b.conformanceStatementIdList.indexOf(a)&&c==a},b.isEmptyConstraintNode=function(a,b){if("datatype"==b){if(null===a.component_1)return!0}else if("segment"==b){if(null===a.field_1)return!0}else if("message"==b&&null===a.position_1)return!0;return!1},b.isEmptyConstraintVerb=function(a){return null===a.verb},b.isEmptyConstraintPattern=function(a){return null===a.contraintType},b.isEmptyConstraintValue=function(a){return null===a.value},b.isEmptyConstraintValue2=function(a){return null===a.value2},b.isEmptyConstraintAnotherNode=function(a,b){if("datatype"==b){if(null===a.component_2)return!0}else if("segment"==b){if(null===a.field_2)return!0}else if("message"==b&&null===a.position_2)return!0;return!1},b.isEmptyConstraintValueSet=function(a){return null===a.valueSetId},b.isEmptyCompositeType=function(a){return null===a},b.openRichTextDlg=function(a,b,c,d){f.open({templateUrl:"RichTextCtrl.html",controller:"RichTextCtrl",windowClass:"app-modal-window",backdrop:!0,keyboard:!0,backdropClick:!1,resolve:{editorTarget:function(){return{key:b,obj:a,disabled:d,title:c}}}})},b.openInputTextDlg=function(a,b,c,d){f.open({templateUrl:"InputTextCtrl.html",controller:"InputTextCtrl",backdrop:!0,keyboard:!0,windowClass:"app-modal-window",backdropClick:!1,resolve:{editorTarget:function(){return{key:b,obj:a,disabled:d,title:c}}}})},b.isDuplicated=function(a,b,c){return null==a||void 0==a?!1:_.find(_.without(c,a),function(c){return c[b]==a[b]})},b.isDuplicatedTwoContexts=function(a,b,c,d){return null==a||void 0==a?!1:_.find(_.without(d,a),function(d){return d[b]==a[b]?d[c]==a[c]:!1})},a.init=function(){},a.getFullName=function(){return e.isAuthenticated()===!0?e.getFullName():""}}]),angular.module("tcl").controller("LoginCtrl",["$scope","$modalInstance","user",function(a,b,c){a.user=c,a.cancel=function(){b.dismiss("cancel")},a.login=function(){b.close(a.user)}}]),angular.module("tcl").controller("RichTextCtrl",["$scope","$modalInstance","editorTarget",function(a,b,c){a.editorTarget=c,a.cancel=function(){b.dismiss("cancel")},a.close=function(){b.close(a.editorTarget)}}]),angular.module("tcl").controller("InputTextCtrl",["$scope","$modalInstance","editorTarget",function(a,b,c){a.editorTarget=c,a.cancel=function(){b.dismiss("cancel")},a.close=function(){b.close(a.editorTarget)}}]),angular.module("tcl").controller("ConfirmLogoutCtrl",["$scope","$modalInstance","$rootScope","$http",function(a,b,c,d){a.logout=function(){b.close()},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("tcl").controller("MasterDatatypeLibraryCtrl",["$scope","$rootScope","Restangular","$http","$filter","$modal","$cookies","$timeout","userInfoService","ToCSvc","ContextMenuSvc","ProfileAccessSvc","ngTreetableParams","$interval","ViewSettings","StorageService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){a.loading=!1,a.initMasterLibrary=function(){}}]),angular.module("tcl").controller("MessageListCtrl",["$scope","$rootScope","Restangular","ngTreetableParams","$filter","$http","$modal","$timeout","CloneDeleteSvc",function(a,b,c,d,e,f,g,h,i){a.init=function(){},a.copy=function(a){i.copyMessage(a),b.$broadcast("event:SetToC")},a.close=function(){b.message=null,a.messagesParams&&a.messagesParams.refresh()},a["delete"]=function(a){i.deleteMessage(a),b.$broadcast("event:SetToC")},a.goToSegment=function(c){a.$emit("event:openSegment",b.segmentsMap[c])},a.goToDatatype=function(b){a.$emit("event:openDatatype",b)},a.goToTable=function(b){a.$emit("event:openTable",b)},a.hasChildren=function(a){return a&&null!=a?"group"===a.type?a.children&&a.children.length>0:"segmentRef"===a.type?b.segmentsMap[a.ref].fields&&b.segmentsMap[a.ref].fields.length>0:"field"===a.type||"component"===a.type?b.datatypesMap[a.datatype].components&&b.datatypesMap[a.datatype].components.length>0:!1:!1},a.isSub=function(b){return a.isSubDT(b)},a.isSubDT=function(a){return"component"===a.type&&b.parentsMap&&b.parentsMap[a.id]&&"component"===b.parentsMap[a.id].type},a.manageConformanceStatement=function(b,c){var d=g.open({templateUrl:"ConformanceStatementMessageCtrl.html",controller:"ConformanceStatementMessageCtrl",windowClass:"app-modal-window",resolve:{selectedMessage:function(){return c},selectedNode:function(){return b}}});d.result.then(function(b){a.selectedNode=b},function(){})},a.managePredicate=function(b,c){var d=g.open({templateUrl:"PredicateMessageCtrl.html",controller:"PredicateMessageCtrl",windowClass:"app-modal-window",resolve:{selectedMessage:function(){return c},selectedNode:function(){return b}}});d.result.then(function(b){a.selectedNode=b},function(){})},a.countPredicate=function(a){if(null!=b.message)for(var c=0,d=b.message.predicates.length;d>c;c++)if(0===b.message.predicates[c].constraintTarget.indexOf(a))return 1;return 0}}]),angular.module("tcl").controller("MessageRowCtrl",["$scope","$filter",function(a,b){a.formName="form_"+(new Date).getTime()}]),angular.module("tcl").controller("MessageViewCtrl",["$scope","$rootScope","Restangular",function(a,b,c){a.loading=!1,a.msg=null,a.messageData=[],a.setData=function(b){b&&("message"===b.type?angular.forEach(b.children,function(b){a.setData(b)}):"group"===b.type?(a.messageData.push({name:"-- "+b.name+" begin"}),b.children&&angular.forEach(b.children,function(b){a.setData(b)}),a.messageData.push({name:"-- "+b.name+" end"})):"segment"===b.type&&a.messageData.push+b)},a.init=function(b){a.loading=!0,a.msg=b,console.log(b.id),a.setData(a.msg),a.loading=!1}}]),angular.module("tcl").controller("PredicateMessageCtrl",["$scope","$modalInstance","selectedNode","selectedMessage","$rootScope",function(a,b,c,d,e){a.constraintType="Plain",a.selectedNode=c,a.selectedMessage=d,a.firstConstraint=null,a.secondConstraint=null,a.compositeType=null,a.complexConstraint=null,a.complexConstraintTrueUsage=null,a.complexConstraintFalseUsage=null,a.changed=!1,a.tempPredicates=[],angular.copy(a.selectedMessage.predicates,a.tempPredicates),a.setChanged=function(){a.changed=!0},a.initPredicate=function(){a.newConstraint=angular.fromJson({position_1:null,position_2:null,location_1:null,location_2:null,currentNode_1:null,currentNode_2:null,childNodes_1:[],childNodes_2:[],verb:null,contraintType:null,value:null,value2:null,trueUsage:null,falseUsage:null,valueSetId:null,bindingStrength:"R",bindingLocation:"1"});for(var b=0,c=a.selectedMessage.children.length;c>b;b++)if("group"===a.selectedMessage.children[b].type){var d={name:a.selectedMessage.children[b].name,position:a.selectedMessage.children[b].position,type:"group",node:a.selectedMessage.children[b]};a.newConstraint.childNodes_1.push(d),a.newConstraint.childNodes_2.push(d)}else if("segmentRef"===a.selectedMessage.children[b].type){var f={name:e.segmentsMap[a.selectedMessage.children[b].ref].name,position:a.selectedMessage.children[b].position,type:"segment",node:e.segmentsMap[a.selectedMessage.children[b].ref]};a.newConstraint.childNodes_1.push(f),a.newConstraint.childNodes_2.push(f)}},a.initComplexPredicate=function(){a.firstConstraint=null,a.secondConstraint=null,
a.compositeType=null,a.complexConstraintTrueUsage=null,a.complexConstraintFalseUsage=null},a.deletePredicate=function(b){a.tempPredicates.splice(a.tempPredicates.indexOf(b),1),a.changed=!0},a.deletePredicateByTarget=function(){for(var b=0,c=a.tempPredicates.length;c>b;b++)if(a.tempPredicates[b].constraintTarget===a.selectedNode.path)return a.deletePredicate(a.tempPredicates[b]),!0;return!1},a.updateLocation1=function(){if(a.newConstraint.location_1=a.newConstraint.currentNode_1.name,null!=a.newConstraint.position_1?a.newConstraint.position_1=a.newConstraint.position_1+"."+a.newConstraint.currentNode_1.position+"[1]":a.newConstraint.position_1=a.newConstraint.currentNode_1.position+"[1]",a.newConstraint.childNodes_1=[],"group"===a.newConstraint.currentNode_1.type){for(var b=0,c=a.newConstraint.currentNode_1.node.children.length;c>b;b++)if("group"===a.newConstraint.currentNode_1.node.children[b].type){var d={name:a.newConstraint.currentNode_1.node.children[b].name,position:a.newConstraint.currentNode_1.node.children[b].position,type:"group",node:a.newConstraint.currentNode_1.node.children[b]};a.newConstraint.childNodes_1.push(d)}else if("segmentRef"===a.newConstraint.currentNode_1.node.children[b].type){var f={name:a.newConstraint.location_1+"."+e.segmentsMap[a.newConstraint.currentNode_1.node.children[b].ref].name,position:a.newConstraint.currentNode_1.node.children[b].position,type:"segment",node:e.segmentsMap[a.newConstraint.currentNode_1.node.children[b].ref]};a.newConstraint.childNodes_1.push(f)}}else if("segment"===a.newConstraint.currentNode_1.type)for(var b=0,c=a.newConstraint.currentNode_1.node.fields.length;c>b;b++){var g={name:a.newConstraint.location_1+"-"+a.newConstraint.currentNode_1.node.fields[b].position,position:a.newConstraint.currentNode_1.node.fields[b].position,type:"field",node:e.datatypesMap[a.newConstraint.currentNode_1.node.fields[b].datatype]};a.newConstraint.childNodes_1.push(g)}else if("field"===a.newConstraint.currentNode_1.type)for(var b=0,c=a.newConstraint.currentNode_1.node.components.length;c>b;b++){var h={name:a.newConstraint.location_1+"."+a.newConstraint.currentNode_1.node.components[b].position,position:a.newConstraint.currentNode_1.node.components[b].position,type:"subComponent",node:e.datatypesMap[a.newConstraint.currentNode_1.node.components[b].datatype]};a.newConstraint.childNodes_1.push(h)}else if("subComponent"===a.newConstraint.currentNode_1.type)for(var b=0,c=a.newConstraint.currentNode_1.node.components.length;c>b;b++){var h={name:a.newConstraint.location_1+"."+a.newConstraint.currentNode_1.node.components[b].position,position:a.newConstraint.currentNode_1.node.components[b].position,type:"subComponent",node:null};a.newConstraint.childNodes_1.push(h)}a.newConstraint.currentNode_1=null},a.updateLocation2=function(){if(a.newConstraint.location_2=a.newConstraint.currentNode_2.name,null!=a.newConstraint.position_2?a.newConstraint.position_2=a.newConstraint.position_2+"."+a.newConstraint.currentNode_2.position+"[1]":a.newConstraint.position_2=a.newConstraint.currentNode_2.position+"[1]",a.newConstraint.childNodes_2=[],"group"===a.newConstraint.currentNode_2.type){for(var b=0,c=a.newConstraint.currentNode_2.node.children.length;c>b;b++)if("group"===a.newConstraint.currentNode_2.node.children[b].type){var d={name:a.newConstraint.currentNode_2.node.children[b].name,position:a.newConstraint.currentNode_2.node.children[b].position,type:"group",node:a.newConstraint.currentNode_2.node.children[b]};a.newConstraint.childNodes_2.push(d)}else if("segmentRef"===a.newConstraint.currentNode_2.node.children[b].type){var f={name:a.newConstraint.location_2+"."+e.segmentsMap[a.newConstraint.currentNode_2.node.children[b].ref].name,position:a.newConstraint.currentNode_2.node.children[b].position,type:"segment",node:e.segmentsMap[a.newConstraint.currentNode_2.node.children[b].ref]};a.newConstraint.childNodes_2.push(f)}}else if("segment"===a.newConstraint.currentNode_2.type)for(var b=0,c=a.newConstraint.currentNode_2.node.fields.length;c>b;b++){var g={name:a.newConstraint.location_2+"-"+a.newConstraint.currentNode_2.node.fields[b].position,position:a.newConstraint.currentNode_2.node.fields[b].position,type:"field",node:e.datatypesMap[a.newConstraint.currentNode_2.node.fields[b].datatype]};a.newConstraint.childNodes_2.push(g)}else if("field"===a.newConstraint.currentNode_2.type)for(var b=0,c=a.newConstraint.currentNode_2.node.components.length;c>b;b++){var h={name:a.newConstraint.location_2+"."+a.newConstraint.currentNode_2.node.components[b].position,position:a.newConstraint.currentNode_2.node.components[b].position,type:"subComponent",node:e.datatypesMap[a.newConstraint.currentNode_2.node.components[b].datatype]};a.newConstraint.childNodes_2.push(h)}else if("subComponent"===a.newConstraint.currentNode_2.type)for(var b=0,c=a.newConstraint.currentNode_2.node.components.length;c>b;b++){var h={name:a.newConstraint.location_2+"."+a.newConstraint.currentNode_2.node.components[b].position,position:a.newConstraint.currentNode_2.node.components[b].position,type:"subComponent",node:null};a.newConstraint.childNodes_2.push(h)}a.newConstraint.currentNode_2=null},a.addComplexPredicate=function(){a.complexConstraint=e.generateCompositePredicate(a.compositeType,a.firstConstraint,a.secondConstraint),a.complexConstraint.trueUsage=a.complexConstraintTrueUsage,a.complexConstraint.falseUsage=a.complexConstraintFalseUsage,a.complexConstraint.constraintId=a.newConstraint.datatype+"-"+a.selectedNode.position,a.tempPredicates.push(a.complexConstraint),a.initComplexPredicate(),a.changed=!0},a.addPredicate=function(){if(null!=a.newConstraint.position_1){e.newPredicateFakeId=e.newPredicateFakeId-1;var b=c.path,d=e.generatePredicate(b,a.newConstraint);a.tempPredicates.push(d),a.changed=!0}a.initPredicate()},a.ok=function(){b.close(a.selectedNode)},a.saveclose=function(){angular.copy(a.tempPredicates,a.selectedMessage.predicates),e.recordChanged(),b.close(a.selectedNode)},a.initPredicate()}]),angular.module("tcl").controller("ConformanceStatementMessageCtrl",["$scope","$modalInstance","selectedMessage","selectedNode","$rootScope",function(a,b,c,d,e){a.constraintType="Plain",a.selectedNode=d,a.selectedMessage=c,a.firstConstraint=null,a.secondConstraint=null,a.compositeType=null,a.complexConstraint=null,a.newComplexConstraintId=e.calNextCSID(),a.changed=!1,a.tempComformanceStatements=[],angular.copy(a.selectedMessage.conformanceStatements,a.tempComformanceStatements),a.setChanged=function(){a.changed=!0},a.initComplexStatement=function(){a.firstConstraint=null,a.secondConstraint=null,a.compositeType=null,a.newComplexConstraintId=e.calNextCSID()},a.initConformanceStatement=function(){a.newConstraint=angular.fromJson({position_1:null,position_2:null,location_1:null,location_2:null,currentNode_1:null,currentNode_2:null,childNodes_1:[],childNodes_2:[],verb:null,constraintId:e.calNextCSID(),contraintType:null,value:null,value2:null,valueSetId:null,bindingStrength:"R",bindingLocation:"1"});for(var b=0,c=a.selectedMessage.children.length;c>b;b++)if("group"===a.selectedMessage.children[b].type){var d={name:a.selectedMessage.children[b].name,position:a.selectedMessage.children[b].position,type:"group",node:a.selectedMessage.children[b]};a.newConstraint.childNodes_1.push(d),a.newConstraint.childNodes_2.push(d)}else if("segmentRef"===a.selectedMessage.children[b].type){var f={name:e.segmentsMap[a.selectedMessage.children[b].ref].name,position:a.selectedMessage.children[b].position,type:"segment",node:e.segmentsMap[a.selectedMessage.children[b].ref]};a.newConstraint.childNodes_1.push(f),a.newConstraint.childNodes_2.push(f)}},a.initConformanceStatement(),a.updateLocation1=function(){if(a.newConstraint.location_1=a.newConstraint.currentNode_1.name,null!=a.newConstraint.position_1?a.newConstraint.position_1=a.newConstraint.position_1+"."+a.newConstraint.currentNode_1.position+"[1]":a.newConstraint.position_1=a.newConstraint.currentNode_1.position+"[1]",a.newConstraint.childNodes_1=[],"group"===a.newConstraint.currentNode_1.type){for(var b=0,c=a.newConstraint.currentNode_1.node.children.length;c>b;b++)if("group"===a.newConstraint.currentNode_1.node.children[b].type){var d={name:a.newConstraint.currentNode_1.node.children[b].name,position:a.newConstraint.currentNode_1.node.children[b].position,type:"group",node:a.newConstraint.currentNode_1.node.children[b]};a.newConstraint.childNodes_1.push(d)}else if("segmentRef"===a.newConstraint.currentNode_1.node.children[b].type){var f={name:a.newConstraint.location_1+"."+e.segmentsMap[a.newConstraint.currentNode_1.node.children[b].ref].name,position:a.newConstraint.currentNode_1.node.children[b].position,type:"segment",node:e.segmentsMap[a.newConstraint.currentNode_1.node.children[b].ref]};a.newConstraint.childNodes_1.push(f)}}else if("segment"===a.newConstraint.currentNode_1.type)for(var b=0,c=a.newConstraint.currentNode_1.node.fields.length;c>b;b++){var g={name:a.newConstraint.location_1+"-"+a.newConstraint.currentNode_1.node.fields[b].position,position:a.newConstraint.currentNode_1.node.fields[b].position,type:"field",node:e.datatypesMap[a.newConstraint.currentNode_1.node.fields[b].datatype]};a.newConstraint.childNodes_1.push(g)}else if("field"===a.newConstraint.currentNode_1.type)for(var b=0,c=a.newConstraint.currentNode_1.node.components.length;c>b;b++){var h={name:a.newConstraint.location_1+"."+a.newConstraint.currentNode_1.node.components[b].position,position:a.newConstraint.currentNode_1.node.components[b].position,type:"component",node:e.datatypesMap[a.newConstraint.currentNode_1.node.components[b].datatype]};a.newConstraint.childNodes_1.push(h)}else if("component"===a.newConstraint.currentNode_1.type)for(var b=0,c=a.newConstraint.currentNode_1.node.components.length;c>b;b++){var h={name:a.newConstraint.location_1+"."+a.newConstraint.currentNode_1.node.components[b].position,position:a.newConstraint.currentNode_1.node.components[b].position,type:"subComponent",node:null};a.newConstraint.childNodes_1.push(h)}a.newConstraint.currentNode_1=null},a.updateLocation2=function(){if(a.newConstraint.location_2=a.newConstraint.currentNode_2.name,null!=a.newConstraint.position_2?a.newConstraint.position_2=a.newConstraint.position_2+"."+a.newConstraint.currentNode_2.position+"[1]":a.newConstraint.position_2=a.newConstraint.currentNode_2.position+"[1]",a.newConstraint.childNodes_2=[],"group"===a.newConstraint.currentNode_2.type){for(var b=0,c=a.newConstraint.currentNode_2.node.children.length;c>b;b++)if("group"===a.newConstraint.currentNode_2.node.children[b].type){var d={name:a.newConstraint.currentNode_2.node.children[b].name,position:a.newConstraint.currentNode_2.node.children[b].position,type:"group",node:a.newConstraint.currentNode_2.node.children[b]};a.newConstraint.childNodes_2.push(d)}else if("segmentRef"===a.newConstraint.currentNode_2.node.children[b].type){var f={name:a.newConstraint.location_2+"."+e.segmentsMap[a.newConstraint.currentNode_2.node.children[b].ref].name,position:a.newConstraint.currentNode_2.node.children[b].position,type:"segment",node:e.segmentsMap[a.newConstraint.currentNode_2.node.children[b].ref]};a.newConstraint.childNodes_2.push(f)}}else if("segment"===a.newConstraint.currentNode_2.type)for(var b=0,c=a.newConstraint.currentNode_2.node.fields.length;c>b;b++){var g={name:a.newConstraint.location_2+"-"+a.newConstraint.currentNode_2.node.fields[b].position,position:a.newConstraint.currentNode_2.node.fields[b].position,type:"field",node:e.datatypesMap[a.newConstraint.currentNode_2.node.fields[b].datatype]};a.newConstraint.childNodes_2.push(g)}else if("field"===a.newConstraint.currentNode_2.type)for(var b=0,c=a.newConstraint.currentNode_2.node.components.length;c>b;b++){var h={name:a.newConstraint.location_2+"."+a.newConstraint.currentNode_2.node.components[b].position,position:a.newConstraint.currentNode_2.node.components[b].position,type:"component",node:e.datatypesMap[a.newConstraint.currentNode_2.node.components[b].datatype]};a.newConstraint.childNodes_2.push(h)}else if("component"===a.newConstraint.currentNode_2.type)for(var b=0,c=a.newConstraint.currentNode_2.node.components.length;c>b;b++){var h={name:a.newConstraint.location_2+"."+a.newConstraint.currentNode_2.node.components[b].position,position:a.newConstraint.currentNode_2.node.components[b].position,type:"subComponent",node:null};a.newConstraint.childNodes_2.push(h)}a.newConstraint.currentNode_2=null},a.deleteConformanceStatement=function(b){a.tempComformanceStatements.splice(a.tempComformanceStatements.indexOf(b),1),a.changed=!0},a.addComplexConformanceStatement=function(){a.complexConstraint=e.generateCompositeConformanceStatement(a.compositeType,a.firstConstraint,a.secondConstraint),a.complexConstraint.constraintId=a.newComplexConstraintId,-1==e.conformanceStatementIdList.indexOf(a.complexConstraint.constraintId)&&e.conformanceStatementIdList.push(a.complexConstraint.constraintId),a.tempComformanceStatements.push(a.complexConstraint),a.initComplexStatement(),a.changed=!0},a.addConformanceStatement=function(){if(null!=a.newConstraint.position_1){e.newConformanceStatementFakeId=e.newConformanceStatementFakeId-1;var b=d.path,c=e.generateConformanceStatement(b,a.newConstraint);a.tempComformanceStatements.push(c),-1==e.conformanceStatementIdList.indexOf(c.constraintId)&&e.conformanceStatementIdList.push(c.constraintId),a.changed=!0}a.initConformanceStatement()},a.ok=function(){angular.forEach(a.tempComformanceStatements,function(a){e.conformanceStatementIdList.splice(e.conformanceStatementIdList.indexOf(a.constraintId),1)}),angular.forEach(a.selectedMessage.conformanceStatements,function(a){-1==e.conformanceStatementIdList.indexOf(a.constraintId)&&e.conformanceStatementIdList.push(a.constraintId)}),b.close(a.selectedNode)},a.saveclose=function(){angular.forEach(a.tempComformanceStatements,function(a){-1==e.conformanceStatementIdList.indexOf(a.constraintId)&&e.conformanceStatementIdList.push(a.constraintId)}),angular.copy(a.tempComformanceStatements,a.selectedMessage.conformanceStatements),e.recordChanged(),b.close(a.selectedNode)}}]),angular.module("tcl").controller("RegisterResetPasswordCtrl",["$scope","$resource","$modal","$routeParams","isFirstSetup",function(a,b,c,d,e){a.agreed=!1,a.displayForm=!0,a.isFirstSetup=e,angular.isDefined(d.username)||(a.displayForm=!1),""===d.username&&(a.displayForm=!1),angular.isDefined(d.token)||(a.displayForm=!1),""===d.token&&(a.displayForm=!1),angular.isDefined(d.userId)||(a.displayForm=!1),""===d.userId&&(a.displayForm=!1);var f=(b("api/sooa/accounts/register/:userId/passwordreset",{userId:"@userId",token:"@token"}),b("api/sooa/accounts/:id/passwordreset",{id:"@userId",token:"@token"}));a.user={},a.user.username=d.username,a.user.newUsername=d.username,a.user.userId=d.userId,a.user.token=d.token,a.changePassword=function(){if(a.agreed){var b=new f(a.user);b.$save(function(){a.user.password="",a.user.passwordConfirm=""})}}}]),angular.module("tcl").controller("RegistrationCtrl",["$scope","$resource","$modal","$location",function(a,b,c,d){a.account={},a.registered=!1,a.agreed=!1;var e=(b("api/sooa/usernames/:username",{username:"@username"}),b("api/sooa/emails/:email",{email:"@email"}),b("api/sooa/accounts/register"));a.registerAccount=function(){if(a.agreed){var b=new e;b.accountType="author",b.employer=a.account.employer,b.fullName=a.account.fullName,b.phone=a.account.phone,b.title=a.account.title,b.juridiction=a.account.juridiction,b.username=a.account.username,b.password=a.account.password,b.email=a.account.email,b.signedConfidentialityAgreement=!0,b.$save(function(){"userAdded"===b.text?(a.account={},a.registered=!0,d.path("/registrationSubmitted")):a.registered=!1},function(){a.registered=!1}),a.registered=!0}}}]),angular.module("tcl").controller("SegmentListCtrl",["$scope","$rootScope","Restangular","ngTreetableParams","CloneDeleteSvc","$filter","$http","$modal","$timeout","SegmentService",function(a,b,c,d,e,f,g,h,i,j){a.readonly=!1,a.saved=!1,a.message=!1,a.segmentCopy=null,a.reset=function(){},a.close=function(){b.segment=null,a.refreshTree(),a.loadingSelection=!1},a.copy=function(a){e.copySegment(a)},a["delete"]=function(a){e.deleteSegment(a),b.$broadcast("event:SetToC")},a.hasChildren=function(a){return a&&null!=a&&(a.fields&&a.fields.length>0||a.datatype&&b.getDatatype(a.datatype)&&b.getDatatype(a.datatype).components&&b.getDatatype(a.datatype).components.length>0)},a.validateLabel=function(a,b){return!a||a.startsWith(b)},a.onDatatypeChange=function(c){b.recordChangeForEdit2("field","edit",c.id,"datatype",c.datatype),a.refreshTree()},a.refreshTree=function(){a.segmentsParams&&a.segmentsParams.refresh()},a.goToTable=function(b){a.$emit("event:openTable",b)},a.goToDatatype=function(b){a.$emit("event:openDatatype",b)},a.deleteTable=function(a){a.table=null,b.recordChangeForEdit2("field","edit",a.id,"table",null)},a.mapTable=function(b){var c=h.open({templateUrl:"TableMappingSegmentCtrl.html",controller:"TableMappingSegmentCtrl",windowClass:"app-modal-window",resolve:{selectedNode:function(){return b}}});c.result.then(function(b){a.selectedNode=b},function(){})},a.findDTByComponentId=function(a){return b.parentsMap&&b.parentsMap[a]?b.parentsMap[a]:null},a.isSub=function(b){return a.isSubDT(b)},a.isSubDT=function(a){return"component"===a.type&&b.parentsMap&&b.parentsMap[a.id]&&"component"===b.parentsMap[a.id].type},a.managePredicate=function(b){var c=h.open({templateUrl:"PredicateSegmentCtrl.html",controller:"PredicateSegmentCtrl",windowClass:"app-modal-window",resolve:{selectedNode:function(){return b}}});c.result.then(function(b){a.selectedNode=b},function(){})},a.manageConformanceStatement=function(b){var c=h.open({templateUrl:"ConformanceStatementSegmentCtrl.html",controller:"ConformanceStatementSegmentCtrl",windowClass:"app-modal-window",resolve:{selectedNode:function(){return b}}});c.result.then(function(b){a.selectedNode=b},function(){})},a.show=function(a){return!0},a.countConformanceStatements=function(a){var c=0;if(null!=b.segment)for(var d=0,e=b.segment.conformanceStatements.length;e>d;d++)0===b.segment.conformanceStatements[d].constraintTarget.indexOf(a+"[")&&(c+=1);return c},a.countPredicate=function(a){if(null!=b.segment)for(var c=0,d=b.segment.predicates.length;d>c;c++)if(0===b.segment.predicates[c].constraintTarget.indexOf(a+"["))return 1;return 0},a.countPredicateOnComponent=function(b,c){var d=a.findDTByComponentId(c);if(null!=d)for(var e=0,f=d.predicates.length;f>e;e++)if(0===d.predicates[e].constraintTarget.indexOf(b+"["))return 1;return 0},a.isRelevant=function(a){return j.isRelevant(a)},a.isBranch=function(a){j.isBranch(a)},a.isVisible=function(a){return j.isVisible(a)},a.children=function(a){return j.getNodes(a)},a.getParent=function(a){return j.getParent(a)},a.getSegmentLevelConfStatements=function(a){return j.getSegmentLevelConfStatements(a)},a.getSegmentLevelPredicates=function(a){return j.getSegmentLevelPredicates(a)}}]),angular.module("tcl").controller("SegmentRowCtrl",["$scope","$filter",function(a,b){a.formName="form_"+(new Date).getTime()}]),angular.module("tcl").controller("TableMappingSegmentCtrl",["$scope","$modalInstance","selectedNode","$rootScope",function(a,b,c,d){a.changed=!1,a.selectedNode=c,a.selectedTable=null,void 0!=c.table&&(a.selectedTable=d.tablesMap[c.table]),a.selectTable=function(b){a.selectedTable=b,a.changed=!0},a.mappingTable=function(){a.selectedNode.table=a.selectedTable.id,d.recordChangeForEdit2("field","edit",a.selectedNode.id,"table",a.selectedNode.table),a.ok()},a.ok=function(){b.close(a.selectedNode)}}]),angular.module("tcl").controller("PredicateSegmentCtrl",["$scope","$modalInstance","selectedNode","$rootScope",function(a,b,c,d){a.constraintType="Plain",a.selectedNode=c,a.firstConstraint=null,a.secondConstraint=null,a.compositeType=null,a.complexConstraint=null,a.complexConstraintTrueUsage=null,a.complexConstraintFalseUsage=null,a.changed=!1,a.tempPredicates=[],angular.copy(d.segment.predicates,a.tempPredicates),a.setChanged=function(){a.changed=!0},a.initPredicate=function(){a.newConstraint=angular.fromJson({position_1:null,position_2:null,location_1:null,location_2:null,segment:"",field_1:null,component_1:null,subComponent_1:null,field_2:null,component_2:null,subComponent_2:null,verb:null,contraintType:null,value:null,value2:null,trueUsage:null,falseUsage:null,valueSetId:null,bindingStrength:"R",bindingLocation:"1"}),a.newConstraint.segment=d.segment.name},a.initComplexPredicate=function(){a.firstConstraint=null,a.secondConstraint=null,a.compositeType=null,a.complexConstraintTrueUsage=null,a.complexConstraintFalseUsage=null},a.initPredicate(),a.deletePredicate=function(b){a.tempPredicates.splice(a.tempPredicates.indexOf(b),1),a.changed=!0},a.updateField_1=function(){a.newConstraint.component_1=null,a.newConstraint.subComponent_1=null},a.updateComponent_1=function(){a.newConstraint.subComponent_1=null},a.updateField_2=function(){a.newConstraint.component_2=null,a.newConstraint.subComponent_2=null},a.updateComponent_2=function(){a.newConstraint.subComponent_2=null},a.deletePredicateByTarget=function(){for(var b=0,c=a.tempPredicates.length;c>b;b++)if(0===a.tempPredicates[b].constraintTarget.indexOf(a.selectedNode.position+"["))return a.deletePredicate(a.tempPredicates[b]),!0;return!1},a.addComplexPredicate=function(){a.complexConstraint=d.generateCompositePredicate(a.compositeType,a.firstConstraint,a.secondConstraint),a.complexConstraint.trueUsage=a.complexConstraintTrueUsage,a.complexConstraint.falseUsage=a.complexConstraintFalseUsage,null===a.selectedNode?a.complexConstraint.constraintId=".":a.complexConstraint.constraintId=a.newConstraint.segment+"-"+a.selectedNode.position,a.tempPredicates.push(a.complexConstraint),a.initComplexPredicate(),a.changed=!0},a.addPredicate=function(){if(d.newPredicateFakeId=d.newPredicateFakeId-1,a.newConstraint.position_1=a.genPosition(a.newConstraint.field_1,a.newConstraint.component_1,a.newConstraint.subComponent_1),a.newConstraint.position_2=a.genPosition(a.newConstraint.field_2,a.newConstraint.component_2,a.newConstraint.subComponent_2),a.newConstraint.location_1=a.genLocation(a.newConstraint.segment,a.newConstraint.field_1,a.newConstraint.component_1,a.newConstraint.subComponent_1),a.newConstraint.location_2=a.genLocation(a.newConstraint.segment,a.newConstraint.field_2,a.newConstraint.component_2,a.newConstraint.subComponent_2),null!=a.newConstraint.position_1){var b=null;if(null===a.selectedNode)var b=d.generatePredicate(".",a.newConstraint);else var b=d.generatePredicate(a.selectedNode.position+"[1]",a.newConstraint);a.tempPredicates.push(b),a.changed=!0}a.initPredicate()},a.genLocation=function(a,b,c,d){var e=null;return null!=b&&null==c&&null==d?e=a+"-"+b.position+"("+b.name+")":null!=b&&null!=c&&null==d?e=a+"-"+b.position+"."+c.position+"("+c.name+")":null!=b&&null!=c&&null!=d&&(e=a+"-"+b.position+"."+c.position+"."+d.position+"("+d.name+")"),e},a.genPosition=function(a,b,c){var d=null;return null!=a&&null==b&&null==c?d=a.position+"[1]":null!=a&&null!=b&&null==c?d=a.position+"[1]."+b.position+"[1]":null!=a&&null!=b&&null!=c&&(d=a.position+"[1]."+b.position+"[1]."+c.position+"[1]"),d},a.ok=function(){b.close(a.selectedNode)},a.saveclose=function(){angular.copy(a.tempPredicates,d.segment.predicates),d.recordChanged(),b.close(a.selectedNode)}}]),angular.module("tcl").controller("ConformanceStatementSegmentCtrl",["$scope","$modalInstance","selectedNode","$rootScope",function(a,b,c,d){a.constraintType="Plain",a.selectedNode=c,a.firstConstraint=null,a.secondConstraint=null,a.compositeType=null,a.complexConstraint=null,a.newComplexConstraintId=d.calNextCSID(),a.newComplexConstraint=[],a.changed=!1,a.tempComformanceStatements=[],angular.copy(d.segment.conformanceStatements,a.tempComformanceStatements),a.setChanged=function(){a.changed=!0},a.initConformanceStatement=function(){a.newConstraint=angular.fromJson({position_1:null,position_2:null,location_1:null,location_2:null,segment:"",field_1:null,component_1:null,subComponent_1:null,field_2:null,component_2:null,subComponent_2:null,verb:null,constraintId:d.calNextCSID(),contraintType:null,value:null,value2:null,valueSetId:null,bindingStrength:"R",bindingLocation:"1"}),a.newConstraint.segment=d.segment.name},a.initComplexStatement=function(){a.firstConstraint=null,a.secondConstraint=null,a.compositeType=null,a.newComplexConstraintId=d.calNextCSID()},a.initConformanceStatement(),a.deleteConformanceStatement=function(b){a.tempComformanceStatements.splice(a.tempComformanceStatements.indexOf(b),1),a.changed=!0},a.updateField_1=function(){a.newConstraint.component_1=null,a.newConstraint.subComponent_1=null},a.updateComponent_1=function(){a.newConstraint.subComponent_1=null},a.updateField_2=function(){a.newConstraint.component_2=null,a.newConstraint.subComponent_2=null},a.updateComponent_2=function(){a.newConstraint.subComponent_2=null},a.genLocation=function(a,b,c,d){var e=null;return null!=b&&null==c&&null==d?e=a+"-"+b.position+"("+b.name+")":null!=b&&null!=c&&null==d?e=a+"-"+b.position+"."+c.position+"("+c.name+")":null!=b&&null!=c&&null!=d&&(e=a+"-"+b.position+"."+c.position+"."+d.position+"("+d.name+")"),e},a.genPosition=function(a,b,c){var d=null;return null!=a&&null==b&&null==c?d=a.position+"[1]":null!=a&&null!=b&&null==c?d=a.position+"[1]."+b.position+"[1]":null!=a&&null!=b&&null!=c&&(d=a.position+"[1]."+b.position+"[1]."+c.position+"[1]"),d},a.addComplexConformanceStatement=function(){a.complexConstraint=d.generateCompositeConformanceStatement(a.compositeType,a.firstConstraint,a.secondConstraint),a.complexConstraint.constraintId=a.newComplexConstraintId,-1==d.conformanceStatementIdList.indexOf(a.complexConstraint.constraintId)&&d.conformanceStatementIdList.push(a.complexConstraint.constraintId),a.tempComformanceStatements.push(a.complexConstraint),a.initComplexStatement(),a.changed=!0},a.addConformanceStatement=function(){if(a.newConstraint.position_1=a.genPosition(a.newConstraint.field_1,a.newConstraint.component_1,a.newConstraint.subComponent_1),a.newConstraint.position_2=a.genPosition(a.newConstraint.field_2,a.newConstraint.component_2,a.newConstraint.subComponent_2),a.newConstraint.location_1=a.genLocation(a.newConstraint.segment,a.newConstraint.field_1,a.newConstraint.component_1,a.newConstraint.subComponent_1),a.newConstraint.location_2=a.genLocation(a.newConstraint.segment,a.newConstraint.field_2,a.newConstraint.component_2,a.newConstraint.subComponent_2),null!=a.newConstraint.position_1){if(d.newConformanceStatementFakeId=d.newConformanceStatementFakeId-1,null===a.selectedNode)var b=d.generateConformanceStatement(".",a.newConstraint);else var b=d.generateConformanceStatement(a.selectedNode.position+"[1]",a.newConstraint);a.tempComformanceStatements.push(b),-1==d.conformanceStatementIdList.indexOf(b.constraintId)&&d.conformanceStatementIdList.push(b.constraintId),a.changed=!0}a.initConformanceStatement()},a.ok=function(){angular.forEach(a.tempComformanceStatements,function(a){d.conformanceStatementIdList.splice(d.conformanceStatementIdList.indexOf(a.constraintId),1)}),angular.forEach(d.segment.conformanceStatements,function(a){-1==d.conformanceStatementIdList.indexOf(a.constraintId)&&d.conformanceStatementIdList.push(a.constraintId)}),b.close(a.selectedNode)},a.saveclose=function(){angular.forEach(a.tempComformanceStatements,function(a){-1==d.conformanceStatementIdList.indexOf(a.constraintId)&&d.conformanceStatementIdList.push(a.constraintId)}),angular.copy(a.tempComformanceStatements,d.segment.conformanceStatements),d.recordChanged(),b.close(a.selectedNode)}}]),angular.module("tcl").controller("ConfirmSegmentDeleteCtrl",["$scope","$modalInstance","segToDelete","$rootScope",function(a,b,c,d){a.segToDelete=c,a.loading=!1,a["delete"]=function(){a.loading=!0;var c=_.findIndex(d.igdocument.profile.segments.children,function(b){return b.id===a.segToDelete.id});c>-1&&d.igdocument.profile.segments.children.splice(c,1);var c=_.findIndex(d.segments,function(b){return b.id===a.segToDelete.id});c>-1&&d.segments.splice(c,1),d.segment===a.segToDelete&&(d.segment=null),d.segmentsMap[a.segToDelete.id]=null,d.references=[],a.segToDelete.id<0||d.recordDelete("segment","edit",a.segToDelete.id),d.msg().text="segDeleteSuccess",d.msg().type="success",d.msg().show=!0,d.manualHandle=!0,d.$broadcast("event:SetToC"),b.close(a.segToDelete)},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("tcl").controller("SegmentReferencesCtrl",["$scope","$modalInstance","segToDelete",function(a,b,c){a.segToDelete=c,a.ok=function(){b.close(a.segToDelete)},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("tcl").controller("TableListCtrl",["$scope","$rootScope","Restangular","$filter","$http","$modal","$timeout","CloneDeleteSvc",function(a,b,c,d,e,f,g,h){a.readonly=!1,a.codeSysEditMode=!1,a.codeSysForm={},a.saved=!1,a.message=!1,a.params=null,a.init=function(){b.$on("event:cloneTableFlavor",function(b,c){a.copyTable(c)})},a.addTable=function(){b.newTableFakeId=b.newTableFakeId-1;var a=angular.fromJson({id:(new ObjectId).toString(),type:"table",bindingIdentifier:"",name:"",version:"",oid:"",tableType:"",stability:"",extensibility:"",codes:[]});b.tables.push(a),b.tablesMap[a.id]=a,b.table=a,b.recordChangeForEdit2("table","add",a.id,"table",a)},a.makeCodeSystemEditable=function(){a.codeSysEditMode=!0},a.addCodeSystem=function(){b.codeSystems.indexOf(a.codeSysForm.str)<0&&a.codeSysForm.str&&""!==a.codeSysForm.str&&b.codeSystems.push(a.codeSysForm.str),a.codeSysForm.str="",a.codeSysEditMode=!1},a.delCodeSystem=function(a){b.codeSystems.splice(b.codeSystems.indexOf(a),1)},a.updateCodeSystem=function(c,d){for(var e=0;e<b.table.codes.length;e++)b.table.codes[e].codeSystem=d,a.recordChangeValue(b.table.codes[e],"codeSystem",b.table.codes[e].codeSystem,c.id)},a.addValue=function(){b.newValueFakeId=b.newValueFakeId?b.newValueFakeId-1:-1;var c={id:(new ObjectId).toString(),type:"value",value:"",label:"",codeSystem:null,codeUsage:"R"};b.table.codes.unshift(c);var d={targetType:"table",targetId:b.table.id,obj:c};a.isNewObject("table","add",b.table.id)||b.recordChangeForEdit2("value","add",null,"value",d)},a.deleteValue=function(c){a.isNewValueThenDelete(c.id)||b.recordChangeForEdit2("value","delete",c.id,"id",c.id),b.table.codes.splice(b.table.codes.indexOf(c),1)},a.isNewValueThenDelete=function(a){if(b.isNewObject("value","add",a)){if(void 0!==b.changes.value&&void 0!==b.changes.value.add)for(var c=0;c<b.changes.value.add.length;c++){var d=b.changes.value.add[c];if(d.obj.id===a)return b.changes.value.add.splice(c,1),b.changes.value.add&&0===b.changes.value.add.length&&delete b.changes.value.add,b.changes.value&&0===Object.getOwnPropertyNames(b.changes.value).length&&delete b.changes.value,!0}return!0}if(void 0!==b.changes.value&&void 0!==b.changes.value.edit){for(var c=0;c<b.changes.value.edit.length;c++){var d=b.changes.value.edit[c];if(d.id===a)return b.changes.value.edit.splice(c,1),b.changes.value.edit&&0===b.changes.value.edit.length&&delete b.changes.value.edit,b.changes.value&&0===Object.getOwnPropertyNames(b.changes.value).length&&delete b.changes.value,!1}return!1}return!1},a.isNewValue=function(b){return a.isNewObject("value","add",b)},a.isNewTable=function(b){return a.isNewObject("table","add",b)},a.close=function(){b.table=null},a.copyTable=function(a){h.copyTable(a),b.$broadcast("event:SetToC")},a.recordChangeValue=function(c,d,e){a.isNewTable(e)||a.isNewValue(c.id)||b.recordChangeForEdit2("value","edit",c.id,d,c)},a.recordChangeTable=function(c,d,e){a.isNewTable(c.id)||b.recordChangeForEdit2("table","edit",c.id,d,e)},a.setAllCodeUsage=function(c,d){for(var e=0,f=c.codes.length;f>e;e++)c.codes[e].codeUsage!==d&&(c.codes[e].codeUsage=d,a.isNewTable(c.id)||a.isNewValue(c.codes[e].id)||b.recordChangeForEdit2("value","edit",c.codes[e].id,"codeUsage",d))},a["delete"]=function(a){h.deleteValueSet(a)}}]),angular.module("tcl").controller("TableModalCtrl",["$scope",function(a){a.showModal=!1,a.toggleModal=function(){a.showModal=!a.showModal;
}}]),angular.module("tcl").controller("ConfirmValueSetDeleteCtrl",["$scope","$modalInstance","tableToDelete","$rootScope",function(a,b,c,d){a.tableToDelete=c,a.loading=!1,a["delete"]=function(){a.loading=!0,!a.isNewTableThenDelete(c.id);var e=d.tables.indexOf(c);d.tables.splice(e,1);var e=d.igdocument.profile.tables.children.indexOf(a.tableToDelete);e>-1&&d.igdocument.profile.tables.children.splice(e,1),d.tablesMap[c.id]=void 0,d.generalInfo.type="info",d.generalInfo.message="Table "+a.tableToDelete.bindingIdentifier+" deleted successfully",d.table===a.tableToDelete&&(d.table=null),d.references=[],d.$broadcast("event:SetToC"),b.close(a.tableToDelete)},a.cancel=function(){b.dismiss("cancel")},a.isNewTableThenDelete=function(a){if(d.isNewObject("table","add",a)){if(void 0!==d.changes.table&&void 0!==d.changes.table.add)for(var b=0;b<d.changes.table.add.length;b++){var c=d.changes.table.add[b];if(c.id==a)return d.changes.table.add.splice(b,1),d.changes.table.add&&0===d.changes.table.add.length&&delete d.changes.table.add,d.changes.table&&0===Object.getOwnPropertyNames(d.changes.table).length&&delete d.changes.table,!0}return!0}if(void 0!==d.changes.table&&void 0!==d.changes.table.edit){for(var b=0;b<d.changes.table.edit.length;b++){var c=d.changes.table.edit[b];if(c.id===a)return d.changes.table.edit.splice(b,1),d.changes.table.edit&&0===d.changes.table.edit.length&&delete d.changes.table.edit,d.changes.table&&0===Object.getOwnPropertyNames(d.changes.table).length&&delete d.changes.table,!1}return!1}return!1}}]),angular.module("tcl").controller("ValueSetReferencesCtrl",["$scope","$modalInstance","tableToDelete",function(a,b,c){a.tableToDelete=c,a.ok=function(){b.close(a.tableToDelete)},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("tcl").controller("TestPlanCtrl",["$scope","$rootScope","$templateCache","Restangular","$http","$filter","$modal","$cookies","$timeout","userInfoService","ToCSvc","ContextMenuSvc","ProfileAccessSvc","ngTreetableParams","$interval","ViewSettings","StorageService","$q","notifications","DatatypeService","SegmentService","IgDocumentService","ElementUtils","AutoSaveService",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x){a.loading=!1,b.tps=[],a.accordi={metaData:!1,definition:!0,igList:!0,igDetails:!1},a.loadTestPlans=function(){var c=r.defer();return a.error=null,b.tps=[],j.isAuthenticated()&&!j.isPending()?(waitingDialog.show("Loading TestPlans...",{dialogSize:"xs",progressType:"info"}),a.loading=!0,e.get("api/testplans").then(function(d){waitingDialog.hide(),b.tps=angular.fromJson(d.data),a.loading=!1,c.resolve(!0)},function(b){a.loading=!1,a.error=b.data,waitingDialog.hide(),c.reject(!1)})):c.reject(!1),c.promise},a.initTestPlans=function(){a.loadTestPlans(),a.getScrollbarWidth()},a.confirmDeleteTestPlan=function(c){var d=g.open({templateUrl:"ConfirmTestPlanDeleteCtrl.html",controller:"ConfirmTestPlanDeleteCtrl",resolve:{testplanToDelete:function(){return c}}});d.result.then(function(c){a.testplanToDelete=c;var d=_.findIndex(b.tps,function(a){return a.id===c.id});b.tps.splice(d,1)})},a.createNewTestPlan=function(){var c={id:(new ObjectId).toString(),name:"New TestPlan",accountId:j.getAccountID()},d=angular.toJson([]),f=angular.fromJson({changes:d,tp:c});e.post("api/testplans/save",f).then(function(a){var d=angular.fromJson(a.data);c.lastUpdateDate=d.date,b.saved=!0},function(a){b.saved=!1}),b.tps.push(c),a.selectTestPlan(c)},a.selectTestPlan=function(c){null!=c&&(waitingDialog.show("Opening Test Plan...",{dialogSize:"xs",progressType:"info"}),a.selectIgTab(1),b.testplans=[],b.testplans.push(c),i(function(){b.selectedTestPlan=c,a.editTestPlan(),waitingDialog.hide()},100))},a.editTestPlan=function(){a.subview="EditTestPlanMetadata.html",i(function(){},100)},a.selectTestCaseGroup=function(c){null!=c&&(waitingDialog.show("Opening Test Case Group...",{dialogSize:"xs",progressType:"info"}),i(function(){b.selectedTestCaseGroup=c,a.editTestCaseGroup(),waitingDialog.hide()},100))},a.editTestCaseGroup=function(){a.subview="EditTestCaseGroupMetadata.html",i(function(){},100)},a.selectTestCase=function(c){null!=c&&(waitingDialog.show("Opening Test Case ...",{dialogSize:"xs",progressType:"info"}),i(function(){b.selectedTestCase=c,a.editTestCase(),waitingDialog.hide()},100))},a.editTestCase=function(){a.subview="EditTestCaseMetadata.html",i(function(){},100)},a.selectTestStep=function(c){null!=c&&(waitingDialog.show("Opening Test Step ...",{dialogSize:"xs",progressType:"info"}),i(function(){b.selectedTestStep=c,a.editTestStep(),waitingDialog.hide()},100))},a.editTestStep=function(){a.subview="EditTestStepMetadata.html",i(function(){},100)},a.selectIgTab=function(b){1===b?(a.accordi.igList=!1,a.accordi.igDetails=!0):(a.accordi.igList=!0,a.accordi.igDetails=!1)},a.recordChanged=function(){b.isChanged=!0,b.selectedTestPlan.isChanged=!0},a.saveAllChangedTestPlans=function(){b.tps.forEach(function(a){if(a.isChanged){var c=angular.toJson([]),d=angular.fromJson({changes:c,tp:a});e.post("api/testplans/save",d).then(function(c){var d=angular.fromJson(c.data);a.lastUpdateDate=d.date,b.saved=!0,a.isChanged=!1},function(a){b.saved=!1})}}),b.isChanged=!1},a.activeModel={},a.treeOptions={accept:function(a,b,c){b.expand();var d=a.$element.attr("data-type"),e=b.$element.attr("data-type");return console.log("source: "+d+"    target: "+e),"root"===d?!1:"testcasegroup"===d?"root"===e||"testcasegroups"===e:"testcase"===d?"testcases"===e||"grouptestcases"===e:"teststep"===d?"teststeps"===e:!1},dropped:function(b){var c=(b.source.nodeScope,b.dest.nodesScope),d=(b.source.index,b.dest.index);c.$element.attr("data-type");b.source.nodeScope.$modelValue.position=d+1,a.updatePositions(b.dest.nodesScope.$modelValue),a.updatePositions(b.source.nodesScope.$modelValue);for(var e=a.testplans.length-1;e>=0;e--)for(var f=a.testplans[e].testcases.length-1;f>=0;f--)a.testplans[e].testcases[f].position=f+1+a.testplans[e].testcasegroups.length}},a.updatePositions=function(a){for(var b=a.length-1;b>=0;b--)a[b].position=b+1},a.Activate=function(b){a.activeModel=b.$modelValue,console.log(b.$modelValue.$$hashKey)},a.ActivateId=function(b){a.activeModel=b,console.log(itemScope.$modelValue.$$hashKey)},a.testPlanOptions=[["add new testGroup",function(b){b.$nodeScope.$modelValue.testcasegroups.push({name:"testGroupAdded",position:b.$nodeScope.$modelValue.testcasegroups.length+1,testcases:[]}),a.activeModel=b.$nodeScope.$modelValue.testcasegroups[b.$nodeScope.$modelValue.testcasegroups.length-1]}],null,["Add new testCase",function(b){b.$nodeScope.$modelValue.testcases.push({name:"TestCaseAdded",position:b.$nodeScope.$modelValue.testcases.length+1+b.$nodeScope.$modelValue.testcasegroups.length,teststeps:[]}),a.activeModel=b.$nodeScope.$modelValue.testcases[b.$nodeScope.$modelValue.testcases.length-1]}]],a.testGroupOptions=[["add new testCase",function(b){b.$nodeScope.$modelValue.testcases.push({name:"testCaseAdded",position:b.$nodeScope.$modelValue.testcases.length+1,teststeps:[]}),a.activeModel=b.$nodeScope.$modelValue.testcases[b.$nodeScope.$modelValue.testcases.length-1]}],null,["clone",function(a){var b={},c=a.$nodeScope.$modelValue.name;c+="(copy)",b.name=c,b.position=a.$nodeScope.$parentNodesScope.$modelValue.length+1,a.$nodeScope.$parentNodesScope.$modelValue.push(b)}],null,["delete",function(b){b.$nodeScope.remove(),a.updatePositions(b.$nodeScope.$parentNodesScope.$modelValue)}]],a.testCaseOptions=[["add new teststep",function(b){b.$nodeScope.$modelValue.teststeps.push({name:"testStepAdded",position:b.$nodeScope.$modelValue.teststeps.length+1}),a.activeModel=b.$nodeScope.$modelValue.teststeps[b.$nodeScope.$modelValue.teststeps.length-1]}],null,["clone",function(b){var c={},d=b.$nodeScope.$modelValue.name;d+="(copy)",c.name=d,c.teststeps=b.$nodeScope.$modelValue.teststeps,c.position=b.$nodeScope.$parentNodesScope.$modelValue.length+1,b.$nodeScope.$parentNodesScope.$modelValue.push(c),a.Activate(b)}],null,["delete",function(b){b.$nodeScope.remove(),a.updatePositions(b.$nodeScope.$parentNodesScope.$modelValue)}]],a.testStepOptions=[["clone",function(b){var c={},d=b.$nodeScope.$modelValue.name;d+="(copy)",c.name=d,c.position=b.$nodeScope.$parentNodesScope.$modelValue.length+1,b.$nodeScope.$parentNodesScope.$modelValue.push(c),a.activeModel=b.$nodeScope.$parentNodesScope.$modelValue[b.$nodeScope.$parentNodesScope.$modelValue.length-1]}],null,["delete",function(b){b.$nodeScope.remove(),a.updatePositions(b.$nodeScope.$parentNodesScope.$modelValue)}]]}]),angular.module("tcl").controller("ConfirmTestPlanDeleteCtrl",["$scope","$modalInstance","testplanToDelete","$rootScope","$http",function(a,b,c,d,e){a.testplanToDelete=c,a.loading=!1,a.deleteTestPlan=function(){a.loading=!0,e.post(d.api("api/testplans/"+a.testplanToDelete.id+"/delete")).then(function(c){d.msg().text="testplanDeleteSuccess",d.msg().type="success",d.msg().show=!0,d.manualHandle=!0,a.loading=!1,b.close(a.testplanToDelete)},function(c){a.error=c,a.loading=!1,b.dismiss("cancel"),d.msg().text="testplanDeleteFailed",d.msg().type="danger",d.msg().show=!0})},a.cancel=function(){b.dismiss("cancel")}}]);